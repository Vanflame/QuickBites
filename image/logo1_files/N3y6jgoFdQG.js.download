;/*FB_PKG_DELIM*/

__d("FDSCheckmarkCircleFilled24Icon",["cr:13826"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:13826")}),98);
__d("FDSCheckmarkCircleFilled24PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("498147"),24);b=a;g["default"]=b}),98);
__d("FDSRefreshRightFilled24Icon",["cr:15578"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:15578")}),98);
__d("FDSRefreshRightFilled24PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("600425"),24);b=a;g["default"]=b}),98);
__d("MAWEncryptedBackupsInitializeBackupDeferred",["EBSMAPI","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.onBackupCreationSuccess,e=a.onFailure,f=a.onStart,g=a.qplEventName,h=g===void 0?d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent:g,i=a.instanceKey;f==null?void 0:f();c("QPLUserFlow").addPoint(h,"SETUP_INITIALIZE_BACKUP_SPROC_START",{instanceKey:i});c("promiseDone")(c("EBSMAPI").initializeBackup({instanceKey:i}),function(a){a.success?(c("QPLUserFlow").addPoint(h,"SETUP_INITIALIZE_BACKUP_SPROC_END",{instanceKey:i}),c("QPLUserFlow").addPoint(h,"SETUP_INITIALIZE_BACKUP_END",{instanceKey:i}),b==null?void 0:b()):(c("QPLUserFlow").markError(h,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE",{instanceKey:i}),e())},function(){c("QPLUserFlow").markError(h,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE",{instanceKey:i}),e()})}g.initializeBackupDeferred=a}),98);
__d("MWEBConnections4AndroidIcon.react",["ix","CometImageFromIXValue.react","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("gkx")("23433");function a(a){var b=d("react-compiler-runtime").c(6),e=a.alt,f=a.ref,g=a.size;a=a.xstyle;g=g===void 0?"large":g;var i;b[0]!==g?(i=g==="large"?k?h("398892"):h("398891"):h("398080"),b[0]=g,b[1]=i):i=b[1];g=i;b[2]!==e||b[3]!==g||b[4]!==a?(i=j.jsx(c("CometImageFromIXValue.react"),{alt:e,ref:f,source:g,xstyle:a}),b[2]=e,b[3]=g,b[4]=a,b[5]=i):i=b[5];return i}g["default"]=a}),98);
__d("MWEBOnboardingDismissOnboardingUpsellsInRelay",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.upsellsToDismiss;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][onboarding] A viewer record does not exist when dismissing softblocks.");return}switch(e){case"softblocks":a.setValue(!0,"is_eb_onboarding_softblocks_dismissed");break;case"all":a.setValue(!0,"is_eb_onboarding_upsells_dismissed");break}})}g.dismissOnboardingUpsellsInRelayStore=a}),98);
__d("useCreateEncryptedBackup",["CometRelay","FBLogger","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWCurrentUser","MAWEncryptedBackupsInitializeBackupDeferred","MAWTraceUtils","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsCreateExtraVirtualDeviceDeferred","MWEncryptedBackupsGenerateRecoveryCode","MWEncryptedBackupsLocalStorageEntryEnum","QPLUserFlow","VestaBackupSecretRegister","cr:17321","gkx","promiseDone","requireDeferred","useLabyrinthLogging","useMWEBFlowSourceContext","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("useCreateEncryptedBackup"),k=c("requireDeferred")("VestaDeleteAccount").__setRef("useCreateEncryptedBackup");function a(a){var e=a.backupExists,f=a.onInit,g=a.onLabyrinthError,l=a.onSuccess,m=a.onVestaError,n=(i||(i=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var o=a.startFlow,p=c("useMWEBFlowSourceContext")(),q=d("CometRelay").useRelayEnvironment(),r=async function(a,b,e){try{d("MAWTraceUtils").recordCheckpointForTrace(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_INITIALIZE_BACKUP),[],!1);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_START");await new Promise(function(b,c){return d("MAWEncryptedBackupsInitializeBackupDeferred").initializeBackupDeferred({db:n,instanceKey:e,onBackupCreationSuccess:function(){return b()},onFailure:function(){return c()},qplEventName:a})});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_END");c("QPLUserFlow").addPoint(a,"success_backup_initialization",{instanceKey:e});return!0}catch(f){d("MAWTraceUtils").recordCheckpointForTrace(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,f==null?void 0:f.message),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_FAILURE"),c("QPLUserFlow").markError(a,"failed_backup_initialization",{instanceKey:e}),c("FBLogger")("labyrinth_web").catching(f).mustfix("[labyrinth][onboarding] Error when initializing backup on device using PIN")}return!1},s=async function(a,b,e){try{d("MAWTraceUtils").recordCheckpointForTrace(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_CREATE_EXTRA_VIRTUAL_DEVICE),[],!1);await new Promise(function(a,b){return d("MWEncryptedBackupsCreateExtraVirtualDeviceDeferred").encryptedBackupsCreateExtraVirtualDeviceDeferred({db:n,onFailure:b,onSuccess:a})});c("QPLUserFlow").addPoint(a,"success_device_verification",{instanceKey:e});return!0}catch(f){d("MAWTraceUtils").recordCheckpointForTrace(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,f==null?void 0:f.message),c("QPLUserFlow").markError(a,"failed_device_verification",{instanceKey:e}),c("FBLogger")("labyrinth_web").catching(f).mustfix("Error when creating extra virtual device with PIN")}return!1};return async function(a,i,t){i===void 0&&(i=d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent);f==null?void 0:f();var u=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_REGISTRATION),d("MAWTraceUtils").CONTEXT_VESTA_REGISTRATION);c("QPLUserFlow").addAnnotations(i,{string:{source:p()}},{instanceKey:t});var v;try{d("MAWTraceUtils").recordCheckpointForTrace(u,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_GENERATE_RECOVERY_CODE),[],!1);o({event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_RECOVERY_CODE_GENERATE_START");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"SETUP_RECOVERY_CODE_GENERATE_START");var w=await d("MWEncryptedBackupsGenerateRecoveryCode").encryptedBackupsGenerateRecoveryCode({db:n,virtualDeviceType:2}),x=w.recoveryCode;w=w.virtualDeviceId;v=w;if(x==null||w==null){c("FBLogger")("labyrinth_web").mustfix("Cannot setup a PIN Code without a recovery code");d("MAWTraceUtils").recordFailureAndFlushForTraceId(u,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],"Cannot setup a PIN Code without a recovery code");c("QPLUserFlow").markError(i,"SETUP_RECOVERY_CODE_GENERATE_FAILURE",{instanceKey:t});d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});g==null?void 0:g();return}d("MAWTraceUtils").recordCheckpointForTrace(u,h.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_CALLING_VESTA_REGISTRATION),[],!1);var y=new TextEncoder();c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_START");c("QPLUserFlow").addPoint(i,"SETUP_SAP_VESTA_REGISTRATION_START",{instanceKey:t});await d("VestaBackupSecretRegister").vestaBackupSecretRegister({environment:q,input:{clientId:w,productUseCase:c("gkx")("24066")?"IGD_ENC_BACKUP":"MSGR_ENC_BACKUP",secret:y.encode(x),vestaAccountPin:a}});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_END");c("QPLUserFlow").addPoint(i,"SETUP_SAP_VESTA_REGISTRATION_END",{instanceKey:t});d("MAWTraceUtils").recordCheckpointForTrace(u,h.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_REGISTRATION_COMPLETION),[],!1);y=e?await s(i,u,t):await r(i,u,t);if(y)d("MAWTraceUtils").recordSuccessAndFlushForTraceId(u,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_SUCCESS),[]),j.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:n,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY}))}),l&&l(),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{string:{setup_type:"pin_code"}},event:i,instanceKey:t}),b("cr:17321")==null?void 0:b("cr:17321").fireAndForget("backend","addDeviceWithPinInWorker",{recoveryCode:x,userId:d("MAWCurrentUser").getID()});else{c("QPLUserFlow").markError(i,"pin_code_create_vd_error",{instanceKey:t});d("MAWTraceUtils").recordCheckpointForTrace(u,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,"Virtual device creation failure");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_START");a=await k.load();y=a.vestaDeleteAccount;y({clientId:w,environment:q,productUseCase:"MSGR_ENC_BACKUP",updater:function(a){var b;b=(b=a.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:b.getLinkedRecord("vesta_user_info");if(b!=null){(a=a.getRoot())==null?void 0:(a=a.getLinkedRecord("viewer"))==null?void 0:(a=a.getLinkedRecord("messenger_default_encrypted_backup"))==null?void 0:(a=a.getLinkedRecord("vesta_user_info"))==null?void 0:a.copyFieldsFrom(b)}}});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_END");d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_VIRTUAL_DEVICE_CREATE_FAILURE"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});d("MAWTraceUtils").recordCheckpointForTrace(u,h.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),[],!0);g==null?void 0:g()}}catch(b){if(v!=null){x=await k.load();a=x.vestaDeleteAccount;a({clientId:v,environment:q,productUseCase:"MSGR_ENC_BACKUP",updater:function(a){var b;b=(b=a.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:b.getLinkedRecord("vesta_user_info");if(b!=null){(a=a.getRoot())==null?void 0:(a=a.getLinkedRecord("viewer"))==null?void 0:(a=a.getLinkedRecord("messenger_default_encrypted_backup"))==null?void 0:(a=a.getLinkedRecord("vesta_user_info"))==null?void 0:a.copyFieldsFrom(b)}}})}c("QPLUserFlow").markError(i,"pin_code_vesta_error",{instanceKey:t});d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:b.toString()}},errorName:"ONBOARDING_UNKNOWN_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});d("MAWTraceUtils").recordFailureAndFlushForTraceId(u,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],b.toString());m==null?void 0:m();c("FBLogger")("labyrinth_web").catching(b).mustfix("[labyrinth][onboarding] Error when setting the pin code up")}}}g.default=a}),98);
__d("useMWChatEncryptedBackupsOnPinCodeSetup",["fbt","ix","BaseToasterStateManager","FDSCheckmarkCircleFilled24Icon","FDSIcon.react","FDSRefreshRightFilled24Icon","ImageIconSource","MWChatEncryptedBackupsQPLEvents","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","MessengerCheckmark.svg.react","QPLUserFlow","SVGIcon","mwPushToast","react","react-compiler-runtime","useCreateEncryptedBackup"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useRef,m=c("BaseToasterStateManager").getInstance();function a(a){var b=d("react-compiler-runtime").c(12),e=a.backupExists,f=a.onFinish,g=a.onStart,h=l(null);b[0]!==g?(a=function(){h.current=n(),g()},b[0]=g,b[1]=a):a=b[1];var i,j,k;b[2]!==f?(i=function(){f==null?void 0:f(),h.current=p(h)},j=function(){f==null?void 0:f(),d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_SET_UP_IN_CURRENT_SESSION),h.current=o(h)},k=function(){f==null?void 0:f(),h.current=p(h)},b[2]=f,b[3]=i,b[4]=j,b[5]=k):(i=b[3],j=b[4],k=b[5]);var m;b[6]!==e||b[7]!==a||b[8]!==i||b[9]!==j||b[10]!==k?(m={backupExists:e,onInit:a,onLabyrinthError:i,onSuccess:j,onVestaError:k},b[6]=e,b[7]=a,b[8]=i,b[9]=j,b[10]=k,b[11]=m):m=b[11];return c("useCreateEncryptedBackup")(m)}function n(){var a=60*60*24*1e3;c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_begin_toast");return d("mwPushToast").mwPushToast({icon:{comet:k.jsx(c("FDSIcon.react"),{icon:c("FDSRefreshRightFilled24Icon")}),mds:new(c("ImageIconSource"))(i("275859"),24,24)},title:h._(/*BTDS*/"Creating your PIN\u2026")},a)}function o(a){q(a);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_success_toast");return d("mwPushToast").mwPushToast({icon:{comet:k.jsx(c("FDSIcon.react"),{icon:c("FDSCheckmarkCircleFilled24Icon")}),mds:d("SVGIcon").svgIcon(c("MessengerCheckmark.svg.react"))},testid:"mw-encrypted-backups-pin-code-created-toast",title:h._(/*BTDS*/"PIN created")})}function p(a){q(a);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_failed_toast");return d("mwPushToast").mwPushErrorToast({body:h._(/*BTDS*/"Failed to create PIN. Try again.")})}function q(a){if(a.current==null)return;m.expire(a.current);a.current=null}g["default"]=a}),226);
__d("MWEBOnboardingHardblockConfirmPINDialogStep.react",["fbt","MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react","MWChatEncryptedBackupsQPLEvents","MWEBConnections4AndroidIcon.react","MWEBPinCodeSize","MWXColumn.react","MWXColumnItem.react","MWXText.react","gkx","promiseDone","react","react-compiler-runtime","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsNumericCode","useMWChatEncryptedBackupsOnPinCodeSetup","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k="eb-onboarding-insert-pin-dialog-step",l=c("gkx")("23219");function a(a){var b=d("react-compiler-runtime").c(26),e=a.enteredPinCode,f=a.onClose,g=a.onReturn,i=a.setIsMismatchError;a=a.subtitle;var m=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"ONBOARDING_EB_PIN_CONFIRM_STEP_IMPRESSION"),n;b[0]!==f?(n={backupExists:!1,onStart:f},b[0]=f,b[1]=n):n=b[1];var o=c("useMWChatEncryptedBackupsOnPinCodeSetup")(n);b[2]!==g||b[3]!==i?(f=function(){i(!0),g()},b[2]=g,b[3]=i,b[4]=f):f=b[4];b[5]!==e||b[6]!==f?(n={onCodeMismatch:f,previouslyInsertedCode:e},b[5]=e,b[6]=f,b[7]=n):n=b[7];b[8]!==o?(e=function(a){c("promiseDone")(o(a,d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent))},b[8]=o,b[9]=e):e=b[9];b[10]!==n||b[11]!==e?(f={checkPreviouslyInsertedCode:n,focusRegionId:k,inputSize:d("MWEBPinCodeSize").EB_PIN_CODE_SIZE,onComplete:e},b[10]=n,b[11]=e,b[12]=f):f=b[12];n=d("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode(f);e=n[0];b[13]!==m?(f=d("xplatToDOMRef").xplatToDOMRef(m),b[13]=m,b[14]=f):f=b[14];b[15]===Symbol["for"]("react.memo_cache_sentinel")?(n=j.jsx(c("MWXColumnItem.react"),{paddingTop:20,children:j.jsx(c("MWEBConnections4AndroidIcon.react"),{})}),b[15]=n):n=b[15];b[16]===Symbol["for"]("react.memo_cache_sentinel")?(m=j.jsx(c("MWXColumnItem.react"),{paddingTop:8,children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._(/*BTDS*/"Confirm your PIN")})}),b[16]=m):m=b[16];var p;b[17]!==a?(p=j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:16,children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:a})}),b[17]=a,b[18]=p):p=b[18];b[19]!==e?(a=j.jsx(c("MWXColumnItem.react"),{paddingTop:16,children:j.jsx(c("MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react"),babelHelpers["extends"]({isMessenger:l},e,{inputSize:"small"}))}),b[19]=e,b[20]=a):a=b[20];b[21]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXColumnItem.react"),{paddingTop:20}),b[21]=e):e=b[21];b[22]!==a||b[23]!==f||b[24]!==p?(n=j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:16,ref:f,children:[n,m,p,a,e]}),b[22]=a,b[23]=f,b[24]=p,b[25]=n):n=b[25];return n}g["default"]=a}),226);