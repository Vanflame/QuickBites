;/*FB_PKG_DELIM*/

__d("LSStoreProjectConfiguration",["LSBase64Decode.nop","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.nativeOperation(b("LSBase64Decode.nop"),a[4]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.blobs.neq(d[0],void 0)?c.db.table(307).put({configId:a[1],projectName:a[0],cipherSuite:a[5],publicKey:d[0],maxEvals:a[2],redemptionLimit:a[3],expirationTimestampMs:a[6],tokenPollFrequencyMs:a[7],maxClientTokenPoolSize:a[8]}):(function(a){c.logger(a).info(a)}("issuing retry for project configurations task since public key was null"),d[1]=new c.Map(),d[1].set("project_name",a[0]),d[2]=d[1].get("project_name"),d[3]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),["acs_credentials","_",d[2]].join(""),c.i64.cast([0,351]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsStoreProjectConfigurationStoredProcedure";a.__tables__=["secure_acs_configurations"];e.exports=a}),null);
__d("LSSyncBumpThreadDataToClient",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.filter(c.db.table(9).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.ge(a[1],b.lastActivityTimestampMs)}).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,c.sequence([function(e){return c.i64.eq(f.parentThreadKey,c.i64.cast([-1,4294967286]))&&c.i64.eq(a[2],c.i64.cast([0,2]))?(d[0]=new c.Map(),d[0].set("thread_fbid",a[0]),d[0].set("force_upsert",!1),d[0].set("use_open_messenger_transport",!1),d[0].set("sync_group",c.i64.cast([0,95])),d[0].set("metadata_only",!1),d[0].set("preview_only",!1),d[1]=d[0].get("thread_fbid"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,209]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastActivityTimestampMs:a[1]})})},function(b){return c.i64.eq(a[2],c.i64.cast([0,1]))?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):c.i64.eq(a[2],c.i64.cast([0,2]))?c.resolve(0):c.i64.eq(a[2],c.i64.cast([0,3]))?c.i64.ge(f.lastReadWatermarkTimestampMs,f.lastActivityTimestampMs)?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):c.resolve():c.resolve(0)}]))})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxSyncBumpThreadDataToClientStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);