;/*FB_PKG_DELIM*/

__d("TrustedTypesChromecastScriptURLPolicy",["TrustedTypes","err"],(function(a,b,c,d,e,f,g){"use strict";var h=["pkedcjkdefgpdelpbcmbmeomcjbeemfm","hfaagokkkhdbgiakmmlclaapfelnkoah","fmfcbgogabcbclcofgocippekhfcmgfj","enhhojjnijigcajfphajepfemndkmdlo"];function i(a){var b=h.join("|");b=new RegExp("^chrome-extension://(?:null|"+b+")/cast_sender\\.js$");return b.test(a)}a={createScriptURL:function(a){if(i(a))return a;throw c("err")("Violated policy TrustedTypesChromecastScriptURLPolicy: "+a+" is not a Chromecast extension URI.")}};b=c("TrustedTypes").createPolicy("chromecast-extension-uri",a);d=b;g["default"]=d}),98);
__d("CastingChromecastAPI",["TrustedTypesChromecastScriptURLPolicy"],(function(a,b,c,d,e,f,g){"use strict";var h=3*60*1e3,i=["pkedcjkdefgpdelpbcmbmeomcjbeemfm","hfaagokkkhdbgiakmmlclaapfelnkoah","fmfcbgogabcbclcofgocippekhfcmgfj","enhhojjnijigcajfphajepfemndkmdlo"],j=null;b=function(a){var b=a.appID,c=a.receiverListener,d=a.sessionListener;return l().then(function(a){var e=new a.ApiConfig(new a.SessionRequest(b),d,c,a.AutoJoinPolicy.ORIGIN_SCOPED,a.DefaultActionPolicy.CAST_THIS_TAB);return new Promise(function(b,c){a.initialize(e,b,c)})})};d=function(a){return l().then(function(b){b.addReceiverActionListener(function(c,d){switch(d){case b.ReceiverAction.CAST:a.onCast(c);break;case b.ReceiverAction.STOP:a.onStop();break}})})};e=function(a){return l().then(function(b){var c=new b.SessionRequest(a,[b.Capability.VIDEO_OUT,b.Capability.AUDIO_OUT],h);return new Promise(function(a,d){b.requestSession(a,d,c)})})};f=function(a){return l().then(function(b){return a===b.ReceiverAvailability.AVAILABLE})};var k=function(){return l().then(function(a){return a.media.DEFAULT_MEDIA_RECEIVER_APP_ID})},l=function(){if(j)return j;if(!a.chrome){j=Promise.reject({code:"not_supported",description:null,details:null});return j}if(a.chrome.cast&&a.chrome.cast.isAvailable){j=Promise.resolve(a.chrome.cast);return j}j=Promise.resolve().then(function(){return m()}).then(function(b){return new Promise(function(d,e){a.chrome.cast=a.chrome.cast||{};a.chrome.cast.extensionId=b;a.__onGCastApiAvailable=function(b,c){c?e(c):d(a.chrome.cast)};var f=document.createElement("script");f.onerror=e;if(b==null){e({code:"extension_not_available",description:null,details:null});return}else f.src=c("TrustedTypesChromecastScriptURLPolicy").createScriptURL(o(b));var g=document.head||document.documentElement;if(g==null){e({code:"extension_no_casting_script",description:null,details:null});return}g.appendChild(f)})});return j};async function m(){for(var a=0;a<i.length;a++){var b=i[a],c=await n(b);if(c)return b}return null}function n(a){return new Promise(function(b,c){c=o(a);var d=new XMLHttpRequest();d.onreadystatechange=function(){d.readyState===4&&b(d.status===200)};d.onerror=function(){b(!1)};d.open("GET",c,!0);d.send()})}function o(a){return"chrome-extension://"+a+"/cast_sender.js"}d={addReceiverListener:d,getDefaultAppID:k,getIsAvailable:f,getSession:e,initialize:b};k=d;g.default=k}),98);
__d("CastingChromecastAPIWrapper",["cr:1885117"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:1885117")}),98);
__d("CastingChromecastSession",["Promise","err","recoverableViolation","removeFromArray"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b,d){var e=this;this.$3=null;this.$4=[];this.$5=[];this.$6=[];this.$7=[];this.$8=[];this.$9=[];this.$10=[];this.$11=[];this.$12=function(a,b){if(a===e.$2){var d=e.$4.slice();d.forEach(function(a){a(b)})}else e.$6.slice().forEach(function(b){b(c("err")("Namespace does not match. Expected "+e.$2+" but received "+a),"CastingChromecastSession._onMessageReceived")})};this.$1=a;this.$2=b;this.$3=d;d.addMessageListener(this.$2,this.$12)}var d=a.prototype;d.destroy=function(){var a=this.$3;a!=null&&(a.status!=null&&a.status!=="disconnected"&&c("recoverableViolation")("Destroying receiver session that is not disconnected. Status, "+a.status,"comet_cast_sender"),a.removeMessageListener(this.$2,this.$12));this.$3=null};d.isCasting=function(){return this.$3!=null};d.isConnected=function(){return this.$3!=null&&this.$3.status==="connected"};d.isDisconnected=function(){return this.$3!=null&&this.$3.status==="disconnected"};d.disconnect=function(){var a=this;this.$5.slice().forEach(function(a){a()});return new(h||(h=b("Promise")))(function(b,c){a.$3!=null?a.$3.stop(b,c):b()})["catch"](function(b){if(a.$3!=null&&a.$3.status!=="stopped"){a.$6.slice().forEach(function(a){a(b,"CastingChromecastSession.disconnect")});throw b}})["finally"](function(){var b=a.$3;a.$3=null;b&&b.removeMessageListener(a.$2,a.$12);a.$7.slice().forEach(function(a){a()})})};d.getVolume=function(){var a=this.$13();return a?a.level:null};d.getFriendlyName=function(){return this.$14()};d.setVolume=function(a){var d=this,e=this.$3;return new(h||(h=b("Promise")))(function(b,d){if(e==null){d(c("err")("Cannot set volume without a session"));return}e.setReceiverVolumeLevel(a,b,d)})["catch"](function(a){d.$6.slice().forEach(function(b){b(a,"CastingChromecastSession.setVolume")});throw a})};d.isMuted=function(){var a=this.$13();return a?a.muted:null};d.mute=function(){return this.$15(!0)};d.unmute=function(){return this.$15(!1)};d.sendMessage=function(a){var d=this;return new(h||(h=b("Promise")))(function(b,e){var f=d.$3;if(f==null){e(c("err")("The message can not be sent without a session"));return}f.sendMessage(d.$2,a,b,e)})["catch"](function(a){d.$6.slice().forEach(function(b){b(a,"CastingChromecastSession.sendMessage")});throw a})};d.$13=function(){var a;a=(a=this.$3)==null?void 0:(a=a.receiver)==null?void 0:a.volume;return a==null?null:a};d.$14=function(){var a;return((a=this.$3)==null?void 0:a.receiver.friendlyName)||null};d.$15=function(a){var d=this;return new(h||(h=b("Promise")))(function(b,e){var f=d.$3;if(f==null){e(c("err")("The muted state can not be set without a session"));return}f.setReceiverMuted(a,b,e)})["catch"](function(a){d.$6.slice().forEach(function(b){b(a,"CastingChromecastSession._setIsMuted")});throw a})};d.onMessage=function(a){var b=this.$4;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onDisconnecting=function(a){var b=this.$5;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onError=function(a){var b=this.$6;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onDisconnected=function(a){var b=this.$7;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onVideoLoading=function(a){var b=this.$8;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onVideoLoaded=function(a){var b=this.$9;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onVideoPlaying=function(a){var b=this.$10;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};d.onVideoPaused=function(a){var b=this.$11;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};return a}();g["default"]=a}),98);
__d("CastingErrorUtils",["ErrorMetadata","err","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a!=null&&typeof a==="object"&&typeof a.code==="string"&&a.code===b}function b(a){return a!=null&&typeof a==="object"&&typeof a.code==="string"?c("err")("Chromecast error: %s, keys: %s","cast.ChromecastError",JSON.stringify({code:a.code})):c("getErrorSafe")(a)}function d(a,b){a.metadata==null&&(a.metadata=new(c("ErrorMetadata"))());var d=a.metadata;b=b==null?void 0:b.videoID;b!=null&&d.addEntries(["COMET_VIDEO","VIDEO_ID",b]);return a}g.isChromecastError=a;g.getCastingErrorSafe=b;g.appendCastingMetadataToExpandedError=d}),98);
__d("ConnectedTvLoggingFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1843753");b=d("FalcoLoggerInternal").create("connected_tv_logging",a);e=b;g["default"]=e}),98);
__d("CastingChromecastScanner",["CastingChromecastAPIWrapper","CastingChromecastSession","CastingErrorUtils","ConnectedTvLoggingFalcoEvent","Promise","err","performanceAbsoluteNow","promiseDone","removeFromArray"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){function a(a,b){this.$6=null,this.$7=[],this.$8=[],this.$9=[],this.$10=[],this.$11=[],this.$12=[],this.$13=[],this.$14=[],this.$15=[],this.$1=a,this.$2=b,this.$4=!1,this.$3=!1,this.$5=new Set()}var e=a.prototype;e.init=function(){if(this.$6!=null)return(i||(i=b("Promise"))).reject(c("err")("Scanner can only be initialized once."));this.$6=this.$16();return this.$6};e.ready=function(){return this.$6==null?(i||(i=b("Promise"))).reject(c("err")("Scanner should be initialized.")):this.$6};e.hasSupport=function(){return this.$3};e.hasFoundReceiver=function(){return this.$4};e.getSession=function(){var a=this;if(!this.$4)return(i||(i=b("Promise"))).reject(c("err")("No receivers found"));this.$13.slice().forEach(function(a){a()});return this.$17().then(function(b){var c=a.$18(b);a.$5.add(c);a.$14.slice().forEach(function(a){a(c)});return c})["catch"](function(b){a.$10.slice().forEach(function(a){a()});a.$11.slice().forEach(function(a){a()});throw b})};e.$16=function(){var a=this;this.$3=!0;return this.$19().then(function(b){return a.$20()}).then(function(b){a.$9.slice().forEach(function(a){a()})}).then(function(b){return a.$21()})["catch"](function(b){!d("CastingErrorUtils").isChromecastError(b,"not_supported")&&!d("CastingErrorUtils").isChromecastError(b,"extension_not_available")&&!d("CastingErrorUtils").isChromecastError(b,"extension_no_casting_script")&&a.$8.slice().forEach(function(a){a(b,"CastingChromecastScanner._init")});throw b})};e.$21=function(){var a=this,d=this.$1;if(d==null)return(i||(i=b("Promise"))).reject(c("err")("App ID is not defined"));var e=function(b){var c=a.$18(b);a.$14.slice().forEach(function(a){a(c)})},f=function(b){c("promiseDone")(c("CastingChromecastAPIWrapper").getIsAvailable(b).then(function(b){a.$4=b,a.$15.slice().forEach(function(b){b({foundReceiver:a.$4})})}))};return c("CastingChromecastAPIWrapper").initialize({appID:d,receiverListener:f,sessionListener:e}).then(function(){})["catch"](function(b){a.$8.slice().forEach(function(a){a(b,"CastingChromecastScanner._initializeApi")});throw b})};e.$19=function(){var a=this;return this.$1!=null?(i||(i=b("Promise"))).resolve():c("CastingChromecastAPIWrapper").getDefaultAppID().then(function(b){a.$1=b})};e.$17=function(){var a=this.$1;if(a==null)return(i||(i=b("Promise"))).reject(c("err")("App ID is not defined"));var d=(h||(h=c("performanceAbsoluteNow")))();c("ConnectedTvLoggingFalcoEvent").log(function(){return{event:"sender_session_requested"}});return c("CastingChromecastAPIWrapper").getSession(a).then(function(a){c("ConnectedTvLoggingFalcoEvent").log(function(){return{event:"sender_session_started",perf_time_ms:Math.floor((h||(h=c("performanceAbsoluteNow")))()-d)}});return a})["catch"](function(a){c("ConnectedTvLoggingFalcoEvent").log(function(){return{event:"sender_session_failed",perf_time_ms:Math.floor((h||(h=c("performanceAbsoluteNow")))()-d),session_failure_code:typeof a.code==="string"?a.code:null,session_failure_description:a.description}});throw a})};e.$18=function(a){var b=this,d=new(c("CastingChromecastSession"))(this.$1||"",this.$2||"",a),e=d.onDisconnecting(function(){b.$12.slice().forEach(function(a){a()})}),f=d.onError(function(a,c){b.$8.slice().forEach(function(b){b(a,c)})}),g=d.onDisconnected(function(){b.$11.slice().forEach(function(a){a()}),b.$5["delete"](d),e.remove(),f.remove(),g.remove()});return d};e.$20=function(){var a=this;return c("CastingChromecastAPIWrapper").addReceiverListener({onCast:function(b){a.$7.slice().forEach(function(a){a(b)})},onStop:function(){a.$5.forEach(function(a){return a.disconnect()})}})};e.onCast=function(a){var b=this.$7;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onError=function(a){var b=this.$8;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onInit=function(a){var b=this.$9;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionCancelled=function(a){var b=this.$10;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionDisconnected=function(a){var b=this.$11;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionDisconnecting=function(a){var b=this.$12;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionRequested=function(a){var b=this.$13;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionStarted=function(a){var b=this.$14;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onStatusChanged=function(a){var b=this.$15;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};return a}();g["default"]=a}),98);
__d("CastingContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(null);c=a.createContext(null);e=a.createContext(null);f=a.createContext(null);g.CastingStateContext=b;g.CastingExperienceStateContext=c;g.SetCastingControllerContext=e;g.CastingControllerContext=f}),98);
__d("CastingState",[],(function(a,b,c,d,e,f){"use strict";function a(){return{isCastPending:!1,receiverExperience:null,receiverFriendlyName:null,receiverIsConnected:!1,receiverIsMuted:null,receiverVolume:null}}function b(){return{currentDuration:null,currentPlaybackState:null,currentPosition:null,currentVideoID:null,type:"video_channel"}}function c(){return{type:"photo"}}function d(){return{currentAssetID:null,currentPlaybackState:null,type:"photo_album"}}f.initialCastingState=a;f.initialVideoChannelExperienceState=b;f.initialPhotoExperienceState=c;f.initialPhotoAlbumExperienceState=d}),66);
__d("TV2PhotoAlbumReportedState",[],(function(a,b,c,d,e,f){"use strict";function a(a){return k(JSON.parse(a),m("TV2PhotoAlbumReportedState"))}function b(a){return JSON.stringify(l(a,m("TV2PhotoAlbumReportedState")),null,2)}function g(a,b,c){c===void 0&&(c="");if(c)throw Error('Invalid value for key "'+c+'". Expected type '+JSON.stringify(a)+" but got "+JSON.stringify(b));throw Error("Invalid value "+JSON.stringify(b)+" for type "+JSON.stringify(a))}function h(a){if(a.jsonToJS===void 0){var b={};a.props.forEach(function(a){return b[a.json]={key:a.js,typ:a.typ}});a.jsonToJS=b}return a.jsonToJS}function i(a){if(a.jsToJSON===void 0){var b={};a.props.forEach(function(a){return b[a.js]={key:a.json,typ:a.typ}});a.jsToJSON=b}return a.jsToJSON}function j(a,b,c,d){d===void 0&&(d="");function e(b,a){return typeof b===typeof a?a:g(b,a,d)}function f(b,a){var d=b.length;for(var e=0;e<d;e++){var f=b[e];try{return j(a,f,c)}catch(a){}}return g(b,a)}function h(b,a){return b.indexOf(a)!==-1?a:g(b,a)}function i(b,a){return!Array.isArray(a)?g("array",a):a.map(function(a){return j(a,b,c)})}function k(a){if(a===null)return null;var b=new Date(a);return isNaN(b.valueOf())?g("Date",a):b}function l(b,d,a){if(a===null||typeof a!=="object"||Array.isArray(a))return g("object",a);var e={};Object.getOwnPropertyNames(b).forEach(function(d){var f=b[d];d=Object.prototype.hasOwnProperty.call(a,d)?a[d]:void 0;e[f.key]=j(d,f.typ,c,f.key)});Object.getOwnPropertyNames(a).forEach(function(f){Object.prototype.hasOwnProperty.call(b,f)||(e[f]=j(a[f],d,c,f))});return e}if(b==="any")return a;if(b===null)return a===null?a:g(b,a);if(b===!1)return g(b,a);while(typeof b==="object"&&b.ref!==void 0)b=n[b.ref];if(Array.isArray(b))return h(b,a);if(typeof b==="object")return Object.prototype.hasOwnProperty.call(b,"unionMembers")?f(b.unionMembers,a):Object.prototype.hasOwnProperty.call(b,"arrayItems")?i(b.arrayItems,a):Object.prototype.hasOwnProperty.call(b,"props")?l(c(b),b.additional,a):g(b,a);return b===Date&&typeof a!=="number"?k(a):e(b,a)}function k(a,b){return j(a,b,h)}function l(a,b){return j(a,b,i)}function c(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return{unionMembers:b}}function d(a,b){return{props:a,additional:b}}function m(a){return{ref:a}}var n={TV2PhotoAlbumReportedState:d([{json:"media_parameters",js:"media_parameters",typ:m("MediaParameters")},{json:"media_state",js:"media_state",typ:m("MediaState")}],"any"),MediaParameters:d([{json:"album_id",js:"album_id",typ:""}],"any"),MediaState:d([{json:"photo_state",js:"photo_state",typ:c(void 0,m("PhotoMediaState"))},{json:"video_state",js:"video_state",typ:c(void 0,m("VideoMediaState"))}],"any"),PhotoMediaState:d([{json:"duration_ms",js:"duration_ms",typ:3.14},{json:"photo_id",js:"photo_id",typ:""},{json:"photo_playback_state",js:"photo_playback_state",typ:m("PhotoPlaybackState")},{json:"position_ms",js:"position_ms",typ:3.14}],"any"),VideoMediaState:d([{json:"duration_ms",js:"duration_ms",typ:3.14},{json:"position_ms",js:"position_ms",typ:3.14},{json:"video_id",js:"video_id",typ:""},{json:"video_playback_state",js:"video_playback_state",typ:m("VideoPlaybackState")}],"any"),PhotoPlaybackState:["paused","play"],VideoPlaybackState:["ended","paused","play","seeking","unknown"]};e.exports={TV2PhotoAlbumReportedStateToJson:b,toTV2PhotoAlbumReportedState:a}}),null);
__d("TV2UniqueIDs",["guid"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a){var b;b=(b=h.get(a))!=null?b:0;h.set(a,b+1);return""+a+b.toString(36)}function a(){return i("id_tv2_vcr_")}function b(){return i("id_tv2_veqe_")}function d(){return i("id_tv2_toast_")}function e(){return i("id_tv2_rvr_")}function f(){return c("guid")()}g.makeTV2VideoCastRequestID=a;g.makeTV2VideoExperienceQueueEntryID=b;g.makeTV2ToastID=d;g.makeTV2RelatedVideosRequestID=e;g.makeTV2ChainingSessionID=f}),98);
__d("getTV2QueryStringCheatcodeValue",[],(function(a,b,c,d,e,f){"use strict";function b(b){try{b=new RegExp("\\b"+b+"=([^&]*)");b=b.exec(a.location.search);return!b||b[1]==null?null:b[1]}catch(a){return null}}f["default"]=b}),66);
__d("getTV2QueryStringCheatcode",["getTV2QueryStringCheatcodeValue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){try{return c("getTV2QueryStringCheatcodeValue")(a)==="1"}catch(a){return!1}}g["default"]=a}),98);
__d("getTV2DebuggingEnabled",["getTV2QueryStringCheatcode"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("getTV2QueryStringCheatcode")("debugging")}g["default"]=a}),98);
__d("TV2CommsParseUtils",["TV2PhotoAlbumReportedState","TV2UniqueIDs","err","getTV2DebuggingEnabled"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===null?"null":a===""?"empty string":Array.isArray(a)?"array":typeof a==="object"?"object with keys: "+JSON.stringify(Object.keys(a).sort()):typeof a}function i(a,b,d){if(typeof a!=="string"||a===""){var e=c("err")("Message parse error: %s expected JSON string, got %s",d,h(a));throw e}try{e=JSON.parse(a);return b(e,d)}catch(b){if("messageFormat"in b&&typeof b.messageFormat==="string"&&"messageParams"in b&&Array.isArray(b.messageParams))throw b;else{a=c("err")("Message parse error: %s expected JSON string, got error: %s",d,b.message);throw a}}}function j(a,b){if(typeof a!=="object"||a==null){b=c("err")("Message parse error: %s expected object, got %s",b,h(a));throw b}return a}function b(a,b){if(a==null)return null;if(typeof a!=="object"||a==null){b=c("err")("Message parse error: %s expected object, got %s",b,h(a));throw b}return a}function k(a,b){if(!Array.isArray(a)){b=c("err")("Message parse error: %s expected array, got %s",b,h(a));throw b}return a}function e(a,b){if(!Array.isArray(a)){var d=c("err")("Message parse error: %s expected array, got %s",b,h(a));throw d}return a.map(function(a){return m(a,b)})}function l(a,b){if(!Array.isArray(a)){var d=c("err")("Message parse error: %s expected array, got %s",b,h(a));throw d}return a.filter(Boolean).map(function(a){return m(a,b)})}function m(a,b){if(typeof a!=="string"||a===""){b=c("err")("Message parse error: %s expected non-empty string, got %s",b,h(a));throw b}return a}function n(a,b){if(a==null)return null;if(typeof a!=="string"||a===""){b=c("err")("Message parse error: %s expected optional non-empty string, got %s",b,h(a));throw b}return a}function o(a,b){if(a==null)return null;if(typeof a!=="string"){b=c("err")("Message parse error: %s expected optional string, got %s",b,h(a));throw b}return a}function p(a,b){if(a==null)return null;if(!(typeof a==="number"&&Number.isFinite(a)||typeof a==="string"&&a!=="")){b=c("err")("Message parse error: %s expected optional non-empty string or number, got %s",b,h(a));throw b}return a}function q(a,b){if(typeof a!=="number"||!Number.isFinite(a)){b=c("err")("Message parse error: %s expected finite number, got %s",b,h(a));throw b}return a}function f(a,b){if(a==null)return null;if(typeof a!=="number"||!Number.isFinite(a)){b=c("err")("Message parse error: %s expected optional finite number, got %s",b,h(a));throw b}return a}function r(a,b){return a==="true"||a===!0}function s(a,b,c){c===void 0&&(c=!1);return a==null?c:a===!0}function t(a,b){if(typeof a!=="boolean"){b=c("err")("Parse error: %s expected boolean, got %s",b,h(a));throw b}return a}function u(a,b){a=a!=null?j(a,b):null;if(a==null)return null;var c=m(a.uri,b+".uri"),d=q(a.width,b+".width");a=q(a.height,b+".height");return{height:a,uri:c,width:d}}function v(a,b){a=a!=null?j(a,b):null;if(a==null)return null;a=j(a.image,b+".image");a=m(a.uri,b+".image.uri");return{uri:a}}function w(a,b){if(a==null)return null;a=k(a,b);return a.map(function(a,b){return m(a,"["+b+"]")})}function x(a,b){return i(a,function(b,a){b=k(b,a);return b.map(function(b,c){c=a+"."+c;return z(j(b,c),c)})},b)}function y(a,b){return i(a,function(b,a){return z(j(b,a),a)},b)}function z(b,e){var f=m(b.access_token,e+".access_token"),g=String(p(b.app_id,e+".app_id")),h=o(b.app_version,e+".app_version"),i=u(b.background_image,e+".background_image"),j=n(b.channel_token,e+".channel_token"),k=n(b.channel_session_id,e+".channel_session_id"),q=o(b.end_cursor,e+".end_cursor")||null,r=s(b.from_next_video_query,e+".from_next_video_query"),t=s(b.is_ad,e+".is_ad"),x=w(b.dash_prefetched_representation_ids,e+".dash_prefetched_representation_ids"),y=n(b.entry_point,e+".entry_point"),z=n(b.player_origin===""?null:b.player_origin,e+".player_origin"),A=n(b.player_suborigin===""?null:b.player_suborigin,e+".player_suborigin"),B=v(b.preferred_thumbnail,e+".preferred_thumbnail"),C=n(b.video_channel_id,e+".video_channel_id"),D=m(b.root_video_id,e+".root_video_id"),E=c("getTV2DebuggingEnabled")()?/\bvideo_id=([0-9]+)\b/.exec(a.location.search):null;E=E&&E[1]?E[1]:m(b.video_id,e+".video_id");b=b.tracking_codes!=null?l(b.tracking_codes,e+".tracking_codes"):null;return{accessToken:f,appID:g,appVersion:h,backgroundImage:i,chainingEnabled:!1,channelSessionID:k,channelToken:j,dashPrefetchedRepresentationIDs:x,endCursor:q,entryPoint:y,fromNextVideoQuery:r,isAd:t,playerOrigin:z,playerSuborigin:A,preferredThumbnail:B,rootVideoID:D,startTimestamp:0,trackingCodes:b,videoCastRequestID:d("TV2UniqueIDs").makeTV2VideoCastRequestID(),videoChannelID:C,videoID:E}}function A(a,b){a=j(a,b);b=m(a.type,b+".type");switch(b){case"version_response":return a;case"version_launch_response":return a;case"experience_state":return a;case"command_result":return a;case"duration_change":return a;case"status_update":return a;case"experience_status_update":return a}b=c("err")("Parse error: %s expected response message type, got %s","parseTV2CommsFBAppOutboundMessageFromObject",h(a));throw b}function B(a){return i(a,A,".")}function C(a){a=B(a);switch(a.type){case"version_response":case"version_launch_response":case"experience_state":case"command_result":return a}a=c("err")("Parse error: %s expected response message type, got %s","parseCastingReceiverResponseMessageFromJSON",h(a));throw a}function D(a){return d("TV2PhotoAlbumReportedState").toTV2PhotoAlbumReportedState(a)}g.parseJSONString=i;g.parseObject=j;g.parseOptionalObject=b;g.parseArray=k;g.parseStringArray=e;g.parseTrackingCodes=l;g.parseNonEmptyString=m;g.parseOptionalNonEmptyString=n;g.parseOptionalString=o;g.parseNumber=q;g.parseOptionalNumber=f;g.parseOptionalStringishBoolean=r;g.parseOptionalBoolean=s;g.parseBoolean=t;g.parseVideoCastingPayloadBackgroundImage=u;g.parseVideoCastingPayloadPreferredThumbnail=v;g.parseVideoCastingPayloadListJSONAsTV2VideoCastRequestArray=x;g.parseVideoCastingPayloadJSONAsTV2VideoCastRequest=y;g.parseVideoCastingPayloadAsTV2VideoCastRequest=z;g.parseTV2CommsFBAppOutboundMessageFromJSON=B;g.parseCastingReceiverResponseMessageFromJSON=C;g.parseCastingReceiverPhotoAlbumReportedState=D}),98);
__d("fetchCtvCastPayloadQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29808457688745543"}),null);
__d("fetchCtvCastPayloadQuery.graphql",["fetchCtvCastPayloadQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"castSessionID"},c={defaultValue:null,kind:"LocalArgument",name:"mediaParameters"},d={defaultValue:null,kind:"LocalArgument",name:"requestID"},e=[{alias:null,args:[{kind:"Variable",name:"cast_session_id",variableName:"castSessionID"},{kind:"Literal",name:"caster_id",value:0},{kind:"Variable",name:"media_parameters_json",variableName:"mediaParameters"},{kind:"Literal",name:"receiver_app_id",value:1614120985559993},{kind:"Variable",name:"request_id",variableName:"requestID"},{kind:"Literal",name:"uses_secure_connection",value:!0}],kind:"ScalarField",name:"ctv_cast_payload",storageKey:null}];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"fetchCtvCastPayloadQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,d,c],kind:"Operation",name:"fetchCtvCastPayloadQuery",selections:e},params:{id:b("fetchCtvCastPayloadQuery_facebookRelayOperation"),metadata:{},name:"fetchCtvCastPayloadQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("fetchCtvCastPayload",["CometRelay","err","fetchCtvCastPayloadQuery.graphql","getErrorSafe","guid"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("fetchCtvCastPayloadQuery.graphql");function a(a){var b=a.castSessionID;a=a.environment;return d("CometRelay").fetchQuery(a,i,{castSessionID:b,mediaParameters:"{}",requestID:c("guid")()}).toPromise().then(function(a){if(a!=null&&a.ctv_cast_payload!=null&&typeof a.ctv_cast_payload==="string")return{payload:a.ctv_cast_payload,type:"loaded"};else return{error:c("err")("Payload was not string"),type:"error"}})["catch"](function(a){a=c("getErrorSafe")(a);return{error:a,type:"error"}})}function e(a){var b=a.albumID,e=a.castSessionID;a=a.environment;return d("CometRelay").fetchQuery(a,i,{castSessionID:e,mediaParameters:JSON.stringify({album_id:b}),requestID:c("guid")()}).toPromise().then(function(a){if(typeof (a==null?void 0:a.ctv_cast_payload)==="string")return{payload:a.ctv_cast_payload,type:"loaded"};else return{error:c("err")("Payload was not string"),type:"error"}})["catch"](function(a){a=c("getErrorSafe")(a);return{error:a,type:"error"}})}g.fetchPhotoCastPayload=a;g.fetchAlbumCastPayload=e}),98);
__d("fetchVideoCastPayloadQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9544699068932467"}),null);
__d("fetchVideoCastPayloadQuery.graphql",["fetchVideoCastPayloadQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"castSessionID"},c={defaultValue:null,kind:"LocalArgument",name:"playerOrigin"},d={defaultValue:null,kind:"LocalArgument",name:"playerSubOrigin"},e={defaultValue:null,kind:"LocalArgument",name:"videoID"},f=[{kind:"Variable",name:"id",variableName:"videoID"}],g={alias:null,args:[{kind:"Variable",name:"cast_session_id",variableName:"castSessionID"},{kind:"Variable",name:"player_origin",variableName:"playerOrigin"},{kind:"Variable",name:"player_suborigin",variableName:"playerSubOrigin"}],kind:"ScalarField",name:"video_cast_payload",storageKey:null};return{fragment:{argumentDefinitions:[a,c,d,e],kind:"Fragment",metadata:null,name:"fetchVideoCastPayloadQuery",selections:[{alias:null,args:f,concreteType:"Video",kind:"LinkedField",name:"video",plural:!1,selections:[g],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,c,d,a],kind:"Operation",name:"fetchVideoCastPayloadQuery",selections:[{alias:null,args:f,concreteType:"Video",kind:"LinkedField",name:"video",plural:!1,selections:[g,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{id:b("fetchVideoCastPayloadQuery_facebookRelayOperation"),metadata:{},name:"fetchVideoCastPayloadQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("fetchVideoCastPayload",["CometRelay","err","fetchVideoCastPayloadQuery.graphql","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("fetchVideoCastPayloadQuery.graphql");function a(a){var b=a.castSessionID,e=a.environment,f=a.playerOrigin,g=a.playerSubOrigin;a=a.videoID;return d("CometRelay").fetchQuery(e,i,{castSessionID:b,playerOrigin:f,playerSubOrigin:g,videoID:a}).toPromise().then(function(a){if(a==null||a.video==null||a.video.video_cast_payload==null)return{type:"video_cannot_be_casted"};else if(typeof a.video.video_cast_payload==="string")return{payload:a.video.video_cast_payload,type:"loaded"};else return{error:c("err")("Payload was not string"),type:"error"}})["catch"](function(a){a=c("getErrorSafe")(a);return{error:a,type:"error"}})}g["default"]=a}),98);
__d("CastingController",["CastingErrorUtils","CastingState","FBLogger","Promise","SubscriptionsHandler","TV2CommsParseUtils","err","fetchCtvCastPayload","fetchVideoCastPayload","getErrorSafe","performanceAbsoluteNow","promiseDone","recoverableViolation","removeFromArray","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("FBLogger")("fbtv"),k="PhotoAlbum",l="ChannelVideo",m="Photo";a=function(){function a(a,b){var e=this;this.$5=[];this.$6=[];this.$7=[];this.$9=function(){var a=d("CastingState").initialCastingState();e.$12(a);e.$13(null)};this.$10=function(a){switch(a.type){case"status_update":e.$16(a);break;case"experience_status_update":e.$17(a);break;default:break}};this.$11=function(a,b){var f;if(d("CastingErrorUtils").isChromecastError(a,"cancel"))j.warn("ChromecastError while casting. Received ChromecastError with cancel code.");else if(((f=e.$2)==null?void 0:f.type)==="video_channel"){f=(f=e.$2)==null?void 0:f.currentVideoID;f=d("CastingErrorUtils").appendCastingMetadataToExpandedError(d("CastingErrorUtils").getCastingErrorSafe(a),babelHelpers["extends"]({},f!=null?{videoID:f}:{}));c("recoverableViolation")("Receiver error at "+b+" while playing video channel","comet_cast_sender",{error:f});c("promiseDone")(e.$4.stopCasting())}else{f=d("CastingErrorUtils").appendCastingMetadataToExpandedError(d("CastingErrorUtils").getCastingErrorSafe(a),{});a=((a=e.$2)==null?void 0:a.type)||"";c("recoverableViolation")("Receiver error at "+b+" while playing in experience "+a,"comet_cast_sender",{error:f});c("promiseDone")(e.$4.stopCasting())}};this.$1=d("CastingState").initialCastingState();this.$2=null;this.$3=b;this.$4=a;this.$8=new(c("SubscriptionsHandler"))();this.$8.addSubscriptions(this.$4.onReceiverDisconnected(this.$9),this.$4.onSessionDisconnected(this.$9),this.$4.onSessionMessage(this.$10),this.$4.onError(this.$11))}var e=a.prototype;e.destroy=function(){this.$8.release()};e.getCastingState=function(){return this.$1};e.getCastingExperienceState=function(){return this.$2};e.setCastingState=function(a){this.$1=a};e.setCastingExperienceState=function(a){this.$2=a};e.subscribeToCastingStateChange=function(a){var b=this;this.$5.push(a);return function(){c("removeFromArray")(b.$5,a)}};e.subscribeToCastingExperienceStateChange=function(a){var b=this;this.$6.push(a);return function(){c("removeFromArray")(b.$6,a)}};e.subscribeToCastingEvent=function(a){var b=this;this.$7.push(a);return function(){c("removeFromArray")(b.$7,a)}};e.startPlayVideoNow=function(a){var e=this,f=a.environment,g=a.origin,j=a.position,k=a.subOrigin,m=a.videoID;if(this.$1.isCastPending)return;this.$12(babelHelpers["extends"]({},this.$1,{isCastPending:!0}));this.$13(null);this.$14({data:{type:"cast_requested",videoID:m},timestamp:(i||(i=c("performanceAbsoluteNow")))()});c("promiseDone")((h||(h=b("Promise"))).all([c("fetchVideoCastPayload")({castSessionID:this.$3,environment:f,playerOrigin:g,playerSubOrigin:k,videoID:m}),this.$4.getSession().then(function(a){e.$12(babelHelpers["extends"]({},e.$1,{receiverIsConnected:!0}));return a})]).then(function(a){var f=a[0];a[1];if(f.type==="video_cannot_be_casted"){c("recoverableViolation")("The video is not eligible to be casted. The cast request is ignored.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(c("err")("video_cannot_be_casted"),{videoID:m})});return(h||(h=b("Promise"))).resolve()}else if(f.type==="error"){c("recoverableViolation")("There was a failure retrieving video cast payload. Video failed to play.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(f.error,{videoID:m})});return(h||(h=b("Promise"))).resolve()}a=e.$4.isCasting(l);a?a=e.$4.playVideoNow({position:j},f.payload):a=e.$4.startCasting(l,{position:j},f.payload);return a.then(function(){var a=babelHelpers["extends"]({},e.$1,e.$15());e.$12(a);a=d("CastingState").initialVideoChannelExperienceState();e.$13(a)})})["catch"](function(a){e.$14({data:{type:"cast_failed",videoID:m},timestamp:(i||(i=c("performanceAbsoluteNow")))()}),d("CastingErrorUtils").isChromecastError(a,"cancel")||c("recoverableViolation")("Failed to cast video.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(c("getErrorSafe")(a),{videoID:m})})})["finally"](function(){var a=babelHelpers["extends"]({},e.$1,{isCastPending:!1});e.$12(a)}))};e.startPhotoCasting=function(a){var e=this;a=a.environment;if(this.$1.isCastPending)return;this.$12(babelHelpers["extends"]({},this.$1,{isCastPending:!0}));this.$13(null);this.$14({data:{type:"photo_cast_requested"},timestamp:(i||(i=c("performanceAbsoluteNow")))()});c("promiseDone")((h||(h=b("Promise"))).all([d("fetchCtvCastPayload").fetchPhotoCastPayload({castSessionID:this.$3,environment:a}),this.$4.getSession().then(function(a){e.$12(babelHelpers["extends"]({},e.$1,{receiverIsConnected:!0}));return a})]).then(function(a){var f=a[0];a[1];if(f.type==="error"){c("recoverableViolation")("There was a failure retrieving photo cast payload.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(f.error,{})});return(h||(h=b("Promise"))).resolve()}a=e.$4.startCasting(m,{},f.payload);return a.then(function(){var a=babelHelpers["extends"]({},e.$1,e.$15());e.$12(a);e.$13(d("CastingState").initialPhotoExperienceState())})})["catch"](function(a){d("CastingErrorUtils").isChromecastError(a,"cancel")||c("recoverableViolation")("Failed to start photo casting session.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(c("getErrorSafe")(a),{})})})["finally"](function(){var a=babelHelpers["extends"]({},e.$1,{isCastPending:!1});e.$12(a)}))};e.startAlbumSlideshow=function(a){var e=this,f=a.albumID;a=a.environment;if(this.$1.isCastPending)return;this.$12(babelHelpers["extends"]({},this.$1,{isCastPending:!0}));this.$13(null);c("promiseDone")((h||(h=b("Promise"))).all([d("fetchCtvCastPayload").fetchAlbumCastPayload({albumID:f,castSessionID:this.$3,environment:a}),this.$4.getSession().then(function(a){e.$12(babelHelpers["extends"]({},e.$1,{receiverIsConnected:!0}));return a})]).then(function(a){var f=a[0];a[1];if(f.type==="album_cannot_be_casted"){c("recoverableViolation")("The album is not eligible to be casted.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(c("err")("album_cannot_be_casted"),{})});return(h||(h=b("Promise"))).resolve()}else if(f.type==="error"){c("recoverableViolation")("There was a failure retrieving album cast payload.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(f.error,{})});return(h||(h=b("Promise"))).resolve()}a=e.$4.startCasting(k,{},f.payload);return a.then(function(){var a=babelHelpers["extends"]({},e.$1,e.$15());e.$12(a);a=d("CastingState").initialPhotoAlbumExperienceState();e.$13(a)})})["catch"](function(a){d("CastingErrorUtils").isChromecastError(a,"cancel")||c("recoverableViolation")("Failed to cast album.","comet_cast_sender",{error:d("CastingErrorUtils").appendCastingMetadataToExpandedError(c("getErrorSafe")(a),{})})})["finally"](function(){var a=babelHelpers["extends"]({},e.$1,{isCastPending:!1});e.$12(a)}))};e.disconnect=function(){c("promiseDone")(this.$4.stopCasting())};e.play=function(){c("promiseDone")(this.$4.playVideo())};e.pause=function(){c("promiseDone")(this.$4.pauseVideo())};e.setVolume=function(a){c("promiseDone")(this.$4.setVolume(a))};e.mute=function(){c("promiseDone")(this.$4.mute())};e.unmute=function(){c("promiseDone")(this.$4.unmute())};e.seek=function(a){c("promiseDone")(this.$4.seekVideo(a))};e.showSingleMedia=function(a){var b=null;switch(a.type){case"photo":b={photo_id:a.photoID};break;case"video":b={video_id:a.videoID};break;default:a.type;return}c("promiseDone")(this.$4.showPhoto({media_parameters:b,request_id:c("uuidv4")()}))};e.playAlbumSlideshow=function(){c("promiseDone")(this.$4.playAlbumSlideshow())};e.pauseAlbumSlideshow=function(){c("promiseDone")(this.$4.pauseAlbumSlideshow())};e.nextPhotoAlbumSlideshow=function(){c("promiseDone")(this.$4.nextPhotoAlbumSlideshow())};e.previousPhotoAlbumSlideshow=function(){c("promiseDone")(this.$4.previousPhotoAlbumSlideshow())};e.$12=function(a){a!==this.$1&&(this.$1=a,this.$5.slice().forEach(function(b){b(a)}))};e.$13=function(a){a!==this.$2&&(this.$2=a,this.$6.slice().forEach(function(b){b(a)}))};e.$14=function(a){this.$7.slice().forEach(function(b){b(a)})};e.$16=function(a){var b=this.$1,d=this.$2;if(d!=null&&d.type==="video_channel"){var e=a.data.video_id,f=this.$4.getVolume()||0,g=this.$4.isMuted()||!1;e!=null&&this.$14({data:{playbackState:a.data.state,playerInfo:(a==null?void 0:a.player_info)||null,receiverInfo:(a==null?void 0:a.receiver_info)||null,type:"video_status_update",videoID:e},timestamp:(i||(i=c("performanceAbsoluteNow")))()});g={receiverIsConnected:!0,receiverIsMuted:g,receiverVolume:f};if(e==null)this.$12(babelHelpers["extends"]({},b,g)),this.$13(babelHelpers["extends"]({},d,{currentDuration:null,currentPlaybackState:null,currentPosition:null,currentVideoID:null}));else{f=babelHelpers["extends"]({},b,g);this.$12(f);this.$13(babelHelpers["extends"]({},d,{currentDuration:a.data.duration!=null?a.data.duration:d.currentDuration,currentPlaybackState:a.data.state,currentPosition:a.data.position,currentVideoID:e}))}}};e.$17=function(a){var b=this.$2;if(b!=null&&b.type==="photo_album"&&a.data.name==="PhotoAlbum"){var c;a=d("TV2CommsParseUtils").parseCastingReceiverPhotoAlbumReportedState(a.data.payload);a=a.media_state;c=((c=(c=a.photo_state)==null?void 0:c.photo_id)!=null?c:(c=a.video_state)==null?void 0:c.video_id)||null;a=this.$18(a);this.$13(babelHelpers["extends"]({},b,{currentAssetID:c,currentPlaybackState:a}))}};e.$15=function(){return{receiverFriendlyName:this.$4.getFriendlyName()||null,receiverIsMuted:this.$4.isMuted()||null,receiverVolume:this.$4.getVolume()||0}};e.$18=function(a){if(a.photo_state!=null)return a.photo_state.photo_playback_state==="play"?"play":"paused";else if(a.video_state!=null)return["play","seeking"].includes(a.video_state.video_playback_state)?"play":"paused";else return null};return a}();g["default"]=a}),98);
__d("CastingEventReporter",["ConnectedTvLoggingFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$4=function(a){switch(a.data.type){case"cast_requested":b.logWithAvailableContext({event:"cast_requested",video_id_override:a.data.videoID});b.$5(a);break;case"photo_cast_requested":b.logWithAvailableContext({event:"photo_cast_requested"});b.$5(a);break;case"cast_failed":b.$5(a);break;case"video_status_update":b.$6(a.data.receiverInfo,a.data.playerInfo);b.$5(a);break;default:break}};this.$1=null;this.$2=null;this.$3={cast_session_id:a,is_google_cast_bg:null,third_party_app_id:null,tv_os_version:null,tv_player_instance_key:null,tv_player_version:null,tv_session_id:null,tv_web_client_revision:null}}var b=a.prototype;b.destroy=function(){this.$1!=null&&this.$1(),this.$1=null};b.bindToCastingController=function(a){this.$1=a.subscribeToCastingEvent(this.$4)};b.logWithAvailableContext=function(a){var b=this;c("ConnectedTvLoggingFalcoEvent").log(function(){return babelHelpers["extends"]({},b.$3,a)})};b.$5=function(a){var b=a.data;switch(b.type){case"cast_requested":this.$2={data:b,timestamp:a.timestamp};break;case"cast_failed":var c=this.$2;this.logWithAvailableContext({event:"cast_failed",perf_time_ms:Math.floor(c!=null?a.timestamp-c.timestamp:0),video_id_override:b.videoID});this.$2=null;break;case"video_status_update":c=this.$2;if(c==null)break;var d=c.data.videoID;b.videoID===d&&b.playbackState==="play"?(this.logWithAvailableContext({event:"cast_started",perf_time_ms:Math.floor(a.timestamp-c.timestamp)}),this.$2=null):b.videoID!==d&&(this.$2=null);break}};b.$6=function(a,b){var c=(a==null?void 0:a.third_party_app_id)||null,d=(a==null?void 0:a.cast_receiver_logger_session_id)||null,e=(a==null?void 0:a.is_google_cast_bg)||null,f=(a==null?void 0:a.os_version)||null;a=(a==null?void 0:a.web_client_revision)||null;var g=(b==null?void 0:b.player_instance_key)||null;b=(b==null?void 0:b.player_version)||null;this.$3=babelHelpers["extends"]({},this.$3,{is_google_cast_bg:e,third_party_app_id:c,tv_os_version:f,tv_player_instance_key:g,tv_player_version:b,tv_session_id:d,tv_web_client_revision:a})};return a}();g["default"]=a}),98);
__d("TV2MessageTypes",[],(function(a,b,c,d,e,f){"use strict";a="urn:x-cast:com.facebook.fb";b="urn:x-cast:com.google.cast.media";f.FBAPP_CAST_PROTOCOL_NAMESPACE=a;f.GOOGLE_CAST_MEDIA_PROTOCOL_NAMESPACE=b}),66);
__d("TV2PhotoShowRequest",[],(function(a,b,c,d,e,f){"use strict";function a(a){return k(JSON.parse(a),m("TV2PhotoShowRequest"))}function b(a){return JSON.stringify(l(a,m("TV2PhotoShowRequest")),null,2)}function g(a,b,c){c===void 0&&(c="");if(c)throw Error('Invalid value for key "'+c+'". Expected type '+JSON.stringify(a)+" but got "+JSON.stringify(b));throw Error("Invalid value "+JSON.stringify(b)+" for type "+JSON.stringify(a))}function h(a){if(a.jsonToJS===void 0){var b={};a.props.forEach(function(a){return b[a.json]={key:a.js,typ:a.typ}});a.jsonToJS=b}return a.jsonToJS}function i(a){if(a.jsToJSON===void 0){var b={};a.props.forEach(function(a){return b[a.js]={key:a.json,typ:a.typ}});a.jsToJSON=b}return a.jsToJSON}function j(a,b,c,d){d===void 0&&(d="");function e(b,a){return typeof b===typeof a?a:g(b,a,d)}function f(b,a){var d=b.length;for(var e=0;e<d;e++){var f=b[e];try{return j(a,f,c)}catch(a){}}return g(b,a)}function h(b,a){return b.indexOf(a)!==-1?a:g(b,a)}function i(b,a){return!Array.isArray(a)?g("array",a):a.map(function(a){return j(a,b,c)})}function k(a){if(a===null)return null;var b=new Date(a);return isNaN(b.valueOf())?g("Date",a):b}function l(b,d,a){if(a===null||typeof a!=="object"||Array.isArray(a))return g("object",a);var e={};Object.getOwnPropertyNames(b).forEach(function(d){var f=b[d];d=Object.prototype.hasOwnProperty.call(a,d)?a[d]:void 0;e[f.key]=j(d,f.typ,c,f.key)});Object.getOwnPropertyNames(a).forEach(function(f){Object.prototype.hasOwnProperty.call(b,f)||(e[f]=j(a[f],d,c,f))});return e}if(b==="any")return a;if(b===null)return a===null?a:g(b,a);if(b===!1)return g(b,a);while(typeof b==="object"&&b.ref!==void 0)b=n[b.ref];if(Array.isArray(b))return h(b,a);if(typeof b==="object")return Object.prototype.hasOwnProperty.call(b,"unionMembers")?f(b.unionMembers,a):Object.prototype.hasOwnProperty.call(b,"arrayItems")?i(b.arrayItems,a):Object.prototype.hasOwnProperty.call(b,"props")?l(c(b),b.additional,a):g(b,a);return b===Date&&typeof a!=="number"?k(a):e(b,a)}function k(a,b){return j(a,b,h)}function l(a,b){return j(a,b,i)}function c(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return{unionMembers:b}}function d(a,b){return{props:a,additional:b}}function m(a){return{ref:a}}var n={TV2PhotoShowRequest:d([{json:"media_parameters",js:"media_parameters",typ:m("MediaParameters")},{json:"request_id",js:"request_id",typ:""}],"any"),MediaParameters:d([{json:"photo_id",js:"photo_id",typ:c(void 0,"")},{json:"video_id",js:"video_id",typ:c(void 0,"")}],"any")};e.exports={TV2PhotoShowRequestToJson:b,toTV2PhotoShowRequest:a}}),null);
__d("CastingReceiverManager",["CastingChromecastScanner","Promise","Random","SubscriptionsHandler","TV2CommsParseUtils","TV2MessageTypes","TV2PhotoShowRequest","promiseDone","removeFromArray","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i="1.2.0";a=function(){function a(a){var b=this;this.$5=null;this.$6=null;this.$10=null;this.$11=[];this.$12=[];this.$13=[];this.$14=[];this.$15=[];this.$16=[];this.$17=[];this.$18=[];this.$19=[];this.$4=new(c("CastingChromecastScanner"))(a,d("TV2MessageTypes").FBAPP_CAST_PROTOCOL_NAMESPACE);this.$2=null;this.$1=!1;this.$3=0;this.$6=null;this.$9=new Map();this.$20=new(c("SubscriptionsHandler"))();this.$20.addSubscriptions(this.$4.onStatusChanged(function(a){var c=a.foundReceiver;b.$15.slice().forEach(function(a){a(!!c)})}),this.$4.onSessionDisconnected(function(){b.$21(),b.$14.slice().forEach(function(a){a()})}),this.$4.onSessionStarted(function(a){b.$22(a)}),this.$4.onError(function(a,c){b.$11.slice().forEach(function(b){b(a,c)})}));this.$7=this.$4.init();c("promiseDone")(this.$7.then(function(){b.$2=!0,b.$1=!0,b.$13.slice().forEach(function(a){a()})},function(a){b.$2=!1,b.$12.slice().forEach(function(b){b(a)})}))}var e=a.prototype;e.ready=function(){return this.$7};e.hasSupport=function(){return this.$2};e.hasFoundReceiver=function(){return this.$4.hasFoundReceiver()};e.isCasting=function(a){var b=!!this.$5&&this.$5.isCasting();b&&a!=null&&(b=this.$6!=null&&this.$6.indexOf(a)>=0);return b};e.getSession=function(){var a=this;return this.ready().then(function(){var b=a.$5;b!=null&&!b.isConnected()&&a.$21()}).then(function(){if(a.$5)return a.$5;a.$8||(a.$8=a.$23());return a.$8})["catch"](function(b){a.$11.slice().forEach(function(a){a(b,"CastingReceiverManager.getSession")});throw b})["finally"](function(){a.$8=null})};e.startCasting=function(a,b,c){var d=this;return this.$24(a,b,c).then(function(a){a.success?d.$6=a.target:d.$6=null})};e.stopCasting=function(){var a=this;return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.ready().then(function(){var b=a.$5;b!=null&&b.isDisconnected()&&a.$21();return a.$5}).then(function(a){return a==null?(h||(h=b("Promise"))).resolve(null):a.disconnect()}).then(function(){a.$21()})};e.playVideoNow=function(a,c){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("next_video",babelHelpers["extends"]({},a,{auto_advance:!0}),c).then(function(){})};e.skipToNextVideo=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("skip_video").then(function(){})};e.playVideo=function(a){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("play_video",{position:a||0}).then(function(){})};e.pauseVideo=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("pause_video").then(function(){})};e.seekVideo=function(a){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("seek_video",{position:a}).then(function(){})};e.showPhoto=function(a){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("show_photo",void 0,d("TV2PhotoShowRequest").TV2PhotoShowRequestToJson(a),"Photo").then(function(){})};e.stopVideo=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("stop_video").then(function(){})};e.playAlbumSlideshow=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("play_photo",void 0,void 0,"PhotoAlbum").then(function(){})};e.pauseAlbumSlideshow=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("pause_photo",void 0,void 0,"PhotoAlbum").then(function(){})};e.nextPhotoAlbumSlideshow=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("next_photo",void 0,void 0,"PhotoAlbum").then(function(){})};e.previousPhotoAlbumSlideshow=function(){return!this.isCasting()?(h||(h=b("Promise"))).resolve():this.$25("previous_photo",void 0,void 0,"PhotoAlbum").then(function(){})};e.getFriendlyName=function(){return this.$5==null?null:this.$5.getFriendlyName()};e.getVolume=function(){return this.$5==null?null:this.$5.getVolume()};e.setVolume=function(a){if(!this.isCasting())return(h||(h=b("Promise"))).resolve();return this.$5==null?(h||(h=b("Promise"))).resolve():this.$5.setVolume(a)};e.isMuted=function(){if(!this.isCasting())return null;return this.$5==null?null:this.$5.isMuted()};e.mute=function(){if(!this.isCasting())return(h||(h=b("Promise"))).resolve();return this.$5==null?(h||(h=b("Promise"))).resolve():this.$5.mute()};e.unmute=function(){if(!this.isCasting())return(h||(h=b("Promise"))).resolve();return this.$5==null?(h||(h=b("Promise"))).resolve():this.$5.unmute()};e.$26=function(){var a=this,b=this.$27();return this.$28(function(a){return{data:{client_cast_session:b,version:i},num:a,target:"version",timestamp:Date.now(),type:"version_request"}}).then(function(b){var c=b.messageNum;return a.$29(function(a){return a.response_num===c})}).then(function(a){if(a.type!=="version_response")throw c("unrecoverableViolation")('Response message was not a "version_response"',"comet_cast_sender");if(a.data==null)throw c("unrecoverableViolation")("Version response is missing data","comet_cast_sender");return a.data})};e.$24=function(a,b,d){var e=this,f=this.$27();return this.$28(function(c){return{data:{client_cast_session:f,name:a,params:b,payload:d,version:i},num:c,target:"version_launch",timestamp:Date.now(),type:"version_launch"}}).then(function(a){var b=a.messageNum;return e.$29(function(a){return a.response_num===b})}).then(function(a){if(a.type!=="version_launch_response")throw c("unrecoverableViolation")('Response message was not a "version_launch_response"',"comet_cast_sender");if(a.data==null)throw c("unrecoverableViolation")("Version launch response is missing data","comet_cast_sender");return a.data})};e.$30=function(){var a=this;return this.$6!=null?(h||(h=b("Promise"))).resolve(this.$6):this.getSession().then(function(b){return a.$26()}).then(function(b){var d=null;typeof b.currently_running_experience==="object"&&(d=b.currently_running_experience);if(d==null)throw c("unrecoverableViolation")("Session has no target","comet_cast_sender");a.$6=d;return a.$6})};e.$27=function(){var a=null;localStorage&&(a=localStorage.getItem("CastingSessionKey"));a==null&&(a=c("Random").uint32().toString(16),localStorage&&localStorage.setItem("CastingSessionKey",a));return a};e.$28=function(a){var b=this.$3+=2;return this.getSession().then(function(d){if(d==null)throw c("unrecoverableViolation")("The message can not be sent without a session","comet_cast_sender");var e=a(b);return d.sendMessage(e)}).then(function(){return{messageNum:b}})};e.$29=function(a){return this.getSession().then(function(e){if(e==null)throw c("unrecoverableViolation")("The message cannot be received without a session","comet_cast_sender");return new(h||(h=b("Promise")))(function(b,c){var f=e.onMessage(function(e){try{e=d("TV2CommsParseUtils").parseTV2CommsFBAppOutboundMessageFromJSON(e);if(e.type==="version_response"||e.type==="version_launch_response"||e.type==="experience_state"||e.type==="command_result"){var g=!a||a(e);g&&(f.remove(),b(e))}}catch(a){f.remove(),c(a)}})})})};e.$25=function(a,b,d,e){var f=this;return this.$30().then(function(c){return f.$28(function(f){return{data:{cmd:a,name:e,params:b,payload:d},num:f,target:c,timestamp:Date.now(),type:"experience_command"}})}).then(function(a){var b=a.messageNum;return f.$29(function(a){return a.response_num===b})}).then(function(a){if(a.type!=="command_result")throw c("unrecoverableViolation")('Response message was not a "command_result"',"comet_cast_sender");return a.data})};e.$23=function(){var a=this;return this.$4.getSession().then(function(b){a.$5==null&&(a.$5=b);return a.$5})};e.$22=function(a){var b=this;this.$5=a;var e="extension";this.$8&&(e="site");c("promiseDone")(this.$26().then(function(c){var f=c.success;if(!f)return;var g=null;typeof c.currently_running_experience==="object"&&(g=c.currently_running_experience);g!=null&&(b.$6=g);b.$18.slice().forEach(function(c){c(a,{session:a,source:e,success:f,target:b.$6})});b.$10=a.onMessage(function(a){try{var c=d("TV2CommsParseUtils").parseTV2CommsFBAppOutboundMessageFromJSON(a);b.$17.slice().forEach(function(a){a(c)})}catch(a){b.$11.slice().forEach(function(b){b(a,"CastingReceiverManager._onSessionStartedHandler")})}})}))};e.$21=function(){this.$10!=null&&(this.$10.remove(),this.$10=null);var a=this.$5;a!=null&&a.destroy();this.$5=null;this.$6=null};e.onError=function(a){var b=this.$11;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onExperienceNotSupported=function(a){var b=this.$12;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onExperienceReady=function(a){var b=this.$13;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onReceiverDisconnected=function(a){var b=this.$14;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onReceiverStatusChanged=function(a){var b=this.$15;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionDisconnected=function(a){var b=this.$16;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionMessage=function(a){var b=this.$17;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onSessionStarted=function(a){var b=this.$18;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};e.onStopView=function(a){var b=this.$19;b.push(a);return{remove:function(){c("removeFromArray")(b,a)}}};return a}();g["default"]=a}),98);
__d("CastingControllerHooks",["CastingContext","CastingController","CastingEventReporter","CastingReceiverManager","CurrentUser","ExecutionEnvironment","Promise","guid","qex","react","react-compiler-runtime","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;f=j||d("react");var k=f.useContext,l=f.useEffect,m=f.useState,n=null,o=c("qex")._("1648");function p(){if(n!=null)return n;if(o==null)throw c("unrecoverableViolation")("Use useIsCastAvailable first to check if casting feature is available in this browser.","comet_cast_sender");var a=new(c("CastingReceiverManager"))(o),b=c("guid")(),d=new(c("CastingController"))(a,b);b=new(c("CastingEventReporter"))(b);b.bindToCastingController(d);n={castingController:d,castingEventReporter:b,castingReceiverManager:a};return n}function q(){var a=r();a=a.castingReceiverManager;return a}function r(){var a=d("react-compiler-runtime").c(1);if((i||(i=c("ExecutionEnvironment"))).canUseDOM&&c("CurrentUser").isLoggedIn()){var e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=p(),a[0]=e):e=a[0];return e}throw new(h||(h=b("Promise")))(s)}function s(){}function t(){var a=r();a=a.castingController;return a}function a(){var a=d("react-compiler-runtime").c(6),b=q(),c=k(d("CastingContext").SetCastingControllerContext),e=m(!1),f=e[0],g=e[1];e=m(!1);var h=e[0],i=e[1],j;a[0]!==b?(e=function(){var a=b.onExperienceReady(function(){g(b.hasSupport()||!1)});g(b.hasSupport()||!1);return function(){return a.remove()}},j=[b],a[0]=b,a[1]=e,a[2]=j):(e=a[1],j=a[2]);l(e,j);a[3]!==b?(e=function(){var a=b.onReceiverStatusChanged(function(){i(b.hasFoundReceiver()||!1)});i(b.hasFoundReceiver()||!1);return function(){return a.remove()}},j=[b],a[3]=b,a[4]=e,a[5]=j):(e=a[4],j=a[5]);l(e,j);if(o==null)return!1;if(c==null)return!1;if(!f)return!1;return!h?!1:!0}function e(){var a=d("react-compiler-runtime").c(4),b=t(),e=k(d("CastingContext").SetCastingControllerContext);if(e==null)throw c("unrecoverableViolation")("Casting has to be initialized inside CastingProvider.","comet_cast_sender");var f,g;a[0]!==b||a[1]!==e?(f=function(){e(b)},g=[e,b],a[0]=b,a[1]=e,a[2]=f,a[3]=g):(f=a[2],g=a[3]);l(f,g)}g.useCastingController=t;g.useIsCastAvailable=a;g.useCastingInitializeIfNecessary=e}),98);
__d("CastingStateHooks",["CastingContext","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useContext;function a(){var a=i(d("CastingContext").CastingStateContext);return(a==null?void 0:a.receiverIsConnected)||!1}function j(){var a=t();return a==null?null:a.currentVideoID}function b(){var a=j();return a!=null}function c(){var a=t();return a==null?0:a.currentPosition||0}function e(){var a=t();return a==null?0:a.currentDuration||0}function f(){var a=t();if(a==null)return!1;a=a.currentPlaybackState;return a==="play"||a==="seeking"}function k(){var a=t();if(a==null)return!1;a=a.currentPlaybackState;return a==="paused"}function l(){var a=t();if(a==null)return!1;a=a.currentPlaybackState;return a==="ended"}function m(){var a=i(d("CastingContext").CastingStateContext);return a==null||!a.receiverIsConnected?!1:a.receiverIsMuted===!0}function n(){var a=i(d("CastingContext").CastingStateContext);return a==null||!a.receiverIsConnected?0:a.receiverVolume||0}function o(){var a=i(d("CastingContext").CastingStateContext);return a==null||!a.receiverIsConnected?null:a.receiverFriendlyName}function p(){var a=u();return a==null?!1:!0}function q(){var a=v();return a==null?!1:a.currentPlaybackState==="paused"}function r(){var a=v();return a==null?!1:a.currentPlaybackState==="play"}function s(){var a=v();return a==null?null:a.currentAssetID}function t(){var a=i(d("CastingContext").CastingStateContext),b=i(d("CastingContext").CastingExperienceStateContext);if(a==null||!a.receiverIsConnected)return null;return(b==null?void 0:b.type)!=="video_channel"?null:b}function u(){var a=i(d("CastingContext").CastingStateContext),b=i(d("CastingContext").CastingExperienceStateContext);if(a==null||!a.receiverIsConnected)return null;return(b==null?void 0:b.type)!=="photo"?null:b}function v(){var a=i(d("CastingContext").CastingStateContext),b=i(d("CastingContext").CastingExperienceStateContext);if(a==null||!a.receiverIsConnected)return null;return(b==null?void 0:b.type)!=="photo_album"?null:b}g.useIsCastingConnected=a;g.useCastingVideoID=j;g.useIsCastingAnyVideo=b;g.useCastingCurrentTime=c;g.useCastingDuration=e;g.useCastingIsPlaying=f;g.useCastingIsPaused=k;g.useCastingIsEnded=l;g.useCastingIsMuted=m;g.useCastingVolume=n;g.useCastingReceiverFriendlyName=o;g.useIsCastingPhotoExperience=p;g.useCastingIsAlbumPaused=q;g.useCastingIsAlbumPlaying=r;g.useCastingAlbumAssetID=s}),98);
__d("CometPictureInPictureExpContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({pictureInPictureExpConfig:{isInPictureInPictureExp:!1,isInPictureInPictureExpControlGroup:!1,isSkipAndChainingDisabled:!1},setPictureInPictureExpConfig:function(){}});g["default"]=b}),98);
__d("CometSetWatchAndScrollVideoContext",["react","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(function(){c("recoverableViolation")("No provider of CometSetWatchAndScrollVideoContext exists","comet_video_player")});g["default"]=b}),98);
__d("CometTahoeCustomVideoAreaContext",["emptyFunction","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;b.useMemo;var j=b.useState,k=i.createContext({customVideoAreaHidden:!0,setCustomVideoAreaHidden:c("emptyFunction")});function a(a){var b=d("react-compiler-runtime").c(5);a=a.children;var c=j(!0),e=c[0];c=c[1];b[0]!==e?(c={customVideoAreaHidden:e,setCustomVideoAreaHidden:c},b[0]=e,b[1]=c):c=b[1];e=c;c=e;b[2]!==a||b[3]!==c?(e=i.jsx(k.Provider,{value:c,children:a}),b[2]=a,b[3]=c,b[4]=e):e=b[4];return e}g.CometTahoeCustomVideoAreaContext=k;g.CometTahoeCustomVideoAreaContextProvider=a}),98);
__d("CometTahoeSidePaneContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b={rightRailExpanded:!1,rightRailHidden:!1,setRightRailExpanded:function(){},setRightRailHidden:function(){}};c=a.createContext(b);g["default"]=c}),98);
__d("CometWatchAndScrollVideoContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(null);g["default"]=b}),98);
__d("XCometWatchControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/watch/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("CometVideoPictureInPictureManager.react",["CometSetWatchAndScrollVideoContext","CometVideoPictureInPictureManagerContext","CometWatchAndScrollVideoContext","XCometWatchControllerRouteBuilder","clearTimeout","gkx","react","requireDeferred","setTimeout","useCometRouterDispatcher","useMinifiedProductAttribution"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useCallback,k=b.useContext,l=b.useEffect,m=b.useMemo,n=b.useRef,o=b.useState,p=c("requireDeferred")("VideoHomeTypedLiteLogger").__setRef("CometVideoPictureInPictureManager.react"),q=c("gkx")("22889"),r=50;e=["286211568997787","214604021960500","108677131037"];var s=window.document.pictureInPictureEnabled;function a(a){var b=a.children;a=a.isPipEnabled;var e=c("useCometRouterDispatcher")(),f=a;a=o(null);var g=a[0],h=a[1];a=o(!1);var t=a[0],u=a[1];a=o(!1);var v=a[0],w=a[1],x=n(!1);a=j(function(a){x.current=a},[]);var y=m(function(){return{hasNextChainedVideo:v,isPipEnabled:f,setHasNextChainedVideo:w,setSkippedFromPipPlayer:u,skippedFromPipPlayer:t}},[t,u,v,w,f]),z=o(null),A=z[0],B=z[1],C=k(c("CometWatchAndScrollVideoContext")),D=k(c("CometSetWatchAndScrollVideoContext")),E=n(null),F=n(null),G=c("useMinifiedProductAttribution")(),H=j(function(a){a===void 0&&(a=null),p.onReady(function(b){b.log({attribution_id_v2:G,click_point:a,event:"click"})})},[]),I=j(function(){var a=C==null?void 0:C.videoID,b=C==null?void 0:C.videoUrl;if(a!=null&&b!=null){var d=C==null?void 0:C.routeTracePolicy,f=C==null?void 0:C.subOrigin;b=q?b:c("XCometWatchControllerRouteBuilder").buildURL({v:a});e&&(e.go(b,{passthroughProps:{portableVideoID:A,portalingRouteTracePolicy:d,portalingSubOrigin:f}}),D(null))}},[e,C,A,D]),J=j(function(){g!=null&&(E.current=c("setTimeout")(function(){var a=g.getCurrentState(),b=a.lastPauseReason;a=a.paused;x.current||(f&&(a===!1||a===!0&&b==="product_initiated")?(I(),H("control_pip_player_return_to_tab")):window.document.pictureInPictureElement===null&&(D(null),H("control_pip_player_close")))},r))},[g,f,I,D,H]),K=j(function(){g!=null&&(x.current||(window.navigator.mediaSession.setActionHandler("play",null),window.navigator.mediaSession.setActionHandler("pause",null),window.navigator.mediaSession.setActionHandler("pause",function(){g.pause("product_initiated")})),v||window.navigator.mediaSession.setActionHandler("nexttrack",null))},[g,v,H,a]),L=j(function(a){a.requestPictureInPicture();R(!1);a=a.internal_getVideoElement();F.current=a==null?void 0:a.currentSrc},[]),M=j(function(){if(g!=null){var a=g.getIsDesktopPictureInPicture();if(a){g.exitPictureInPicture();return}L(g)}},[L,g]),N=j(function(a){h(a)},[h]),O=j(function(a){a!=null&&B(a)},[B]);z=m(function(){return{openPipPlayer:M,setController:N,setPipPortableVideoID:O}},[M,N,O]);var P=n(!1);a=o(!1);var Q=a[0],R=a[1];l(function(){var a=null;if(s&&g!=null&&window.document.pictureInPictureElement){var b=g.internal_getVideoElement();b=b==null?void 0:b.currentSrc;var c=!1,d=!1;a=g.subscribe(function(){var a=g.getCurrentState(),b=a.playing;a=a.isDesktopPictureInPicture;!c&&b&&P.current&&!x.current&&(P.current=!1,R(!0));d&&!a&&J();!d&&a&&K();c=b;d=a});b!==F.current?!Q?(g.play("user_initiated"),P.current=!0):L(g):f&&(K(),F.current=b)}return function(){a!=null&&a.remove()}},[L,g,M,v,K,J,f,Q]);l(function(){return function(){E.current!=null&&(c("clearTimeout")(E.current),E.current=null)}},[]);return i.jsx(d("CometVideoPictureInPictureManagerContext").CometVideoPictureInPictureManagerContext.Provider,{value:y,children:i.jsx(d("CometVideoPictureInPictureManagerContext").CometVideoPictureInPictureManagerAPIContext.Provider,{value:z,children:b})})}a.displayName=a.name+" [from "+f.id+"]";g.EXCLUDED_PROVIDERS=e;g.CometVideoPictureInPictureManager=a}),98);
__d("CometWatchAndScrollControlNUXContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b={isVideoPlayerWatchAndScrollControlNUXVisible:!1,setIsVideoPlayerWatchAndScrollControlNUXVisible:null};c=a.createContext(b);g["default"]=c}),98);
__d("CometWatchAndScrollSoundContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({muted:null,setMuted:function(){},setVolume:function(){},volume:null});g["default"]=b}),98);
__d("CometWatchAndScrollTriggerContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b={isControlShown:!1,isTriggerDisabled:!1,setIsControlShown:null,setIsTriggerDisabled:null};c=a.createContext(b);g["default"]=c}),98);
__d("LSOptimisticUpdateThreadDisappearingSetting",["LSIssueNewError","LSIssueNewTask","LSLocalize"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[4]=a})},function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[5]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[4],d[5],void 0,void 0)}]):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("wa_jid",void 0),d[2].set("thread_key",a[0]),d[2].set("disappearing_ttl",a[1]),d[2].set("updated_timestamp",a[2]),d[2].set("updated_by",a[3]),d[2].set("sync_group",c.i64.cast([0,95])),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),"disappearing_setting",c.i64.cast([0,714]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticUpdateThreadDisappearingSettingStoredProcedure";a.__tables__=["user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure",["LSOptimisticUpdateThreadDisappearingSetting","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSOptimisticUpdateThreadDisappearingSetting"),e.threadKey,e.disappearingTtl,e.updatedTimestamp,e.updatedBy);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("useLiveCostreamerTagSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9770086849717179"}),null);
__d("useLiveCostreamerTagSubscription.graphql",["VideoPlayerRelay_video$normalization.graphql","useLiveCostreamerTagSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{kind:"Variable",name:"data",variableName:"input"}],d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},e=[d],f={alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"tagged_page",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"currently_live_video",plural:!1,selections:e,storageKey:null}],storageKey:null},g={args:null,documentName:"useLiveCostreamerTagSubscription",fragmentName:"VideoPlayerCostreamingControl_video",fragmentPropName:"video",kind:"ModuleImport"};e={alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"video",plural:!1,selections:[d,{alias:null,args:null,concreteType:"VideoLiveCostreamingStreamersConnection",kind:"LinkedField",name:"live_costreaming_streamers",plural:!1,selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"nodes",plural:!0,selections:e,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}],storageKey:null};var h={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},i=[{alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"useLiveCostreamerTagSubscription",selections:[{alias:null,args:c,concreteType:"LiveVideoTagSubscribeResponsePayload",kind:"LinkedField",name:"live_video_tag_subscribe",plural:!1,selections:[f,{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"tagged_video",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_see_costreaming_tools",plural:!1,selections:[g],storageKey:null},{alias:null,args:null,concreteType:"VideoLiveCostreamingStreamersConnection",kind:"LinkedField",name:"live_costreaming_streamers",plural:!1,selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"currently_live_video",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometVideoPlayerCostreamingThumbnailRowInner_video"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},e],storageKey:null}],type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"useLiveCostreamerTagSubscription",selections:[{alias:null,args:c,concreteType:"LiveVideoTagSubscribeResponsePayload",kind:"LinkedField",name:"live_video_tag_subscribe",plural:!1,selections:[f,{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"tagged_video",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_see_costreaming_tools",plural:!1,selections:[g,d],storageKey:null},{alias:null,args:null,concreteType:"VideoLiveCostreamingStreamersConnection",kind:"LinkedField",name:"live_costreaming_streamers",plural:!1,selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"currently_live_video",plural:!1,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"video_channel",plural:!1,selections:[h,d],storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"owner",plural:!1,selections:[h,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:i,storageKey:null},d],storageKey:null},{args:null,fragment:b("VideoPlayerRelay_video$normalization.graphql"),kind:"FragmentSpread"},{alias:null,args:null,concreteType:"VideoThumbnail",kind:"LinkedField",name:"preferred_thumbnail",plural:!1,selections:[{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:i,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image_preview_payload",storageKey:null},d],storageKey:null}],storageKey:null},d],storageKey:null}],storageKey:null}],storageKey:null},e],storageKey:null}]},params:{id:b("useLiveCostreamerTagSubscription_facebookRelayOperation"),metadata:{subscriptionName:"live_video_tag_subscribe"},name:"useLiveCostreamerTagSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("useLiveCostreamerTagSubscription.react",["CometRelay","react","react-compiler-runtime","useLiveCostreamerTagSubscription.graphql","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useMemo;function a(a,e,f){var g=d("react-compiler-runtime").c(8),i;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(i=h!==void 0?h:h=b("useLiveCostreamerTagSubscription.graphql"),g[0]=i):i=g[0];i=i;var k;g[1]===Symbol["for"]("react.memo_cache_sentinel")?(k=c("uuidv4")(),g[1]=k):k=g[1];g[2]!==a||g[3]!==e?(k={input:{client_subscription_id:k,tagged_page_id:a,tagged_video_id:e}},g[2]=a,g[3]=e,g[4]=k):k=g[4];g[5]!==f||g[6]!==k?(a={onNext:f,subscription:i,updater:j,variables:k},g[5]=f,g[6]=k,g[7]=a):a=g[7];e=a;i=e;d("CometRelay").useSubscription(i)}function j(a){var b;a=a.getRootField("live_video_tag_subscribe");b=a==null?void 0:(b=a.getLinkedRecord("tagged_page"))==null?void 0:b.getLinkedRecord("currently_live_video");a=a==null?void 0:a.getLinkedRecord("tagged_video");b==null&&a!=null&&a.setValue(null,"if_viewer_can_see_costreaming_tools")}g["default"]=a}),98);
__d("LiveCostreamerTagSubscription.react",["useLiveCostreamerTagSubscription.react"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.onNext,d=a.pageID;a=a.videoID;c("useLiveCostreamerTagSubscription.react")(d,a,b);return null}g["default"]=a}),98);
__d("LiveVideoLatencyMenuContextProvider_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"LiveVideoLatencyMenuContextProvider_video",selections:[{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_use_latency_menu",plural:!1,selections:[{args:null,documentName:"LiveVideoLatencyMenuContextProvider_video_if_viewer_can_use_latency_menu",fragmentName:"VideoPlayerSettingsMenuLatencyPane_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null},action:"NONE",path:"if_viewer_can_use_latency_menu"},{kind:"RequiredField",field:{alias:"if_viewer_can_use_latency_menu_toggle",args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_use_latency_menu",plural:!1,selections:[{args:null,documentName:"LiveVideoLatencyMenuContextProvider_video_if_viewer_can_use_latency_menu_toggle",fragmentName:"VideoPlayerSettingsMenuLatencyPaneToggle_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null},action:"NONE",path:"if_viewer_can_use_latency_menu_toggle"}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("useRelayClientStateWithLocalStorage",["CometRelay","FBLogger","WebStorage","react","useStable"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useCallback,k=b.useEffect,l=new Set();function a(a,b,e,f){var g=l.has(b),i=d("CometRelay").useRelayEnvironment(),m=c("useStable")((h||(h=c("WebStorage"))).getLocalStorage),n=c("useStable")(function(){if(g||m==null)return f;var a=m.getItem(b);try{return a==null||a===""?f:JSON.parse(a)}catch(a){return f}}),o=j(function(c){d("CometRelay").commitLocalUpdate(i,function(d){d=d.get(a);if(d==null)return;if(d.getValue(e)===c)return;d.setValue(c,e);l.add(b)})},[i,e,a,b]);k(function(){if(m==null)return;if(!g)return;var a=JSON.stringify(f);if(a==null)return;try{m.setItem(b,a)}catch(b){b!=null&&typeof b==="object"&&b.code===22&&m.clear();a=c("FBLogger")("use_local_storage");b instanceof Error&&(a=a.catching(b));a.mustfix("Cannot save to local storage.")}},[b,g,m,f]);return[g?f:n,o]}g.useRelayClientStateWithLocalStorage=a}),98);
__d("useSelectedLatencySetting",["react-compiler-runtime","useRelayClientStateWithLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h="_video_LiveVideoLatencyMenuContextProvider_selected_latency_setting";function i(a){if(a==null)return null;switch(a){case"low":case"normal":return a;default:return null}}function a(a,b){var c=d("react-compiler-runtime").c(5);if(c[0]!==b){var e;e=(e=i(b))!=null?e:"normal";c[0]=b;c[1]=e}else e=c[1];b=d("useRelayClientStateWithLocalStorage").useRelayClientStateWithLocalStorage(a,h,"selected_latency_setting",e);a=b[0];e=b[1];c[2]!==a||c[3]!==e?(b=[a,e],c[2]=a,c[3]=e,c[4]=b):b=c[4];return b}g["default"]=a}),98);
__d("LiveVideoLatencyMenu.react",["fbt","CometRelay","LiveVideoLatencyMenuContextProvider_video.graphql","VideoPlayerHooks","react","react-compiler-runtime","recoverableViolation","useSelectedLatencySetting"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=j||(j=d("react"));j.useMemo;f=h._(/*BTDS*/"Latency");var m=[o("low"),o("normal")],n=l.createContext({liveVideoLatencyMenuPaneMatchPointer:null,liveVideoLatencyMenuPaneToggleMatchPointer:null});function o(a){switch(a){case"low":return{description:h._(/*BTDS*/"A near-realtime experience."),title:h._(/*BTDS*/"Low latency"),value:a};case"normal":return{description:h._(/*BTDS*/"Best for performance and slower connections."),title:h._(/*BTDS*/"Normal"),value:a};case"ultra-low":return{description:h._(/*BTDS*/"Best for interactive broadcasts."),title:h._(/*BTDS*/"Ultra-low"),value:a};default:a;c("recoverableViolation")("Setting "+a+" is not valid","gaming_video");return{description:h._(/*BTDS*/"Error"),title:h._(/*BTDS*/"Error"),value:a}}}function a(a,b){var e=d("react-compiler-runtime").c(10),f=(k||(k=d("VideoPlayerHooks"))).useController(),g=k.useLatencyLevel();a=c("useSelectedLatencySetting")(a,b);var h=a[1];e[0]!==g?(b=o(g),e[0]=g,e[1]=b):b=e[1];a=b;b=a.title;e[2]!==f||e[3]!==g||e[4]!==h?(a=function(a){g!==a&&(h(a),f.setLatencyLevel(a))},e[2]=f,e[3]=g,e[4]=h,e[5]=a):a=e[5];a=a;var i;e[6]!==g||e[7]!==a||e[8]!==b?(i={selectedLatencySetting:g,selectedLatencySettingTitle:b,setSelectedLatencySetting:a},e[6]=g,e[7]=a,e[8]=b,e[9]=i):i=e[9];return i}var p=i!==void 0?i:i=b("LiveVideoLatencyMenuContextProvider_video.graphql");function e(a){var b=d("react-compiler-runtime").c(7),c=a.children;a=a.video;a=d("CometRelay").useFragment(p,a);bb0:{if(a==null){var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e={liveVideoLatencyMenuPaneMatchPointer:null,liveVideoLatencyMenuPaneToggleMatchPointer:null},b[0]=e):e=b[0];e=e;break bb0}var f;b[1]!==a.if_viewer_can_use_latency_menu||b[2]!==a.if_viewer_can_use_latency_menu_toggle?(f={liveVideoLatencyMenuPaneMatchPointer:a.if_viewer_can_use_latency_menu,liveVideoLatencyMenuPaneToggleMatchPointer:a.if_viewer_can_use_latency_menu_toggle},b[1]=a.if_viewer_can_use_latency_menu,b[2]=a.if_viewer_can_use_latency_menu_toggle,b[3]=f):f=b[3];e=f}a=e;b[4]!==c||b[5]!==a?(f=l.jsx(n.Provider,{value:a,children:c}),b[4]=c,b[5]=a,b[6]=f):f=b[6];return f}g.LATENCY_MENU_TITLE=f;g.LATENCY_SETTING_OPTIONS=m;g.LiveVideoLatencyMenuContext=n;g.getLiveVideoLatencySettingToInfoMapping=o;g.useLatencySettingState=a;g.LiveVideoLatencyMenuContextProvider=e}),226);
__d("LsMessageClickFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1743853");b=d("FalcoLoggerInternal").create("ls_message_click",a);e=b;g["default"]=e}),98);
__d("MAWBridgeUpdateClientRestoreStatus",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","MAWUpdateClientRestoreStatusOperationType","ReQL","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.encrypted_backups_client_restore_status).filter(function(a){return a.threadId===b})).then(function(b){if(b!=null)return a.encrypted_backups_client_restore_status.delete(b.threadId).then(c("emptyFunction"));else return Promise.resolve()})}function k(a,b,e,f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.encrypted_backups_client_restore_status).getKeyRange(b)).then(function(f){if(f!=null)return a.encrypted_backups_client_restore_status.put({lastUpdated:(h||(h=d("I64"))).of_float(Date.now()),restoreStatus:(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_COMPLETE),serverThreadKey:e,threadId:b});else return Promise.resolve()})}function a(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.encrypted_backups_client_restore_status)).then(function(b){return b.reduce(function(b,c){return b.then(function(){return j(a,c.threadId)})},Promise.resolve())})}async function b(a,b){var e=b.threadId,f=b.action;f===d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus?await a.encrypted_backups_client_restore_status.put({lastUpdated:(h||(h=d("I64"))).of_float(Date.now()),restoreStatus:(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS),serverThreadKey:void 0,threadId:e}):await k(a,b.threadId,void 0,b.ebPrefetch);return Promise.resolve()}g.truncateClientRestoreStatusTable=a;g.call=b}),98);
__d("MAWEncryptedBackupsUpdateGlobalRestoreStatus",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Thread with thread id "," is not currently being tracked, but restore seems to be in progress"]);h=function(){return a};return a}var i=new Set(),j=new Set();function k(a){if(a==="restore")return i;else return j}function a(a,b){b=k(b);b.add(a)}function b(a,b){b=k(b);b.has(a)?b["delete"](a):d("WALogger").WARN(h(),a)}function c(a){a=k(a);return a.size}g.addThreadIdToStatusArray=a;g.removeThreadIdFromStatusArray=b;g.getCurrentGlobalRestoreStatusArrayLength=c}),98);
__d("MAWEphemeralSettingsUpdate",["FBLogger","I64","LSOptimisticUpdateThreadDisappearingSettingStoredProcedure","MAWChatJid","MAWCurrentUser","MAWEphemeralMsgAutoResetSystemId","gkx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWEphemeralSettingsUpdate"),j=c("requireDeferred")("LSFactory").__setRef("MAWEphemeralSettingsUpdate"),k=c("requireDeferred")("WATimeUtils").__setRef("MAWEphemeralSettingsUpdate");async function l(a,b,c,e){a=await a.threads.get(e);if(a!=null){e=a.disappearingSettingUpdatedTs;a=a.disappearingSettingTtl;if(e==null||a==null)return!0;if((h||(h=d("I64"))).lt(e,(h||(h=d("I64"))).of_float(c))&&!(h||(h=d("I64"))).equal(a,(h||(h=d("I64"))).of_int32(b)))return!0}return!1}async function m(a,b,e,f,g,i,k){var m=await l(a,b,e,g);if(!m)return Promise.resolve();i&&c("FBLogger")("labyrinth_web").addMetadata("LABYRINTH_WEB","APP_VERSION","OCCAM_EPHEMERAL_SETTINGS_UPDATE").info("[Occam][Web] Ephemeral Settings Updated.");m=await j.load();return c("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure")(m(a),{disappearingTtl:(h||(h=d("I64"))).of_int32(b),threadKey:g,updatedBy:h.of_string(f?c("MAWEphemeralMsgAutoResetSystemId"):(i=k)!=null?i:d("MAWCurrentUser").getID()),updatedTimestamp:h.of_float(e)})}async function a(a,b,c,d){var e=await i.load();e=await e();return e.runInTransaction(function(e){return m(e,a,b,c,d,!1)},"readwrite")}async function b(a,b,e,f,g){var h=await i.load();h=await h();var j;c("gkx")("11440")&&(j=(await k.load()).castUnixTimeToMillisTime(b));return h.runInTransaction(async function(h){var i=await d("MAWChatJid").toThreadKeyMaybe(h,f);return i!=null?m(h,a,c("gkx")("11440")?j:(await k.load()).castUnixTimeToMillisTime(b),e,i,g):Promise.resolve()},"readwrite")}g.updateEphemeralSettingsWithTxn=m;g.updateEphemeralSettings=a;g.updateEphemeralSettingsByChatJid=b}),98);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWLoggerDeferred","MAWMediaGalleryM2Utils","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","ReQL","WAJobOrchestratorTypes","WATagsLogger","cr:4992","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to restore messages for thread "," with error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""]);o=function(){return a};return a}async function p(a,b){try{b=await d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(i||(i=d("I64"))).of_string(b));if(b!=null){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(b));if(a!=null)return a.minMessageId}}catch(a){return Promise.reject(a)}return}function q(a,b,c){if(b===0)return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((i||(i=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}async function a(a,e,f,g,h,s,t,u,v,w,x,y,z,A,B){A===void 0&&(A=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(B=w)!=null?B:""]).LOG(o(),(B=w)!=null?B:"",f,x,g.length);B=await d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(i||(i=d("I64"))).of_string(f));B==null&&void d("MAWLoggerDeferred").ERROR(n(),f);B=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&x==null&&f!=null;var C=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");await q(a,C,B);try{C=await p(a,f);if(B&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",(B=w)!=null?B:""]).LOG(m(),f);d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(y,w);B={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};await d("MAWBridgeUpdateClientRestoreStatus").call(a,B);await b("cr:4992")(a,e,f,g,h,s,t,u,v,w,x,C,y,z,A)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(B=w)!=null?B:""]).LOG(l(),f,x,g.length);return r(e,f,g,C,h,t,v,w,x,y,z,A).then(function(){w!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:w,type:"echo"})})}}catch(b){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(s=w)!=null?s:""]).ERROR(k(),f,b);return w!=null?d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:w,errorMessage:b,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return Promise.reject(b)}):Promise.reject(b)}}function r(a,b,e,f,g,i,j,k,l,m,n,o){var p=(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWJobManager").getJobManager():d("MAWTimedJob").TimedUIJobStarters;if(k!=null&&m===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION){var q;return p.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,i,j,(q=f)!=null?q:void 0,(q=k)!=null?q:void 0,(q=l)!=null?q:void 0,void 0,void 0,m,{priority:o},n)).then(function(a){if(a.success===!0)d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(k);else{var b;d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(k,(b=a.payload)!=null?b:c("err")(a.error))}})}if(m===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&d("MAWMediaGalleryM2Utils").shouldSkipSyncToLSDB()){return p.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,i,j,(q=f)!=null?q:void 0,(o=k)!=null?o:void 0,(q=l)!=null?q:void 0,void 0,void 0,m,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},n)).then(function(){return Promise.resolve()})}return Promise.resolve(p.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,e,g,i,j,(o=f)!=null?o:void 0,(q=k)!=null?q:void 0,(p=l)!=null?p:void 0,void 0,void 0,m,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},n)))}g.call=a}),98);
__d("MwbCmInformTreatmentEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("6736");b=d("FalcoLoggerInternal").create("mwb_cm_inform_treatment_event",a);e=b;g["default"]=e}),98);
__d("MwbInformTreatmentShownImpressionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("6735");b=d("FalcoLoggerInternal").create("mwb_inform_treatment_shown_impression",a);e=b;g["default"]=e}),98);
__d("VideoPlayerAudioTrackUtils",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";var i=function(a,b){if(b==null)return void 0;a=String(a).substring(0,2);try{return new Intl.DisplayNames([a],{type:"language"}).of(b)}catch(a){return void 0}};a=function(a,b){if(a==null)return h._(/*BTDS*/"Default");b=i(b,a.lang);b=(b=b)!=null?b:h._(/*BTDS*/"Default");var c=null;a.role==="dub"?c=h._(/*BTDS*/"Dubbed"):(a==null?void 0:a.role)==="description"&&(c=h._(/*BTDS*/"Description"));return c!=null?b.toString()+" - "+c.toString():b};g.getAudioTrackLabelLocalized=a}),226);
__d("VideoPlayerCaptionsControl_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerCaptionsControl_video",selections:[{alias:null,args:null,kind:"ScalarField",name:"captions_url",storageKey:null},{args:null,kind:"FragmentSpread",name:"useVideoPlayerAvailableCaptionsLocalesFromRelay_video"}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerCaptionsMenu.react",["fbt","$InternalEnum","CometKeys","VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react","VideoPlayerCaptionsMenuCaptionsDisplayPane.react","VideoPlayerCaptionsMenuMainPane.react","VideoPlayerHooks","react","react-compiler-runtime","useLayerKeyCommands"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react"));e=i;e.useCallback;var l=e.useEffect;e.useMemo;var m=e.useRef,n=e.useState,o=b("$InternalEnum")({CAPTIONS_BG_COLOR:"captionsBackgroundColor",CAPTIONS_BG_OPACITY:"captionsBackgroundOpacity",CAPTIONS_DISPLAY_MAIN:"captionsDisplayMain",CAPTIONS_TEXT_COLOR:"captionsTextColor",CAPTIONS_TEXT_SIZE:"captionsTextSize",CAPTIONS_MAIN:"captionsMain"});function a(a){var b=d("react-compiler-runtime").c(36),e=a.availableCaptionsLocales,f=a.captionsListExpanded,g=a.children,i=a.onClose,p=a.onPressLog,q=a.selectedCaptionsLocale,r=a.setCaptionsListExpanded;a=a.setSelectedCaptionsLocale;g=g===void 0?null:g;var s=(j||(j=d("VideoPlayerHooks"))).useCaptionDisplayStyle(),t=n(o.CAPTIONS_MAIN),u=t[0];t=t[1];var v=m(null),w=m(null),x;b[0]!==i?(x=function(a){v.current&&w.current&&a.target instanceof HTMLElement&&document.contains(a.target)&&!v.current.contains(a.target)&&w.current.contains(a.target)&&i()},b[0]=i,b[1]=x):x=b[1];var y=x,z;b[2]!==y?(x=function(){document.addEventListener("click",y);return function(){document.removeEventListener("click",y)}},z=[y],b[2]=y,b[3]=x,b[4]=z):(x=b[3],z=b[4]);l(x,z);b[5]===Symbol["for"]("react.memo_cache_sentinel")?(x={key:c("CometKeys").ESCAPE},z=h._(/*BTDS*/"Close captions menu"),b[5]=x,b[6]=z):(x=b[5],z=b[6]);b[7]!==i?(x=[{command:x,description:z,handler:function(){i()}}],b[7]=i,b[8]=x):x=b[8];z=x;x=z;c("useLayerKeyCommands")(x);b[9]!==e||b[10]!==f||b[11]!==g||b[12]!==p||b[13]!==q||b[14]!==r||b[15]!==a?(z=k.jsx(d("VideoPlayerCaptionsMenuMainPane.react").VideoPlayerCaptionsMenuMainPane,{availableCaptionsLocales:e,captionsListExpanded:f,onPressLog:p,selectedCaptionsLocale:q,setCaptionsListExpanded:r,setPane:t,setSelectedCaptionsLocale:a,children:g}),b[9]=e,b[10]=f,b[11]=g,b[12]=p,b[13]=q,b[14]=r,b[15]=a,b[16]=z):z=b[16];x=z;bb0:switch(u){case o.CAPTIONS_MAIN:break bb0;case o.CAPTIONS_DISPLAY_MAIN:b[17]!==s||b[18]!==p?(e=k.jsx(d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react").VideoPlayerCaptionsMenuCaptionsDisplayMainPane,{currentCaptionsDisplay:s,onPressLog:p,setPane:t}),b[17]=s,b[18]=p,b[19]=e):e=b[19];x=e;break bb0;case o.CAPTIONS_BG_COLOR:b[20]!==s||b[21]!==p?(f=k.jsx(d("VideoPlayerCaptionsMenuCaptionsDisplayPane.react").VideoPlayerCaptionsMenuCaptionsDisplayPane,{captionsDisplayOption:"captionsBackgroundColor",currentCaptionsDisplay:s,onPressLog:p,setPane:t}),b[20]=s,b[21]=p,b[22]=f):f=b[22];x=f;break bb0;case o.CAPTIONS_BG_OPACITY:b[23]!==s||b[24]!==p?(g=k.jsx(d("VideoPlayerCaptionsMenuCaptionsDisplayPane.react").VideoPlayerCaptionsMenuCaptionsDisplayPane,{captionsDisplayOption:"captionsBackgroundOpacity",currentCaptionsDisplay:s,onPressLog:p,setPane:t}),b[23]=s,b[24]=p,b[25]=g):g=b[25];x=g;break bb0;case o.CAPTIONS_TEXT_SIZE:b[26]!==s?(q=k.jsx(d("VideoPlayerCaptionsMenuCaptionsDisplayPane.react").VideoPlayerCaptionsMenuCaptionsDisplayPane,{captionsDisplayOption:"captionsTextSize",currentCaptionsDisplay:s,setPane:t}),b[26]=s,b[27]=q):q=b[27];x=q;break bb0;case o.CAPTIONS_TEXT_COLOR:b[28]!==s||b[29]!==p?(r=k.jsx(d("VideoPlayerCaptionsMenuCaptionsDisplayPane.react").VideoPlayerCaptionsMenuCaptionsDisplayPane,{captionsDisplayOption:"captionsTextColor",currentCaptionsDisplay:s,onPressLog:p,setPane:t}),b[28]=s,b[29]=p,b[30]=r):r=b[30];x=r}b[31]!==x?(a=k.jsx("div",{ref:v,children:x}),b[31]=x,b[32]=a):a=b[32];b[33]===Symbol["for"]("react.memo_cache_sentinel")?(z=k.jsx("div",babelHelpers["extends"]({className:"x5yr21d x17qophe xixxii4 x13vifvy xh8yej3 x8knxv4"},{"data-testid":void 0,ref:w})),b[33]=z):z=b[33];b[34]!==a?(u=k.jsxs(k.Fragment,{children:[a,z]}),b[34]=a,b[35]=u):u=b[35];return u}g.VideoPlayerCaptionsMenuPaneType=o;g.VideoPlayerCaptionsMenu=a}),226);
__d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react",["fbt","ix","CometImage.react","CometPressable.react","FocusRegion.react","VideoPlayerCaptionsMenu.react","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react"));j.useCallback;var l={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",outline:"x1a2a7pz",paddingTop:"x1y1aw1k",paddingEnd:"x4uap5",paddingBottom:"xwib8y2",paddingStart:"xkhd6sd",textAlign:"x1yc453h",width:"xafpxmx",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0}},m={captionsBackgroundColor:{Black:"BLACK",Blue:"BLUE",Cyan:"CYAN",Green:"GREEN",Magenta:"MAGENTA",Red:"RED",White:"WHITE",Yellow:"YELLOW"},captionsBackgroundOpacity:{"0%":"TRANSPARENT","25%":"LIGHT","45%":"DEFAULT","75%":"DARK","100%":"OPAQUE"},captionsTextColor:{Black:"BLACK",Blue:"BLUE",Cyan:"CYAN",Green:"GREEN",Magenta:"MAGENTA",Red:"RED",White:"WHITE",Yellow:"YELLOW"},captionsTextSize:{"(50%)":"SMALLEST","(75%)":"SMALL","(100%)":"DEFAULT","(125%)":"MEDIUM","(150%)":"BIG","(175%)":"BIGGER","(200%)":"BIGGEST"}},n={"Background Color":{ftbLabel:h._(/*BTDS*/"Background Color"),name:"captionsBackgroundColor"},"Background Opacity":{ftbLabel:h._(/*BTDS*/"Background Opacity"),name:"captionsBackgroundOpacity"},"Text Color":{ftbLabel:h._(/*BTDS*/"Text Color"),name:"captionsTextColor"},"Text Size":{ftbLabel:h._(/*BTDS*/"Text Size"),name:"captionsTextSize"}},o={Black:h._(/*BTDS*/"Black"),Blue:h._(/*BTDS*/"Blue"),Cyan:h._(/*BTDS*/"Cyan"),Green:h._(/*BTDS*/"Green"),Magenta:h._(/*BTDS*/"Magenta"),Red:h._(/*BTDS*/"Red"),White:h._(/*BTDS*/"White"),Yellow:h._(/*BTDS*/"Yellow")};function p(a){var b=null,c=null;switch(a){case"(50%)":b=h._(/*BTDS*/"Small");c="X-";break;case"(75%)":b=h._(/*BTDS*/"Small");break;case"(125%)":b=h._(/*BTDS*/"Large");break;case"(150%)":b=h._(/*BTDS*/"Large");c="X-";break;case"(175%)":b=h._(/*BTDS*/"Large");c="XX-";break;case"(200%)":b=h._(/*BTDS*/"Large");c="XXX-";break;case"(100%)":b=h._(/*BTDS*/"Medium")}return k.jsxs("span",{children:[c!=null&&c,b,a]})}p.displayName=p.name+" [from "+f.id+"]";var q={captionsBackgroundColor:d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_BG_COLOR,captionsBackgroundOpacity:d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_BG_OPACITY,captionsTextColor:d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_TEXT_COLOR,captionsTextSize:d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_TEXT_SIZE};function r(a){var b=d("react-compiler-runtime").c(24),e=a.onPressLog,f=a.option,g=a.optionVal,h=a.setPane,j=n[f].name;b[0]!==j||b[1]!==e||b[2]!==f||b[3]!==h?(a=function(){h(q[j]),e&&e("captions_display_main_menu",f)},b[0]=j,b[1]=e,b[2]=f,b[3]=h,b[4]=a):a=b[4];a=a;var m;bb0:switch(j){case"captionsTextColor":case"captionsBackgroundColor":m=o[g];break bb0;default:m=g}var r=f.replace(" ","");r="video-player-captions-menu-captions-display-main-"+r;var s;b[5]===Symbol["for"]("react.memo_cache_sentinel")?(s={className:"x1ypdohk x1rg5ohu x1nxh6w3 x1s688f x1uncgzr"},b[5]=s):s=b[5];var t=n[f],u;b[6]===Symbol["for"]("react.memo_cache_sentinel")?(u={className:"x1nxh6w3 xo1l8bm"},b[6]=u):u=b[6];var v;b[7]!==j||b[8]!==g||b[9]!==m?(v=j==="captionsTextSize"?p(g):m,b[7]=j,b[8]=g,b[9]=m,b[10]=v):v=b[10];b[11]!==v||b[12]!==r?(g=k.jsx("div",babelHelpers["extends"]({},u,{"data-testid":void 0,children:v})),b[11]=v,b[12]=r,b[13]=g):g=b[13];b[14]!==t.ftbLabel||b[15]!==g?(u=k.jsxs("div",babelHelpers["extends"]({},s,{children:[t.ftbLabel,g]})),b[14]=t.ftbLabel,b[15]=g,b[16]=u):u=b[16];b[17]===Symbol["for"]("react.memo_cache_sentinel")?(v={className:"x1rg5ohu"},r={className:"x1lliihq"},s={display:"table-cell"},b[17]=s,b[18]=v,b[19]=r):(s=b[17],v=b[18],r=b[19]);b[20]===Symbol["for"]("react.memo_cache_sentinel")?(t=k.jsx("div",babelHelpers["extends"]({},v,{children:k.jsx("div",babelHelpers["extends"]({},r,{children:k.jsx("div",{style:s,children:k.jsx(c("CometImage.react"),{src:i("480588")})})}))})),b[20]=t):t=b[20];b[21]!==a||b[22]!==u?(g=k.jsxs(c("CometPressable.react"),{onPress:a,xstyle:l.menuOptionRow,children:[u,t]}),b[21]=a,b[22]=u,b[23]=g):g=b[23];return g}function a(a){var b=d("react-compiler-runtime").c(17),e=a.currentCaptionsDisplay,f=a.onPressLog,g=a.setPane;b[0]!==g?(a=function(){g(d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_MAIN)},b[0]=g,b[1]=a):a=b[1];a=a;var j;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(j={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1s688f x1lku1pv"},b[2]=j):j=b[2];var o;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x6s0dn4 x3nfvp2"},b[3]=o):o=b[3];var p;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(o=k.jsx("span",babelHelpers["extends"]({},o,{children:k.jsx(c("CometImage.react"),{src:i("480580")})})),p=k.jsx("span",babelHelpers["extends"]({className:"x1nxh6w3 x1s688f x16n37ib"},{children:h._(/*BTDS*/"Subtitle Options")})),b[4]=o,b[5]=p):(o=b[4],p=b[5]);b[6]!==a?(j=k.jsx("div",babelHelpers["extends"]({},j,{children:k.jsxs(c("CometPressable.react"),{onPress:a,xstyle:l.pressableOption,children:[o,p]})})),b[6]=a,b[7]=j):j=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x1anpbxc"},b[8]=o):o=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(p=Object.keys(n),b[9]=p):p=b[9];b[10]!==e||b[11]!==f||b[12]!==g?(a=k.jsx("div",babelHelpers["extends"]({},o,{"data-testid":void 0,children:p.map(function(a){var b=n[a].name,c=m[b];c=Object.fromEntries(Object.entries(c).map(s));c=e!=null?c[e[b]]:"";return k.jsx(r,{onPressLog:f,option:a,optionVal:c,setPane:g},a)})})),b[10]=e,b[11]=f,b[12]=g,b[13]=a):a=b[13];b[14]!==j||b[15]!==a?(o=k.jsxs(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:[j,a]}),b[14]=j,b[15]=a,b[16]=o):o=b[16];return o}function s(a){var b=a[0];a=a[1];return[a,b]}g.captionsDisplayOptionsMap=m;g.colorsFBTMap=o;g.getFontSizeDivWithFBTLabel=p;g.VideoPlayerCaptionsMenuCaptionsDisplayMainPane=a}),226);
__d("VideoPlayerCaptionsSettingMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8917695971664599"}),null);
__d("VideoPlayerCaptionsSettingMutation.graphql",["VideoPlayerCaptionsSettingMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"VideoPlayerCaptionsSettingResponsePayload",kind:"LinkedField",name:"video_player_captions_setting",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"success",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VideoPlayerCaptionsSettingMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VideoPlayerCaptionsSettingMutation",selections:c},params:{id:b("VideoPlayerCaptionsSettingMutation_facebookRelayOperation"),metadata:{},name:"VideoPlayerCaptionsSettingMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VideoPlayerCaptionsSettingMutation",["CometRelay","VideoPlayerCaptionsSettingMutation.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("VideoPlayerCaptionsSettingMutation.graphql");function a(a,b,c){return d("CometRelay").commitMutation(a,{mutation:i,onCompleted:c&&c.onCompleted,onError:c&&c.onError,optimisticResponse:{video_captions_setting:{success:!0}},variables:{input:{captions_background_color:b.captions_background_color,captions_background_opacity:b.captions_background_opacity,captions_text_color:b.captions_text_color,captions_text_size:b.captions_text_size,client_mutation_id:"www_captions_settings"}}})}g.commit=a}),98);
__d("VideoPlayerCaptionsMenuCaptionsDisplayPane.react",["fbt","ix","CometImage.react","CometPressable.react","CometRelay","FDSIcon.react","FocusRegion.react","VideoPlayerCaptionsMenu.react","VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react","VideoPlayerCaptionsSettingMutation","VideoPlayerHooks","fbicon","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||(j=d("react")),m=j.useCallback,n={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",outline:"x1a2a7pz",paddingTop:"x1y1aw1k",paddingEnd:"x4uap5",paddingBottom:"xwib8y2",paddingStart:"xkhd6sd",textAlign:"x1yc453h",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0}},o={captionsBackgroundColor:h._(/*BTDS*/"Background Color"),captionsBackgroundOpacity:h._(/*BTDS*/"Background Opacity"),captionsTextColor:h._(/*BTDS*/"Text Color"),captionsTextSize:h._(/*BTDS*/"Text Size")},p=function(a){return{captions_background_color:a.captionsBackgroundColor,captions_background_opacity:a.captionsBackgroundOpacity,captions_text_color:a.captionsTextColor,captions_text_size:a.captionsTextSize}};function q(a){var b=a.captionsDisplayOption,e=a.currentCaptionsDisplay,f=a.onPressLog,g=a.option,h=a.selected,j=a.setPane,o=(k||(k=d("VideoPlayerHooks"))).useController();a=h;var q=d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react").captionsDisplayOptionsMap[b];h=null;switch(b){case"captionsTextColor":case"captionsBackgroundColor":h=d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react").colorsFBTMap[g];break;default:h=g}var r="video-player-captions-menu-captions-display-pane-"+b+"-"+g;r=m(function(){a=!0;if(e!=null){e[b]=q[g];o.setCaptionsDisplayStyle(babelHelpers["extends"]({},e));var c=p(e);d("VideoPlayerCaptionsSettingMutation").commit(s,c)}j(d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_DISPLAY_MAIN);f&&f(b)},[e,q,b,o,g]);var s=d("CometRelay").useRelayEnvironment();return l.jsxs(c("CometPressable.react"),{"aria-pressed":a,onPress:r,testid:void 0,xstyle:n.menuOptionRow,children:[l.jsx("div",babelHelpers["extends"]({className:"x1rg5ohu x1849jeq"},{children:a&&l.jsx("div",{"data-testid":void 0,children:l.jsx(c("FDSIcon.react"),{color:"white",icon:d("fbicon")._(i("477813"),16)})})})),b==="captionsTextSize"?d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react").getFontSizeDivWithFBTLabel(g):l.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1rg5ohu"},{children:h}))]})}q.displayName=q.name+" [from "+f.id+"]";function a(a){var b=d("react-compiler-runtime").c(26),e=a.captionsDisplayOption,f=a.currentCaptionsDisplay,g=a.onPressLog,h=a.setPane;a=o[e];var j=d("VideoPlayerCaptionsMenuCaptionsDisplayMainPane.react").captionsDisplayOptionsMap[e],k=f!=null?f[e]:null,m;b[0]!==h?(m=function(){h(d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_DISPLAY_MAIN)},b[0]=h,b[1]=m):m=b[1];m=m;var p="video-player-captions-menu-captions-display-pane-"+e,r;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(r={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1nxh6w3 x1s688f x1lku1pv"},b[2]=r):r=b[2];var s=p+"-topBar",t;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(t={className:"x6s0dn4 x3nfvp2 x1849jeq"},b[3]=t):t=b[3];b[4]===Symbol["for"]("react.memo_cache_sentinel")?(t=l.jsx("span",babelHelpers["extends"]({},t,{children:l.jsx(c("CometImage.react"),{src:i("480580")})})),b[4]=t):t=b[4];b[5]!==m||b[6]!==a||b[7]!==s?(r=l.jsx("div",babelHelpers["extends"]({},r,{children:l.jsxs(c("CometPressable.react"),{onPress:m,testid:void 0,xstyle:n.pressableOption,children:[t,a]})})),b[5]=m,b[6]=a,b[7]=s,b[8]=r):r=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(t={className:"x1nxh6w3 xo1l8bm x1anpbxc"},b[9]=t):t=b[9];b[10]!==j?(m=Object.keys(j),b[10]=j,b[11]=m):m=b[11];b[12]!==j||b[13]!==k||b[14]!==e||b[15]!==f||b[16]!==g||b[17]!==h||b[18]!==m?(a=m.map(function(a){var b=k===j[a];return l.jsx(q,{captionsDisplayOption:e,currentCaptionsDisplay:f,onPressLog:g,option:a,selected:b,setPane:h},a)}),b[12]=j,b[13]=k,b[14]=e,b[15]=f,b[16]=g,b[17]=h,b[18]=m,b[19]=a):a=b[19];b[20]!==a||b[21]!==p?(s=l.jsx("div",babelHelpers["extends"]({},t,{"data-testid":void 0,children:a})),b[20]=a,b[21]=p,b[22]=s):s=b[22];b[23]!==s||b[24]!==r?(m=l.jsxs(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:[r,s]}),b[23]=s,b[24]=r,b[25]=m):m=b[25];return m}g.VideoPlayerCaptionsMenuCaptionsDisplayPane=a}),226);
__d("VideoPlayerCaptionsMenuMainPane.react",["fbt","ix","CometPressable.react","CometScrollableArea.react","FDSIcon.react","FocusRegion.react","VideoPlayerCaptionsMenuTopBar.react","VideoPlayerHooks","fbicon","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||(j=d("react")),m=j.useEffect,n={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",fontSize:"x1nxh6w3",fontWeight:"xo1l8bm",minWidth:"xfvyar9",outline:"x1a2a7pz",paddingTop:"x1y1aw1k",paddingEnd:"x4uap5",paddingBottom:"xwib8y2",paddingStart:"xkhd6sd",textAlign:"x1yc453h",":hover_backgroundColor":"xx8nu07",$$css:!0}},o=5;function p(a){var b,e,f=d("react-compiler-runtime").c(27),g=a.captions,j=a.captionsVisible,m=a.controller,o=a.focused,p=a.onPressLog,q=a.setSelectedCaptionsLocale;a=(k||(k=d("VideoPlayerHooks"))).useIsVideoBroadcast();a=g.localizedCreationMethod!=null||a;b="video-player-captions-menu-language-list-item-"+((b=g.localizedLanguage)!=null?b:"");var r;f[0]!==g.captionsUrl||f[1]!==g.locale||f[2]!==g.localizedLanguage||f[3]!==j||f[4]!==m||f[5]!==p||f[6]!==q?(r=function(){var a;g.locale!=null&&q(g.locale);j||m.setCaptionsVisible(!0);g.captionsUrl!=null&&m.setCaptionsUrl(g.captionsUrl);p&&p("captions_language_selector",(a=g.localizedLanguage)!=null?a:"")},f[0]=g.captionsUrl,f[1]=g.locale,f[2]=g.localizedLanguage,f[3]=j,f[4]=m,f[5]=p,f[6]=q,f[7]=r):r=f[7];var s;f[8]===Symbol["for"]("react.memo_cache_sentinel")?(s={className:"x1rg5ohu xw4jnvo"},f[8]=s):s=f[8];var t;f[9]!==o||f[10]!==b?(t=o&&l.jsx("div",{"data-testid":void 0,children:l.jsx(c("FDSIcon.react"),{color:"white",icon:d("fbicon")._(i("477813"),16)})}),f[9]=o,f[10]=b,f[11]=t):t=f[11];f[12]!==t?(s=l.jsx("div",babelHelpers["extends"]({},s,{children:t})),f[12]=t,f[13]=s):s=f[13];f[14]===Symbol["for"]("react.memo_cache_sentinel")?(t={className:"x1ypdohk x1rg5ohu x17adc0v xzjbwwf"},f[14]=t):t=f[14];e=(e=g.localizedCountry)!=null?e:null;var u;f[15]!==a?(u=!a&&h._(/*BTDS*/"(Provided by Author)"),f[15]=a,f[16]=u):u=f[16];f[17]!==g.localizedLanguage||f[18]!==e||f[19]!==u?(a=l.jsxs("div",babelHelpers["extends"]({},t,{children:[g.localizedLanguage,e,u]})),f[17]=g.localizedLanguage,f[18]=e,f[19]=u,f[20]=a):a=f[20];f[21]!==o||f[22]!==r||f[23]!==s||f[24]!==a||f[25]!==b?(t=l.jsxs(c("CometPressable.react"),{"aria-pressed":o,onPress:r,testid:void 0,xstyle:n.menuOptionRow,children:[s,a]}),f[21]=o,f[22]=r,f[23]=s,f[24]=a,f[25]=b,f[26]=t):t=f[26];return t}function a(a){var b=d("react-compiler-runtime").c(59),e=a.availableCaptionsLocales,f=a.captionsListExpanded,g=a.children,j=a.onPressLog,q=a.selectedCaptionsLocale,r=a.setCaptionsListExpanded,s=a.setPane,t=a.setSelectedCaptionsLocale,u=(k||(k=d("VideoPlayerHooks"))).useController(),v=k.useCaptionsVisible();a=e!=null?e.length:0;var w,x;b[0]!==v||b[1]!==t?(w=function(){v||t("")},x=[v,t],b[0]=v,b[1]=t,b[2]=w,b[3]=x):(w=b[2],x=b[3]);m(w,x);if(e==null)return null;b[4]!==e||b[5]!==j||b[6]!==s?(w=l.jsx(c("VideoPlayerCaptionsMenuTopBar.react"),{availableCaptionsLocales:e,onPressLog:j,setPane:s}),b[4]=e,b[5]=j,b[6]=s,b[7]=w):w=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(x={className:"x1anpbxc x15eivr9"},b[8]=x):x=b[8];s=q==="";var y;b[9]!==u||b[10]!==t?(y=function(){t(""),u.setCaptionsVisible(!1)},b[9]=u,b[10]=t,b[11]=y):y=b[11];var z;b[12]===Symbol["for"]("react.memo_cache_sentinel")?(z={className:"x1rg5ohu xw4jnvo"},b[12]=z):z=b[12];var A;b[13]!==q?(A=q===""&&l.jsx(c("FDSIcon.react"),{color:"white",icon:d("fbicon")._(i("477813"),16)}),b[13]=q,b[14]=A):A=b[14];b[15]!==A?(z=l.jsx("div",babelHelpers["extends"]({},z,{children:A})),b[15]=A,b[16]=z):z=b[16];b[17]===Symbol["for"]("react.memo_cache_sentinel")?(A=l.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1rg5ohu x17adc0v xzjbwwf"},{children:h._(/*BTDS*/"Off")})),b[17]=A):A=b[17];b[18]!==s||b[19]!==y||b[20]!==z?(A=l.jsxs(c("CometPressable.react"),{"aria-pressed":s,onPress:y,xstyle:n.menuOptionRow,children:[z,A]}),b[18]=s,b[19]=y,b[20]=z,b[21]=A):A=b[21];if(b[22]!==e||b[23]!==v||b[24]!==u||b[25]!==j||b[26]!==q||b[27]!==t){b[29]!==v||b[30]!==u||b[31]!==j||b[32]!==q||b[33]!==t?(s=function(a){var b=a.locale===q;return a.localizedLanguage!=null?l.jsx(p,{captions:a,captionsVisible:v,controller:u,focused:b,onPressLog:j,setSelectedCaptionsLocale:t},a.locale):null},b[29]=v,b[30]=u,b[31]=j,b[32]=q,b[33]=t,b[34]=s):s=b[34];y=e.slice(0,4).map(s);b[22]=e;b[23]=v;b[24]=u;b[25]=j;b[26]=q;b[27]=t;b[28]=y}else y=b[28];b[35]!==a||b[36]!==f||b[37]!==r?(z=a>=o&&!f&&l.jsx(c("CometPressable.react"),{onPress:function(){r(!0)},xstyle:n.menuOptionRow,children:l.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1rg5ohu x1iedhe"},{children:h._(/*BTDS*/"See more")}))}),b[35]=a,b[36]=f,b[37]=r,b[38]=z):z=b[38];b[39]!==e||b[40]!==f||b[41]!==v||b[42]!==u||b[43]!==q||b[44]!==t?(s=f&&e.slice(4).map(function(a){var b=a.locale===q;return a.localizedLanguage!=null?l.jsx(p,{captions:a,captionsVisible:v,controller:u,focused:b,setSelectedCaptionsLocale:t},a.locale):null}),b[39]=e,b[40]=f,b[41]=v,b[42]=u,b[43]=q,b[44]=t,b[45]=s):s=b[45];b[46]!==f||b[47]!==r?(a=f&&l.jsx(c("CometPressable.react"),{onPress:function(){r(!1)},xstyle:n.menuOptionRow,children:l.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1rg5ohu x1iedhe"},{children:h._(/*BTDS*/"See less")}))}),b[46]=f,b[47]=r,b[48]=a):a=b[48];b[49]!==A||b[50]!==y||b[51]!==z||b[52]!==s||b[53]!==a?(e=l.jsx(c("CometScrollableArea.react"),{hideScrollbar:!0,children:l.jsxs("div",babelHelpers["extends"]({},x,{"data-testid":void 0,children:[A,y,z,s,a]}))}),b[49]=A,b[50]=y,b[51]=z,b[52]=s,b[53]=a,b[54]=e):e=b[54];b[55]!==g||b[56]!==e||b[57]!==w?(f=l.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:l.jsxs("div",{"data-testid":void 0,children:[w,g,e]})}),b[55]=g,b[56]=e,b[57]=w,b[58]=f):f=b[58];return f}g.VideoPlayerCaptionsMenuMainPane=a}),226);
__d("VideoPlayerCaptionsMenuTopBar.react",["fbt","ix","CometImage.react","CometPressable.react","VideoPlayerCaptionsMenu.react","VideoPlayerHooks","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||(j=d("react"));j.useCallback;var m={pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(18),e=a.availableCaptionsLocales,f=a.onPressLog,g=a.setPane;b[0]!==f||b[1]!==g?(a=function(){g(d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenuPaneType.CAPTIONS_DISPLAY_MAIN),f&&f("captions_main_menu_top_bar")},b[0]=f,b[1]=g,b[2]=a):a=b[2];a=a;var j=(k||(k=d("VideoPlayerHooks"))).useIsLive(),o=k.useIsVideoBroadcast();o=o&&!j;b[3]!==e||b[4]!==o?(j=(e==null?void 0:e.some(n))||o,b[3]=e,b[4]=o,b[5]=j):j=b[5];e=j;b[6]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x14ctfv x78zum5 x1jzhcrs"},b[6]=o):o=b[6];var p,q;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(j=l.jsx("div",babelHelpers["extends"]({className:"x1nxh6w3 x1s688f"},{children:h._(/*BTDS*/"Subtitles")})),p={className:"x6s0dn4 x14ctfv x1ypdohk x3nfvp2 x1bhwmg6 x13a6bvl x8zvzrc"},q={className:"x3nfvp2"},b[7]=j,b[8]=p,b[9]=q):(j=b[7],p=b[8],q=b[9]);b[10]===Symbol["for"]("react.memo_cache_sentinel")?(p=l.jsxs("div",babelHelpers["extends"]({},p,{children:[l.jsx("span",babelHelpers["extends"]({},q,{children:l.jsx(c("CometImage.react"),{src:i("492300")})})),l.jsx("div",babelHelpers["extends"]({className:"x3nfvp2 xo1l8bm x1mnrxsn"},{children:h._(/*BTDS*/"Options")}))]})),b[10]=p):p=b[10];b[11]!==a?(q=l.jsx("div",babelHelpers["extends"]({},o,{children:l.jsxs(c("CometPressable.react"),{onPress:a,testid:void 0,xstyle:m.pressableOption,children:[j,p]})})),b[11]=a,b[12]=q):q=b[12];b[13]!==e?(o=e!=null&&e&&l.jsx("div",babelHelpers["extends"]({className:"x1nxh6w3 x1k4tb9n"},{children:h._(/*BTDS*/"Auto-generated")})),b[13]=e,b[14]=o):o=b[14];b[15]!==q||b[16]!==o?(j=l.jsxs("div",{children:[q,o]}),b[15]=q,b[16]=o,b[17]=j):j=b[17];return j}function n(a){return a.localizedCreationMethod!=null}g["default"]=a}),226);
__d("VideoPlayerLoggingSuboriginContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(null);g["default"]=b}),98);
__d("useVideoPlayerAvailableCaptionsLocalesFromRelay_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVideoPlayerAvailableCaptionsLocalesFromRelay_video",selections:[{alias:null,args:null,concreteType:"VideoCaptionLocale",kind:"LinkedField",name:"video_available_captions_locales",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"localized_creation_method",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"captions_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"locale",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"localized_language",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"localized_country",storageKey:null}],storageKey:null}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("useVideoPlayerAvailableCaptionsLocalesFromRelay",["CometRelay","react","react-compiler-runtime","useVideoPlayerAvailableCaptionsLocalesFromRelay_video.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useMemo;function a(a){var c=d("react-compiler-runtime").c(2);a=d("CometRelay").useFragment(h!==void 0?h:h=b("useVideoPlayerAvailableCaptionsLocalesFromRelay_video.graphql"),a);a==null?void 0:a.video_available_captions_locales;if(c[0]!==(a==null?void 0:a.video_available_captions_locales)){var e;e=a==null?void 0:(e=a.video_available_captions_locales)==null?void 0:e.map(j);c[0]=a==null?void 0:a.video_available_captions_locales;c[1]=e}else e=c[1];a=e;c=a;return c}function j(a){return{captionsUrl:a.captions_url,locale:a.locale,localizedCountry:a.localized_country,localizedCreationMethod:a.localized_creation_method,localizedLanguage:a.localized_language}}g["default"]=a}),98);
__d("VideoPlayerCaptionsControl.react",["fbt","ix","CometRelay","IntlCurrentLocale","VideoPlayerCaptionsControl_video.graphql","VideoPlayerCaptionsMenu.react","VideoPlayerControlIcon.react","VideoPlayerDefaultControlsProperties","VideoPlayerHooks","VideoPlayerLoggingSuboriginContext","VideoPlayerUserInteractionCounter","fbicon","react","requireDeferred","useMinifiedProductAttribution","usePlayerOriginRouteTracePolicy","useVideoPlayerAvailableCaptionsLocalesFromRelay"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=k||(k=d("react"));e=k;var n=e.useCallback,o=e.useContext,p=e.useEffect,q=e.useMemo,r=e.useRef,s=e.useState,t=c("requireDeferred")("VideoHomeTypedLiteLogger").__setRef("VideoPlayerCaptionsControl.react"),u="asr",v=function(a){return a.length<2?null:a.substr(0,2)};function a(a){var e=a.alignMenuToIcon;e=e===void 0?!1:e;var f=a.availableCaptionsLocales,g=a.captionsVisible,k=a.children;k=k===void 0?null:k;var w=a.compactMenu,x=a.icon,y=a.initialCaptionsUrl,z=a.menuOpened,A=a.onMenuOpen,B=a.onUserInteraction,C=a.setMenuOpened;a=a.video;var D=h._(/*BTDS*/"Captions");d("VideoPlayerUserInteractionCounter").useVideoPlayerUserInteraction("video_captions_menu",z===d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_CAPTIONS_MENU,B);B=d("CometRelay").useFragment(j!==void 0?j:j=b("VideoPlayerCaptionsControl_video.graphql"),a);var E=(l||(l=d("VideoPlayerHooks"))).useMuted(),F=l.useController(),G=c("usePlayerOriginRouteTracePolicy")(),H=c("useVideoPlayerAvailableCaptionsLocalesFromRelay")(B),I=q(function(){var a;return((a=(a=f)!=null?a:H)!=null?a:[]).slice().sort(function(a,b){return((a=a.localizedLanguage)!=null?a:"")>((a=b.localizedLanguage)!=null?a:"")?1:-1})},[f,H]),J=(a=y)!=null?a:B==null?void 0:B.captions_url;y=s("");a=y[0];var K=y[1],L=r(null),M=r(null);p(function(){I.forEach(function(a){a.captionsUrl===J&&a.locale!=null&&(L.current==null&&(L.current=a.locale),K(a.locale))})},[I,J]);var N=c("IntlCurrentLocale").code;p(function(){var a;L.current!==u&&v((a=L.current)!=null?a:"")!==v(N)&&M.current===null?(F.setCaptionsVisible(!1),M.current=!1):E&&!g&&M.current===null?(M.current=!0,F.setCaptionsVisible(!0)):!E&&M.current===!0&&(F.setCaptionsVisible(!1),M.current=!1)},[g,F,E,N]);var O=z===d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_CAPTIONS_MENU;B=s(!1);y=B[0];z=B[1];var P=o(c("VideoPlayerLoggingSuboriginContext")),Q=c("useMinifiedProductAttribution")(),R=n(function(a,b){a===void 0&&(a=null),b===void 0&&(b=null),t.onReady(function(c){c.log({attribution_id_v2:Q,click_point:a,event:"click",event_target_info:G,event_target_sub_type:b,player_suborigin:P})})},[Q,G,P]);return m.jsxs("div",babelHelpers["extends"]({},{0:{className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn"},1:{className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn x1n2onr6 xuxw1ft"}}[!!(e===!0)<<0],{"data-testid":void 0,children:[O&&m.jsx("div",babelHelpers["extends"]({role:"dialog"},{0:{className:"x1av4zun x1lcm9me x1yr5g0i xrt01vj x10y3i5r xacj9c0 x14ctfv x89ytp0 x1hdnelj xgmxx4u xyamay9 x1pi30zi x1l90r2v x1swvt13 x10l6tqk xk6ci0l x1602a87"},2:{className:"x1av4zun x1lcm9me x1yr5g0i xrt01vj x10y3i5r xacj9c0 x14ctfv x89ytp0 x1hdnelj xgmxx4u xyamay9 x1pi30zi x1l90r2v x1swvt13 x10l6tqk x1602a87 xwjie4w"},1:{className:"x1av4zun x1lcm9me x1yr5g0i xrt01vj x10y3i5r xacj9c0 x14ctfv x89ytp0 x1hdnelj xgmxx4u xyamay9 x1pi30zi x1l90r2v x1swvt13 x10l6tqk x1602a87 x1g75g36"},3:{className:"x1av4zun x1lcm9me x1yr5g0i xrt01vj x10y3i5r xacj9c0 x14ctfv x89ytp0 x1hdnelj xgmxx4u xyamay9 x1pi30zi x1l90r2v x1swvt13 x10l6tqk x1602a87 x1g75g36"}}[!!(w===!0)<<1|!!(e===!0)<<0],{children:m.jsx(d("VideoPlayerCaptionsMenu.react").VideoPlayerCaptionsMenu,{availableCaptionsLocales:I,captionsListExpanded:y,onClose:function(){C!=null&&C(null)},onPressLog:R,selectedCaptionsLocale:a,setCaptionsListExpanded:z,setSelectedCaptionsLocale:K,children:k})})),m.jsx(c("VideoPlayerControlIcon.react"),{icon:x==null?g?d("fbicon")._(i("662652"),20):d("fbicon")._(i("662655"),20):x,label:D,onPress:function(){C!=null&&C(O?null:d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_CAPTIONS_MENU),!O&&A!=null&&A(),R("closed_captions_button")},tooltip:D})]}))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("VideoPlayerCastControlIcon.react",["fbt","ix","CastingControllerHooks","CometRelay","CometWatchAndScrollVideoContext","JSResourceForInteraction","VideoPlayerControlIcon.react","VideoPlayerHooks","emptyFunction","fbicon","react","react-compiler-runtime","recoverableViolation","useCometLazyDialog"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||(j=d("react"));b=j;b.useCallback;var m=b.useContext,n=c("JSResourceForInteraction")("CometCastingStopWatchAndScrollDialog.react").__setRef("VideoPlayerCastControlIcon.react");function a(a){var b=d("react-compiler-runtime").c(14),e=a.subOrigin;d("CastingControllerHooks").useCastingInitializeIfNecessary();var f=(a=(k||(k=d("VideoPlayerHooks"))).useVideoFbid())!=null?a:"",g=(k||(k=d("VideoPlayerHooks"))).useController(),j=d("CometRelay").useRelayEnvironment(),o=d("CastingControllerHooks").useCastingController();a=m(c("CometWatchAndScrollVideoContext"));var p=c("useCometLazyDialog")(n),q=p[0],r=a==null?void 0:a.videoID;b[0]!==o||b[1]!==j||b[2]!==e||b[3]!==g||b[4]!==f?(p=function(){if(f!=null){var a=g.getPlayheadPosition();o.startPlayVideoNow({environment:j,origin:"video_home",position:a,subOrigin:e,videoID:f})}else c("recoverableViolation")("Could not transition to Cast player because videoID was null","comet_video_player")},b[0]=o,b[1]=j,b[2]=e,b[3]=g,b[4]=f,b[5]=p):p=b[5];var s=p;b[6]!==s||b[7]!==q||b[8]!==r?(a=function(){r!=null?q({onClose:c("emptyFunction"),onContinue:s,startingVideoType:"cast"},c("emptyFunction")):s()},b[6]=s,b[7]=q,b[8]=r,b[9]=a):a=b[9];p=a;b[10]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"Cast video to your TV"),b[10]=a):a=b[10];a=a;var t;b[11]===Symbol["for"]("react.memo_cache_sentinel")?(t=d("fbicon")._(i("788899"),20),b[11]=t):t=b[11];b[12]!==p?(t=l.jsx(c("VideoPlayerControlIcon.react"),{color:"white",icon:t,label:a,onPress:p,tooltip:a}),b[12]=p,b[13]=t):t=b[13];return t}g["default"]=a}),226);
__d("VideoPlayerCastControl.react",["CastingControllerHooks","VideoPlayerCastControlIcon.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(2);a=a.subOrigin;var e=d("CastingControllerHooks").useIsCastAvailable();if(!e)return null;b[0]!==a?(e=i.jsx(c("VideoPlayerCastControlIcon.react"),{subOrigin:a}),b[0]=a,b[1]=e):e=b[1];return e}g["default"]=a}),98);
__d("VideoPlayerCastControlShimImpl.modern.react",["deferredLoadComponent","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=c("deferredLoadComponent")(c("requireDeferred")("VideoPlayerCastControl.react").__setRef("VideoPlayerCastControlShimImpl.modern.react"));g["default"]=a}),98);
__d("VideoPlayerCastControlShim.react",["CometPlaceholder.react","VideoPlayerCastControlShimImpl.modern.react","VideoPlayerControlsGroups.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(8),e,f;b[0]!==a?(e=a.isVisible,f=babelHelpers.objectWithoutPropertiesLoose(a,["isVisible"]),b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);b[3]!==f?(a=i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(c("VideoPlayerCastControlShimImpl.modern.react"),babelHelpers["extends"]({},f))}),b[3]=f,b[4]=a):a=b[4];b[5]!==e||b[6]!==a?(f=i.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:e,noPaddingEnd:!0,noPaddingStart:!0,children:a}),b[5]=e,b[6]=a,b[7]=f):f=b[7];return f}g["default"]=a}),98);
__d("VideoPlayerDefaultControlsImplLive_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerDefaultControlsImplLive_video",selections:[{args:null,kind:"FragmentSpread",name:"VideoPlayerLiveVideoControls_video"}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerExpandSidePanelControl.react",["fbt","ix","CometTahoeSidePaneContext","VideoPlayerControlIcon.react","fbicon","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useContext;function a(){var a=d("react-compiler-runtime").c(12),b=l(c("CometTahoeSidePaneContext")),e=b.rightRailExpanded,f=b.setRightRailExpanded;a[0]!==e?(b=e?h._(/*BTDS*/"Collapse comments"):h._(/*BTDS*/"Expand comments"),a[0]=e,a[1]=b):b=a[1];b=b;var g;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(g={className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn"},a[2]=g):g=a[2];var j;a[3]!==e?(j=e?d("fbicon")._(i("557039"),20):d("fbicon")._(i("557052"),20),a[3]=e,a[4]=j):j=a[4];var m;a[5]!==e||a[6]!==f?(m=function(){f(!e)},a[5]=e,a[6]=f,a[7]=m):m=a[7];a[8]!==b||a[9]!==j||a[10]!==m?(g=k.jsx("div",babelHelpers["extends"]({},g,{children:k.jsx(c("VideoPlayerControlIcon.react"),{icon:j,label:b,onPress:m,tooltip:b})})),a[8]=b,a[9]=j,a[10]=m,a[11]=g):g=a[11];return g}g["default"]=a}),226);
__d("VideoPlayerLiveVideoControls_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerLiveVideoControls_video",selections:[a,{alias:null,args:null,kind:"ScalarField",name:"is_clipping_enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"live_rewind_enabled",storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"owner",plural:!1,selections:[a],storageKey:null},{args:null,kind:"FragmentSpread",name:"VideoPlayerWatchAndScrollControl_video"},{args:null,kind:"FragmentSpread",name:"LiveVideoLatencyMenuContextProvider_video"},{args:null,kind:"FragmentSpread",name:"VideoPlayerCaptionsControl_video"},{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_see_community_moderation_tools",plural:!1,selections:[{args:null,documentName:"VideoPlayerLiveVideoControls_video",fragmentName:"VideoPlayerModeratorControl_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null},{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_use_live_rewind",plural:!1,selections:[{args:null,documentName:"VideoPlayerLiveVideoControls_video_if_viewer_can_use_live_rewind",fragmentName:"VideoPlayerLiveRewindControlsGroup_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null},{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_use_clipping",plural:!1,selections:[{args:null,documentName:"VideoPlayerLiveVideoControls_video_if_viewer_can_use_clipping",fragmentName:"VideoPlayerClipVideoControl_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null},{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_see_costreaming_tools",plural:!1,selections:[{args:null,documentName:"VideoPlayerLiveVideoControls_video_if_viewer_can_see_costreaming_tools",fragmentName:"VideoPlayerCostreamingControl_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null}],type:"Video",abstractKey:null}}();e.exports=a}),null);
__d("VideoPlayerQuietModeControl.react",["fbt","ix","CometTahoeSidePaneContext","VideoPlayerControlIcon.react","fbicon","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useContext;function a(){var a=d("react-compiler-runtime").c(12),b=l(c("CometTahoeSidePaneContext")),e=b.rightRailHidden,f=b.setRightRailHidden;a[0]!==e?(b=e?h._(/*BTDS*/"Show comments and reactions"):h._(/*BTDS*/"Hide comments and reactions"),a[0]=e,a[1]=b):b=a[1];b=b;var g;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(g={className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn"},a[2]=g):g=a[2];var j;a[3]!==e?(j=e?d("fbicon")._(i("942218"),20):d("fbicon")._(i("942221"),20),a[3]=e,a[4]=j):j=a[4];var m;a[5]!==e||a[6]!==f?(m=function(){f(!e)},a[5]=e,a[6]=f,a[7]=m):m=a[7];a[8]!==b||a[9]!==j||a[10]!==m?(g=k.jsx("div",babelHelpers["extends"]({},g,{children:k.jsx(c("VideoPlayerControlIcon.react"),{icon:j,label:b,onPress:m,tooltip:b})})),a[8]=b,a[9]=j,a[10]=m,a[11]=g):g=a[11];return g}g["default"]=a}),226);
__d("VideoPlayerSettingsMenuQualityPaneToggle.react",["fbt","ix","CometImage.react","CometPressable.react","VideoPlayerSettingsMenu.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react"),l={pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(14),e=a.selectedVideoQuality,f=a.setPane;a=a.targetVideoQuality;var g;b[0]!==f?(g=function(){f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.QUALITY)},b[0]=f,b[1]=g):g=b[1];var j,m;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(j=k.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1s688f"},{children:h._(/*BTDS*/"Quality")})),m={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1bhwmg6 x13a6bvl x1i64zmx x450l9j"},b[2]=j,b[3]=m):(j=b[2],m=b[3]);var n;b[4]!==e||b[5]!==a?(n=e==="notselected"?k.jsx("span",{"data-testid":void 0,children:"\xa0"}):e==="auto"?k.jsxs(k.Fragment,{children:[k.jsx("span",{"data-testid":void 0,children:h._(/*BTDS*/"Auto")}),a!=null?k.jsxs(k.Fragment,{children:[k.jsx("span",{children:"\xa0"}),k.jsx("span",{"data-testid":void 0,children:a})]}):null]}):k.jsx("span",{"data-testid":void 0,children:e}),b[4]=e,b[5]=a,b[6]=n):n=b[6];b[7]===Symbol["for"]("react.memo_cache_sentinel")?(e={className:"x3nfvp2 xmgb6t1 x12mruv9"},b[7]=e):e=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(a=k.jsx("span",babelHelpers["extends"]({},e,{children:k.jsx(c("CometImage.react"),{src:i("480587")})})),b[8]=a):a=b[8];b[9]!==n?(e=k.jsxs("div",babelHelpers["extends"]({},m,{children:[n,a]})),b[9]=n,b[10]=e):e=b[10];b[11]!==g||b[12]!==e?(m=k.jsxs(c("CometPressable.react"),{onPress:g,testid:void 0,xstyle:l.pressableOption,children:[j,e]}),b[11]=g,b[12]=e,b[13]=m):m=b[13];return m}g["default"]=a}),226);
__d("VideoPlayerSettingsMenu.react",["fbt","$InternalEnum","CometErrorBoundary.react","CometKeys","CometPlaceholder.react","CometRelay","LiveVideoLatencyMenu.react","PlaybackSpeedExperiments","VideoPlayerHooks","VideoPlayerSettingsMenuAudioTrackPane.react","VideoPlayerSettingsMenuMainPane.react","VideoPlayerSettingsMenuPlaybackSpeedPane.react","VideoPlayerSettingsMenuQualityPane.react","react","react-compiler-runtime","recoverableViolation","useLayerKeyCommands"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react"));e=i;e.useCallback;var l=e.useContext,m=e.useEffect;e.useMemo;var n=e.useRef,o=e.useState,p=b("$InternalEnum")({LATENCY:"latency",MAIN:"main",PLAYBACK_SPEED:"playbackSpeed",QUALITY:"quality",AUDIO:"audio"});function a(a){var b=d("react-compiler-runtime").c(51),e=a.children,f=a.forceShowPlaybackRateControl,g=a.onClose;a=e===void 0?null:e;e=(j||(j=d("VideoPlayerHooks"))).useCaptionsLoaded();var i=j.useCaptionsVisible(),q=j.useSelectedVideoQuality(),r=j.useTargetAudioTrack(),s=j.useAvailableAudioTracks(),t=j.useInbandCaptionsAutogenerated(),u=j.useTargetVideoQuality(),v=o(p.MAIN),w=v[0],x=v[1];v=o(i);i=v[0];v=v[1];var y=j.usePlaybackRate(),z=j.useIsLive(),A=j.useIsLiveRewindActive(),B=l(d("LiveVideoLatencyMenu.react").LiveVideoLatencyMenuContext);B=B.liveVideoLatencyMenuPaneMatchPointer;var C=j.useShouldShowPlaybackRateControl(),D;b[0]!==f||b[1]!==C?(D=f===!0||d("PlaybackSpeedExperiments").enableCometPlaybackSpeedControl()&&C,b[0]=f,b[1]=C,b[2]=D):D=b[2];f=D;b[3]!==z||b[4]!==A||b[5]!==w?(C=function(){z&&!A&&w===p.PLAYBACK_SPEED&&x(p.MAIN)},D=[A,x,z,w],b[3]=z,b[4]=A,b[5]=w,b[6]=C,b[7]=D):(C=b[6],D=b[7]);m(C,D);b[8]!==s.length||b[9]!==w?(C=function(){s.length<=1&&w===p.AUDIO&&x(p.MAIN)},b[8]=s.length,b[9]=w,b[10]=C):C=b[10];b[11]!==s||b[12]!==w?(D=[s,w],b[11]=s,b[12]=w,b[13]=D):D=b[13];m(C,D);var E=n(null),F=n(null);b[14]!==g?(C=function(a){E.current&&F.current&&a.target instanceof HTMLElement&&document.contains(a.target)&&!E.current.contains(a.target)&&F.current.contains(a.target)&&g()},b[14]=g,b[15]=C):C=b[15];var G=C;b[16]!==G?(D=function(){document.addEventListener("click",G);return function(){document.removeEventListener("click",G)}},C=[G],b[16]=G,b[17]=D,b[18]=C):(D=b[17],C=b[18]);m(D,C);b[19]===Symbol["for"]("react.memo_cache_sentinel")?(D={key:c("CometKeys").ESCAPE},C=h._(/*BTDS*/"Close video settings menu"),b[19]=D,b[20]=C):(D=b[19],C=b[20]);b[21]!==g?(D=[{command:D,description:C,handler:function(){g()}}],b[21]=g,b[22]=D):D=b[22];C=D;D=C;c("useLayerKeyCommands")(D);b[23]!==s||b[24]!==e||b[25]!==i||b[26]!==a||b[27]!==t||b[28]!==z||b[29]!==y||b[30]!==q||b[31]!==f||b[32]!==r||b[33]!==u?(C=k.jsx(c("VideoPlayerSettingsMenuMainPane.react"),{availableAudioTracks:s,captionsLoaded:e,captionsVisibleOptimistic:i,inbandCaptionsAutogenerated:t,isLive:z,playbackRate:y,selectedVideoQuality:q,setIsCaptionsVisible:v,setPane:x,shouldEnablePlaybackRateSupport:f,targetAudioTrack:r,targetVideoQuality:u,children:a}),b[23]=s,b[24]=e,b[25]=i,b[26]=a,b[27]=t,b[28]=z,b[29]=y,b[30]=q,b[31]=f,b[32]=r,b[33]=u,b[34]=C):C=b[34];D=C;bb0:switch(w){case p.LATENCY:if(B==null){c("recoverableViolation")("Latency components should not be null","gaming_video");break bb0}b[35]===Symbol["for"]("react.memo_cache_sentinel")?(v={setPane:x},b[35]=v):v=b[35];b[36]!==B?(e=k.jsx(c("CometErrorBoundary.react"),{children:k.jsx(c("CometPlaceholder.react"),{fallback:null,children:k.jsx(d("CometRelay").MatchContainer,{match:B,props:v})})}),b[36]=B,b[37]=e):e=b[37];D=e;break bb0;case p.MAIN:break bb0;case p.PLAYBACK_SPEED:b[38]!==y?(i=k.jsx(c("VideoPlayerSettingsMenuPlaybackSpeedPane.react"),{playbackRate:y,setPane:x}),b[38]=y,b[39]=i):i=b[39];D=i;break bb0;case p.QUALITY:b[40]!==q?(a=k.jsx(c("VideoPlayerSettingsMenuQualityPane.react"),{selectedVideoQuality:q,setPane:x}),b[40]=q,b[41]=a):a=b[41];D=a;break bb0;case p.AUDIO:b[42]!==s||b[43]!==z||b[44]!==r?(t=!z&&s.length>1?k.jsx(c("VideoPlayerSettingsMenuAudioTrackPane.react"),{availableAudioTracks:s,setPane:x,targetAudioTrack:r}):null,b[42]=s,b[43]=z,b[44]=r,b[45]=t):t=b[45];D=t}b[46]!==D?(f=k.jsx("div",{ref:E,children:D}),b[46]=D,b[47]=f):f=b[47];b[48]===Symbol["for"]("react.memo_cache_sentinel")?(u=k.jsx("div",babelHelpers["extends"]({className:"xjbqb8w x5yr21d x17qophe xg6iff7 x1g81zrj xixxii4 x13vifvy xh8yej3 x8knxv4"},{"data-testid":void 0,ref:F})),b[48]=u):u=b[48];b[49]!==f?(C=k.jsxs(k.Fragment,{children:[f,u]}),b[49]=f,b[50]=C):C=b[50];return C}g.VideoPlayerSettingsMenuPaneType=p;g.VideoPlayerSettingsMenu=a}),226);
__d("VideoPlayerSettingsMenuAudioTrackPane.react",["fbt","ix","CometImage.react","CometPressable.react","CurrentLocale","FocusRegion.react","VideoPlayerAudioTrackUtils","VideoPlayerHooks","VideoPlayerSettingsMenu.react","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||d("react"),m={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",minWidth:"xfvyar9",outline:"x1a2a7pz",paddingTop:"xyqdw3p",paddingEnd:"x4uap5",paddingBottom:"xg8j3zb",paddingStart:"xkhd6sd",textAlign:"x1yc453h",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(21),e=a.availableAudioTracks,f=a.setPane,g=a.targetAudioTrack,j=(k||(k=d("VideoPlayerHooks"))).useController();b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1s688f x1lku1pv"},b[0]=a):a=b[0];var n;b[1]!==f?(n=function(){return f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.MAIN)},b[1]=f,b[2]=n):n=b[2];var o;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x6s0dn4 x3nfvp2 xmgb6t1 x139jcc6"},b[3]=o):o=b[3];var p;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(o=l.jsx("span",babelHelpers["extends"]({},o,{children:l.jsx(c("CometImage.react"),{src:i("480579")})})),p=h._(/*BTDS*/"Audio"),b[4]=o,b[5]=p):(o=b[4],p=b[5]);b[6]!==n?(a=l.jsx("div",babelHelpers["extends"]({},a,{children:l.jsxs(c("CometPressable.react"),{onPress:n,testid:void 0,xstyle:m.pressableOption,children:[o,p]})})),b[6]=n,b[7]=a):a=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(o={className:"x17adc0v x1anpbxc xn80e1m"},b[8]=o):o=b[8];if(b[9]!==e||b[10]!==j||b[11]!==(g==null?void 0:g.id)){b[13]!==j||b[14]!==(g==null?void 0:g.id)?(p=function(a){var b=(g==null?void 0:g.id)===a.id,e=d("VideoPlayerAudioTrackUtils").getAudioTrackLabelLocalized(a,c("CurrentLocale").get());return l.jsx("div",{children:l.jsxs(c("CometPressable.react"),{onPress:function(){j.selectVideoVariant({lang:a.lang,role:a.role})},testid:void 0,xstyle:m.menuOptionRow,children:[l.jsx("div",babelHelpers["extends"]({className:"xiakxrv x1ykpwxx x118zf8b xnwxkdh xfocsrx x1rg5ohu xmgb6t1 xmo9yow x1yrsyyn xsyo7zv x10b6aqq x16hj40l"},{children:b&&l.jsx("div",babelHelpers["extends"]({className:"x14hiurz x8u2fvd x1ht7hnu x1quq95r x5yzy4c x1rg5ohu xqu0tyb x8182xy x1kgmq87 x10l6tqk x51ohtg"},{"data-testid":void 0}))})),l.jsx("div",babelHelpers["extends"]({},{0:{className:"x1ypdohk x1rg5ohu"},1:{className:"x1ypdohk x1rg5ohu x1s688f"}}[!!b<<0],{"data-testid":void 0,children:e}))]})},a.id)},b[13]=j,b[14]=g==null?void 0:g.id,b[15]=p):p=b[15];n=e.map(p);b[9]=e;b[10]=j;b[11]=g==null?void 0:g.id;b[12]=n}else n=b[12];b[16]!==n?(p=l.jsx("div",babelHelpers["extends"]({},o,{"data-testid":void 0,children:n})),b[16]=n,b[17]=p):p=b[17];b[18]!==a||b[19]!==p?(e=l.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:l.jsxs("div",{"data-testid":void 0,children:[a,p]})}),b[18]=a,b[19]=p,b[20]=e):e=b[20];return e}g["default"]=a}),226);
__d("VideoPlayerSettingsMenuAudioTrackPaneToggle.react",["fbt","ix","CometImage.react","CometPressable.react","CurrentLocale","VideoPlayerAudioTrackUtils","VideoPlayerSettingsMenu.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react"),l={pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(15),e=a.setPane;a=a.targetAudioTrack;var f;b[0]!==a?(f=d("VideoPlayerAudioTrackUtils").getAudioTrackLabelLocalized(a,c("CurrentLocale").get()),b[0]=a,b[1]=f):f=b[1];a=f;b[2]!==e?(f=function(){e(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.AUDIO)},b[2]=e,b[3]=f):f=b[3];var g,j;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(g=k.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1s688f"},{children:h._(/*BTDS*/"Audio")})),j={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1bhwmg6 x13a6bvl x1i64zmx x450l9j xn80e1m"},b[4]=g,b[5]=j):(g=b[4],j=b[5]);var m;b[6]!==a?(m=k.jsx("span",{"data-testid":void 0,children:a}),b[6]=a,b[7]=m):m=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"x3nfvp2 xmgb6t1 x12mruv9"},b[8]=a):a=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(a=k.jsx("span",babelHelpers["extends"]({},a,{children:k.jsx(c("CometImage.react"),{src:i("480587")})})),b[9]=a):a=b[9];b[10]!==m?(j=k.jsxs("div",babelHelpers["extends"]({},j,{children:[m,a]})),b[10]=m,b[11]=j):j=b[11];b[12]!==f||b[13]!==j?(a=k.jsxs(c("CometPressable.react"),{onPress:f,testid:void 0,xstyle:l.pressableOption,children:[g,j]}),b[12]=f,b[13]=j,b[14]=a):a=b[14];return a}g["default"]=a}),226);
__d("VideoPlayerSettingsMenuMainPane.react",["CometErrorBoundary.react","CometPlaceholder.react","CometRelay","FocusRegion.react","LiveVideoLatencyMenu.react","VideoPlayerSettingsMenuAudioTrackPaneToggle.react","VideoPlayerSettingsMenuPlaybackPaneToggle.react","VideoPlayerSettingsMenuQualityPaneToggle.react","focusScopeQueries","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext;function a(a){var b=d("react-compiler-runtime").c(23),e=a.availableAudioTracks,f=a.children,g=a.isLive,h=a.playbackRate,k=a.selectedVideoQuality,l=a.setPane,m=a.shouldEnablePlaybackRateSupport,n=a.targetAudioTrack;a=a.targetVideoQuality;var o=j(d("LiveVideoLatencyMenu.react").LiveVideoLatencyMenuContext);o=o.liveVideoLatencyMenuPaneToggleMatchPointer;g=!g&&e.length>1?c("gkx")("24336"):!1;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e={className:"x14ctfv x78zum5 x1hoihq8 x1lku1pv"},b[0]=e):e=b[0];b[1]!==k||b[2]!==l||b[3]!==a?(e=i.jsx("div",babelHelpers["extends"]({},e,{children:i.jsx(c("VideoPlayerSettingsMenuQualityPaneToggle.react"),{selectedVideoQuality:k,setPane:l,targetVideoQuality:a})})),b[1]=k,b[2]=l,b[3]=a,b[4]=e):e=b[4];b[5]!==l||b[6]!==g||b[7]!==n?(k=g&&i.jsx("div",babelHelpers["extends"]({className:"x14ctfv x78zum5 x1hoihq8 x1lku1pv"},{children:i.jsx(c("VideoPlayerSettingsMenuAudioTrackPaneToggle.react"),{setPane:l,targetAudioTrack:n})})),b[5]=l,b[6]=g,b[7]=n,b[8]=k):k=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"x14ctfv x78zum5 x1hoihq8 x1lku1pv"},b[9]=a):a=b[9];b[10]!==h||b[11]!==l||b[12]!==m?(g=i.jsx("div",babelHelpers["extends"]({},a,{children:i.jsx(c("VideoPlayerSettingsMenuPlaybackPaneToggle.react"),{playbackRate:h,setPane:l,shouldEnablePlaybackRateSupport:m})})),b[10]=h,b[11]=l,b[12]=m,b[13]=g):g=b[13];b[14]!==o||b[15]!==l?(n=o!=null&&i.jsx("div",babelHelpers["extends"]({className:"x14ctfv x78zum5 x1hoihq8 x1lku1pv"},{children:i.jsx(c("CometErrorBoundary.react"),{children:i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(d("CometRelay").MatchContainer,{match:o,props:{setPane:l}})})})})),b[14]=o,b[15]=l,b[16]=n):n=b[16];b[17]!==f||b[18]!==e||b[19]!==k||b[20]!==g||b[21]!==n?(a=i.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:i.jsxs("div",{"data-testid":void 0,children:[e,k,g,n,f]})}),b[17]=f,b[18]=e,b[19]=k,b[20]=g,b[21]=n,b[22]=a):a=b[22];return a}g["default"]=a}),98);
__d("VideoPlayerSettingsMenuPlaybackPaneToggle.react",["fbt","ix","CometImage.react","CometPressable.react","VideoPlayerSettingsMenu.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react"),l={pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(13),e=a.playbackRate,f=a.setPane;a=a.shouldEnablePlaybackRateSupport;if(!a)return null;b[0]!==f?(a=function(){f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.PLAYBACK_SPEED)},b[0]=f,b[1]=a):a=b[1];var g,j;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(g=k.jsx("div",babelHelpers["extends"]({className:"x1ypdohk x1s688f"},{children:h._(/*BTDS*/"Playback Speed")})),j={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1bhwmg6 x13a6bvl x1i64zmx x450l9j"},b[2]=g,b[3]=j):(g=b[2],j=b[3]);var m;b[4]!==e?(m=k.jsx("span",{"data-testid":void 0,children:e}),b[4]=e,b[5]=m):m=b[5];b[6]===Symbol["for"]("react.memo_cache_sentinel")?(e={className:"x3nfvp2 xmgb6t1 x12mruv9"},b[6]=e):e=b[6];b[7]===Symbol["for"]("react.memo_cache_sentinel")?(e=k.jsx("span",babelHelpers["extends"]({},e,{children:k.jsx(c("CometImage.react"),{src:i("480587")})})),b[7]=e):e=b[7];b[8]!==m?(j=k.jsxs("div",babelHelpers["extends"]({},j,{children:[m,e]})),b[8]=m,b[9]=j):j=b[9];b[10]!==a||b[11]!==j?(e=k.jsxs(c("CometPressable.react"),{onPress:a,testid:void 0,xstyle:l.pressableOption,children:[g,j]}),b[10]=a,b[11]=j,b[12]=e):e=b[12];return e}g["default"]=a}),226);
__d("VideoPlayerSettingsMenuPlaybackSpeedPane.react",["fbt","ix","CometImage.react","CometPressable.react","FocusRegion.react","VideoPlayerHooks","VideoPlayerSettingsMenu.react","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||d("react"),m={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",minWidth:"xfvyar9",outline:"x1a2a7pz",paddingTop:"xyqdw3p",paddingEnd:"x4uap5",paddingBottom:"xg8j3zb",paddingStart:"xkhd6sd",textAlign:"x1yc453h",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(15),e=a.playbackRate,f=a.setPane,g=(k||(k=d("VideoPlayerHooks"))).useController();b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1s688f x1lku1pv"},b[0]=a):a=b[0];var j;b[1]!==f?(j=function(){return f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.MAIN)},b[1]=f,b[2]=j):j=b[2];var n;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(n={className:"x3nfvp2 xmgb6t1 x139jcc6"},b[3]=n):n=b[3];var o;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(n=l.jsx("span",babelHelpers["extends"]({},n,{children:l.jsx(c("CometImage.react"),{src:i("480579")})})),o=h._(/*BTDS*/"Playback Speed"),b[4]=n,b[5]=o):(n=b[4],o=b[5]);b[6]!==j?(a=l.jsx("div",babelHelpers["extends"]({},a,{children:l.jsxs(c("CometPressable.react"),{onPress:j,testid:void 0,xstyle:m.pressableOption,children:[" ",n,o]})})),b[6]=j,b[7]=a):a=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(n={className:"x17adc0v x1anpbxc"},b[8]=n):n=b[8];b[9]!==g||b[10]!==e?(o=l.jsx("div",babelHelpers["extends"]({},n,{"data-testid":void 0,children:[.5,.75,1,1.25,1.5,1.75,2].map(function(a){var b=e===a,d=h._(/*BTDS*/"Set the playback speed to {playback_rate_option}{is_playback_rate_option_selected}",[h._param("playback_rate_option",a),h._param("is_playback_rate_option_selected",b?", selected":"")]);return l.jsx("div",{children:l.jsxs(c("CometPressable.react"),{"aria-checked":b,"aria-label":d,onPress:function(){g.setPlaybackRate(a)},testid:void 0,xstyle:m.menuOptionRow,children:[l.jsx("div",babelHelpers["extends"]({className:"x17j41np x1ykpwxx x118zf8b xnwxkdh xfocsrx x1rg5ohu xmgb6t1 xmo9yow x1yrsyyn xsyo7zv x10b6aqq x16hj40l"},{children:b&&l.jsx("div",babelHelpers["extends"]({className:"x14hiurz x8u2fvd x1ht7hnu x1quq95r x5yzy4c x1rg5ohu xqu0tyb x8182xy x1kgmq87 x10l6tqk x51ohtg"},{"data-testid":void 0}))})),l.jsx("div",babelHelpers["extends"]({},{0:{className:"x1ypdohk x1rg5ohu"},1:{className:"x1ypdohk x1rg5ohu x1s688f"}}[!!b<<0],{"data-testid":void 0,children:a}))]})},a)})})),b[9]=g,b[10]=e,b[11]=o):o=b[11];b[12]!==a||b[13]!==o?(j=l.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:l.jsxs("div",{"data-testid":void 0,children:[a,o]})}),b[12]=a,b[13]=o,b[14]=j):j=b[14];return j}g["default"]=a}),226);
__d("VideoPlayerSettingsMenuQualityPane.react",["fbt","ix","CometImage.react","CometPressable.react","FocusRegion.react","VideoPlayerHooks","VideoPlayerSettingsMenu.react","focusScopeQueries","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||d("react"),m={menuOptionRow:{color:"x14ctfv",display:"x1lliihq",minWidth:"xfvyar9",outline:"x1a2a7pz",paddingTop:"xyqdw3p",paddingEnd:"x4uap5",paddingBottom:"xg8j3zb",paddingStart:"xkhd6sd",textAlign:"x1yc453h",$$css:!0},pressableOption:{width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(26),e=a.selectedVideoQuality,f=a.setPane;a=(k||(k=d("VideoPlayerHooks"))).useAvailableVideoQualities();var g=k.useIsAbrEnabled(),j=k.useController(),n;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(n={className:"x6s0dn4 x14ctfv x1ypdohk x78zum5 x1s688f x1lku1pv"},b[0]=n):n=b[0];var o;b[1]!==f?(o=function(){return f(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenuPaneType.MAIN)},b[1]=f,b[2]=o):o=b[2];var p;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(p={className:"x6s0dn4 x3nfvp2 xmgb6t1 x139jcc6"},b[3]=p):p=b[3];var q;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(p=l.jsx("span",babelHelpers["extends"]({},p,{children:l.jsx(c("CometImage.react"),{src:i("480579")})})),q=h._(/*BTDS*/"Quality"),b[4]=p,b[5]=q):(p=b[4],q=b[5]);b[6]!==o?(n=l.jsx("div",babelHelpers["extends"]({},n,{children:l.jsxs(c("CometPressable.react"),{onPress:o,testid:void 0,xstyle:m.pressableOption,children:[p,q]})})),b[6]=o,b[7]=n):n=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(p={className:"x17adc0v x1anpbxc"},b[8]=p):p=b[8];b[9]!==j||b[10]!==g||b[11]!==e?(q=g?l.jsx("div",{children:l.jsxs(c("CometPressable.react"),{onPress:function(){j.selectVideoQuality("auto")},testid:void 0,xstyle:m.menuOptionRow,children:[l.jsx("div",babelHelpers["extends"]({className:"xiakxrv x1ykpwxx x118zf8b xnwxkdh xfocsrx x1rg5ohu xmgb6t1 xmo9yow x1yrsyyn xsyo7zv x10b6aqq x16hj40l"},{children:e==="auto"&&l.jsx("div",babelHelpers["extends"]({className:"x14hiurz x8u2fvd x1ht7hnu x1quq95r x5yzy4c x1rg5ohu xqu0tyb x8182xy x1kgmq87 x10l6tqk x51ohtg"},{"data-testid":void 0}))})),l.jsx("div",babelHelpers["extends"]({},{0:{className:"x1ypdohk x1rg5ohu"},1:{className:"x1ypdohk x1rg5ohu x1s688f"}}[!!(e==="auto")<<0],{"data-testid":void 0,children:h._(/*BTDS*/"Auto")}))]})},"auto"):null,b[9]=j,b[10]=g,b[11]=e,b[12]=q):q=b[12];if(b[13]!==a||b[14]!==j||b[15]!==e){b[17]!==j||b[18]!==e?(o=function(a){var b=e===a;return l.jsx("div",{children:l.jsxs(c("CometPressable.react"),{onPress:function(){j.selectVideoQuality(a)},testid:void 0,xstyle:m.menuOptionRow,children:[l.jsx("div",babelHelpers["extends"]({className:"xiakxrv x1ykpwxx x118zf8b xnwxkdh xfocsrx x1rg5ohu xmgb6t1 xmo9yow x1yrsyyn xsyo7zv x10b6aqq x16hj40l"},{children:b&&l.jsx("div",babelHelpers["extends"]({className:"x14hiurz x8u2fvd x1ht7hnu x1quq95r x5yzy4c x1rg5ohu xqu0tyb x8182xy x1kgmq87 x10l6tqk x51ohtg"},{"data-testid":void 0}))})),l.jsx("div",babelHelpers["extends"]({},{0:{className:"x1ypdohk x1rg5ohu"},1:{className:"x1ypdohk x1rg5ohu x1s688f"}}[!!b<<0],{"data-testid":void 0,children:a}))]})},a)},b[17]=j,b[18]=e,b[19]=o):o=b[19];g=a.map(o).reverse();b[13]=a;b[14]=j;b[15]=e;b[16]=g}else g=b[16];b[20]!==q||b[21]!==g?(o=l.jsxs("div",babelHelpers["extends"]({},p,{"data-testid":void 0,children:[q,g]})),b[20]=q,b[21]=g,b[22]=o):o=b[22];b[23]!==o||b[24]!==n?(a=l.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,recoverFocusQuery:d("focusScopeQueries").headerFirstTabbableSecondScopeQuery,children:l.jsxs("div",{"data-testid":void 0,children:[n,o]})}),b[23]=o,b[24]=n,b[25]=a):a=b[25];return a}g["default"]=a}),226);
__d("VideoPlayerSettingsControl.react",["fbt","ix","VideoPlayerControlIcon.react","VideoPlayerDefaultControlsProperties","VideoPlayerSettingsMenu.react","VideoPlayerUserInteractionCounter","fbicon","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useState;function a(a){var b=d("react-compiler-runtime").c(26),e=a.alignMenuToIcon,f=a.children,g=a.compactMenu,j=a.forceShowPlaybackRateControl,m=a.icon,n=a.menuOpened,o=a.onMenuOpen,p=a.onUserInteraction,q=a.ref,r=a.setMenuOpened;a=e===void 0?!1:e;e=f===void 0?null:f;f=l(!1);var s=f[0],t=f[1];b[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=h._(/*BTDS*/"Settings"),b[0]=f):f=b[0];f=f;var u=r!=null;d("VideoPlayerUserInteractionCounter").useVideoPlayerUserInteraction("video_settings_menu",u?n===d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_SETTINGS_MENU:s,p);var v=u?n===d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_SETTINGS_MENU:s;b[1]!==a?(p={0:{className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn"},1:{className:"x1rg5ohu x1k70j0n x1w0mnb xzueoph x1mnrxsn x1n2onr6 xuxw1ft"}}[!!(a===!0)<<0],b[1]=a,b[2]=p):p=b[2];b[3]!==a||b[4]!==e||b[5]!==g||b[6]!==j||b[7]!==u||b[8]!==v||b[9]!==r?(n=v&&k.jsx("div",babelHelpers["extends"]({},{0:{className:"xjb1437 xacj9c0 x14ctfv x89ytp0 x889kno x1ou2tus x1a8lsjc x1egjynq x10l6tqk x1fwd5yv"},2:{className:"xjb1437 xacj9c0 x14ctfv x89ytp0 x889kno x1ou2tus x1a8lsjc x1egjynq x10l6tqk xwjie4w"},1:{className:"xjb1437 xacj9c0 x14ctfv x89ytp0 x889kno x1ou2tus x1a8lsjc x1egjynq x10l6tqk x3m8u43"},3:{className:"xjb1437 xacj9c0 x14ctfv x89ytp0 x889kno x1ou2tus x1a8lsjc x1egjynq x10l6tqk x3m8u43"}}[!!(g===!0)<<1|!!(a===!0)<<0],{children:k.jsx(d("VideoPlayerSettingsMenu.react").VideoPlayerSettingsMenu,{forceShowPlaybackRateControl:j,onClose:function(){u?r!=null&&r(null):t(!1)},children:e})})),b[3]=a,b[4]=e,b[5]=g,b[6]=j,b[7]=u,b[8]=v,b[9]=r,b[10]=n):n=b[10];b[11]!==m?(a=m==null?d("fbicon")._(i("497567"),20):m,b[11]=m,b[12]=a):a=b[12];b[13]!==u||b[14]!==v||b[15]!==s||b[16]!==o||b[17]!==r?(e=function(){u?r!=null&&r(v?null:d("VideoPlayerDefaultControlsProperties").VideoMenuType.VIDEO_SETTINGS_MENU):t(!s),!v&&o!=null&&o()},b[13]=u,b[14]=v,b[15]=s,b[16]=o,b[17]=r,b[18]=e):e=b[18];b[19]!==a||b[20]!==e?(g=k.jsx(c("VideoPlayerControlIcon.react"),{icon:a,label:f,onPress:e,tooltip:f}),b[19]=a,b[20]=e,b[21]=g):g=b[21];b[22]!==p||b[23]!==n||b[24]!==g?(j=k.jsxs("div",babelHelpers["extends"]({},p,{ref:q,children:[n,g]})),b[22]=p,b[23]=n,b[24]=g,b[25]=j):j=b[25];return j}a.displayName="VideoPlayerSettingsControl";g["default"]=a}),226);
__d("VideoPlayerWatchAndScrollControl_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerWatchAndScrollControl_video",selections:[a,{alias:null,args:null,kind:"ScalarField",name:"playable_duration_in_ms",storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"owner",plural:!1,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"has_professional_features_for_watch",storageKey:null}],type:"VideoOwner",abstractKey:"__isVideoOwner"},a],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_huddle",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Video",abstractKey:null}}();e.exports=a}),null);
__d("VideoPlayerWithWatchAndScrollTrigger.react",["$InternalEnum","CastingStateHooks","CometWatchAndScrollTriggerContext","CometWatchAndScrollVideoContext","VideoPlayerHooks","react","react-compiler-runtime","requireDeferred","useVisibilityObserver","useWatchAndScrollTrigger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));e=h;e.useCallback;var k=e.useContext,l=c("requireDeferred")("VideoHomeTypedLiteLogger").__setRef("VideoPlayerWithWatchAndScrollTrigger.react"),m=5,n=30,o=b("$InternalEnum")({BROADCAST:"broadcast",HERO:"hero",PAGE_SPOTLIGHT_CARD:"page_spotlight_card",TAHOE:"tahoe",VOD:"vod",WNS_CONTROL:"wns_control"});function a(a){var b=d("react-compiler-runtime").c(14),e=a.subOrigin,f=a.triggerType;a=a.videoID;var g=k(c("CometWatchAndScrollTriggerContext")),h=g.isControlShown;g=g.isTriggerDisabled;var s=(i||(i=d("VideoPlayerHooks"))).useController(),t=d("useWatchAndScrollTrigger").useWatchAndScrollTrigger(e,f,a),u=k(c("CometWatchAndScrollVideoContext")),v=d("CastingStateHooks").useIsCastingAnyVideo();b[0]!==s||b[1]!==u||b[2]!==v||b[3]!==f||b[4]!==t?(e=function(a){if(a.hiddenReason!=="NOT_IN_VIEWPORT")return;a=s.getCurrentState();var b=a.paused,c=!a.muted,d=s.getPlayheadPosition();a=a.duration;var e=m;a>=30&&(e=Math.max(m,Math.min(n,Math.ceil(a*0/100))));if(!b&&!v&&u==null)bb9:switch(f){case o.HERO:t();l.onReady(r);break bb9;case o.BROADCAST:c&&(t(),l.onReady(q));break bb9;case o.VOD:c&&d>=e&&(t(),l.onReady(p));break bb9;default:}},b[0]=s,b[1]=u,b[2]=v,b[3]=f,b[4]=t,b[5]=e):e=b[5];a=e;b[6]!==a?(e={onHidden:a},b[6]=a,b[7]=e):e=b[7];a=c("useVisibilityObserver")(e);if(!h||g)return null;switch(f){case o.HERO:case o.BROADCAST:b[8]===Symbol["for"]("react.memo_cache_sentinel")?(e={className:"xu1mrb xh8yej3"},b[8]=e):e=b[8];b[9]!==a?(h=j.jsx("div",babelHelpers["extends"]({},e,{ref:a})),b[9]=a,b[10]=h):h=b[10];return h;case o.VOD:b[11]===Symbol["for"]("react.memo_cache_sentinel")?(g={className:"xu1mrb xh8yej3"},b[11]=g):g=b[11];b[12]!==a?(e=j.jsx("div",babelHelpers["extends"]({},g,{ref:a})),b[12]=a,b[13]=e):e=b[13];return e;default:return null}}function p(a){a.log({event:"watch_and_scroll_trigger",event_target:"newsfeed_vod"})}function q(a){a.log({event:"watch_and_scroll_trigger",event_target:"newsfeed_live"})}function r(a){a.log({event:"watch_and_scroll_trigger",event_target:"hero"})}g.WatchAndScrollTriggerType=o;g.VideoPlayerWithWatchAndScrollTrigger=a}),98);
__d("useVideoPlayerPortalingPassthroughProps",["VideoPlayerPortalingPlaceInfoProvider.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useMemo;function a(){var a=d("VideoPlayerPortalingPlaceInfoProvider.react").useVideoPlayerPortalingPlaceInfo(),b=a.currentVideoID,c=a.thisPlaceID;return i(function(){return{portableVideoID:b,portalingPlaceID:c,positionToViewport:null}},[b])}g["default"]=a}),98);
__d("useWatchAndScrollTrigger",["CometPictureInPictureExpContext","CometSetWatchAndScrollVideoContext","CometWatchAndScrollSoundContext","VideoPlayerHooks","VideoPlayerWithWatchAndScrollTrigger.react","react","recoverableViolation","usePlayerOriginRouteTracePolicy","useVideoPlayerPortalingPassthroughProps"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=h||d("react");var j=b.useCallback,k=b.useContext;function a(a,b,e,f){var g=c("useVideoPlayerPortalingPassthroughProps")(),h=g.portableVideoID,l=g.portalingPlaceID,m=c("usePlayerOriginRouteTracePolicy")(),n=(i||(i=d("VideoPlayerHooks"))).useController(),o=k(c("CometSetWatchAndScrollVideoContext")),p=k(c("CometWatchAndScrollSoundContext")),q=k(c("CometPictureInPictureExpContext"));return j(function(){p!=null&&(p.setMuted(null),p.setVolume(null));if(h!=null&&l!=null){var g=q.pictureInPictureExpConfig.isInPictureInPictureExp,i=q.pictureInPictureExpConfig.isInPictureInPictureExpControlGroup;if((g||i)&&b!==d("VideoPlayerWithWatchAndScrollTrigger.react").WatchAndScrollTriggerType.WNS_CONTROL)return;o({controller:n,portableVideoID:h,portalingPlaceID:l,routeTracePolicy:m,sessionStartTime:new Date(),sessionTrigger:b,subOrigin:a,videoID:e,videoUrl:f})}else c("recoverableViolation")("Could not transition to Watch and Scroll player because portableVideoID was null","comet_video_player")},[p,h,l,q.pictureInPictureExpConfig.isInPictureInPictureExp,q.pictureInPictureExpConfig.isInPictureInPictureExpControlGroup,b,o,n,m,a,e,f])}g.useWatchAndScrollTrigger=a}),98);
__d("useIsVideoHomePlayerOriginFromTracePolicy",["react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("react-compiler-runtime").c(1),c;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(c=["comet.watch.catalog","comet.watch.explore","comet.watch.feed","comet.watch.injection","comet.watch.latest","comet.watch.notifications","comet.watch.playlist","comet.watch.saved","comet.watch.search","comet.watch.sports","comet.watch.live.injection","comet.watch.live","comet.watch.music","comet.watch.lancelet"],b[0]=c):c=b[0];b=c;return b.includes(a)}g["default"]=a}),98);
__d("useVideoPlayerWatchAndScrollControlNUXQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9959057844158796"}),null);
__d("useVideoPlayerWatchAndScrollControlNUXQuery.graphql",["useVideoPlayerWatchAndScrollControlNUXQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"Literal",name:"nux_id",value:9347}],c={alias:null,args:null,kind:"ScalarField",name:"should_show",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVideoPlayerWatchAndScrollControlNUXQuery",selections:[{alias:null,args:a,concreteType:null,kind:"LinkedField",name:"nux",plural:!1,selections:[c],storageKey:"nux(nux_id:9347)"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useVideoPlayerWatchAndScrollControlNUXQuery",selections:[{alias:null,args:a,concreteType:null,kind:"LinkedField",name:"nux",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},c,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:"nux(nux_id:9347)"}]},params:{id:b("useVideoPlayerWatchAndScrollControlNUXQuery_facebookRelayOperation"),metadata:{},name:"useVideoPlayerWatchAndScrollControlNUXQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useVideoPlayerWatchAndScrollControlNUX",["fbt","ARIA_LABEL_PLACEHOLDER_FIXME","CometRelay","CometWatchAndScrollTriggerContext","react","react-compiler-runtime","recoverableViolation","requireDeferred","useFDSCallout","useVideoPlayerWatchAndScrollControlNUXQuery.graphql"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;e=j||d("react");e.useCallback;var k=e.useContext,l=e.useEffect,m=e.useState,n=c("requireDeferred")("CometDismissFBNuxMutation").__setRef("useVideoPlayerWatchAndScrollControlNUX"),o=c("requireDeferred")("CometLogImpressionFBNuxMutation").__setRef("useVideoPlayerWatchAndScrollControlNUX"),p={nux:{maxWidth:"xw5ewwj",$$css:!0}},q=9347,r=i!==void 0?i:i=b("useVideoPlayerWatchAndScrollControlNUXQuery.graphql");function a(a){var b=d("react-compiler-runtime").c(18),e=k(c("CometWatchAndScrollTriggerContext")),f=e.setIsTriggerDisabled;e=m(null);var g=e[0],i=e[1],j=d("CometRelay").useRelayEnvironment();b[0]!==j||b[1]!==f?(e=function(){f!=null&&f(!0),i(!1),n.onReady(function(a){a.commit(j,q)})},b[0]=j,b[1]=f,b[2]=e):e=b[2];var u=e,v;b[3]!==a||b[4]!==j||b[5]!==g?(e=function(){if(a&&g===null){var b=d("CometRelay").fetchQuery(j,r,{fetchPolicy:"store-or-network"}).subscribe({next:function(b){b=(b==null?void 0:(b=b.nux)==null?void 0:b.should_show)||!1;i(b);b&&a&&o.onReady(function(a){a.commit(j,q,t,s)})}});return function(){b.unsubscribe()}}},v=[j,a,g],b[3]=a,b[4]=j,b[5]=g,b[6]=e,b[7]=v):(e=b[6],v=b[7]);l(e,v);b[8]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"Continue watching while you browse Facebook."),b[8]=e):e=b[8];b[9]!==u?(v=function(){u()},b[9]=u,b[10]=v):v=b[10];var w;b[11]===Symbol["for"]("react.memo_cache_sentinel")?(w=function(){i(!1)},b[11]=w):w=b[11];b[12]!==v?(e={align:"end","aria-label":c("ARIA_LABEL_PLACEHOLDER_FIXME"),arrowStyle:"inset",content:e,disableAutoFlip:!0,hasCloseButton:!0,onClose:v,onHide:w,position:"below",type:"accent",xstyle:p.nux},b[12]=v,b[13]=e):e=b[13];w=c("useFDSCallout")(e,g===!0&&a||!1);v=w.anchorRef;b[14]!==v||b[15]!==u||b[16]!==g?(e={handleDismissNUX:u,nuxRef:v,shouldShowNUX:g},b[14]=v,b[15]=u,b[16]=g,b[17]=e):e=b[17];return e}function s(){c("recoverableViolation")("logimpression fb nux mutation failed for video player watch and scroll control.","watch_www_and_off_platform")}function t(){}g["default"]=a}),226);
__d("VideoPlayerWatchAndScrollControl.react",["fbt","ix","CastingStateHooks","CometPictureInPictureExpContext","CometRelay","CometRouteRenderType","CometVideoPictureInPictureManager.react","CometVideoPictureInPictureManagerContext","CometWatchAndScrollControlNUXContext","CometWatchAndScrollTriggerContext","JSResourceForInteraction","VideoPlayerControlIcon.react","VideoPlayerHooks","VideoPlayerInstreamAdsStateHooks","VideoPlayerWatchAndScrollControl_video.graphql","VideoPlayerWithWatchAndScrollTrigger.react","emptyFunction","fbicon","gkx","react","react-compiler-runtime","requireDeferred","useCometLazyDialog","useCometRouterDispatcher","useCometRouterState","useIsVideoHomePlayerOriginFromTracePolicy","useMinifiedProductAttribution","usePlayerOriginRouteTracePolicy","useVideoPlayerWatchAndScrollControlNUX","useWatchAndScrollTrigger"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l,m=k||(k=d("react"));e=k;e.useCallback;var n=e.useContext,o=e.useEffect,p=e.useState,q=c("requireDeferred")("VideoHomeTypedLiteLogger").__setRef("VideoPlayerWatchAndScrollControl.react"),r=c("JSResourceForInteraction")("CometCastingStopWatchAndScrollDialog.react").__setRef("VideoPlayerWatchAndScrollControl.react"),s=6e4,t=window.document.pictureInPictureEnabled;function a(a){var e=d("react-compiler-runtime").c(56),f=a.subOrigin;a=a.video;var g=n(c("CometWatchAndScrollTriggerContext")),k=g.isControlShown,u=g.setIsControlShown;g=d("CometRouteRenderType").useIsPushView();var v=(l||(l=d("VideoPlayerHooks"))).useIsFullscreen(),w=c("useCometRouterDispatcher")(),x=c("useCometRouterState")(),y=(x=x==null?void 0:x.main.route.tabKey)!=null?x:"undefined";x=d("CometRelay").useFragment(j!==void 0?j:j=b("VideoPlayerWatchAndScrollControl_video.graphql"),a);var z=x==null?void 0:x.id;a=(a=x==null?void 0:x.playable_duration_in_ms)!=null?a:0;var A=x==null?void 0:x.is_huddle,B=x==null?void 0:x.url,C,D;e[0]!==u?(C=function(){u!=null&&u(!0)},D=[u],e[0]=u,e[1]=C,e[2]=D):(C=e[1],D=e[2]);o(C,D);var E=c("usePlayerOriginRouteTracePolicy")();C=c("useIsVideoHomePlayerOriginFromTracePolicy")(E);D=(x==null?void 0:(D=x.owner)==null?void 0:D.has_professional_features_for_watch)===!0&&a>=s&&k&&!C;var F=l.usePlaying(),G=l.useController();a=G.getPlayheadPosition();var H=a>=10;k=p(!1);C=k[0];var I=k[1];a=p(!1);var J=a[0],K=a[1];k=p(!1);a=k[0];var L=k[1];k=d("VideoPlayerInstreamAdsStateHooks").useInstreamAdsStateValue();k=k==="STARTING_INDICATOR"||k==="PLAY_NI_VIDEO"||k==="START_AD"||k==="PLAY_LONGER_AD";var M=c("useMinifiedProductAttribution")(),N,O;e[3]!==H||e[4]!==F?(N=function(){F&&H&&I(!0)},O=[H,F],e[3]=H,e[4]=F,e[5]=N,e[6]=O):(N=e[5],O=e[6]);o(N,O);var P=d("CastingStateHooks").useIsCastingAnyVideo();N=c("useCometLazyDialog")(r);var Q=N[0];O=!k&&C&&D;N=c("useVideoPlayerWatchAndScrollControlNUX")(O);var R=N.handleDismissNUX;k=N.nuxRef;C=N.shouldShowNUX;var S=C===!0&&O;D=n(c("CometWatchAndScrollControlNUXContext"));var T=D.setIsVideoPlayerWatchAndScrollControlNUXVisible,U=n(c("CometPictureInPictureExpContext"));e[7]!==S||e[8]!==T?(N=function(){T&&T(S)},C=[S,T],e[7]=S,e[8]=T,e[9]=N,e[10]=C):(N=e[9],C=e[10]);o(N,C);var V=d("useWatchAndScrollTrigger").useWatchAndScrollTrigger(f,d("VideoPlayerWithWatchAndScrollTrigger.react").WatchAndScrollTriggerType.WNS_CONTROL,z,B),W=l.useIsPremiumMusicVideo(),X=x==null?void 0:(O=x.owner)==null?void 0:O.id;e[11]!==W||e[12]!==X||e[13]!==U?(D=function(){var a=d("CometVideoPictureInPictureManagerContext").isInPictureInPictureExp(),b=d("CometVideoPictureInPictureManagerContext").isInPictureInPictureExpControlGroup();U.setPictureInPictureExpConfig({isInPictureInPictureExp:a,isInPictureInPictureExpControlGroup:b,isSkipAndChainingDisabled:!1});t&&a&&K(!0);a=(a||b)&&(W||d("CometVideoPictureInPictureManager.react").EXCLUDED_PROVIDERS.includes(X));a&&L(!0)},e[11]=W,e[12]=X,e[13]=U,e[14]=D):D=e[14];N=D;var Y=E==="comet.videos.tahoe";e[15]!==P||e[16]!==V||e[17]!==Q||e[18]!==z?(C=function(){P&&z!=null?Q({onClose:c("emptyFunction"),onContinue:V,startingVideoType:"wns"},c("emptyFunction")):V()},e[15]=P,e[16]=V,e[17]=Q,e[18]=z,e[19]=C):C=e[19];var Z=C;e[20]!==G||e[21]!==w||e[22]!==R||e[23]!==J||e[24]!==S||e[25]!==Z||e[26]!==M||e[27]!==E||e[28]!==f||e[29]!==y?(B=function(){Z(),J?(q.onReady(function(a){a.log({attribution_id_v2:M,click_point:"control_picture_in_picture",event:"click",event_target_info:E,player_suborigin:f})}),G.requestPictureInPicture()):q.onReady(function(a){a.log({attribution_id_v2:M,click_point:"control_watch_and_scroll",event:"click",event_target_info:y})}),S===!0&&R(),w&&w.popPushView()},e[20]=G,e[21]=w,e[22]=R,e[23]=J,e[24]=S,e[25]=Z,e[26]=M,e[27]=E,e[28]=f,e[29]=y,e[30]=B):B=e[30];x=B;var $=f==="live_producer";e[31]!==G||e[32]!==w||e[33]!==Y||e[34]!==R||e[35]!==J||e[36]!==v||e[37]!==S||e[38]!==Z||e[39]!==M||e[40]!==$||e[41]!==E||e[42]!==f||e[43]!==y?(O=function(){Z(),J?(q.onReady(function(a){a.log({attribution_id_v2:M,click_point:"control_picture_in_picture",event:"click",event_target_info:E,player_suborigin:f})}),G.requestPictureInPicture()):q.onReady(function(a){a.log({attribution_id_v2:M,click_point:"control_watch_and_scroll",event:"click",event_target_info:y})}),S===!0&&R(),v&&G.requestSetIsFullscreen(!1),w!=null&&($||Y)&&w.go("/",{})},e[31]=G,e[32]=w,e[33]=Y,e[34]=R,e[35]=J,e[36]=v,e[37]=S,e[38]=Z,e[39]=M,e[40]=$,e[41]=E,e[42]=f,e[43]=y,e[44]=O):O=e[44];D=O;C=g?x:D;if(c("gkx")("20836")){e[45]===Symbol["for"]("react.memo_cache_sentinel")?(B=h._(/*BTDS*/"Continue watching while you use Workplace"),e[45]=B):B=e[45];O=B}else if(A===!0){e[46]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Continue listening while you browse Facebook."),e[46]=g):g=e[46];O=g}else{e[47]===Symbol["for"]("react.memo_cache_sentinel")?(x=h._(/*BTDS*/"Continue watching while you browse Facebook."),e[47]=x):x=e[47];O=x}if(J){e[48]===Symbol["for"]("react.memo_cache_sentinel")?(D=h._(/*BTDS*/"Enter Picture in Picture Mode"),e[48]=D):D=e[48];O=D}e[49]!==a||e[50]!==S||e[51]!==O||e[52]!==k||e[53]!==N||e[54]!==C?(B=a?null:m.jsx("div",{onMouseEnter:N,ref:k,children:m.jsx(c("VideoPlayerControlIcon.react"),{color:"white",icon:d("fbicon")._(i("150489"),20),label:O,onPress:C,tooltip:S?null:O})}),e[49]=a,e[50]=S,e[51]=O,e[52]=k,e[53]=N,e[54]=C,e[55]=B):B=e[55];return B}g["default"]=a}),226);
__d("VideoPlayerLiveVideoControls.react",["CometPlaceholder.react","CometRelay","CometTahoeCustomVideoAreaContext","CometTahoeSidePaneContext","CometTrackingNodeProvider.react","LiveCostreamerTagSubscription.react","LiveVideoLatencyMenu.react","VideoPlayerCaptionsControl.react","VideoPlayerCastControlShim.react","VideoPlayerControlsBottomRowAddOnContext","VideoPlayerControlsContainerOverlay.react","VideoPlayerControlsGroups.react","VideoPlayerExpandSidePanelControl.react","VideoPlayerHooks","VideoPlayerLiveVideoControls_video.graphql","VideoPlayerPlaybackControl.react","VideoPlayerQuietModeControl.react","VideoPlayerSettingsControl.react","VideoPlayerVolumeControl.react","VideoPlayerWatchAndScrollControl.react","gkx","react","react-compiler-runtime","useVideoPlayerBigPlayButtonOverlay"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=i||(i=d("react"));e=i;var l=e.useContext,m=e.useState,n=h!==void 0?h:h=b("VideoPlayerLiveVideoControls_video.graphql");function o(a){var b,e,f=d("react-compiler-runtime").c(85),g=d("CometRelay").useFragment(n,a.video),h=(j||(j=d("VideoPlayerHooks"))).useEnded(),i=j.useIsFullscreen(),o=l(d("VideoPlayerControlsBottomRowAddOnContext").VideoPlayerControlsBottomRowAddOnContext),p=l(c("CometTahoeSidePaneContext"));p=p.rightRailHidden;var q=c("useVideoPlayerBigPlayButtonOverlay")();q=q.bigPlayButtonIsVisible;var r=j.useCaptionsLoaded(),s=j.useCaptionsVisible(),t=m(null),u=t[0];t=t[1];var v=l(d("CometTahoeCustomVideoAreaContext").CometTahoeCustomVideoAreaContext);v=v.customVideoAreaHidden;if(h)return null;h=a.disablePlaybackControls;var w=a.expandControl,x=a.isControlsVisible,y=a.isExpandControlVisible,z=a.isVolumeControlVisible,A=a.isWatchAndScrollControlVisible,B=a.onUserInteraction,C=a.shouldRenderCaptionsControl,D=a.shouldRenderCostreamControl,E=a.shouldRenderModeratorControl,F=a.subOrigin;y=y===void 0?!1:y;A=A===void 0?!1:A;C=C===void 0?!0:C;D=D===void 0?!1:D;E=E===void 0?!1:E;var G=g==null?void 0:g.id;b=g==null?void 0:(b=g.owner)==null?void 0:b.id;var H=g==null?void 0:g.if_viewer_can_see_costreaming_tools,I=H!=null,J=g==null?void 0:g.if_viewer_can_use_clipping,K=(g==null?void 0:g.is_clipping_enabled)===!0,L=g==null?void 0:g.if_viewer_can_see_community_moderation_tools,M=L!=null,N=g==null?void 0:g.if_viewer_can_use_live_rewind;e=((e=g==null?void 0:g.live_rewind_enabled)!=null?e:!1)&&a.shouldHideRewindControls!==!0;y=y||x||h===!0&&!q;A=A||x||h===!0&&!q;f[0]!==w||f[1]!==y?(q=k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:y,noPaddingEnd:!0,noPaddingStart:!0,children:w}),f[0]=w,f[1]=y,f[2]=q):q=f[2];w=q;f[3]!==a.shouldRenderWatchAndScrollControl||f[4]!==A||f[5]!==F||f[6]!==g?(y=a.shouldRenderWatchAndScrollControl===!0&&F!=null&&g!=null?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:A,children:k.jsx(c("VideoPlayerWatchAndScrollControl.react"),{subOrigin:F,video:g})}):null,f[3]=a.shouldRenderWatchAndScrollControl,f[4]=A,f[5]=F,f[6]=g,f[7]=y):y=f[7];q=y;A=F==="watch_scroll";y=c("gkx")("24335")?C===!0:!A;f[8]!==N||f[9]!==h||f[10]!==x||f[11]!==e||f[12]!==B||f[13]!==a.shouldRenderPauseControl?(C=e?k.jsx(d("CometRelay").MatchContainer,{match:N,props:{isControlsVisible:x&&!h,onUserInteraction:B,video:N}}):k.jsxs(k.Fragment,{children:[Boolean(a.shouldRenderPauseControl)?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:x&&!h,children:k.jsx(c("VideoPlayerPlaybackControl.react"),{})}):null,k.jsx(d("VideoPlayerControlsGroups.react").Expanded,{children:k.jsx(k.Fragment,{})})]}),f[8]=N,f[9]=h,f[10]=x,f[11]=e,f[12]=B,f[13]=a.shouldRenderPauseControl,f[14]=C):C=f[14];f[15]!==b||f[16]!==G?(A=b!=null&&G!=null&&k.jsx(c("LiveCostreamerTagSubscription.react"),{pageID:b,videoID:G}),f[15]=b,f[16]=G,f[17]=A):A=f[17];f[18]!==I||f[19]!==H||f[20]!==i||f[21]!==D||f[22]!==G?(N=I&&D&&G!=null&&!i&&k.jsx(c("CometPlaceholder.react"),{fallback:null,children:k.jsx(d("CometRelay").MatchContainer,{match:H,props:{video:H}})}),f[18]=I,f[19]=H,f[20]=i,f[21]=D,f[22]=G,f[23]=N):N=f[23];f[24]!==i||f[25]!==a.shouldRenderQuietModeControl?(e=a.shouldRenderQuietModeControl===!0&&!i&&k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:!0,noPaddingEnd:!0,children:k.jsx(c("VideoPlayerQuietModeControl.react"),{})}),f[24]=i,f[25]=a.shouldRenderQuietModeControl,f[26]=e):e=f[26];f[27]!==i||f[28]!==a.shouldRenderExpandSidePanelControl||f[29]!==p?(b=a.shouldRenderExpandSidePanelControl===!0&&!i&&!p&&k.jsx(c("VideoPlayerExpandSidePanelControl.react"),{}),f[27]=i,f[28]=a.shouldRenderExpandSidePanelControl,f[29]=p,f[30]=b):b=f[30];f[31]!==J||f[32]!==K||f[33]!==G?(I=K&&G!=null&&k.jsx(d("CometRelay").MatchContainer,{match:J,props:{video:J,videoID:G}}),f[31]=J,f[32]=K,f[33]=G,f[34]=I):I=f[34];f[35]!==M||f[36]!==L||f[37]!==E||f[38]!==G?(H=M&&E?k.jsx(c("CometPlaceholder.react"),{fallback:null,children:k.jsx(d("CometRelay").MatchContainer,{match:L,props:{video:L,videoID:G}})}):null,f[35]=M,f[36]=L,f[37]=E,f[38]=G,f[39]=H):H=f[39];f[40]!==o||f[41]!==h||f[42]!==u||f[43]!==B||f[44]!==g?(D=h===!0?null:k.jsx(c("CometTrackingNodeProvider.react"),{trackingNode:257,children:k.jsx(d("LiveVideoLatencyMenu.react").LiveVideoLatencyMenuContextProvider,{video:g,children:k.jsx(c("VideoPlayerSettingsControl.react"),{alignMenuToIcon:(o==null?void 0:o.getBottomRowAddOn())!=null,menuOpened:u,onUserInteraction:B,setMenuOpened:t})})}),f[40]=o,f[41]=h,f[42]=u,f[43]=B,f[44]=g,f[45]=D):D=f[45];f[46]!==o||f[47]!==r||f[48]!==s||f[49]!==y||f[50]!==x||f[51]!==u||f[52]!==B||f[53]!==g?(i=r&&y?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:x,children:k.jsx(c("VideoPlayerCaptionsControl.react"),{alignMenuToIcon:(o==null?void 0:o.getBottomRowAddOn())!=null,captionsVisible:s,menuOpened:u,onUserInteraction:B,setMenuOpened:t,video:g})}):null,f[46]=o,f[47]=r,f[48]=s,f[49]=y,f[50]=x,f[51]=u,f[52]=B,f[53]=g,f[54]=i):i=f[54];f[55]!==h||f[56]!==x||f[57]!==a.shouldRenderCastControl||f[58]!==F||f[59]!==g?(p=a.shouldRenderCastControl===!0&&F!=null&&g!=null?k.jsx(c("VideoPlayerCastControlShim.react"),{isVisible:x&&!h,subOrigin:F}):null,f[55]=h,f[56]=x,f[57]=a.shouldRenderCastControl,f[58]=F,f[59]=g,f[60]=p):p=f[60];f[61]!==x||f[62]!==e||f[63]!==b||f[64]!==I||f[65]!==H||f[66]!==D||f[67]!==i||f[68]!==p||f[69]!==A||f[70]!==N?(J=k.jsxs(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:x,children:[A,N,e,b,I,H,D,i,p]}),f[61]=x,f[62]=e,f[63]=b,f[64]=I,f[65]=H,f[66]=D,f[67]=i,f[68]=p,f[69]=A,f[70]=N,f[71]=J):J=f[71];f[72]!==B?(K=k.jsx(c("CometTrackingNodeProvider.react"),{trackingNode:114,children:k.jsx(c("VideoPlayerVolumeControl.react"),{onUserInteraction:B})}),f[72]=B,f[73]=K):K=f[73];f[74]!==z||f[75]!==K?(M=k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:z,noPaddingStart:!0,children:K}),f[74]=z,f[75]=K,f[76]=M):M=f[76];f[77]!==v||f[78]!==w||f[79]!==x||f[80]!==J||f[81]!==M||f[82]!==C||f[83]!==q?(L=k.jsxs(c("VideoPlayerControlsContainerOverlay.react"),{isBackgroundVisible:x,isVisible:v,children:[C,J,w,q,M]}),f[77]=v,f[78]=w,f[79]=x,f[80]=J,f[81]=M,f[82]=C,f[83]=q,f[84]=L):L=f[84];return L}function a(a){var b=d("react-compiler-runtime").c(2),e;b[0]!==a?(e=k.jsx(c("CometPlaceholder.react"),{fallback:null,children:k.jsx(o,babelHelpers["extends"]({},a))}),b[0]=a,b[1]=e):e=b[1];return e}g["default"]=a}),98);
__d("VideoPlayerDefaultControlsImplLive.react",["CometRelay","VideoPlayerDefaultControlsImplLive_video.graphql","VideoPlayerLiveVideoControls.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e=d("react-compiler-runtime").c(17),f=a.expandControl,g=a.isControlsVisible,i=a.isVolumeControlVisible,k=a.onUserInteraction,l=a.pictureInPictureControl,m=a.shouldHideRewindControls,n=a.shouldRenderCaptionsControl,o=a.shouldRenderCostreamControl,p=a.shouldRenderExpandSidePanelControl,q=a.shouldRenderModeratorControl,r=a.shouldRenderPauseControl,s=a.shouldRenderQuietModeControl,t=a.shouldRenderWatchAndScrollControl,u=a.subOrigin,v=a.video;a=a.videoTahoeUrl;v=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerDefaultControlsImplLive_video.graphql"),v);var w;e[0]!==f||e[1]!==g||e[2]!==i||e[3]!==k||e[4]!==l||e[5]!==m||e[6]!==n||e[7]!==o||e[8]!==p||e[9]!==q||e[10]!==r||e[11]!==s||e[12]!==t||e[13]!==u||e[14]!==v||e[15]!==a?(w=j.jsx(c("VideoPlayerLiveVideoControls.react"),{expandControl:f,isControlsVisible:g,isVolumeControlVisible:i,onUserInteraction:k,pictureInPictureControl:l,shouldHideRewindControls:m,shouldRenderCaptionsControl:n,shouldRenderCostreamControl:o,shouldRenderExpandSidePanelControl:p,shouldRenderModeratorControl:q,shouldRenderPauseControl:r,shouldRenderQuietModeControl:s,shouldRenderWatchAndScrollControl:t,subOrigin:u,video:v,videoTahoeUrl:a}),e[0]=f,e[1]=g,e[2]=i,e[3]=k,e[4]=l,e[5]=m,e[6]=n,e[7]=o,e[8]=p,e[9]=q,e[10]=r,e[11]=s,e[12]=t,e[13]=u,e[14]=v,e[15]=a,e[16]=w):w=e[16];return w}g["default"]=a}),98);
__d("VideoPlayerDefaultControlsImplNotLive_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerDefaultControlsImplNotLive_video",selections:[{args:null,kind:"FragmentSpread",name:"VideoPlayerScrubberWithPreview_video"},{args:null,kind:"FragmentSpread",name:"VideoPlayerWatchAndScrollControl_video"},{args:null,kind:"FragmentSpread",name:"VideoPlayerCaptionsControl_video"},{args:null,kind:"FragmentSpread",name:"useVideoPlayerAvailableCaptionsLocalesFromRelay_video"},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,concreteType:"Video",kind:"LinkedField",name:"if_viewer_can_use_clipping",plural:!1,selections:[{args:null,documentName:"VideoPlayerDefaultControlsImplNotLive_video_if_viewer_can_use_clipping",fragmentName:"VideoPlayerClipVideoControl_video",fragmentPropName:"video",kind:"ModuleImport"}],storageKey:null}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerScrubberPreview_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerScrubberPreview_video",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"video_player_scrubber_preview_renderer",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"VideoPlayerScrubberPreview_video",fragmentName:"VideoPlayerScrubberChapterPreview_video",fragmentPropName:"video",kind:"ModuleImport"}],type:"XFBVideoPlayerScrubberChapterPreviewRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"VideoPlayerScrubberPreview_video",fragmentName:"VideoPlayerScrubberDefaultPreview_video",fragmentPropName:"video",kind:"ModuleImport"}],type:"XFBVideoPlayerScrubberDefaultPreviewRenderer",abstractKey:null}],storageKey:null}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerTimeIndicator.react",["FDSText.react","formatDurationSeconds","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.shouldCenterSelf;a=a.timestampSec;var f=e===!0?"var(--always-black)":"var(--always-dark-overlay)",g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g="x18l40ae x1lcm9me x1yr5g0i xrt01vj x10y3i5r x1wa3icf x123j3cw x1mpkggp xs9asl8 x1t2a60a x10l6tqk xuxw1ft",b[0]=g):g=b[0];var h;b[1]!==f?(h={backgroundColor:f},b[1]=f,b[2]=h):h=b[2];b[3]!==a?(f=c("formatDurationSeconds")(Math.round(a)),b[3]=a,b[4]=f):f=b[4];b[5]!==f?(a=i.jsx(c("FDSText.react"),{color:"primaryOnMedia",type:"body4",children:f}),b[5]=f,b[6]=a):a=b[6];b[7]!==h||b[8]!==a?(f=i.jsx("div",{className:g,style:h,children:a}),b[7]=h,b[8]=a,b[9]=f):f=b[9];g=f;b[10]!==e||b[11]!==g?(h=e===!0?i.jsx("div",babelHelpers["extends"]({className:"x78zum5 xl56j7k x1n2onr6"},{children:g})):g,b[10]=e,b[11]=g,b[12]=h):h=b[12];return h}g["default"]=a}),98);
__d("VideoPlayerScrubberPreview.react",["CometRelay","VideoPlayerScrubberPreview_video.graphql","VideoPlayerTimeIndicator.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e=d("react-compiler-runtime").c(8),f=a.timestampSec;a=a.video;a=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerScrubberPreview_video.graphql"),a);if(a==null){var g;e[0]!==f?(g=j.jsx(c("VideoPlayerTimeIndicator.react"),{shouldCenterSelf:!0,timestampSec:f}),e[0]=f,e[1]=g):g=e[1];return g}g=a==null?void 0:a.video_player_scrubber_preview_renderer;var i;e[2]!==f||e[3]!==a?(i={timestampSec:f,video:a},e[2]=f,e[3]=a,e[4]=i):i=e[4];e[5]!==g||e[6]!==i?(f=j.jsx(d("CometRelay").MatchContainer,{match:g,props:i}),e[5]=g,e[6]=i,e[7]=f):f=e[7];return f}g["default"]=a}),98);
__d("VideoPlayerScrubberRenderer_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerScrubberRenderer_video",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"video_player_scrubber_base_content_renderer",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"VideoPlayerScrubberRenderer_video",fragmentName:"VideoPlayerScrubberBaseContentSegmented_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"XFBVideoPlayerScrubberBaseContentSegmentedRenderer",abstractKey:null}],storageKey:null}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerScrubberRenderer.react",["CometRelay","VideoPlayerScrubberBaseContentDefault.react","VideoPlayerScrubberRenderer_video.graphql","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e=d("react-compiler-runtime").c(7),f=a.scrubberProps;a=a.video;a=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerScrubberRenderer_video.graphql"),a);if((a==null?void 0:a.video_player_scrubber_base_content_renderer)==null){var g;e[0]!==f?(g=j.jsx(c("VideoPlayerScrubberBaseContentDefault.react"),babelHelpers["extends"]({},f)),e[0]=f,e[1]=g):g=e[1];return g}g=a==null?void 0:a.video_player_scrubber_base_content_renderer;e[2]!==f?(a=babelHelpers["extends"]({},f),e[2]=f,e[3]=a):a=e[3];e[4]!==g||e[5]!==a?(f=j.jsx(d("CometRelay").MatchContainer,{match:g,props:a}),e[4]=g,e[5]=a,e[6]=f):f=e[6];return f}g["default"]=a}),98);
__d("VideoPlayerScrubberWithPreview_video.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VideoPlayerScrubberWithPreview_video",selections:[{args:null,kind:"FragmentSpread",name:"VideoPlayerScrubberPreview_video"},{args:null,kind:"FragmentSpread",name:"VideoPlayerScrubberRenderer_video"}],type:"Video",abstractKey:null};e.exports=a}),null);
__d("VideoPlayerScrubberWithPreview.react",["CometRelay","VideoPlayerScrubber.react","VideoPlayerScrubberPreview.react","VideoPlayerScrubberRenderer.react","VideoPlayerScrubberWithPreview_video.graphql","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e=d("react-compiler-runtime").c(7),f=a.onUserInteraction;a=a.video;var g=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerScrubberWithPreview_video.graphql"),a),i;e[0]!==g?(a=function(a){return j.jsx(c("VideoPlayerScrubberRenderer.react"),{scrubberProps:a,video:g})},i=function(a){return j.jsx(c("VideoPlayerScrubberPreview.react"),{timestampSec:a,video:g})},e[0]=g,e[1]=a,e[2]=i):(a=e[1],i=e[2]);var k;e[3]!==f||e[4]!==a||e[5]!==i?(k=j.jsx(c("VideoPlayerScrubber.react"),{onUserInteraction:f,renderScrubber:a,renderTooltip:i}),e[3]=f,e[4]=a,e[5]=i,e[6]=k):k=e[6];return k}g["default"]=a}),98);
__d("VideoPlayerDefaultControlsImplNotLive.react",["CometRelay","CometTahoeSidePaneContext","VideoPlayerCaptionsControl.react","VideoPlayerControlsBottomRowAddOnContext","VideoPlayerControlsContainerOverlay.react","VideoPlayerControlsGroups.react","VideoPlayerDefaultControlsImplNotLive_video.graphql","VideoPlayerExpandSidePanelControl.react","VideoPlayerHooks","VideoPlayerPlaybackControl.react","VideoPlayerPlaybackTimer.react","VideoPlayerQuietModeControl.react","VideoPlayerScrubberWithPreview.react","VideoPlayerSettingsControl.react","VideoPlayerVolumeControl.react","VideoPlayerWatchAndScrollControl.react","gkx","react","react-compiler-runtime","useVideoPlayerAvailableCaptionsLocalesFromRelay"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=i||(i=d("react"));e=i;var l=e.useContext,m=e.useState;function a(a){var e=d("react-compiler-runtime").c(67),f=a.availableCaptionsLocales,g=a.expandControl,i=a.initialCaptionsUrl,n=a.isControlsVisible,o=a.isVolumeControlVisible,p=a.onUserInteraction,q=a.shouldRenderCaptionsControl,r=a.shouldRenderExpandSidePanelControl,s=a.shouldRenderQuietModeControl,t=a.shouldRenderWatchAndScrollControl,u=a.skipControl,v=a.subOrigin;a=a.video;q=q===void 0?!0:q;r=r===void 0?!1:r;s=s===void 0?!1:s;a=d("CometRelay").useFragment(h!==void 0?h:h=b("VideoPlayerDefaultControlsImplNotLive_video.graphql"),a);var w=(j||(j=d("VideoPlayerHooks"))).useIsFullscreen(),x=a==null?void 0:a.id,y=a==null?void 0:a.if_viewer_can_use_clipping,z=l(d("VideoPlayerControlsBottomRowAddOnContext").VideoPlayerControlsBottomRowAddOnContext),A=l(c("CometTahoeSidePaneContext"));A=A.rightRailHidden;var B;e[0]!==n||e[1]!==w||e[2]!==s?(B=s===!0&&!w?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,noPaddingEnd:!0,children:k.jsx(c("VideoPlayerQuietModeControl.react"),{})}):null,e[0]=n,e[1]=w,e[2]=s,e[3]=B):B=e[3];s=B;e[4]!==n||e[5]!==w||e[6]!==A||e[7]!==r?(B=r===!0&&!w&&!A&&k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,noPaddingEnd:!0,children:k.jsx(c("VideoPlayerExpandSidePanelControl.react"),{})}),e[4]=n,e[5]=w,e[6]=A,e[7]=r,e[8]=B):B=e[8];w=B;e[9]!==y||e[10]!==n||e[11]!==s||e[12]!==x?(A=y!=null&&x!=null&&k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,noPaddingEnd:!0,noPaddingStart:s!=null,children:k.jsx(d("CometRelay").MatchContainer,{match:y,props:{video:y,videoID:x}})}),e[9]=y,e[10]=n,e[11]=s,e[12]=x,e[13]=A):A=e[13];r=A;B=m(null);y=B[0];x=B[1];A=s!=null||r!=null;B=(z==null?void 0:z.getBottomRowAddOn())!=null;e[14]!==y||e[15]!==p||e[16]!==B?(z=k.jsx(c("VideoPlayerSettingsControl.react"),{alignMenuToIcon:B,menuOpened:y,onUserInteraction:p,setMenuOpened:x}),e[14]=y,e[15]=p,e[16]=B,e[17]=z):z=e[17];e[18]!==n||e[19]!==A||e[20]!==z?(B=k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,noPaddingEnd:!0,noPaddingStart:A,children:z}),e[18]=n,e[19]=A,e[20]=z,e[21]=B):B=e[21];A=B;e[22]!==n||e[23]!==t||e[24]!==v||e[25]!==a?(z=t===!0&&v!=null&&a!=null?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,children:k.jsx(c("VideoPlayerWatchAndScrollControl.react"),{subOrigin:v,video:a})}):null,e[22]=n,e[23]=t,e[24]=v,e[25]=a,e[26]=z):z=e[26];B=z;e[27]!==g||e[28]!==n?(t=k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,noPaddingEnd:!0,children:g}),e[27]=g,e[28]=n,e[29]=t):t=e[29];z=t;e[30]!==p?(g=k.jsx(c("VideoPlayerVolumeControl.react"),{onUserInteraction:p}),e[30]=p,e[31]=g):g=e[31];e[32]!==o||e[33]!==g?(t=k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:o,noPaddingStart:!0,children:g}),e[32]=o,e[33]=g,e[34]=t):t=e[34];o=t;e[35]!==p||e[36]!==a?(g=k.jsx(c("VideoPlayerScrubberWithPreview.react"),{onUserInteraction:p,video:a}),e[35]=p,e[36]=a,e[37]=g):g=e[37];e[38]!==n||e[39]!==g?(t=k.jsx(d("VideoPlayerControlsGroups.react").Expanded,{isVisible:n,children:g}),e[38]=n,e[39]=g,e[40]=t):t=e[40];g=t;e[41]===Symbol["for"]("react.memo_cache_sentinel")?(t=k.jsx(c("VideoPlayerPlaybackControl.react"),{}),e[41]=t):t=e[41];var C;e[42]===Symbol["for"]("react.memo_cache_sentinel")?(C=k.jsx(c("VideoPlayerPlaybackTimer.react"),{}),e[42]=C):C=e[42];e[43]!==n||e[44]!==u?(t=k.jsxs(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,children:[t,u,C]}),e[43]=n,e[44]=u,e[45]=t):t=e[45];C=t;u=c("gkx")("21034")?!1:c("gkx")("24335")?q===!0:v!=="watch_scroll";t=j.useCaptionsLoaded();q=j.useCaptionsVisible();v=c("useVideoPlayerAvailableCaptionsLocalesFromRelay")(a);f=(f=f)!=null?f:v;t=t||((v=f==null?void 0:f.length)!=null?v:0)>0;v=u&&t;e[46]!==f||e[47]!==q||e[48]!==i||e[49]!==n||e[50]!==y||e[51]!==p||e[52]!==v||e[53]!==a?(u=v?k.jsx(d("VideoPlayerControlsGroups.react").Contracted,{isVisible:n,children:k.jsx(c("VideoPlayerCaptionsControl.react"),{availableCaptionsLocales:f,captionsVisible:q,initialCaptionsUrl:i,menuOpened:y,onUserInteraction:p,setMenuOpened:x,video:a})}):null,e[46]=f,e[47]=q,e[48]=i,e[49]=n,e[50]=y,e[51]=p,e[52]=v,e[53]=a,e[54]=u):u=e[54];t=u;e[55]!==t||e[56]!==r||e[57]!==w||e[58]!==n||e[59]!==C||e[60]!==s||e[61]!==z||e[62]!==g||e[63]!==A||e[64]!==o||e[65]!==B?(x=k.jsxs(c("VideoPlayerControlsContainerOverlay.react"),{isBackgroundVisible:n,children:[C,g,s,w,r,A,t,B,z,null,o]}),e[55]=t,e[56]=r,e[57]=w,e[58]=n,e[59]=C,e[60]=s,e[61]=z,e[62]=g,e[63]=A,e[64]=o,e[65]=B,e[66]=x):x=e[66];return x}g["default"]=a}),98);
__d("VideoPlayerWithLiveVideoInterruptedOverlay.react",["fbt","FDSLoadingAnimation.react","FDSTextPairing.react","VideoPlayerHooks","VideoPlayerInteractionOverlay.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||d("react");function a(){var a=d("react-compiler-runtime").c(3),b=(j||(j=d("VideoPlayerHooks"))).useStreamInterrupted(),e=j.useIsLiveRewindActive();if(!b||e)return null;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={className:"x6s0dn4 x18l40ae x1ey2m1c x9f619 x78zum5 xdt5ytf xds687c x17qophe xl56j7k x10l6tqk x13vifvy"},a[0]=b):b=a[0];a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"The broadcast is waiting for a signal. It should resume shortly."),a[1]=e):e=a[1];a[2]===Symbol["for"]("react.memo_cache_sentinel")?(b=k.jsx(d("VideoPlayerInteractionOverlay.react").VideoPlayerInteractionOverlay,{children:k.jsxs("div",babelHelpers["extends"]({},b,{children:[k.jsx("div",{children:k.jsx(c("FDSTextPairing.react"),{body:e,bodyColor:"white",headline:h._(/*BTDS*/"Waiting for Live Video Signal"),headlineColor:"white",level:2,textAlign:"center"})}),k.jsx("div",babelHelpers["extends"]({className:"xc9qbxq x1sy10c2 x1n2onr6 x14qfxbe"},{children:k.jsx(c("FDSLoadingAnimation.react"),{size:36})}))]}))}),a[2]=b):b=a[2];return b}g["default"]=a}),226);/*FB_PKG_DELIM*/
__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupdDYIFileSaver",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("EncryptedBackupdDYIFileSaver");function a(a,b){h.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}g.saveFile=a}),98);
__d("LSBeginHandlingSyncForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(1).fetch([[[a[0]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=void 0:(d=a.item,c[9]=new b.Map(),c[9].set("group_id",d.groupId),c[9].set("current_cursor",d.currentCursor),c[9].set("sync_status",d.syncStatus),c[9].set("sync_params",d.syncParams),c[9].set("send_sync_params",d.sendSyncParams),c[9].set("min_time_to_sync_timestamp_ms",d.minTimeToSyncTimestampMs),c[9].set("can_ignore_timestamp",d.canIgnoreTimestamp),c[9].set("sync_channel",d.syncChannel),c[9].set("last_sync_request_timestamp_ms",d.lastSyncRequestTimestampMs),c[0]=c[9])})},function(d){return c[0]?c[2]=!1:c[2]=!0,c[2]?b.resolve((d=[a[0],void 0,b.i64.cast([0,4]),void 0,!1],c[3]=d[0],c[4]=d[1],c[5]=d[2],c[6]=d[3],c[7]=d[4],d)):b.sequence([function(a){return c[9]=c[0].get("group_id"),b.filter(b.db.table(3).fetch(),function(a){return b.i64.neq(a.epochId,void 0)&&b.i64.eq(a.syncDatabaseId,c[9])}).next().then(function(a,b){b=a.done;a=a.value;return b?c[10]=!1:(a.item,c[10]=!0)})},function(d){return c[10]?b.resolve((c[17]=c[0].get("group_id"),d=[c[17],void 0,b.i64.cast([0,4]),void 0,!1],c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=d[3],c[16]=d[4],d)):b.sequence([function(d){return c[17]=b.i64.of_float(Date.now()),c[18]=c[0].get("min_time_to_sync_timestamp_ms"),c[19]=c[0].get("last_sync_request_timestamp_ms"),c[20]=c[0].get("can_ignore_timestamp"),c[20]&&a[1]||b.i64.ge(c[17],c[18])?b.sequence([function(d){return a[1]?b.resolve(c[28]=b.i64.cast([0,0])):b.sequence([function(a){return c[29]=c[0].get("group_id"),b.db.table(3).fetch([[["",c[29]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[30]=b.i64.cast([0,0]):(d=a.item,c[30]=d.failureCount)})},function(a){return c[32]=b.i64.mul(b.i64.sub(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.lt(b.i64.cast([0,15]),c[30])?b.i64.cast([0,15]):c[30])),b.i64.cast([0,1])),b.i64.cast([0,500])),c[33]=b.i64.sub(b.i64.add(c[19]==null?b.i64.cast([0,0]):c[19],b.i64.lt(c[32],b.i64.cast([0,3e4]))?c[32]:b.i64.cast([0,3e4])),c[17]),c[28]=b.i64.gt(c[33],b.i64.cast([0,0]))?c[33]:b.i64.cast([0,0])}])},function(a){return c[21]=c[28]}]):b.resolve(c[21]=b.i64.sub(c[18],c[17]))},function(a){return c[22]=c[0].get("group_id"),b.i64.gt(c[21],b.i64.cast([0,0]))?b.sequence([function(a){return c[28]=b.i64.of_float(Date.now()),b.forEach(b.filter(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[22])}),function(a){var b=a.update;a.item;return b({lastDelayedRequestTimestampMs:c[28]})})},function(a){return a=[c[22],c[21],b.i64.cast([0,3]),void 0,!1],c[23]=a[0],c[24]=a[1],c[25]=a[2],c[26]=a[3],c[27]=a[4],a}]):b.sequence([function(a){return c[28]=b.i64.of_float(Date.now()),b.forEach(b.db.table(1).fetch([[[c[22]]]]),function(a){var b=a.update;a.item;return b({lastSyncRequestTimestampMs:c[28]})})},function(a){return c[29]=b.i64.of_float(Date.now()),b.forEach(b.filter(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[22])}),function(a){var b=a.update;a.item;return b({lastSyncRequestTimestampMs:c[29]})})},function(a){return c[30]=c[0].get("group_id"),c[31]=b.i64.of_float(Date.now()),c[32]=b.i64.random(),c[45]=b.i64.and_(b.i64.or_(b.i64.lsl_(c[31],b.i64.to_int32(b.i64.cast([0,22]))),b.i64.and_(c[32],b.i64.cast([0,4194303]))),b.i64.cast([2147483647,4294967295])),b.db.table(3).fetch([[["",c[30]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?b.db.table(3).add({syncDatabaseId:c[30],taskQueueName:"",failureCount:b.i64.cast([0,0]),lastSentTimestampMs:b.i64.cast([0,0]),lastSyncRequestTimestampMs:b.i64.cast([0,0]),epochId:c[45]}):(a.item,b.forEach(b.db.table(3).fetch([[["",c[30]]]]),function(a){var b=a.update;a.item;return b({epochId:c[45]})}))})},function(a){return c[34]=c[0].get("group_id"),b.db.table(3).fetch([[["",c[34]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[35]=b.i64.cast([0,0]):(d=a.item,c[35]=d.failureCount)})},function(a){return c[37]=c[0].get("send_sync_params"),c[38]=c[0].get("sync_params"),c[39]=c[0].get("current_cursor"),c[40]=new b.Map(),c[40].set("database",c[34]),c[40].set("version",b.i64.cast([-1,4294967295])),c[40].set("epoch_id",c[45]),c[40].set("last_applied_cursor",c[39]),c[40].set("sync_params",c[37]?c[38]:void 0),c[40].set("failure_count",b.i64.gt(c[35],b.i64.cast([0,0]))?c[35]:void 0),c[41]=c[0].get("current_cursor"),void 0===c[41]?c[42]=b.i64.cast([0,1]):c[42]=b.i64.cast([0,2]),c[43]=new b.Map(),c[43].set("type",c[42]),c[43].set("request_payload",c[40]),c[44]=c[0].get("sync_channel"),a=[c[30],void 0,b.i64.cast([0,1]),c[43],b.i64.eq(c[44],b.i64.cast([0,2]))],c[23]=a[0],c[24]=a[1],c[25]=a[2],c[26]=a[3],c[27]=a[4],a}])},function(a){return a=[c[23],c[24],c[25],c[26],c[27]],c[12]=a[0],c[13]=a[1],c[14]=a[2],c[15]=a[3],c[16]=a[4],a}])},function(a){return a=[c[12],c[13],c[14],c[15],c[16]],c[3]=a[0],c[4]=a[1],c[5]=a[2],c[6]=a[3],c[7]=a[4],a}])},function(a){return c[8]=new b.Map(),c[8].set("sync_group_id",c[3]),c[8].set("next_sync_ms",c[4]),c[8].set("work_item_type",c[5]),c[8].set("network_payload",c[6]),c[8].set("skip_realtime_gateway",c[7]),d[0]=c[8]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreBeginHandlingSyncForSyncGroupStoredProcedure";a.__tables__=["sync_groups","network_requests"];e.exports=a}),null);
__d("LSBeginHandlingSync",["LSBeginHandlingSyncForSyncGroup"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.createArray(),c.forEach(c.db.table(1).fetch(),function(e){var f=e.item;return c.sequence([function(e){return c.storedProcedure(b("LSBeginHandlingSyncForSyncGroup"),f.groupId,a[0]).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[2]=(d[0].push(d[1]),d[0])}])})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreBeginHandlingSyncStoredProcedure";a.__tables__=["sync_groups"];e.exports=a}),null);
__d("LSBeginHandlingSyncForSyncGroupStoredProcedure",["LSBeginHandlingSyncForSyncGroup","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBeginHandlingSyncForSyncGroup"),e.syncGroupId,e.ignoreSoftDelay);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSBeginHandlingSyncStoredProcedure",["LSBeginHandlingSync","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBeginHandlingSync"),e.ignoreSoftDelay);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",void 0),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",void 0),d[0].set("is_message_deletion",!1),d[0].set("is_unbump",a[3]),d[1]=d[0].get("thread_key"),c.storedProcedure(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",void 0),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",void 0),d[2].set("is_message_deletion",!1),d[2].set("is_unbump",a[3]),d[3]=d[2].get("thread_key"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBumpE2EEMetadataThread"),e.threadKey,e.serverAuthoritativeTimestampMs,e.bumpedByLocalDeviceSend,e.isUnbump);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSClearMessagePlaceholderRangeStoredProcedure",["LSClearMessagePlaceholderRange","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSClearMessagePlaceholderRange"),e.threadKey,e.messageId,e.maxTimestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSDataUseConsentState",[],(function(a,b,c,d,e,f){a=Object.freeze({UNSET:0,CONSENTED:1,WITHDRAWN:2,NOT_APPLICABLE:3,SEEN:4});f["default"]=a}),66);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(a,b,c,d,e,f){a=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});f["default"]=a}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12,SECURITY_QUESTION_HSM:13,TRUSTED_CONTACT:14});f["default"]=a}),66);
__d("LSFetchBackupsMetadata",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(a){return d.sequence([function(a){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] Beginning execution."),c("justknobx")._("1101")?d.sequence([function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1478]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[9]=a[0],a})},function(a){return e[9]?e[10]=!0:e[10]=!1,e[10]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[12]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[12]].join("")),e[11]=d.createArray(),void 0!==void 0?e[13]=(e[11].push(void 0),e[11]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[12],e[11],d.i64.cast([0,3]))):d.resolve()}])},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.db.table(172).fetch([[[d.i64.cast([0,1])]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[7]=void 0:(b=a.item,e[7]=b.backupId)})},function(a){return d.i64.neq(e[7],void 0)?d.sequence([function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[e[7]]]]),function(a){return d.i64.eq(a.backupId,e[7])&&d.i64.lt(a.authorityLevel,d.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:e[7],authorityLevel:d.i64.cast([0,20]),backupSize:d.i64.cast([0,0]),creationTime:d.i64.cast([0,0]),lastSyncTime:d.i64.cast([0,0])})},function(a){return e[9]=new d.Map(),e[9].set("trace_id",void 0),e[10]=d.toJSON(e[9]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50022]),e[10],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[11]=a[0],a})}]):d.sequence([function(a){return e[9]="Backup is not initialized",e[9]!==void 0?(function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ","",e[9]].join("")),e[10]=d.createArray(),void 0!==void 0?e[11]=(e[10].push(void 0),e[10]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",e[9],e[10],d.i64.cast([0,3]))):d.resolve()},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[d.i64.cast([-1,4294967295])]]]),function(a){return d.i64.eq(a.backupId,d.i64.cast([-1,4294967295]))&&d.i64.lt(a.authorityLevel,d.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:d.i64.cast([-1,4294967295]),authorityLevel:d.i64.cast([0,80]),backupSize:d.i64.cast([-1,4294967295]),creationTime:d.i64.cast([-1,4294967295]),lastSyncTime:d.i64.cast([-1,4294967295])})}])}]):d.resolve(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] is_backup_metadata_enabled is disabled"))},function(a){return e[1]=d.i64.of_float(Date.now()),e[2]=d.i64.random(),e[4]="Finishing execution. Execution time: ",e[5]=d.i64.to_string(d.i64.sub(e[1],e[0])),e[6]=" ms",e[3]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ",e[3],e[4],e[3],e[5],e[3],e[6]].join("")),d.i64.eq(d.i64.mod_(e[2],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[7]=",",e[8]=d.createArray(),void 0!==void 0?e[9]=(e[8].push(void 0),e[8]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",[e[4],e[7],e[5],e[7],e[6]].join(""),e[8],d.i64.cast([0,4]))):d.resolve()}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupsMetadataStoredProcedure";a.__tables__=["encrypted_backups_metadata","encrypted_backups"];d=a;g["default"]=d}),98);
__d("LSFetchBackupsMetadataStoredProcedure",["LSFetchBackupsMetadata","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSFetchBackupsMetadata"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSInsertNewMessageRangeStoredProcedure",["LSInsertNewMessageRange","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSInsertNewMessageRange"),e.threadKey,e.newMinTs,e.newMaxTs,e.newMinMid,e.newMaxMid,e.lowerOverlap,e.upperOverlap,e.hasMoreBefore,e.hasMoreAfter,e.requestedMessageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueThreadRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1],e)})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[35]=void 0,c.i64.neq(d[35],void 0)?c.resolve(d[36]=d[35]):c.sequence([function(a){return d[42]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[52]=(d[42].push(c.i64.cast([0,0])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[52]=(d[42].push(c.i64.cast([0,2])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[52]=(d[42].push(c.i64.cast([0,3])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[52]=(d[42].push(c.i64.cast([0,4])),d[42]):0,d[47]=c.createArray(),d[48]=c.i64.of_int32(d[42].length),c.i64.gt(d[48],c.i64.cast([0,0]))?c.loopAsync(d[48],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[47].push(d[53]),d[47])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[52]=c.createArray(),d[53]=c.i64.of_int32(d[47].length),c.i64.gt(d[53],c.i64.cast([0,0]))?c.loopAsync(d[53],function(a){return d[55]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],d[55]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return d[58]=(d[52].push(c.i64.to_string(d[56])),d[52])}])}):c.resolve()},function(a){return d[54]=d[52].join(","),d[49]=d[54]}])},function(a){return d[47].some(function(a){return c.i64.eq(d[29],a)})?d[50]=d[29]:d[50]=void 0,c.i64.neq(d[50],void 0)?d[51]=d[50]:d[51]=void 0,d[36]=d[51]}])},function(e){return c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[38]=d[28]:d[38]=c.i64.cast([0,1]),d[39]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[39],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[39],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[40]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[40],actionType:c.i64.cast([0,2]),contentType:c.i64.cast([0,2]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[0],sortKey:a[1],persistentId:"",isInstamadillo:!1,lsTraceId:a[3],error:a[4]})},function(b){return c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[42]=c.createArray(),d[44]=(d[42].push("Successfully issued message backup task. act thread id = "),d[42]),d[44]=(d[42].push(a[0]),d[42]),d[44]=(d[42].push(", otid = "),d[42]),d[44]=(d[42].push(a[0]),d[42]),d[43]=d[42].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[43]].join("")),c.resolve()):(d[42]=c.createArray(),d[44]=(d[42].push("Successfully issued message remove task. act thread id = "),d[42]),d[44]=(d[42].push(a[0]),d[42]),d[44]=(d[42].push(", otid = "),d[42]),d[44]=(d[42].push(a[0]),d[42]),d[43]=d[42].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[43]].join("")),c.resolve()):(d[42]=c.createArray(),d[44]=(d[42].push("Successfully issued thread remove task. act thread id = "),d[42]),d[44]=(d[42].push(a[0]),d[42]),d[43]=d[42].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[43]].join("")),c.resolve())},function(a){return d[41]=new c.Map(),d[41].set("task_id",d[40]),a=[d[41],void 0],d[33]=a[0],d[34]=a[1],a}]):c.sequence([function(b){return d[35]=c.createArray(),d[38]=(d[35].push("Skipping thread remove since EB is disabled. act thread id = "),d[35]),d[38]=(d[35].push(a[0]),d[35]),d[36]=d[35].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[36]].join("")),c.resolve()},function(a){return d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,24])),d[37].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[37].set("error_message",""),a=[void 0,d[37]],d[33]=a[0],d[34]=a[1],a}])},function(a){return a=[d[33],d[34]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping thread remove since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1],a}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueThreadRemove",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueThreadRemoveStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSIssueThreadRemoveStoredProcedure",["LSIssueThreadRemove","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueThreadRemove"),e.actThreadId,e.sortKey,e.source,e.traceId,e.error);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticallyUpdateMessagingPrivacySettings",["LSGetViewerFBID","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.forEach(c.db.table(288).fetch([[[d[0]]]]),function(b){var c=b.update;b.item;return c({readReceiptsDisabled:a[0]})})},function(e){return d[1]=new c.Map(),d[1].set("read_receipts_disabled",a[0]),d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),"toggle_rr",c.i64.cast([0,731]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSOmnistoreSettingsOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure";a.__tables__=["messaging_privacy_settings"];e.exports=a}),null);
__d("LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure",["LSOptimisticallyUpdateMessagingPrivacySettings","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticallyUpdateMessagingPrivacySettings"),e.readReceiptsDisabled);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSPlatformDGWTransport",["DGWClient","DGWExponentialBackoff","DGWLoggingContext","DGWStream","DGWStreamGroupCallbacks","FBLogger","LSIntEnum","LSLogHistory","LSPlatformDGWHostnameOverride","LSPlatformRealtimeTransport","MWPBumpEntityKey","MessengerWebRegion","MqttConfig","Random","err","gkx","promiseDone","setTimeout","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("gkx")("3218"),j=c("gkx")("2659"),k=c("gkx")("12101"),l=0,m=!1,n={connectionStatusChangeHandler:null,current:null,publishBuffer:new Map(),reconnectHandler:null,status:"Disconnected",subscribers:new Map()},o=null,p=!1,q=!1;function r(a){a=1*Math.pow(2,a);a=Math.max(a,1);a=Math.min(a,64);return Math.ceil(a*(1e3+d("Random").random()*200))}function s(a,b){var e;if(p){var f;(f=n.current)==null?void 0:f.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"SkipReconnectAttempt","deviceId:"+a);return}p=!0;f=r(l++);var g="deviceId:"+a+", reconnectMs:"+f+", attempt:"+l+", isClosedLocally:"+String(q);(e=n.current)==null?void 0:e.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"ScheduleReconnect",g);d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"scheduleReconnect");c("setTimeout")(function(){t(a,b),p=!1},f)}function t(a,b){var e=c("uuidv4")(),f={deviceId:a,keepAliveMs:15e3,loggingId:e,serviceId:"lightspeed",streamGroupAppHeaders:{},verboseLoggingEnabled:i};k&&(f.trafficTracing=e);d("MessengerWebRegion").regionNullable!=null&&(f.regionHint=d("MessengerWebRegion").regionNullable);e={onStreamGroupError:function(b){var c;n.status!=="Disconnected"&&(n.status="Disconnected",n.connectionStatusChangeHandler&&n.connectionStatusChangeHandler("Disconnected","Stream Group Error"));(c=n.current)==null?void 0:c.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"onStreamGroupError",d("DGWStreamGroupCallbacks").DGWStreamGroupError.getName(b),"deviceId:"+a);d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,d("DGWStreamGroupCallbacks").DGWStreamGroupError.getName(b));d("DGWStreamGroupCallbacks").isRetryableError(b)?(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"StreamGroupError.isRetryableError"),s(a,"reconnect_on_streamgrouperror."+d("DGWStreamGroupCallbacks").DGWStreamGroupError.getName(b))):d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"StreamGroupError.isNotRetryableError")},onStreamGroupMustDrain:function(b){var c;d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed","LSPlatformDGWTransport.onStreamGroupMustDrain."+b);(c=n.current)==null?void 0:c.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"onStreamGroupMustDrain",b,"deviceId:"+a);s(a,"reconnect_on_streamgroupmustdrain")},onStreamGroupTransportClose:function(){var b;n.status!=="Disconnected"&&(n.status="Disconnected",n.connectionStatusChangeHandler&&n.connectionStatusChangeHandler("Disconnected","Stream Group Close"));(b=n.current)==null?void 0:b.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"onStreamGroupTransportClose","","deviceId:"+a)}};n.status="Connecting";e=c("DGWClient")().createStreamGroup(e,f);f="deviceId:"+a+", runtime_site_is_comet_fb_web:"+String(c("gkx")("2116"))+", endpoint:"+c("MqttConfig").endpoint+", reason:"+b;e.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"CreatingStreamGroupTransport",f);c("promiseDone")(e.initTransport(),function(c){d("LSLogHistory").log("StreamGroupTransport Connected","debug");n.status!=="Connected"&&(n.status="Connected",n.connectionStatusChangeHandler&&n.connectionStatusChangeHandler("Connected"));m&&(n.reconnectHandler&&n.reconnectHandler());m=!0;(c=n.current)==null?void 0:c.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"StreamGroupTransportOnOpen","deviceId:"+a+", reason:"+b);(c=n.current)==null?void 0:c.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"BufferFlushed",String(n.publishBuffer.size));l=0;n.publishBuffer.forEach(function(a,b,c){a.resolve(),n.publishBuffer.delete(b)})},function(b){var c;d("LSLogHistory").log("StreamGroupTransport onError","debug");n.publishBuffer.clear();n.status!=="Disconnected"&&(n.status="Disconnected",n.connectionStatusChangeHandler&&n.connectionStatusChangeHandler("Disconnected",b));(c=n.current)==null?void 0:c.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"StreamGroupTransportOnError",String(b),"deviceId:"+a);d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"WebSocketOnError");b!==d("DGWStream").StreamError.UNAUTHORIZED&&s(a,"reconnect_on_streamgrouptransportonerror."+String(b))});n.current=e;return n.current}async function u(a,b,e,f){e===void 0&&(e=!0);var g=n.current;if(g==null)throw c("FBLogger")("ls_web_init").mustfixThrow("LS Stream Group not initialized");var h=new TextDecoder(),j={method:"LightSpeed","xrs-stream-handler":"LSDGWStreamHandler"};d("LSPlatformDGWHostnameOverride").useHostNameOverride&&d("LSPlatformDGWHostnameOverride").hostNameOverride!=null&&(j["javascript-sandbox"]=d("LSPlatformDGWHostnameOverride").hostNameOverride);try{var k=c("uuidv4")();g=await g.establishStream({groupedStreamHeaders:j,loggingId:k,streamTraceId:k,verboseLoggingEnabled:i},{onClose:function(){d("LSLogHistory").log("Stream closed","debug")},onDataReceived:function(a){var b=h.decode(a);n.subscribers.forEach(function(a){a(b)})},onError:function(a){d("LSLogHistory").log("Stream onError. Disconnected","debug")},onServerHasFinishedSendingData:function(a){d("LSLogHistory").log("Stream finished sending data","debug"),a.loggingContext().logEvent(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"onServerHasFinishedSendingData"),a.close()},onStreamMustDrain:function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed","LSPlatformDGWTransport.onStreamMustDrain"),d("LSLogHistory").log("Stream must drain","debug"),a.loggingContext().logEvent(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"onStreamMustDrain"),a.close()}},b,e,f);d("LSLogHistory").log("Stream Connected","debug");return g}catch(b){d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"initStreamFailure."+a);d("LSLogHistory").log("Error Establishing Stream. Disconnected","debug");throw b}}var v="Disconnected";b=function(){return v};function a(a,b){o||(o=w(a,b,"init_single_transport_instance"));return o}function w(a,b,e){var f=new TextEncoder();t(b,e);return{cleanup:function(){var a;q=!0;(a=n.current)==null?void 0:a.close();n.reconnectHandler=null;n.connectionStatusChangeHandler=null;n.publishBuffer.clear();n.subscribers.clear()},logEvent:function(a){var b;(b=n.current)==null?void 0:b.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,a)},onConnectionStatusChange:function(a){n.connectionStatusChangeHandler=a;return function(){n.connectionStatusChangeHandler=null}},onReconnect:function(a){n.reconnectHandler=a;return function(){n.reconnectHandler=null}},publish:async function(a,b,e){var g=(h||(h=d("LSIntEnum"))).toNumber(b);try{d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"initStream."+(h||(h=d("LSIntEnum"))).toNumber(b));n.status!=="Connected"&&await x().then(function(){}).catch(function(){var a;d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"ConnectionTimeout."+g);(a=n.current)==null?void 0:a.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"Publish","ConnectionTimeout",String(g));return Promise.reject({RE_EXN_ID:d("LSPlatformRealtimeTransport").NotConnected})});var i=4!==h.unwrapIntEnum(b),k={int:{databaseType:e,requestType:g}};if(!j)await u(g,f.encode(a),i,k);else{b=function(){return u(g,f.encode(a),i,k)};await d("DGWExponentialBackoff").callWithExponentialBackoff(b)}}catch(a){if(a.message==="Max number of stream IDs reached"){d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"StreamIdLimitExceeded."+g);(e=n.current)==null?void 0:e.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"initStream","StreamIdLimitExceeded",g.toString())}d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"initStreamError."+g);(b=n.current)==null?void 0:b.streamGroupLoggingContext.logError(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"Publish","Failed to publish payload",g.toString());c("FBLogger")("messenger_web").catching(typeof a==="string"?c("err")(a):a).warn("Failed to create DGW stream and send payload %s",String(a));return new Promise(function(b,c){return c(a)})}},subscribe:function(a){n.subscribers.set(a,a);return function(){n.subscribers.delete(a)}}}}function x(){var a={reject:function(){},resolve:function(){}},b=d("Random").uint32(),c=new Promise(function(b,c){a.resolve=b,a.reject=c});n.publishBuffer.set(b,a);return c}g.getStatusForDebugging=b;g.LSPlatformDGWTransport=a}),98);
__d("LSPlatformSyncSystem",["FBLogger","I64","LSBeginHandlingSyncForSyncGroupStoredProcedure","LSBeginHandlingSyncStoredProcedure","LSDatabaseProviderType","LSFactory","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformGraphQLTransport","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSShape","LSVec","MWPBumpEntityKey","MessengerLogHistory","ReQL","gkx","promiseDone","qex","recoverableViolation","throttle"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,g,j,k){var l=d("MessengerLogHistory").getInstance("client_sync"),m=new(c("LSPlatformServerResponseHandler"))(e),n=d("LSDatabaseProviderType").isProviderPersisted(a),o=function(b){return a.runInTransaction(async function(a){var c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange("",b));c!=null&&await a.network_requests.put({epochId:void 0,failureCount:(h||(h=d("I64"))).add(c.failureCount,h.one),lastDelayedRequestTimestampMs:c.lastDelayedRequestTimestampMs,lastSentTimestampMs:c.lastSentTimestampMs,lastSyncRequestTimestampMs:c.lastSyncRequestTimestampMs,networkTaskIdentifier:c.networkTaskIdentifier,syncDatabaseId:c.syncDatabaseId,taskQueueName:c.taskQueueName})},"readwrite",void 0,void 0,f.id+":76")},p=new(c("LSPlatformRequestScheduler"))(),q=async function(f,l){l=d("LSShape").toRecord(l);var o=d("LSShape").toRecord(l.request_payload);l=l.type;var p=c("LSPlatformRequestId").generate(),q=d("LSJson").stringify(d("LSShape").ofRecord({database:o.database,epoch_id:o.epoch_id,failure_count:o.failure_count,last_applied_cursor:o.last_applied_cursor,sync_params:o.sync_params,version:(h||(h=d("I64"))).of_string(g)})),r=(h||(h=d("I64"))).equal(f.sync_group_id,(i||(i=d("LSIntEnum"))).ofNumber(1))&&c("gkx")("26386")===!0;if(!r&&f.skip_realtime_gateway){r=await d("LSPlatformGraphQLTransport").publish(j,p,l,q,k);var s=r[0],t=r[1],u=r[2];r=r[3];u={experiments:u,syncScript:t,target:r};return n?m.maybeEvalInOrderReceived(s,u):e(u)}else{t=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange(f.sync_group_id));r=t!=null?t.syncChannel:d("LSMailboxInitialSyncCursor").syncChannel;t!=null&&(i||(i=d("LSIntEnum"))).toNumber(t.syncChannel)!==(h||(h=d("I64"))).to_int32(d("LSMailboxInitialSyncCursor").syncChannel)&&b.logEvent("Sync channel mismatch between "+(i||(i=d("LSIntEnum"))).toNumber(t.syncChannel)+" and "+(h||(h=d("I64"))).to_int32(d("LSMailboxInitialSyncCursor").syncChannel));s=c("qex")._("789");if(t!=null&&s!=null&&s!=="default"){u=(i||(i=d("LSIntEnum"))).unwrapIntEnum(l);if(1===u||2===u||5===u){f=s+"."+(i||(i=d("LSIntEnum"))).toNumber(r)+"."+i.toNumber(l)+"."+i.toNumber(t.groupId);d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",f)}}u=(h||(h=d("I64"))).to_int32(o.database);return b.publish({databaseType:u,payload:q,queueName:void 0,requestId:p,syncChannel:r,type_:l}).then(function(){return Promise.resolve()})}},r=function b(e){var g=function(d){return a.runInTransaction(function(a){return c("LSBeginHandlingSyncForSyncGroupStoredProcedure")(c("LSFactory")(a),{ignoreSoftDelay:!1,syncGroupId:d})},"readwrite",void 0,void 0,f.id+":216").then(function(a){return b(a[0])})},j=function(a,b){p.schedule(function(){c("promiseDone")(g(a))},(h||(h=d("I64"))).to_string(a),h.to_float(b))},k=d("LSShape").toRecord(e);e=k.work_item_type;if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(1))||(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(5))){var m=k.network_payload;if(m!=null)return q(k,m).catch(function(a){if(a.message===d("LSPlatformGraphQLTransport").ServerError)d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_graphql_error");else if(a.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout||a.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected)d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_timeout_or_disc"),l.debug("Publish timed out");else{d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_other_error");if(a instanceof Error)c("FBLogger")("messenger_web").catching(a).mustfix("Encountered an JS error while publishing a LS sync request");else{var b="";try{b=JSON.stringify(a)}catch(a){}c("FBLogger")("messenger_web").mustfix("Encountered an JS error while publishing a LS sync request %s",b)}}d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","handleSyncFailure."+(i||(i=d("LSIntEnum"))).toNumber(d("LSShape").toRecord(m).type)+"."+i.toNumber(k.sync_group_id));return o(k.sync_group_id).then(function(){return g(k.sync_group_id)})});else{c("recoverableViolation")("Expected networkpayload for sync request but didn't get any","ls_web_init");return Promise.resolve()}}if(!(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(3)))if((h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(4))||!(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(2)))return Promise.resolve();else{c("recoverableViolation")("Native handling for sync group not implemented yet","ls_web_init");return Promise.resolve()}e=k.next_sync_ms;if(e!=null){j(k.sync_group_id,e);return Promise.resolve()}else{c("recoverableViolation")("Expected delay for delayed sync request but didn't get any","ls_web_init");return Promise.resolve()}},s=function(a){return Promise.all(c("LSVec").toArray(a[0]).map(function(a){return r(a)}))},t=function(){c("promiseDone")(a.runInTransaction(function(a){return c("LSBeginHandlingSyncStoredProcedure")(c("LSFactory")(a),{ignoreSoftDelay:!1})},"readwrite",void 0,void 0,f.id+":366").then(s))},u=c("throttle")(t,500);t=function(){return d("ReQL").fromTableAscending(a.tables.sync_groups).subscribe(function(){return u()})};var v=function(){return b.subscribeToNonTaskResponses(function(a,b){var f=b.ex,g=b.payload;f={experiments:f,sp:b.sp,syncScript:g,target:b.target};c("promiseDone")(n?m.maybeEvalInOrderReceived(a,f):c("gkx")("10470")?m.maybeEvalInOrderReceived(a,f):e(f),function(){return u()},function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","handle_sync_response_failure");if(a instanceof Error)c("FBLogger")("messenger_web").catching(a).mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",n,a.message);else{var b="";try{b=JSON.stringify(a)}catch(a){}c("FBLogger")("messenger_web").mustfix("JS error encountered handling response from MQTT (pdb=%s): %s",n,b)}})})},w=function(){return b.onReconnect(function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_sync","resume_sync_reconnect"),l.debug("Sync System reconnecting"),c("promiseDone")(a.runInTransaction(async function(b){var e;e=await (e=d("ReQL")).toArrayAsync(e.mergeJoin(e.fromTableAscending(a.tables.sync_groups),e.fromTableAscending(a.tables.network_requests).getKeyRange("")));await Promise.all(e.map(function(a){a=a[1];return b.network_requests.put({epochId:void 0,failureCount:a.failureCount,lastDelayedRequestTimestampMs:a.lastDelayedRequestTimestampMs,lastSentTimestampMs:a.lastSentTimestampMs,lastSyncRequestTimestampMs:a.lastSyncRequestTimestampMs,networkTaskIdentifier:a.networkTaskIdentifier,syncDatabaseId:a.syncDatabaseId,taskQueueName:a.taskQueueName})}));return c("LSBeginHandlingSyncStoredProcedure")(c("LSFactory")(b),{ignoreSoftDelay:!1})},"readwrite",void 0,void 0,f.id+":461").then(s))})},x=t(),y=v(),z=w();u();return{cleanup:function(){x(),z(),y()}}}g.default=a}),98);
__d("LSUpdateBackupsTableStoredProcedure",["LSSynchronousPromise","LSUpdateBackupsTable","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateBackupsTable"),e.isSuccess,e.backupIds,e.virtualDevices,e.deviceIds,e.backupMetadata,e.traceId,e.isUserOptedOut,e.hasOtcEligibleDevices,e.encryptionManagementDelegatorId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("user_self_remove",!1),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSSynchronousPromise","LSUpdateE2EEMetadataParticipants","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateE2EEMetadataParticipants"),e.threadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:a[4]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure";a.__tables__=["attachments_ranges_v2__generated"];e.exports=a}),null);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSSynchronousPromise","LSUpsertAttachmentRange","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpsertAttachmentRange"),e.threadKey,e.mediaGroup,e.newMinTs,e.hasMoreBefore,e.newLastLoadedMessageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUserVisibleErrorsUtil",["LSFactory","LSRemoveErrorStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSRemoveErrorStoredProcedure")(c("LSFactory")(a),{errorId:b})},"readwrite",void 0,void 0,f.id+":24"))}g.removeUserVisibleErrorFromTable=a}),98);
__d("MAWBridgeAddMessageSearchResultHandler",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWFTSRawStringMatcher","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","cr:17064","cr:17065","emptyFunction","gkx","isMAWUniversalSearchWithEBEnabled","promiseDone","waitForMiActMappingForUniversalSearch"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),k=h.ofNumber(c("LSMessageSearchType").THREAD);function a(a,b,d){return d.length===0?Promise.resolve():Promise.all([m(a,b,d),n(a,b,d)]).then(c("emptyFunction"))}async function l(a,b){var c=await d("MAWFTSRawStringMatcher").load();return b.filter(function(b){b=(b=b.msg)==null?void 0:b.content;return b==null?!1:c(a,b)})}async function m(a,e,f){var g=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.message_search_queries).getKeyRange(j));if(g.length===0)return;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,f[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(e,h){return async function(){var c=g.filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,h)})[0];if(c==null)return;var j=c.query;if(j==null||j.length<2)return;var k=(i||(i=d("I64"))).to_int32(c.resultCount);j=await l(j,f);if(j.length===0)return;await b("cr:17064").addBridgeSearchMsgsToSearchResult(a,e,c.query,j,k+j.length,i.of_string(d("MAWCurrentUser").getID()))}().then(c("emptyFunction"))})}async function n(a,e,f){if(!c("isMAWUniversalSearchWithEBEnabled")())return;var g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.message_search_queries).getKeyRange(k).filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,i.one)}));if(g==null)return;var h=g.query;if(h==null||h.length<2)return;var j=await l(h,f);if(j.length===0)return;if(c("gkx")("11537"))c("promiseDone")(c("waitForMiActMappingForUniversalSearch")(a,f[0].chatJid),function(c){if(c!=null)return b("cr:17065")(a,void 0,c.serverThreadKey,h,j,g)});else{await c("waitForMiActMappingForUniversalSearch")(a,f[0].chatJid);return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(e,f[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(c,d){return b("cr:17065")(a,c,d,h,j,g)})}}g.call=a}),98);
__d("MAWBridgeCallRestoreNativeOpHandler",["I64","Promise","WAJids","WALogger","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to call restore native op - echo and protobuf messages are both null"]);j=function(){return a};return a}var k=c("requireDeferred")("LSProtobufRestoreHandler").__setRef("MAWBridgeCallRestoreNativeOpHandler"),l=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("MAWBridgeCallRestoreNativeOpHandler");function a(a,c){var e=c.chatJid,f=c.decryptedMessagesProtobufs,g=c.echoMessages,m=c.hasMoreAfter,n=c.hasMoreBefore,o=c.isPointQuery,p=c.nextMessageTimestampMsAfter,q=c.nextMessageTimestampMsBefore,r=c.referenceTimestamp,s=c.requestId,t=c.taskSource;if(f!=null)return k.load().then(function(a){return a.handleProtobufRestoreHelper(d("WAJids").threadIdForChatJid(e),{convertedProtobufs:f,type:"convertedProtobufs"},n,q,m,p,o,s,r,void 0,void 0,t,e)});else if(g!=null)return l.load().then(function(c){return c(a,0,(i||(i=d("I64"))).zero,g,n,q,m,p,o,d("WAJids").threadIdForChatJid(e),s,r,t,e).then(function(){return(h||(h=b("Promise"))).resolve()})});else d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeCentralizedThreadUpdateHandler",["FBLogger","I64","LSAuthorityLevel","LSBumpE2EEMetadataThreadStoredProcedure","LSDatabaseSingleton","LSFactory","LSIntEnum","MAWBridgeBuildThreadSnippet","MAWBridgeFireAndForget","MAWChatJid","MAWJids","MAWLoggerDeferred","MAWMiActGetThreadLifecycleState","MAWODSProxy","MAWThreadBumpType","MAWThreadUpdateMiddlewareGatingUtil","MAWThreadUpdateType","ODS","ReQL","WAJids","WAOdsEnums","WATimeUtils","getMAWLastMessageCtaType","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo][Middleware] Starting Thread Update on "," via middleware. threadKey: ",", authorityLevel: ",", lastActivityTimestampMs: ",", bumpTimestampMs: ",", bumpedByLocalDeviceSend: ",", bumpType: ",", threadUpdateType: ",", isUnbump: ",", isThrottled: "," from ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo][Middleware] Updated thread via middleware. threadKey: ",", bumpTimestampMs: ",",\n    original lastActivityTimestampMs: ","\n    , bumpedByLocalDeviceSend: ",", bumpType: ",", threadUpdateType: ",",  from ",""]);m=function(){return a};return a}async function a(a,b){var e=await d("MAWChatJid").toThreadMaybe(a,b.jid);if(e==null){var f=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(b.jid),"MAWBridgeCentralizedThreadUpdateHandler");c("FBLogger")("messenger_web").mustfix("[Occamadillo][Middleware] missing thread for bumping jid: %s with thread state: %s",b.jid,f.type);return}return(h||(h=d("I64"))).lt(e.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&!b.bumpedByLocalDeviceSend?y(e,b):n(a,e,b)}async function n(a,b,e){var f=b;b=f;b=b.threadKey;var g=e.author,i=e.bumpedByLocalDeviceSend,k=e.bumpTimestampMs,l=e.threadUpdateType;if(l===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE)return;var m=f.lastActivityTimestampMs;u(e,f,"Local",e.isUnbump,e.threadBumpType);if((h||(h=d("I64"))).equal(m,(h||(h=d("I64"))).zero)){var n;A("zero_last_activity_timestamp");var q=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.messages).getKeyRange(f.threadKey).take(5)),x=q.length;q=q.map(function(a){return(h||(h=d("I64"))).to_string(a.displayedContentTypes)}).join(",");c("FBLogger")("messenger_web").warn("[Occamadillo][Middleware] Encountered lastActivityTs == 0 for thread jid : %s with authority level: %s, threadType : %s, threadStatus : %s, folderType : %s, numMsgs (limit 5): %s and msgContentTypes: [%s]",e.jid,(h||(h=d("I64"))).to_string(f.authorityLevel),h.to_string(f.threadType),h.to_string((n=f.threadStatus)!=null?n:(h||(h=d("I64"))).neg_one),f.folderName,x,q)}n=v(e,m);x=n.isUnbump;q=n.threadBumpType;if(l===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD||l===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD||x){A("bump_on_local");x&&(f=p(x,k,f),l!==d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD&&(f=r(k,f,x)));n=w(g,i,q,k,m,f.threadKey);if(n){l={bumpedByLocalDeviceSend:i,isUnbump:x,serverAuthoritativeTimestampMs:k,threadKey:b};(j||(j=d("ODS"))).bumpEntityKey(3185,"maw_tc_server_thread_bump",""+((g=e.centralizedThreadSnippetData.snippetType)!=null?g:"undefined"));u(e,f,"Server",x,q);await o(c("LSFactory")(a),l)}}var y=s(e.centralizedThreadSnippetData,f);return a.threads.put(y).then(function(){f!=null&&t(e,m,y)})}async function o(a,b){A("bump_on_server");return c("LSBumpE2EEMetadataThreadStoredProcedure")(a,b)}function p(a,b,c){return!q(a,b,c)?c:babelHelpers.extends({},c,{lastActivityTimestampMs:b})}function q(a,b,c){return a?(h||(h=d("I64"))).lt(b,c.lastActivityTimestampMs):(h||(h=d("I64"))).gt(b,c.lastActivityTimestampMs)}function r(a,b,c){return!c&&(h||(h=d("I64"))).lt(a,b.lastReadWatermarkTimestampMs)?b:babelHelpers.extends({},b,{lastReadWatermarkTimestampMs:a})}function s(a,b){var e=a.snippetSenderContactId!=null?(h||(h=d("I64"))).of_string(a.snippetSenderContactId):(h||(h=d("I64"))).zero,f=c("getMAWLastMessageCtaType")(a.snippetType);a=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b.snippet);return babelHelpers.extends({},b,{lastMessageCtaType:f,snippet:a,snippetSenderContactId:e})}function t(a,b,e){c("promiseDone")(d("MAWLoggerDeferred").LOG(m(),(h||(h=d("I64"))).to_string(e.threadKey),h.to_string(e.lastActivityTimestampMs),h.to_string(b),a.bumpedByLocalDeviceSend,a.threadBumpType,a.threadUpdateType,a.description))}function u(a,b,e,f,g){e=[e,(h||(h=d("I64"))).to_string(b.threadKey),h.to_string(b.authorityLevel),h.to_string(b.lastActivityTimestampMs),h.to_string(a.bumpTimestampMs),a.bumpedByLocalDeviceSend,g,a.threadUpdateType,f,a.isThrottled,a.description];c("promiseDone")(d("MAWLoggerDeferred").LOG(l(),e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10]))}function v(a,b){var e=c("justknobx")._("3068");if(e)return{isUnbump:a.isUnbump,threadBumpType:a.threadBumpType};e=(h||(h=d("I64"))).lt(a.bumpTimestampMs,b);if(a.isThrottled&&e){switch(a.tableName){case"messages":A("unbump_from_message_in_throttle");break;case"reactions":A("unbump_from_reaction_in_throttle");break;default:A("unbump_from_throttle")}e=a.tableName==="reactions";e&&d("MAWThreadUpdateMiddlewareGatingUtil").isPeristedUnbumpEnabled()&&d("MAWBridgeFireAndForget").fireAndForget("backend","unbumpThread",{incomingUnbumpFromTs:d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(b)),threadJid:a.jid});return{isUnbump:!0,threadBumpType:d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_ONLY}}return{isUnbump:a.isUnbump,threadBumpType:a.threadBumpType}}function w(a,b,e,f,g,i){if(e!==d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_AND_SERVER)return!1;if(x(a,b)){c("FBLogger")("messenger_web").info("[Occamadillo][Middleware] Skipping receiver bump for own message on thread %s",(h||(h=d("I64"))).to_string(i));return!1}A("check_if_bump_is_newer_than_current_activity");e=(h||(h=d("I64"))).gt(f,g);e||A("server_bump_prevented");return e}function x(a,b){return a!=null&&d("WAJids").isAuthorMe(a)&&b===!1}async function y(a,b){var e=await (k||(k=d("LSDatabaseSingleton"))).LSDatabaseSingleton;A("wait_for_authoritative_thread_start");z(a.threadKey,e,function(a){A("wait_for_authoritative_thread_end");var g=(h||(h=d("I64"))).to_float(a.lastActivityTimestampMs);A("ts_of_authoritative_thread_after_wait_"+(g>0?"gt_0":"eq_0"));c("promiseDone")(e.runInTransaction(function(c){return n(c,a,b)},"readwrite",void 0,void 0,f.id+":498"))});return}function z(a,b,e){var f=d("ReQL").fromTableAscending(b.tables.threads).getKeyRange(a).subscribe(function(a,b){if(b.operation==="delete")return;a=b.value;if((h||(h=d("I64"))).lt(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;e(a);return f()})}function A(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_UPDATE_MIDDLEWARE,key:a})}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["LSThreadBitOffset","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeDeleteGroupInviteHandler",async function(b,e){var f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.group_invites).getKeyRange(e));return Promise.all(f.map(function(a){return b.group_invites.delete(a.threadKey,a.inviterId,a.inviteeId)})).then(function(){if(!c("justknobx")._("1162"))return;c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e)),function(b){if(b==null)return;var c=d("LSThreadBitOffset").clear([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5),e=c[0],f=c[1],g=c[2],h=c[3];c=c[4];return a.threads.put(babelHelpers.extends({},b,{capabilities:e,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:c,snippet:void 0}))})})})}g.call=a}),98);
__d("MAWBridgeDeleteMessageRangesV2Handler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeDeleteMessageRangesV2Handler",function(a,c){return a.messages_ranges_v2__generated["delete"](c,(h||(h=d("I64"))).of_float(b.minTimestampMs),b.minMsgId)})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesOfThreadHandler",["EBIsEbEnabled","LSFactory","LSIntEnum","LSIssueThreadRemoveStoredProcedure","LSMEBTaskCreationSource"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){if(b.actionType===2){if(!await d("EBIsEbEnabled").isEbEnabledLS(a))return;await c("LSIssueThreadRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:b.threadId,sortKey:b.ts.toString(),source:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM_WEB)})}}g.call=a}),98);
__d("MAWBridgeEphemeralSettingsUpdatedForUIHandlerLazy",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("JSResourceForInteraction")("MAWBridgeEphemeralSettingsUpdatedForUIHandler").__setRef("MAWBridgeEphemeralSettingsUpdatedForUIHandlerLazy").load().then(function(c){return c.call(a,b)})}g.call=a}),98);
__d("MAWBridgeFulfillRestorePromisePayloadHandler",["MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.success?(d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(a.value.traceId),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(a.value.traceId)):(d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(a.error.traceId,c("err")(a.error.message)),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a.error.traceId));return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeGQLUploadUtils",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";async function a(b,d){var a=await c("JSResourceForInteraction")("MAWEncryptedBackupsMessageUploadMutation").__setRef("MAWBridgeGQLUploadUtils").load();return a.uploadMessageOverGQL(b,d)}g.uploadMessageOverGQL=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["I64","MAWLoggerDeferred","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ODS","ReQL","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(['[Occamadillo] MAWDB groupInfo is missing "name" field for threadKey: ',""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n            [Occamadillo] missing thread for updating group\n            with threadKey: ",""]);k=function(){return a};return a}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeGroupInfoUpdatedHandler",async function(a,e){var f;f=(f=b.threadName)!=null?f:void 0;a=a.threads;var g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e));if(g==null){(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_group_info_update","missing_thread");c("promiseDone")(d("MAWLoggerDeferred").WARN(k(),(i||(i=d("I64"))).to_string(e)));return}else f==null&&c("justknobx")._("4129")&&(f=g.threadName,c("promiseDone")(d("MAWLoggerDeferred").WARN(j(),(i||(i=d("I64"))).to_string(e))));e=b.memberAddMode!=="all_member_add";await a.put(babelHelpers.extends({},g,{needsAdminApprovalForNewParticipant:e,threadName:f}))})}g.call=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","justknobx"],(function(a,b,c,d,e,f,g,h){"use strict";var i;async function j(a,b,e){var f=a.threads,g=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(f).getKeyRange(e));if(g==null)return;var j=d("LSMessagingThreadTypeUtil").isGroup(g.threadType);if(!j)return;j=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(e));if(j==null){c("justknobx")._("1162")&&await f.put(babelHelpers.extends({},g,{additionalThreadContext:void 0}));return}e=(i||(i=d("I64"))).equal((i||(i=d("I64"))).of_string(b.actorId),j.inviterId)?null:await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(j.inviterId));if(e==null)return;b=h._(/*BTDS*/"{Inviter Name} invited you to join",[h._param("Inviter Name",e.name)]).toString();a=g.folderName==="inbox"?h._(/*BTDS*/"Message request").toString():g.additionalThreadContext;await f.put(babelHelpers.extends({},g,{additionalThreadContext:a,snippet:b}))}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeGroupInviteLoadedHandler",function(a,c){return j(a,b,c)})}g.callWithoutWaitingForAnything=j;g.call=a}),226);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeGroupInviteUpdateHandler",function(a,f){var g=(i||(i=d("I64"))).of_string(e.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,f,g)]).then(c("emptyFunction"))})}g.call=a}),98);
__d("MAWBridgeHandleCOPDigest",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.attachments["delete"](c,b.msgId,String(b.plaintextHash))})}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["FBLogger","MAWAdminMsgCTA","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsgReplySnippet","MAWUpdateMsg","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeMsgUpdatedHandler",async function(a,e){var f,g=await (f=d("ReQL")).firstAsync(f.fromTableAscending(a.messages.index("messageId")).getKeyRange(b.msgId));f=await f.firstAsync(f.fromTableAscending(a.attachments).getKeyRange(e,b.msgId));if(g==null){c("FBLogger")("messenger_web").info("existing message is null for type %s, and attachment is null: %s",b.type_,f==null);return}f=await d("MAWAdminMsgCTA").getAdminMsgCtaStep(a,e,b);e=await d("MAWMsgReplySnippet").getReplySnippet(b);return d("MAWUpdateMsg").call(a,b,g,f,e)})}g.call=a}),98);
__d("MAWBridgeMsgsLoadedHandler",["I64","LSClearMessagePlaceholderRangeStoredProcedure","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeMsgsLoadedHandler",function(a,e){return c("LSClearMessagePlaceholderRangeStoredProcedure")(c("LSFactory")(a),{maxTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,messageId:"",threadKey:e}).then(function(){if(c("gkx")("23927")){var f,g,i,j,k,l,m,n;f=(f=(f=b.rangeExtensionType)==null?void 0:f.hasMoreBefore)!=null?f:!1;g=(g=(g=b.rangeExtensionType)==null?void 0:g.hasMoreAfter)!=null?g:!1;i=f&&((i=b.rangeExtensionType)==null?void 0:i.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;j=g&&((j=b.rangeExtensionType)==null?void 0:j.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;k=(k=(k=b.rangeExtensionType)==null?void 0:k.minMsgId)!=null?k:"";l=(l=(l=b.rangeExtensionType)==null?void 0:l.maxMsgId)!=null?l:"";m=((m=b.rangeExtensionType)==null?void 0:m.rangeKind)==="before"?i:d("MAWTimeUtils").MIN_TIMESTAMP_MS;n=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="after"?j:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:g,hasMoreBefore:f,lowerOverlap:m,newMaxMid:l,newMaxTs:j,newMinMid:k,newMinTs:i,threadKey:e,upperOverlap:n})}else{f=((g=b.rangeExtensionType)==null?void 0:g.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;l=((m=b.rangeExtensionType)==null?void 0:m.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;i=(k=(j=b.rangeExtensionType)==null?void 0:j.minMsgId)!=null?k:"";m=(g=(n=b.rangeExtensionType)==null?void 0:n.maxMsgId)!=null?g:"";k=((j=b.rangeExtensionType)==null?void 0:j.rangeKind)==="extensionBefore"?f:d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="extensionAfter"?l:d("MAWTimeUtils").MAX_TIMESTAMP_MS;j=(n=(j=b.rangeExtensionType)==null?void 0:j.hasMoreBefore)!=null?n:!1;n=(n=(n=b.rangeExtensionType)==null?void 0:n.hasMoreAfter)!=null?n:!1;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:n,hasMoreBefore:j,lowerOverlap:k,newMaxMid:m,newMaxTs:l,newMinMid:i,newMinTs:f,threadKey:e,upperOverlap:g})}})})}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSUpsertAttachmentRangeStoredProcedure","MAWMediaGalleryEBTaggingUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","cr:20238","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeNewMediaRangeHandler",function(a,f){var g=(h||(h=d("I64"))).of_float(e.earliestLoadedMediaTs),j=e.mediaGalleryGroup,k=b("cr:20238")!=null?b("cr:20238").getMediaRestoreEBRange().getRange(f):null;k=Boolean(k==null?void 0:k.hasMoreBefore)&&d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryGroupSupportedForTaggedRestore(j);k=e.hasMoreBefore||k;return c("LSUpsertAttachmentRangeStoredProcedure")(c("LSFactory")(a),{hasMoreBefore:k,mediaGroup:(i||(i=d("LSIntEnum"))).ofNumber(j),newLastLoadedMessageId:e.lastLoadedMessageId,newMinTs:g,threadKey:f})})}function a(a,b){return j(a,b).then(c("emptyFunction"))}g.call=a}),98);
__d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandler",["FBLogger","I64","LSAuthorityLevel","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","MAWCreateOptimisticThread","MAWFolderUtils","MAWJids","MAWThreadUpdateMiddlewareGatingUtil","MAWThreadUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="[Occamadillo][CreateE2EEMetadataThreadHandler]";async function a(a,b){d("WALogger").LOG([j+" Handler called from "+b.creationSource+" for "+("jid: "+b.jid)]);if(!d("MAWThreadUpdateMiddlewareGatingUtil").isNewMiThreadCreationFlowEnabled("exposure_logging_disabled")){d("WALogger").LOG([j+" Early return due to failed eligibility check"]);return Promise.resolve()}var e=b.bumpTimestampMs,f=b.creationSource,g=b.folderId,i=b.jid;b=b.threadKeys;var l=await k(a,b);if(!n(f,l)){d("WALogger").LOG([j+" Early return due to no SPROC call required: jid: "+i+", "+("threadKey: "+((l==null?void 0:l.threadKey)?(h||(h=d("I64"))).to_string(l==null?void 0:l.threadKey):"null"))]);return Promise.resolve()}f=o(f);g=d("MAWFolderUtils").systemFolderToLSCoreClientFolder(g);l=await m(a,l,b,i);b=d("MAWThreadUtils").getLSThreadTypeFromJid(i);p({bumpTimestampMs:e,createdByLocalDevice:f,folderType:g,jid:i,offlineThreadKeyDetails:l,threadType:b});return c("LSCreateE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpTimestampMs:e,createdByLocalDevice:f,folderType:g,offlineThreadKey:l.offlineThreadKey,threadType:b,waJid:d("MAWJids").convertChatJidToIntJid(i)})}async function k(a,b){a=await Promise.all([await l(a,b.authoritative),await l(a,b.optimistic)]);b=a[0];a=a[1];return(b=b)!=null?b:a}async function l(a,b){if(b==null)return Promise.resolve();a=await a.threads.get((h||(h=d("I64"))).of_string(b));return a}async function m(a,b,e,f){if(b!=null)return{offlineThreadKey:b.threadKey,source:"Pre-existing LSDB Thread"};b=null;var g=null;e.authoritative!=null?(b=(h||(h=d("I64"))).of_string(e.authoritative),g="MAW: authoritative"):e.optimistic!=null?(b=(h||(h=d("I64"))).of_string(e.optimistic),g="MAW: optimistic"):(b=await d("MAWCreateOptimisticThread").createOfflineThreadingId(a),g="New Offline Threading ID");await Promise.all([d("MAWCreateOptimisticThread").createOptimisticThreadWithThreadKey(a,b),a.mi_act_mapping_table.put({clientThreadPk:d("MAWJids").convertChatJidToIntJid(f),jid:d("MAWJids").convertChatJidToIntJid(f),serverThreadKey:b})]);c("FBLogger")("messenger_web").info(j.concat(" Created new optimistic thread in LSDB with threadKey: ",(h||(h=d("I64"))).to_string(b),", threadKey source: ",g,", for jid: ",f));return{offlineThreadKey:b,source:g}}function n(a,b){var e=b!=null?(i||(i=d("LSIntEnum"))).unwrapIntEnum(b.authorityLevel):null;switch(a){case"incoming_message":return b==null;case"outgoing_message":switch(e){case null:case void 0:case c("LSAuthorityLevel").CLIENT_PARTIAL:case c("LSAuthorityLevel").OPTIMISTIC:case c("LSAuthorityLevel").SERVER_PARTIAL:return!0;case c("LSAuthorityLevel").AUTHORITATIVE:case c("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT:case c("LSAuthorityLevel").CLIENT_AUTHORITATIVE_DELETE:return!1;default:e;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown authority level")}default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown creation source")}}function o(a){switch(a){case"incoming_message":return!1;case"outgoing_message":return!0;default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown creation source")}}function p(a){var b=a.bumpTimestampMs,e=a.createdByLocalDevice,f=a.folderType,g=a.jid,k=a.offlineThreadKeyDetails;a=a.threadType;c("FBLogger")("messenger_web").info(j.concat(" Calling LSCreateE2EEMetadataThreadStoredProcedure with params: ","bumpTimestampMs: ",(h||(h=d("I64"))).to_float(b).toString(),", createdByLocalDevice: ",e.toString(),", folderType: ",(i||(i=d("LSIntEnum"))).toNumber(f).toString(),", offlineThreadKey: ",h.to_string(k.offlineThreadKey),", offlineThreadKeySource: ",k.source,", threadType: ",i.toNumber(a).toString(),", waJid: ",g))}g.call=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWJids","MAWMessageRequestUtil","MAWMiActMappingTableAPI","ODS","ReQL","WADbContact"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;async function a(a,b){b=b.threadJid;var c=d("MAWJids").convertChatJidToIntJid(b);b=await d("MAWMiActMappingTableAPI").getThreadKeyForChatJid(a,b);if(b==null)return;b=await Promise.all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange(c))]);c=b[0];b=b[1];if(c==null||b==null||!d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))return;b=l(c,b);b=c.folderName==="pending"||c.folderName==="other"||c.folderName==="spam"||b;if(!b)return;b=c.folderName==="inbox"?h._(/*BTDS*/"Message request").toString():void 0;b=babelHelpers.extends({},c,{additionalThreadContext:b},m(c));await a.threads.put(b)}function l(a,b){var e=d("MAWContactRelationshipType").getContactRelationshipType(b);e=a.folderName==="inbox"&&e===d("WADbContact").REVERSED_ONE_WAY_CONTACT&&!(i||(i=d("I64"))).equal(a.lastActivityTimestampMs,(i||(i=d("I64"))).zero);a=(i||(i=d("I64"))).lt(b.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE));e&&!a&&(k||(k=d("ODS"))).bumpEntityKey(3185,"e2ee.message_request_loaded_failure","contacts_not_yet_loaded",1);return e&&a}function m(a){a=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest,a.capabilities,a.capabilities2,a.capabilities3,a.capabilities4,a.capabilities5);a=d("LSThreadBitOffset").set(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,a[0],a[1],a[2],a[3],a[4]);return{capabilities:a[0],capabilities2:a[1],capabilities3:a[2],capabilities4:a[3],capabilities5:a[4]}}g.call=a}),226);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.participants["delete"](c,(h||(h=d("I64"))).of_string(b.userId))})}g.call=a}),98);
__d("MAWBridgeParticipantUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWBridgeParticipantsUpdatedHandler","MAWCurrentUser","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","MAWUpdateLSThreadCapabilities","TemporaryLoggingUtilsForS406998Only","gkx","vulture"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=d("MAWCurrentUser").getID(),l=(i||(i=d("I64"))).of_string(k);async function m(a,b,e){var f=(i||(i=d("I64"))).of_string(b.fbid),g=d("MAWTimeUtils").toTimestamp(b.readWatermarkTs),m=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs),n=d("MAWTimeUtils").toTimestamp(b.lastReadActionTs),o=b.isSuperAdmin?h._(/*BTDS*/"Group creator").toString():void 0,p=await a.participants.get(e,f);p!=null?await a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:p.authorityLevel,contactId:f,deliveredWatermarkTimestampMs:m,groupParticipantJoinState:b.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:b.isAdmin,isModerator:!1,isSuperAdmin:p.isSuperAdmin,nickname:p.nickname,normalizedSearchTerms:p.normalizedSearchTerms,participantCapabilities:p.participantCapabilities,readActionTimestampMs:n,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:e},"MAWBridgeParticipantUpdatedHandler.put")):await a.participants.add(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:(i||(i=d("I64"))).zero,contactId:f,deliveredWatermarkTimestampMs:m,groupParticipantJoinState:b.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:b.isAdmin,isModerator:!1,isSuperAdmin:b.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:i.zero,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:e},"MAWBridgeParticipantUpdatedHandler.add"));await d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,e);n=b.isAdmin;(i||(i=d("I64"))).equal(l,f)&&(n?await d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,e):await d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,e));p==null&&await c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===b.fbid,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}function a(a,b){if(c("gkx")("13628"))return d("MAWBridgeParticipantsUpdatedHandler").call(a,{participants:[b]});if(b.fbid.startsWith("shadow_")){c("vulture")("Hxg8SseiWP5IZUyhTKsM26kY__w=");return Promise.resolve()}return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeParticipantUpdatedHandler",function(a,c){return m(a,b,c)})}g.callWithoutWaitingForAnything=m;g.call=a}),226);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsg","MAWRavenUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeRavenActionMsgForUIHandler",async function(a,c){a=a.attachments;c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(c,b.ravenMsgId));if(c==null)return Promise.resolve();if(c.ephemeralMediaState==null)return Promise.resolve();var e=(h||(h=d("I64"))).to_int32(c.ephemeralMediaState);if(c.ephemeralMediaViewMode==null)return Promise.resolve();var f=h.to_int32(c.ephemeralMediaViewMode);e=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(e);f=d("MAWMsg").MAWRavenMsgEphemeralType.cast(f);if(e==null||f==null)return Promise.resolve();e=d("MAWRavenUtils").getNextRavenMessageEphemeralState(e,f);if(e==null)return Promise.resolve();c.ephemeralMediaState;f=babelHelpers.objectWithoutPropertiesLoose(c,["ephemeralMediaState"]);c=babelHelpers.extends({ephemeralMediaState:h.of_int32(e)},f,{transportKey:"WhatsApp"});e=[f.threadKey,f.messageId,f.attachmentFbid];return a.upsert(e,c)})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","ReQL","TemporaryLoggingUtilsForS406998Only"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,c){var e=(h||(h=d("I64"))).of_string(b.fbid),f=d("MAWTimeUtils").toTimestamp(b.lastReadWatermarkTs),g=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs);b=d("MAWTimeUtils").toTimestamp(b.lastReadActionTs);c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(c,e));c!=null&&await a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:(h||(h=d("I64"))).equal(g,(h||(h=d("I64"))).zero)?c.deliveredWatermarkTimestampMs:g,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).zero)?c.readActionTimestampMs:b,readWatermarkTimestampMs:(h||(h=d("I64"))).equal(f,(h||(h=d("I64"))).zero)?c.readWatermarkTimestampMs:f,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:(h||(h=d("I64"))).zero},"MAWBridgeReceivedReceiptHandler"))}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeReceivedReceiptHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeRefreshContactHandler",["LSFactory","LSRefetchContactRowIfExistsStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("LSRefetchContactRowIfExistsStoredProcedure")(c("LSFactory")(a),{id:b})}g.call=a}),98);
__d("MAWBridgeRemoveMessageSearchResultHandler",["ReQL","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return async function(){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.message_search_results).filter(function(a){return b.includes(a.messageOtid)}));await Promise.all(c.map(function(b){return a.message_search_results.delete(b.type_,b.query,b.threadKey,b.globalIndex)}))}().then(c("emptyFunction"))}g.call=a}),98);
__d("MAWBridgeResignAttachmentCDNUrlHandlerLazy",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("JSResourceForInteraction")("MAWBridgeResignAttachmentCDNUrlHandler").__setRef("MAWBridgeResignAttachmentCDNUrlHandlerLazy").load().then(function(c){return c.call(a,b)})}g.call=a}),98);
__d("MAWBridgeTraceUtils",["I64","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c,e){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_meta).filter(function(a){var b=a.contextThree;if(b!=null&&c===b&&(i||(i=d("I64"))).equal(a.traceType,e))return a.shouldFlush===!1;else return!1})).then(function(a){if(a.length!==0)return(h||(h=b("Promise"))).resolve(a[0].traceId);else return(h||(h=b("Promise"))).resolve()})}g.getTraceId=a}),98);
__d("MAWBridgeStartTraceHandler",["ArmadilloDataTraceCheckPoint","ArmadilloDataTraceType","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceTag","LSFactory","LSRequestId","MAWAckLevel","MAWBridgeTraceUtils","MAWMsg","MAWTimeUtils","Promise","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){return a.data_trace_meta.add({contextOne:void 0,contextThree:b.externalId,contextTwo:void 0,foregroundTimestampMs:(i||(i=d("I64"))).zero,initTimestampMs:d("MAWTimeUtils").toTimestamp(b.ts),predefinedId:void 0,shouldFlush:!1,traceId:e,traceType:b.traceType}).then(function(){return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").traceCreated,dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one})}).then(function(){var f;if(b.threadKey==null||!c("gkx")("23995"))return;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one,tags:(f=b.threadKey)!=null?f:void 0})})}function a(a,e){var f=e.ack,g=e.traceType;return f===d("MAWAckLevel").ACK.clock?d("MAWBridgeTraceUtils").getTraceId(a,e.externalId,e.traceType).then(function(f){if(f!=null)return;var k=c("LSRequestId").generate();if((i||(i=d("I64"))).equal(g,d("ArmadilloDataTraceType").armadilloMessageSend))return j(a,e,k).then(function(){var b=e.threadType;if(b==="User")return;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").traceGroupMessage,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one})}).then(function(){if(e.isFirstMsg)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloActMessageSend,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one,tags:"first_msg=1"})}).then(function(){var f=e.type_;f=f===d("MAWMsg").text?d("ArmadilloDataTraceCheckPoint").traceTextMessage:f===d("MAWMsg").ptt||f===d("MAWMsg").image||f===d("MAWMsg").video||f===d("MAWMsg").gif?d("ArmadilloDataTraceCheckPoint").traceMediaMessage:void 0;if(f==null)return(h||(h=b("Promise"))).resolve(f);c("promiseDone")(c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one}));return(h||(h=b("Promise"))).resolve(f)}).then(function(b){if(b==null)return;if(!(i||(i=d("I64"))).equal(b,d("ArmadilloDataTraceCheckPoint").traceMediaMessage))return;b=e.type_;b=b===d("MAWMsg").image?d("LSDataTraceTag").image:b===d("MAWMsg").ptt?d("LSDataTraceTag").audio:b===d("MAWMsg").video?d("LSDataTraceTag").video:b===d("MAWMsg").gif?d("LSDataTraceTag").animatedImage:d("LSDataTraceTag").none;return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").richMediaMediaSendAttachmentType,dataTraceId:k,syncChannel:(i||(i=d("I64"))).neg_one,tags:String(b)})});else return j(a,e,k)}):(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeStartTraceWithTraceIdHandler",["MAWMainTraceUtils","MAWTimeUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMainTraceUtils").startTraceWithTxn(a,d("MAWTimeUtils").toTimestamp(d("WATimeUtils").unixTime()),b.traceId,b.traceType,void 0,void 0,b.traceContext)}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentMessengerUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("CurrentMessengerUser").getID();function a(a,e){return e.reduce(function(b,e){var f=(i||(i=d("I64"))).of_string(e);return b.then(function(){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===e,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}).then(c("emptyFunction"))},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeThreadHiddenV2Handler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeThreadHiddenV2Handler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSThreadRemoveType").DELETE_THREAD),threadKey:b})})}g.call=a}),98);
__d("MAWBridgeThreadTimestampsHandler",["CurrentMessengerUser","I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","ReQL","TemporaryLoggingUtilsForS406998Only"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,c){var e=d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs),f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b));if(f==null||c.markUnread!==null&&c.markUnread===!1&&(h||(h=d("I64"))).ge(f.lastReadWatermarkTimestampMs,e))return;e=babelHelpers.extends({},f,{lastReadWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)});await a.threads.put(e);f=(h||(h=d("I64"))).of_string(d("CurrentMessengerUser").getID());e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(b,f));e!=null&&await a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only(babelHelpers.extends({},e,{readActionTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastActivityTimestampMs),readWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)}),"MAWBridgeThreadTimestampsHandler"))}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeThreadTimestampsHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}async function i(a,b,e){e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e));if(e==null)return;var f=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(b,e.snippet),g=h(e,b),i=c("getMAWLastMessageCtaType")(b.snippetType);g=babelHelpers.extends({},e,{cannotReplyReason:g,folderName:e.folderName,lastMessageCtaType:i,parentThreadKey:e.parentThreadKey,snippet:f,snippetSenderContactId:b.snippetSenderContactId==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(b.snippetSenderContactId)});await a.threads.put(g)}function a(a,b){var c=b.threadJid;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,c,"MAWBridgeThreadUpdatedHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(1056849266,"1765"),b,{instanceKey:a})}function d(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function e(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.addAnnotations=b;g.endSuccess=d;g.endFailure=e}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUnbumpOnThreadLoadHandler",["FBLogger","I64","MAWChatJid","MAWJids","MAWMiActGetThreadLifecycleState","MAWODSProxy","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();async function a(a,b){var e=b.jid,f=b.unbumpFromTs;b=b.unbumpToTs;var g=await d("MAWChatJid").toThreadMaybe(a,e);if(g==null){var j=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(e),"MAWBridgeCentralizedThreadUpdateHandler");c("FBLogger")("UnbumpOnRefresh").mustfix("[UnbumpOnRefresh] missing thread for unbumping jid: %s with thread state: %s",e,j.type);return}if(i.has(e)){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_UPDATE_MIDDLEWARE,key:"unbump_already_processed"});return}i.add(e);if(!(h||(h=d("I64"))).equal(g.lastActivityTimestampMs,f))return;d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_UPDATE_MIDDLEWARE,key:"unbump_on_thread_load"});j=babelHelpers.extends({},g,{lastActivityTimestampMs:b});await a.threads.put(j)}g.call=a}),98);
__d("MAWBridgeUpdateContactAsConnectedHandler",["FBLogger","I64","LSAddMessengerContactStoredProcedure","LSContactViewerRelationship","LSFactory","LSIntEnum","LSOptimisticAcceptMessageRequestStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,b){var e=b.contactUserId;b=b.threadJid;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange((h||(h=d("I64"))).of_string(e)));if(f==null){c("FBLogger")("messenger_web").warn("Missing contact in MAWBridgeUpdateContactAsConnectedHandler");return}var g=babelHelpers.extends({},f,{contactViewerRelationship:(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").CONTACT_OF_VIEWER)});return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeUpdateContactAsConnectedHandler",async function(a,b){await Promise.allSettled([a.contacts.upsert([f.id],g),c("LSAddMessengerContactStoredProcedure")(c("LSFactory")(a),{contactId:f.id}),d("MAWUpdateLSThreadCapabilities").updateNonMessageRequestThreadTxn(a,b),c("LSOptimisticAcceptMessageRequestStoredProcedure")(c("LSFactory")(a),{threadKey:b})])})}g.call=a}),98);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipantsStoredProcedure")(c("LSFactory")(a),{threadKey:b})})}g.call=a}),98);
__d("MAWBridgeUpdateMinMessageHandler",["FBLogger","I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","ReQLTable"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=(h||(h=d("I64"))).of_float(b.minTimestampMs),f=b.minMessageId;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeUpdateMinMessageHandler",function(a,g){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(g)).then(function(h){if(h==null)return;var i=b.hasMoreBefore,j=i!=null?i:h.hasMoreBefore;return d("ReQLTable").update(a.messages_ranges_v2__generated,[g,h.minTimestampMs,h.minMessageId],function(a){if(a!=null)return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:j,isLoadingAfter:a.isLoadingAfter,isLoadingBefore:a.isLoadingBefore,maxMessageId:a.maxMessageId,maxTimestampMs:a.maxTimestampMs,minMessageId:f,minTimestampMs:e,threadKey:a.threadKey};throw c("FBLogger")("wmi_eb").mustfixThrow("Thread is missing in updating the min message in message range")})})})}g.call=a}),98);
__d("MAWBridgeUpdateThreadListItemHandler",["FBLogger","I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWBridgeBuildThreadSnippet","MAWChatJid","MAWJids","MAWLoggerDeferred","MAWMiActGetThreadLifecycleState","getMAWLastMessageCtaType","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," Updated thread snippet. threadKey: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," ",". threadKey: ",", source: ",", bumpTimestampMs: ",", originalLastActivityTimestampMs: ",", originalLastReadWatermarkTimestampMs: ",""]);j=function(){return a};return a}async function a(a,b){var c=b.activityUpdate,d=b.chatJid;b=b.snippetUpdate;c!=null&&await k(a,d,c);b!=null&&await n(a,d,b)}async function k(a,b,e){var f=await d("MAWChatJid").toThreadMaybe(a,b);if(f==null){await s(a,b);return}switch(e.source){case"outgoing_msg":case"incoming_msg":return l(a,f,e);case"deleted_msg":return m(a,f,e);case"inserted_admin_msg":return q(f,e,"No bump for admin message");case"eb_restore":return c("FBLogger")("messenger_web").warn("Attempted bump from EB restore");default:e.source;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown source")}}async function l(a,b,d){if(o(b,d)){q(b,d,"Stale incoming bump");return}await c("LSBumpE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpedByLocalDeviceSend:d.source==="outgoing_msg",isUnbump:!1,serverAuthoritativeTimestampMs:d.bumpTimestampMs,threadKey:b.threadKey});q(b,d,"Thread bumped")}async function m(a,b,c){await a.threads.put(babelHelpers.extends({},b,{lastActivityTimestampMs:(h||(h=d("I64"))).min(b.lastActivityTimestampMs,c.bumpTimestampMs),lastReadWatermarkTimestampMs:h.min(b.lastReadWatermarkTimestampMs,c.bumpTimestampMs)})),q(b,c,"Thread unbumped")}async function n(a,b,e){var f=await d("MAWChatJid").toThreadMaybe(a,b);if(f==null){await s(a,b);return}await a.threads.put(babelHelpers.extends({},f,{lastMessageCtaType:c("getMAWLastMessageCtaType")(e.snippetType),snippet:d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(e,f.snippet),snippetSenderContactId:e.snippetSenderContactId!=null?(h||(h=d("I64"))).of_string(e.snippetSenderContactId):(h||(h=d("I64"))).zero}));r(f.threadKey)}function o(a,b){return b.source==="incoming_msg"&&(h||(h=d("I64"))).le(b.bumpTimestampMs,a.lastActivityTimestampMs)}var p="[Occamadillo][Middleware]";function q(a,b,e){b=[(h||(h=d("I64"))).to_string(a.threadKey),b.source,h.to_string(b.bumpTimestampMs),h.to_string(a.lastActivityTimestampMs),h.to_string(a.lastReadWatermarkTimestampMs)];(a=c("FBLogger")("messenger_web")).info.apply(a,[p+" "+e+". threadKey: %s, source: %s, bumpTimestampMs: %s, originalLastActivityTimestampMs: %s, originalLastReadWatermarkTimestampMs: %s"].concat(b));c("promiseDone")(d("MAWLoggerDeferred").LOG(j(),p,e,b[0],b[1],b[2],b[3],b[4]))}function r(a){c("FBLogger")("messenger_web").info(p+" Updated thread snippet. threadKey: %s",(h||(h=d("I64"))).to_string(a)),c("promiseDone")(d("MAWLoggerDeferred").LOG(i(),p,h.to_string(a)))}async function s(a,b){a=await d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(b),"MAWBridgeUpdateThreadListItemHandler");c("FBLogger")("messenger_web").mustfix(p+" Missing LSDBThread when updating threadlist item. jid: %s, thread state: %s",b,a.type)}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c,d){var e=String(d.xmaId);return a.attachments.get(c,d.msgId,e).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.attachment_ctas["delete"](b)});return(h||(h=b("Promise"))).all(f).then(function(){return a.attachments["delete"](c,d.msgId,e)})})}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareExpiredHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=String(b.xmaId);return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareTombstonedHandler",function(a,f){return a.attachments.get(f,b.msgId,e).then(function(g){if(g==null)return Promise.resolve();g=[g.defaultCtaId,g.attachmentCta1Id,g.attachmentCta2Id,g.attachmentCta3Id].filter(Boolean);g=g.map(function(b){return a.attachment_ctas.delete(b)});return Promise.all(g).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(f,b.msgId,e)).then(async function(b){if(b!=null){b=babelHelpers.extends({},b,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});await a.attachments.put(b)}c("FBLogger")("messenger_web_sharing").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return Promise.resolve()})})})})}g.call=a}),98);
__d("isInstamadilloDYI",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("665")===!0}g["default"]=a}),98);
__d("MAWBridgeUIEventHandler",["FBLogger","MAWAbPropsClient","MAWBridgeAddMessageSearchResultHandler","MAWBridgeCallRestoreNativeOpHandler","MAWBridgeCentralizedThreadUpdateHandler","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessageRangesV2Handler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeEditMsgHistoryAddedHandler","MAWBridgeFulfillRestorePromisePayloadHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsLoadedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewPollHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantUpdatedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeRefreshContactHandler","MAWBridgeRemoveMessageSearchResultHandler","MAWBridgeSyncContacts","MAWBridgeThreadHiddenV2Handler","MAWBridgeThreadTimestampsHandler","MAWBridgeThreadUpdatedHandler","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUnbumpOnThreadLoadHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateContactAsConnectedHandler","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateMinMessageHandler","MAWBridgeUpdateThreadListItemHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","MAWLoggerUtils","WAResultOrError","WATagsLogger","WATimeUtils","cr:15985","cr:15986","cr:15987","cr:16021","cr:16022","cr:16023","cr:16024","cr:16025","cr:16026","cr:16027","cr:16028","emptyFunction","getErrorSafe","isArmadillo","isInstamadilloDYI","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]);j=function(){return a};return a}function k(a,e,f){switch(f.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(e,f.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(e,f.value);case"MsgClearCountdown":return Promise.resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(f.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(e);case"VerifyThreadExists":var g=f.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(e,g);case"CreateE2EEMetadataThread":return d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandler").call(e,f.value);case"EditMsgHistoryAdded":return d("MAWBridgeEditMsgHistoryAddedHandler").call(a,e,f.value);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(e,f.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(e,f.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(e,f.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(e,f.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(e,f.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(e,f.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(e,f.value);case"ParticipantUpdated":return d("MAWBridgeParticipantUpdatedHandler").call(e,f.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(e,f.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(e,f.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(e,f.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(e,f.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(e,f.value);case"CentralizedThreadUpdate":return d("MAWBridgeCentralizedThreadUpdateHandler").call(e,f.value);case"UpdateThreadListItem":return d("MAWBridgeUpdateThreadListItemHandler").call(e,f.value);case"UnbumpOnThreadLoad":return d("MAWBridgeUnbumpOnThreadLoadHandler").call(e,f.value);case"ThreadTimestampsUpdated":return d("MAWBridgeThreadTimestampsHandler").call(e,f.value);case"MsgsLoaded":return d("MAWBridgeMsgsLoadedHandler").call(e,f.value);case"StartTrace":return b("cr:16023").call(e,f.value);case"UpdateTrace":return b("cr:16026").call(e,f.value);case"ThreadHiddenV2":return d("MAWBridgeThreadHiddenV2Handler").call(e,f.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(e,f.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(e,f.value);case"ClockSkewUpdated":return Promise.resolve(d("WATimeUtils").setClockSkew(f.value));case"ABPropsUpdated":c("FBLogger")("messenger_web").warn("[messenger_e2ee_web] ABPropsUpdated has been deprecated. Please use the bridge with ABPropsUpdated");return Promise.resolve(d("MAWAbPropsClient").rewrite(f.value));case"COPDigestReceived":return d("MAWBridgeHandleCOPDigest").call(e,f.value);case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(e,f.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(e,f.value);case"UploadMessage":return b("cr:16028").call(e,f.value);case"UploadMessageByBatch":return b("cr:16027").call(e,f.value);case"DeleteMessagesOfThread":return b("cr:16021").call(e,f.value);case"UploadAttachment":return b("cr:15987").call(e,f.value);case"ResignAttachmentCDNUrl":return b("cr:15986").call(e,f.value);case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(e,f.value);case"RestoreMessageBatch":d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi"]).WARN(j());return Promise.resolve();case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(e,f.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(e,f.value);case"UpdateDyiStatus":d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi"]).WARN(i());return Promise.resolve();case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(e,f.value);case"TraceRecordCheckpoint":return b("cr:16025").call(e,f.value);case"DeleteMessageRangesV2":return d("MAWBridgeDeleteMessageRangesV2Handler").call(e,f.value);case"UpdateMinMessage":return d("MAWBridgeUpdateMinMessageHandler").call(e,f.value);case"IssuePointQuery":return b("cr:16022").call(e,f.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(e,f.value);case"StartTraceWithTraceId":return b("cr:16024").call(e,f.value);case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(e,f.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(e,f.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(e,f.value);case"EphemeralSettingsUpdatedForUI":return b("cr:15985").call(e,f.value);case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(e,f.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(e,f.value);case"RemoveMessageSearchResult":return d("MAWBridgeRemoveMessageSearchResultHandler").call(e,f.value);case"AddMessageSearchResult":return d("MAWBridgeAddMessageSearchResultHandler").call(a,e,f.value);case"FulfillRestorePromise":return d("MAWBridgeFulfillRestorePromisePayloadHandler").call(f.value);case"UpdateContactAsConnected":return d("MAWBridgeUpdateContactAsConnectedHandler").call(e,f.value);case"RefreshContact":return d("MAWBridgeRefreshContactHandler").call(e,f.value);case"NewReceiverFetchInfo":return d("MAWBridgeNewReceiverFetchInfoHandler").call(e,f.value);case"RestoreNativeOp":return d("MAWBridgeCallRestoreNativeOpHandler").call(e,f.value);case"NewPoll":return d("MAWBridgeNewPollHandler").call(e,f.value);default:return Promise.resolve()}}function a(a,b){if(!c("isArmadillo")()&&!c("isInstamadilloDYI")()){c("FBLogger")("maw_bridge").mustfix("User is neither part of armadillo QE and dual send QE but somehow loaded this handler");return}if(!(b.length===1&&b[0].tag==="TraceRecordCheckpoint")){var e={};e=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},e);d("WATagsLogger").TAGS(["MAWBridgeUIEvent"]).LOG(h(),e)}c("promiseDone")(l(a,b),c("emptyFunction"),function(a){c("FBLogger")("messenger_web").catching(a).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI events: %s",b.map(function(a){return a.tag}).join(", "))})}async function l(a,b){var e=await a;a=d("MAWLoggerUtils").getInstanceKey();var g=b.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);d("MAWBridgeUIEventQueueQPLLogger").addAnnotations(a,{int:{queue_size:b.length}});var i;try{i=await e.runInTransaction(async function(a){for(var f=0;f<b.length;f++){var g=b[f];try{await k(e,a,g)}catch(a){h=g.tag;return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}return d("WAResultOrError").makeResult(!0)},"readwrite","background",{events:b,type:"maw_ui_bridge"},f.id+":310")}catch(a){i=d("WAResultOrError").makeError(c("getErrorSafe")(a))}!i.success?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),c("FBLogger")("messenger_web").catching(i.error).mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB: %s",g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)}async function e(a,b,d){try{await k(a,b,d)}catch(b){a=c("getErrorSafe")(b);c("FBLogger")("messenger_web").catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",d.tag);throw b}}g.handleEvents=a;g.handleShimEvent=e}),98);
__d("MAWBridgeUpdateDYIStatusV2",["EncryptedBackupdDYIFileSaver","EncryptedBackupsDYIFileUtils","EncryptedBackupsDYITypes","FBLogger","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b,e){d("EncryptedBackupdDYIFileSaver").saveFile(a,b),window.setTimeout(function(){c("promiseDone")(e())},1e3)}async function a(a){var b=a.qplEvent,e=a.qplInstanceKeyE2E;a=a.status;var f=c("FBLogger")("[labyrinth_web][dyi]");if(a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed)try{if(navigator.storage==null)throw f.mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.");var g=d("EncryptedBackupsDYIFileUtils").DyiArchiveFilename,i=await d("EncryptedBackupsDYIFileUtils").getRootFolderHandle(),j=await d("EncryptedBackupsDYIFileUtils").readFile(i,g);await h(g,j,async function(){await i.removeEntry(g)});f.info("Saving file with filename ",g);b!=null&&e!=null&&c("QPLUserFlow").endSuccess(b,{instanceKey:e});f.info("DYI Complete")}catch(a){f.mustfix("Failed to download the DYI archive: %s",a);b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,a.message,{instanceKey:e});return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed}a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed&&(b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,"Unknown error",{instanceKey:e}));return a}g.call=a}),98);
__d("MAWBridgeUpdateTraceHandler",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","MAWBridgeTraceEvent","Promise","ReQL","emptyFunction","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e,f){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_meta).filter(function(a){var b=a.contextThree;if(b!=null&&e.externalIds.includes(b)&&(j||(j=d("I64"))).equal(a.traceType,e.traceType))return a.shouldFlush===!1;else return!1})).then(function(g){var i=[];return g.reduce(function(b,g){return b.then(function(){i.push(g.traceId);var b=e.errorMessage;if(b!=null)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,errorMessage:b,syncChannel:(j||(j=d("I64"))).neg_one});else return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,syncChannel:(j||(j=d("I64"))).neg_one})})},(h||(h=b("Promise"))).resolve()).then(function(){return i})})}function l(a,d){return d.reduce(function(b,d){return b.then(function(){return c("updateAndFlushLSDataTrace")(a,d)})},(h||(h=b("Promise"))).resolve())}function a(a,e){var f=e.event;if(f===c("MAWBridgeTraceEvent").ReceivedReceipt)return k(a,e,d("ArmadilloDataTraceCheckPoint").deliveryReceiptReceived).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").ReceivedSent)return k(a,e,d("ArmadilloDataTraceCheckPoint").advancedCryptoMEMSendTaskComplete).then(c("emptyFunction"));else if(f===c("MAWBridgeTraceEvent").FlowEndForFailure)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE)).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").FlowEndForSuccess)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH)).then(function(b){return l(a,b)});else return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeUploadAttachmentHandlerLazy",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("JSResourceForInteraction")("MAWBridgeUploadAttachmentHandler").__setRef("MAWBridgeUploadAttachmentHandlerLazy").load().then(function(c){return c.call(a,b)})}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchGQLHandler",["FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWEBFrontendQPLLogger","WAResultOrError","cr:8110"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,e){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(e.messages,"upload_tracking_bridge_batch_handler_gql");var f=await b("cr:8110").call(a,e.messages);if(f.success){a=e.messages.map(function(a){if(a.uploadTrackingInstanceKey!=null)return{instanceKey:a.traceId,success:!0};else return null}).filter(Boolean);d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",{instancesWithOutcomes:a});c("FBLogger")("labyrinth_web").info("Successfully completed GQL upload batch of size %s",e.messages.length);return d("WAResultOrError").makeResult()}e.messages.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(a.uploadTrackingInstanceKey,"gql_upload_failed",{string:{error:f.error}})});return d("WAResultOrError").makeError(f.error)}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchHandler",["MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUploadMessageHandler","MAWEBFrontendQPLLogger","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(a.uploadTrackingInstanceKey,b)})}async function a(a,b){h(b.messages,"upload_tracking_bridge_batch_handler");b.qpl.forEach(function(a){return c("QPLUserFlow").addPoint(a.event,a.action.name,{instanceKey:a.instanceKey,timestamp:a.timestamp})});b.checkPoint.forEach(function(b){return c("promiseDone")(d("MAWBridgeTraceRecordCheckpointHandler").call(a,b))});for(b of b.messages)await d("MAWBridgeUploadMessageHandler").call(a,b);return Promise.resolve()}g.call=a}),98);
__d("MWXIconMenuItemHouseKeyhole",["MWXSvgIcon","SVGIcon","cr:12821","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12821")),c("gkx")("23219"));g["default"]=a}),98);
__d("MAWSecurityAlertsBadgeMenuItem.react",["fbt","ARIA_LABEL_PLACEHOLDER_FIXME","FDSNumberedBadge.react","JSResourceForInteraction","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWXIconMenuItemHouseKeyhole","MWXMenuItem.react","gkx","react","react-compiler-runtime","useMWXLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext,l=c("JSResourceForInteraction")("MAWSecurityAlertsDialog.react").__setRef("MAWSecurityAlertsBadgeMenuItem.react");function a(a){var b=d("react-compiler-runtime").c(9);a=a.count;var e=c("useMWXLazyDialog")(l),f=e[0];e=k(c("MWJewelPopoverDialogContext.react"));var g=e.setIsOpenForDialog;e=c("gkx")("23219");var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"View security alerts"),b[0]=i):i=b[0];i=i;b[1]!==a?(e={badge:j.jsx(c("FDSNumberedBadge.react"),{accessibilityText:c("ARIA_LABEL_PLACEHOLDER_FIXME"),color:e?"red":"lightBlue",value:a}),type:"numberedBadge"},b[1]=a,b[2]=e):e=b[2];b[3]!==g||b[4]!==f?(a=function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","security_alerts"),g(!0),f({})},b[3]=g,b[4]=f,b[5]=a):a=b[5];b[6]!==e||b[7]!==a?(i=j.jsx(c("MWXMenuItem.react"),{auxItem:e,icon:c("MWXIconMenuItemHouseKeyhole"),id:"security_alerts_badge_menu_item",onClick:a,primaryText:i}),b[6]=e,b[7]=a,b[8]=i):i=b[8];return i}g["default"]=a}),226);
__d("MAWSecurityAlertsBadgeMenuItemWrapper.react",["MAWSecurityAlertsBadgeMenuItem.react","react","react-compiler-runtime","useMAWSecurityAlertsPreferences"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useMemo;function a(a){var b=d("react-compiler-runtime").c(3);a=a.value;var e=c("useMAWSecurityAlertsPreferences")();e=e.securityAlertsPreferences;e==null?void 0:e.allowSecurityAlertForSelf;var f;b[0]!==(e==null?void 0:e.allowSecurityAlertForSelf)||b[1]!==a?(f=(e==null?void 0:e.allowSecurityAlertForSelf)?i.jsx(c("MAWSecurityAlertsBadgeMenuItem.react"),{count:a}):null,b[0]=e==null?void 0:e.allowSecurityAlertForSelf,b[1]=a,b[2]=f):f=b[2];e=f;return e}g["default"]=a}),98);
__d("MAWSecurityAlertsMenuItem.react",["fbt","JSResourceForInteraction","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWXMenuItem.react","react","react-compiler-runtime","useMWXLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext,l=c("JSResourceForInteraction")("MAWSecurityAlertsDialog.react").__setRef("MAWSecurityAlertsMenuItem.react");function a(){var a=d("react-compiler-runtime").c(7),b=c("useMWXLazyDialog")(l),e=b[0];b=k(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog;a[0]!==f||a[1]!==e?(b=function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","security_alerts"),f(!0),e({})},a[0]=f,a[1]=e,a[2]=b):b=a[2];var g,i;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Security alerts"),i=h._(/*BTDS*/"View and manage alerts for logins and key changes"),a[3]=g,a[4]=i):(g=a[3],i=a[4]);a[5]!==b?(g=j.jsx(c("MWXMenuItem.react"),{onClick:b,primaryText:g,secondaryText:i,testid:void 0}),a[5]=b,a[6]=g):g=a[6];return g}g["default"]=a}),226);
__d("MAWXMAPreviewsSettingsMenuItem.react",["fbt","FDSMenuItemCheckbox.react","JSResourceForInteraction","MWXLink.react","MWXMenuItem.react","MWXMenuItemWithSubmenu.react","MWXText.react","getE2EEPreviewsHelpCenterArticleLink","justknobx","react","react-compiler-runtime","useMWXLazyDialog","useToggleXMAPreviewSettingsState","useXMAPreviewsDisabledSetting"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=h._(/*BTDS*/"Previews"),l=h._(/*BTDS*/"See previews of Facebook content");function m(){var a=d("react-compiler-runtime").c(9),b=c("useToggleXMAPreviewSettingsState")(),e=b[0],f=b[1];b=!e;a[0]!==f?(e=function(){f()},a[0]=f,a[1]=e):e=a[1];var g;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Show previews"),a[2]=g):g=a[2];var i;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"See previews of Facebook content like posts, stories and reels in your end-to-end encrypted chats."),a[3]=i):i=a[3];var k;a[4]===Symbol["for"]("react.memo_cache_sentinel")?(k=c("getE2EEPreviewsHelpCenterArticleLink")(),a[4]=k):k=a[4];a[5]===Symbol["for"]("react.memo_cache_sentinel")?(i=j.jsxs(c("MWXText.react"),{color:"secondary",type:"body4",children:[i,j.jsxs(c("MWXLink.react"),{display_DEPRECATED:"inline",href:k,rel:"noreferrer",target:"_blank",children:[" ",h._(/*BTDS*/"Learn more")]})]}),a[5]=i):i=a[5];a[6]!==b||a[7]!==e?(k=j.jsx(c("FDSMenuItemCheckbox.react"),{asSwitch:!0,isSelected:b,onClick:e,preventClosingMenuOnSelect:!0,primaryText:g,secondaryText:i}),a[6]=b,a[7]=e,a[8]=k):k=a[8];return k}var n=c("JSResourceForInteraction")("MAWXMAPreviewSettingsDialog.react").__setRef("MAWXMAPreviewsSettingsMenuItem.react");function a(){var a=d("react-compiler-runtime").c(3),b=c("useXMAPreviewsDisabledSetting")(),e=c("useMWXLazyDialog")(n),f=e[0];a[0]!==f||a[1]!==b?(e=c("justknobx")._("3913")?j.jsx(c("MWXMenuItem.react"),{auxItem:{auxText:b?h._(/*BTDS*/"Off"):h._(/*BTDS*/"On"),type:"text"},onClick:function(){return f({})},primaryText:k,secondaryText:l}):j.jsx(c("MWXMenuItemWithSubmenu.react"),{primaryText:k,secondaryText:l,submenu:{header:{title:k},items:[j.jsx(m,{},"xma-previews")]}}),a[0]=f,a[1]=b,a[2]=e):e=a[2];return e}g["default"]=a}),226);
__d("MWChatEncryptedBackupsAddDeviceWithEBKeys",["EBMainThreadEBDBApiDeferred","EBSMAPI","EBWorkerODSEntityName.enum","cr:17321"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.backupId,f=a.db,g=a.newDeviceRegistrationId,h=a.previousDeviceId;return c("EBSMAPI").addDeviceWithEBKeys({backupId:e,db:f,isInWorker:!1,newDeviceRegistrationId:g,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_MAIN_THREAD,trackAddingDevice:function(a){void d("EBMainThreadEBDBApiDeferred").addNewDevice(a)}}).then(function(){return b("cr:17321")==null?void 0:b("cr:17321").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:e,deviceRegistrationId:g,isAutoRestore:!0,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER})})}g.addDeviceWithEBKeys=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapper.react",["cr:6736","cr:8598","cr:8599","cr:8601"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:8598")==null?void 0:b("cr:8598")();b("cr:8599")==null?void 0:b("cr:8599")();b("cr:8601")==null?void 0:b("cr:8601")();b("cr:6736")==null?void 0:b("cr:6736")();return null}g["default"]=a}),98);
__d("MWChatSidebarEncryptedBackupsMenuItem.react",["fbt","MAWEncryptedBackupsStateManager","MWChatEncryptedBackupsSettingsDialog.entrypoint","MWEBEntrypointsKillswitch.enum","MWJewelPopoverDialogContext.react","MWXMenuItem.react","promiseDone","react","react-compiler-runtime","requireDeferred","useMWEBBackupState","useMWXEntryPointDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react")),l=j.useContext,m=c("requireDeferred")("MWEncryptedBackupsFetchBackupMetadata").__setRef("MWChatSidebarEncryptedBackupsMenuItem.react"),n=h._(/*BTDS*/"Message storage"),o=h._(/*BTDS*/"Manage how you store and access your chat history.");function a(){var a=d("react-compiler-runtime").c(13),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={},a[0]=b):b=a[0];b=c("useMWXEntryPointDialog")(c("MWChatEncryptedBackupsSettingsDialog.entrypoint"),b);var e=b[0];b=l(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog,g=(i||(i=c("useReStore")))();a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b={entrypoint:c("MWEBEntrypointsKillswitch.enum").EB_SETTINGS},a[1]=b):b=a[1];var j=c("useMWEBBackupState")(b);a[2]!==j||a[3]!==f||a[4]!==e||a[5]!==g?(b=function(){d("MAWEncryptedBackupsStateManager").eligibleForEBUX(j)&&m.onReady(function(a){a=a.fetchBackupMetadata;c("promiseDone")(a(g))}),f(!0),e({})},a[2]=j,a[3]=f,a[4]=e,a[5]=g,a[6]=b):b=a[6];b=b;var p=j===-1||j===1,q;a[7]!==j||a[8]!==p?(q=p?void 0:{auxText:j===3?h._(/*BTDS*/"On"):h._(/*BTDS*/"Off"),type:"text"},a[7]=j,a[8]=p,a[9]=q):q=a[9];a[10]!==b||a[11]!==q?(p=k.jsx(c("MWXMenuItem.react"),{auxItem:q,onClick:b,primaryText:n,role:"button",secondaryText:o,testid:void 0}),a[10]=b,a[11]=q,a[12]=p):p=a[12];return p}g["default"]=a}),226);
__d("MWChatSidebarSettingsE2EEChatsMenu.react",["fbt","MAWSecurityAlertsMenuItem.react","MAWXMAPreviewsSettingsMenuItem.react","MWXDivider.react","MWXMenuItemWithSubmenu.react","cr:3079","cr:6692","cr:6733","cr:7398","cr:8596","cr:8597","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={divider:{marginTop:"x1gslohp",marginBottom:"x12nagc",marginStart:"x1d52u69",marginEnd:"xktsk01",marginLeft:null,marginRight:null,$$css:!0}},l=h._(/*BTDS*/"End-to-end encrypted chats"),m=h._(/*BTDS*/"Manage your end-to-end encrypted chat settings"),n=(f=(e=b("cr:8596"))!=null?e:b("cr:8597"))!=null?f:b("cr:6733");function a(){var a=d("react-compiler-runtime").c(4),e,f,g;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e={title:l},f=n!=null?j.jsx(n,{},"encrypted-backups-comet"):null,g=j.jsx(c("MAWSecurityAlertsMenuItem.react"),{},"security-alerts-after-redesign"),a[0]=e,a[1]=f,a[2]=g):(e=a[0],f=a[1],g=a[2]);a[3]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXMenuItemWithSubmenu.react"),{primaryText:l,secondaryText:m,submenu:{header:e,items:[f,g,j.jsxs(j.Fragment,{children:[j.jsx(c("MWXDivider.react"),{xstyle:k.divider}),j.jsx(c("MAWXMAPreviewsSettingsMenuItem.react"),{})]},"settings-xma-previews"),b("cr:3079")!=null?j.jsx(b("cr:3079"),{},"encrypted-backups-dev-options"):null,b("cr:6692")&&j.jsx(b("cr:6692"),{},"persisted-eb-state-menu"),b("cr:7398")!=null?j.jsx(b("cr:7398"),{},"reset-menu"):null]},testid:void 0}),a[3]=e):e=a[3];return e}g["default"]=a}),226);
__d("MWSupportInboxDialogQuery$Parameters",["MWSupportInboxDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWSupportInboxDialogQuery_facebookRelayOperation"),metadata:{},name:"MWSupportInboxDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWSupportInboxDialog.entrypoint",["JSResourceForInteraction","MWSupportInboxDialogQuery$Parameters","WebPixelRatio"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{options:{fetchPolicy:"network-only"},parameters:c("MWSupportInboxDialogQuery$Parameters"),variables:{scale:d("WebPixelRatio").get()}}}}},root:c("JSResourceForInteraction")("MWSupportInboxDialog.react").__setRef("MWSupportInboxDialog.entrypoint")};g["default"]=a}),98);
__d("XSupportInboxControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/support/",Object.freeze({second:!1,shimmed_in_item:!1}),void 0);b=a;g["default"]=b}),98);
__d("MWSupportInboxMenuItem.react",["fbt","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWSupportInboxDialog.entrypoint","MWXMenuItem.react","MessengerWebUXLogger","QPLUserFlow","XSupportInboxControllerRouteBuilder","gkx","qpl","react","react-compiler-runtime","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;function a(){var a=d("react-compiler-runtime").c(12),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={},a[0]=b):b=a[0];b=c("useMWXEntryPointDialog")(c("MWSupportInboxDialog.entrypoint"),b);var e=b[0];b=k(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog,g=c("MessengerWebUXLogger").useInteractionLogger();a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b={eventName:"support_inbox_entrypoint_impression"},a[1]=b):b=a[1];b=c("MessengerWebUXLogger").useImpressionLoggerRef(b);var i;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(i=c("gkx")("23433")?void 0:c("XSupportInboxControllerRouteBuilder").buildURL({}),a[2]=i):i=a[2];var l;a[3]!==g||a[4]!==f||a[5]!==e?(l=function(){g==null?void 0:g({eventName:"support_inbox_entrypoint_click"}),c("gkx")("23433")&&(c("QPLUserFlow").start(c("qpl")._(25305734,"469")),d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","support_inbox"),f(!0),e({}))},a[3]=g,a[4]=f,a[5]=e,a[6]=l):l=a[6];var m;a[7]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"Reported chats"),a[7]=m):m=a[7];var n;a[8]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._(/*BTDS*/"View updates about your reports"),a[8]=n):n=a[8];a[9]!==b||a[10]!==l?(i=j.jsx(c("MWXMenuItem.react"),{href:i,onClick:l,primaryText:m,ref:b,secondaryText:n}),a[9]=b,a[10]=l,a[11]=i):i=a[11];return i}g["default"]=a}),226);
__d("MWChatSidebarSettingsPrivacyMenu.react",["fbt","MWPBumpEntityKey","MWSupportInboxMenuItem.react","MWXIconMenuItemHouseKeyhole","MWXMenuItemWithSubmenu.react","cr:20183","cr:7253","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(2),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=[],b("cr:7253")!=null&&e.push(j.jsx(b("cr:7253"),{},"settings-e2ee-chats")),b("cr:20183")!=null&&e.push(j.jsx(b("cr:20183"),{},"settings-read-receipts")),e.push(j.jsx(c("MWSupportInboxMenuItem.react"),{},"settings-support-inbox")),a[0]=e):e=a[0];a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXMenuItemWithSubmenu.react"),{icon:c("MWXIconMenuItemHouseKeyhole"),onClick:k,primaryText:h._(/*BTDS*/"Privacy & safety"),submenu:{items:e},testid:void 0}),a[1]=e):e=a[1];return e}function k(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","privacy_submenu")}g["default"]=a}),226);
__d("useMWDropEBDbMenuDialog",["fbt","MAWEncryptedBackupsPersistedDB","promiseDone","react-compiler-runtime","setTimeout","useMWXConfirmationDialog"],(function(a,b,c,d,e,f,g,h){"use strict";function a(){var a=d("react-compiler-runtime").c(3),b=c("useMWXConfirmationDialog")(),e;a[0]===Symbol.for("react.memo_cache_sentinel")?(e=async function(){await d("MAWEncryptedBackupsPersistedDB").deleteEBIDB()},a[0]=e):e=a[0];var f=e;a[1]!==b?(e=function(){return b({body:h._(/*BTDS*/"Confirm deleting persisted state for encrypted backups?"),cancel:h._(/*BTDS*/"Cancel"),confirm:h._(/*BTDS*/"Delete"),title:h._(/*BTDS*/"Clear Messaging Data")},function(){c("promiseDone")(f().then(i))})},a[1]=b,a[2]=e):e=a[2];return e}function i(){c("setTimeout")(j,500)}function j(){window.location.reload()}g.default=a}),226);
__d("MWDropEBDbMenu.react",["cr:5086","react","react-compiler-runtime","useMWDropEBDbMenuDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=d("react-compiler-runtime").c(2),e=c("useMWDropEBDbMenuDialog")(),f;a[0]!==e?(f=b("cr:5086")!=null?i.jsx(b("cr:5086"),{onClick:e,primaryText:"[Fb-only] Clear persisted EB DB"}):null,a[0]=e,a[1]=f):f=a[1];return f}g["default"]=a}),98);
__d("MWEncryptedBackupsFetchBackupMetadata",["LSFactory","LSFetchBackupsMetadataStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.runInTransaction(function(a){return c("LSFetchBackupsMetadataStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":17")}g.fetchBackupMetadata=a}),98);
__d("MWXIconMenuItemFriends",["MWXSvgIcon","SVGIcon","cr:12805","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12805")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWFamilyCenterSuppervisionMenuItem.react",["fbt","MWXIconMenuItemFriends","MWXMenuItem.react","XMessengerFamilyCenterHomeControllerRouteBuilder","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(2),b=c("gkx")("6418");a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=b?h._(/*BTDS*/"Family Center"):h._(/*BTDS*/"Supervision"),a[0]=b):b=a[0];b=b;if(a[1]===Symbol["for"]("react.memo_cache_sentinel")){var e;e=j.jsx(c("MWXMenuItem.react"),{href:(e=c("XMessengerFamilyCenterHomeControllerRouteBuilder").buildUri({}).setSubDomain("familycenter"))==null?void 0:e.toString(),icon:c("MWXIconMenuItemFriends"),primaryText:b,target:"_blank",testid:void 0});a[1]=e}else e=a[1];return e}g["default"]=a}),226);
__d("MWInboxAccessibilitySettingsDialogQuery$Parameters",["MWInboxAccessibilitySettingsDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWInboxAccessibilitySettingsDialogQuery_facebookRelayOperation"),metadata:{},name:"MWInboxAccessibilitySettingsDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWInboxAccessibilitySettingsDialog.entrypoint",["JSResourceForInteraction","MWInboxAccessibilitySettingsDialogQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("MWInboxAccessibilitySettingsDialogQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWInboxAccessibilitySettingsDialog.react").__setRef("MWInboxAccessibilitySettingsDialog.entrypoint")};g["default"]=a}),98);
__d("MWInboxInfoFRXOverflowMenu.react",["fbt","ARIA_LABEL_PLACEHOLDER_FIXME","MWPBumpEntityKey","MWXIconMenuItemAppFacebook","MWXIconMenuItemShieldStar","MWXMenu.react","MWXMenuItem.react","emptyFunction","react","react-compiler-runtime","useMWInboxInfoFRX"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(19),e=a.onClose;a=a.thread;var f;b[0]!==a?(f={entryPoint:"groups_report_to_admin",messagingEntrypoint:"thread_details",onPress:c("emptyFunction"),thread:a},b[0]=a,b[1]=f):f=b[1];var g=c("useMWInboxInfoFRX")(f);b[2]!==a?(f={entryPoint:"report_button",messagingEntrypoint:"thread_details",onPress:c("emptyFunction"),thread:a},b[2]=a,b[3]=f):f=b[3];var i=c("useMWInboxInfoFRX")(f);b[4]!==e||b[5]!==g?(a=function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.infobar","privacy_support_section_something_wrong"),g(),e==null?void 0:e(a)},b[4]=e,b[5]=g,b[6]=a):a=b[6];b[7]===Symbol["for"]("react.memo_cache_sentinel")?(f=h._(/*BTDS*/"Report to admins"),b[7]=f):f=b[7];b[8]!==a?(f=j.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemShieldStar"),onClick:a,primaryText:f}),b[8]=a,b[9]=f):f=b[9];b[10]!==e||b[11]!==i?(a=function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.infobar","privacy_support_section_something_wrong"),i(),e==null?void 0:e(a)},b[10]=e,b[11]=i,b[12]=a):a=b[12];var k;b[13]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"Report to Facebook"),b[13]=k):k=b[13];b[14]!==a?(k=j.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemAppFacebook"),onClick:a,primaryText:k}),b[14]=a,b[15]=k):k=b[15];b[16]!==f||b[17]!==k?(a=j.jsxs(c("MWXMenu.react"),{"aria-label":c("ARIA_LABEL_PLACEHOLDER_FIXME"),withArrow:!0,children:[f,k]}),b[16]=f,b[17]=k,b[18]=a):a=b[18];return a}g["default"]=a}),226);
__d("MWInboxMediaGalleryEBRestoreSyncBanner.react",["fbt","MWXCard.react","MWXRow.react","MWXRowItem.react","MWXSpinner.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={files:"files",links:"links",media:"media"};function a(a){var b=d("react-compiler-runtime").c(3);a=a.contentType;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXSpinner.react"),{color:"blue",size:20})}),b[0]=e):e=b[0];b[1]!==a?(e=j.jsx(c("MWXCard.react"),{background:"card-flat",children:j.jsxs(c("MWXRow.react"),{align:"center",paddingHorizontal:12,paddingVertical:12,verticalAlign:"center",children:[e,j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXText.react"),{align:"center",color:"primary",type:"body4",children:h._(/*BTDS*/"_j{\"media\":\"Syncing media...\",\"files\":\"Syncing files...\",\"links\":\"Syncing links...\"}",[h._enum(k[a],{media:"media",files:"files",links:"links"})])})})]})}),b[1]=a,b[2]=e):e=b[2];return e}g["default"]=a}),226);
__d("MWInboxMediaGalleryEBRestoreUpsell.react",["fbt","MWChatEncryptedBackupsQPLSource.enum","MWEBRestoreUpsellTrigger.react","MWXCard.react","MWXLink.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={files:"files may be",links:"links may be",media:"media may be"};function a(a){var b=d("react-compiler-runtime").c(2),e=a.contentType;b[0]!==e?(a=j.jsx(c("MWEBRestoreUpsellTrigger.react"),{markerPrefix:"MEDIA_GALLERY_RESTORE",qplSource:c("MWChatEncryptedBackupsQPLSource.enum").MEDIA_GALLERY_RESTORE,children:function(a,b){return j.jsx(c("MWXCard.react"),{background:"card-flat",children:j.jsx("div",babelHelpers["extends"]({className:"xyamay9 x1l90r2v x1ye3gou xn6708d"},{ref:b,children:j.jsxs(c("MWXText.react"),{align:"center",color:"primary",type:"body4",children:[h._(/*BTDS*/"_j{\"files may be\":\"Some files may be missing.\",\"links may be\":\"Some links may be missing.\",\"media may be\":\"Some media may be missing.\"}",[h._enum(k[e],{"files may be":"files may be","links may be":"links may be","media may be":"media may be"})])," ",j.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:j.jsx(c("MWXLink.react"),{onClick:a,children:h._(/*BTDS*/"Restore now")})})]})}))})}}),b[0]=e,b[1]=a):a=b[1];return a}g["default"]=a}),226);
__d("MWInboxSecureContentSearchLazy",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("MWInboxSecureContentSearch").__setRef("MWInboxSecureContentSearchLazy");function a(a,b,c,d,e,g){return h.load().then(function(h){return h.addBridgeSearchMsgsToSearchResult(a,b,c,d,e,g)})}g.addBridgeSearchMsgsToSearchResult=a}),98);
__d("MessengerSettingsActionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("120");b=d("FalcoLoggerInternal").create("messenger_settings_action",a);e=b;g["default"]=e}),98);
__d("logMessengerSettingsFalcoEvent",["MessengerSettingsActionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.majorSurface,d=a.minorSurface,e=d===void 0?"NA":d;d=a.target;var f=d===void 0?"button":d;d=a.eventType;var g=d===void 0?"single_click":d;c("MessengerSettingsActionFalcoEvent").log(function(){return{event_type:g,surface:{entry_point:void 0,major_surface:b,minor_surface:e},target:{type:f}}})}g["default"]=a}),98);
__d("MWInboxSettingEditUsernameMenuItem.react",["fbt","MWPActor.react","MWXIconMenuItemText","MWXMenuItem.react","ReQL","ReQLSuspense","logMessengerSettingsFalcoEvent","react","react-compiler-runtime","useMWEditUsernameDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||c("react");function a(){var a=d("react-compiler-runtime").c(12),b=(j||(j=c("useReStore")))(),e=d("MWPActor.react").useActor(),g;a[0]!==e||a[1]!==b.tables.contacts?(g=function(){return d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e)},a[0]=e,a[1]=b.tables.contacts,a[2]=g):g=a[2];var i;a[3]!==e||a[4]!==b?(i=[b,e],a[3]=e,a[4]=b,a[5]=i):i=a[5];var l=d("ReQLSuspense").useFirst(g,i,f.id+":29"),m=c("useMWEditUsernameDialog")();if(l==null)return null;a[6]!==l.username||a[7]!==m?(g=function(){c("logMessengerSettingsFalcoEvent")({majorSurface:"msgr_settings"}),m(l.username,"msgr_settings")},a[6]=l.username,a[7]=m,a[8]=g):g=a[8];a[9]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"Edit username"),a[9]=i):i=a[9];a[10]!==g?(i=k.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemText"),onClick:g,primaryText:i}),a[10]=g,a[11]=i):i=a[11];return i}g["default"]=a}),226);
__d("useCometHomeChatSettingsQuery$Parameters",["useCometHomeChatSettingsQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("useCometHomeChatSettingsQuery_facebookRelayOperation"),metadata:{},name:"useCometHomeChatSettingsQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWInboxSettingsDialog.entrypoint",["JSResourceForInteraction","useCometHomeChatSettingsQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{chatSettingsQueryReference:{parameters:b("useCometHomeChatSettingsQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWInboxSettingsDialogEntrypoint.react").__setRef("MWInboxSettingsDialog.entrypoint")};g["default"]=a}),98);
__d("MWXIconMenuItemAccessibility",["MWXSvgIcon","SVGIcon","cr:12651","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12651")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemDownload",["MWXSvgIcon","SVGIcon","cr:12767","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12767")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemInfoCircle",["MWXSvgIcon","SVGIcon","cr:12824","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12824")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemMessageDots",["MWXSvgIcon","SVGIcon","cr:12849","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12849")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemQuestionCircle",["MWXSvgIcon","SVGIcon","cr:12898","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12898")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemSettings",["MWXSvgIcon","SVGIcon","cr:12921","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12921")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemTextAlignLeft",["MWXSvgIcon","SVGIcon","cr:12947","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:12947")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWInboxSettingsMenu.react",["fbt","CurrentEnvironment","CurrentUser","FDSMenuSeparator.react","FDSSeparatorMenuItem.react","I64","JSResourceForInteraction","LSDataUseConsentState","LSIntEnum","MWChatSidebarSettingsPrivacyMenu.react","MWFacebookUserWithoutMessengerAccess","MWInboxAccessibilitySettingsDialog.entrypoint","MWInboxRestrictedAccountsRouteBuilder","MWInboxSettingEditUsernameMenuItem.react","MWInboxSettingsDialog.entrypoint","MWPBumpEntityKey","MWSeparatorContainer.react","MWXIconMenuItemAccessibility","MWXIconMenuItemBox","MWXIconMenuItemCautionTriangle","MWXIconMenuItemDownload","MWXIconMenuItemInfoCircle","MWXIconMenuItemLeave","MWXIconMenuItemMessageCross","MWXIconMenuItemMessageDots","MWXIconMenuItemQuestionCircle","MWXIconMenuItemSettings","MWXIconMenuItemTextAlignLeft","MWXMenu.react","MWXMenuItem.react","MessageRequestsLog","MessengerMSplitFlag","MetaConfig","ODS","Promise","ReQL","ReQLSuspense","VenusFlytrapLogging","VenusFlytrapLoggingEntrypoint","XMessengerHelpCenterHomeControllerRouteBuilder","cr:19955","cr:4007","cr:4021","cr:494","cr:7484","cr:8035","gkx","openMessengerLogOut","promiseDone","react","useMWXEntryPointDialog","useMWXLazyDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n,o,p=o||d("react");function a(a){return q}function q(){return(n||(n=b("Promise"))).resolve()}var r=(i=b("cr:494"))!=null?i:a;function e(a){a.onClose;var e=a.showHidden,g=a.showMessageRequests,i=a.showRestrictedAccounts,n=(j||(j=c("useReStore")))();a=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(n.tables.epd_cookie_settings)},[n],f.id+":88");var o=c("MetaConfig")._("37"),q=c("useMWXEntryPointDialog")(c("MWInboxSettingsDialog.entrypoint"),{}),s=q[0];q=c("useMWXEntryPointDialog")(c("MWInboxAccessibilitySettingsDialog.entrypoint"),{});var t=q[0],u=b("cr:19955")();q=c("useMWXLazyDialog")(c("JSResourceForInteraction")("MWInboxBugReportDialog.react").__setRef("MWInboxSettingsMenu.react"));var v=q[0];q=p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/help/cookies",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","cookie_policy")},primaryText:h._(/*BTDS*/"Cookie Policy"),target:"_blank",testid:void 0});var w=c("gkx")("24080"),x=p.jsx(c("MWXMenuItem.react"),{href:"https://accountscenter.facebook.com/info_and_permissions/cookie_settings",icon:c("MWXIconMenuItemSettings"),primaryText:h._(/*BTDS*/"Cookie settings"),target:"_blank",testid:void 0});w=w&&a!=null&&!(k||(k=d("I64"))).equal(a.fbTrackersOnOtherCompanies,(l||(l=d("LSIntEnum"))).ofNumber(c("LSDataUseConsentState").UNSET))&&!(k||(k=d("I64"))).equal(a.otherCompanyTrackersOnFoa,(l||(l=d("LSIntEnum"))).ofNumber(c("LSDataUseConsentState").UNSET))&&!c("MessengerMSplitFlag").is_msplit_account?x:q;var y=r(!0);o?a=p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemLeave"),onClick:function(){c("promiseDone")(y().then(function(){return c("openMessengerLogOut")()}));return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","logout")},primaryText:h._(/*BTDS*/"Log out"),testid:void 0}):a=null;x=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess();q=p.jsx(c("MWXMenuItem.react"),{href:o?d("MWInboxRestrictedAccountsRouteBuilder").buildURLWithoutThread():void 0,icon:c("MWXIconMenuItemMessageCross"),onClick:function(){o||i();return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","show_restricted_accounts")},primaryText:h._(/*BTDS*/"Restricted accounts"),testid:void 0});var z=d("CurrentUser").isMessengerOnlyUser()||d("CurrentUser").isDeactivatedAllowedOnMessenger()?p.jsx(c("MWXMenuItem.react"),{href:"https://www.messenger.com/dyi",icon:c("MWXIconMenuItemDownload"),primaryText:h._(/*BTDS*/"Download your information"),target:"_blank"}):null,A=b("cr:4007")==null?void 0:b("cr:4007")();return p.jsxs(c("MWXMenu.react"),{"aria-label":h._(/*BTDS*/"Inbox settings menu"),testid:void 0,truncate:!0,withArrow:!0,children:[b("cr:4021")&&A!=null&&A>0?p.jsx(b("cr:4021"),{value:A}):null,A!=null&&A>0?p.jsx(c("FDSSeparatorMenuItem.react"),{}):null,p.jsxs(c("MWSeparatorContainer.react"),{separator:p.jsx(c("FDSMenuSeparator.react"),{}),children:[p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemSettings"),onClick:function(){s({},function(){});return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","preferences")},primaryText:h._(/*BTDS*/"Preferences"),testid:void 0}),o&&c("gkx")("538")?p.jsx(c("MWInboxSettingEditUsernameMenuItem.react"),{}):null,o?q:p.jsxs("div",{children:[p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemMessageDots"),onClick:function(){d("MessageRequestsLog").logMessageRequestsView(0,-1);d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","message_requests");return g()},primaryText:h._(/*BTDS*/"Message requests"),testid:void 0}),p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemBox"),onClick:function(){e();return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","report_problem")},primaryText:h._(/*BTDS*/"Archived chats"),testid:void 0}),q]}),p.jsxs(p.Fragment,{children:[c("MWChatSidebarSettingsPrivacyMenu.react")&&p.jsx(c("MWChatSidebarSettingsPrivacyMenu.react"),{}),o&&p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemAccessibility"),onClick:function(){return t({},function(){})},primaryText:h._(/*BTDS*/"Accessibility"),testid:void 0})]}),b("cr:7484")&&p.jsx(b("cr:7484"),{}),p.jsxs("div",{children:[p.jsx(c("MWXMenuItem.react"),{href:c("XMessengerHelpCenterHomeControllerRouteBuilder").buildUri({}).toString(),icon:c("MWXIconMenuItemQuestionCircle"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","help")},primaryText:h._(/*BTDS*/"Help"),target:"_blank",testid:void 0}),c("CurrentEnvironment").messengerdotcom?p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemCautionTriangle"),onClick:function(){u!=null?(d("VenusFlytrapLogging").venusFlytrapLoggingStart(c("VenusFlytrapLoggingEntrypoint").TOP_NAVIGATION_SETTINGS),u()):(d("VenusFlytrapLogging").venusFlytrapLoggingStart(c("VenusFlytrapLoggingEntrypoint").TOP_NAVIGATION_SETTINGS),v({initialProduct:"chat"},function(){}));return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","report_problem")},primaryText:h._(/*BTDS*/"Report a problem"),testid:void 0}):null]}),o?p.jsxs(p.Fragment,{children:[p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/policies",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","terms")},primaryText:h._(/*BTDS*/"Terms"),target:"_blank",testid:void 0}),p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/privacy/policy?entry_point=messenger_settings",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","privacy_policy")},primaryText:h._(/*BTDS*/"Privacy Policy"),target:"_blank",testid:void 0}),w,z,d("CurrentUser").isMessengerOnlyUser()?p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/help/messenger-app/ipad/458908261952384?helpref=platform_switcher&rdrhc",icon:c("MWXIconMenuItemInfoCircle"),onClick:function(){(m||(m=d("ODS"))).bumpEntityKey(3185,"inbox_settings","delete_account")},primaryText:h._(/*BTDS*/"Delete your account"),target:"_blank"}):null]}):null,x&&a==null?null:p.jsxs("div",{children:[b("cr:8035")&&p.jsx(b("cr:8035"),{}),a]})]})]})}e.displayName=e.name+" [from "+f.id+"]";g["default"]=e}),226);
__d("MWReadReceiptsMenuItem.react",["fbt","FDSMenuItemCheckbox.react","I64","LSFactory","LSIntEnum","LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure","LSReadReceiptSettingState","MWXMenuItemWithSubmenu.react","MWXText.react","ReadReceiptControlSettingChangedFalcoEvent","promiseDone","react","react-compiler-runtime","useAsyncReStore","useDebouncedOnChange","useMWIsReadReceiptsDisabledForUser"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=i||(i=d("react"));i.useCallback;var m=250;function n(){var a=d("react-compiler-runtime").c(10),b=c("useAsyncReStore")(),e=c("useMWIsReadReceiptsDisabledForUser")(),g;a[0]!==b?(g=function(a){c("promiseDone")(b,function(b){var e=a?(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").DISABLED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").ENABLED);c("ReadReceiptControlSettingChangedFalcoEvent").log(function(){return{is_account_level:!0,setting_enabled:!(k||(k=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").DISABLED))}});c("promiseDone")(b.runInTransaction(function(a){return c("LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure")(c("LSFactory")(a),{readReceiptsDisabled:e})},"readwrite",void 0,void 0,f.id+":50"))})},a[0]=b,a[1]=g):g=a[1];g=g;e=c("useDebouncedOnChange")(e,g,m);var i=e[0],n=e[1];g=!i;a[2]!==n||a[3]!==i?(e=function(){return n(!i)},a[2]=n,a[3]=i,a[4]=e):e=a[4];var o;a[5]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"Show read receipts"),a[5]=o):o=a[5];var p;a[6]===Symbol["for"]("react.memo_cache_sentinel")?(p=l.jsx(c("MWXText.react"),{color:"secondary",type:"body4",children:h._(/*BTDS*/"People wont be able to see when you've read their messages, and you won't be able to see when they've read yours.")}),a[6]=p):p=a[6];a[7]!==g||a[8]!==e?(o=l.jsx(c("FDSMenuItemCheckbox.react"),{asSwitch:!0,isSelected:g,onClick:e,preventClosingMenuOnSelect:!0,primaryText:o,secondaryText:p}),a[7]=g,a[8]=e,a[9]=o):o=a[9];return o}function a(){var a=d("react-compiler-runtime").c(6),b=c("useMWIsReadReceiptsDisabledForUser")(),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"Read receipts"),a[0]=e):e=a[0];var f;a[1]!==b?(f=b?h._(/*BTDS*/"Off"):h._(/*BTDS*/"On"),a[1]=b,a[2]=f):f=a[2];a[3]===Symbol["for"]("react.memo_cache_sentinel")?(b={header:{title:h._(/*BTDS*/"Read receipts")},items:[l.jsx(n,{},"read-receipts")]},a[3]=b):b=a[3];a[4]!==f?(e=l.jsx(c("MWXMenuItemWithSubmenu.react"),{primaryText:e,secondaryText:f,submenu:b}),a[4]=f,a[5]=e):e=a[5];return e}g["default"]=a}),226);
__d("MessengerAccessibilityFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 29c6.075 0 11-4.925 11-11S24.075 7 18 7 7 11.925 7 18s4.925 11 11 11zm0-15c-.941 0-1.75-.652-1.75-2.07 0-1.158.737-1.93 1.75-1.93s1.75.772 1.75 1.93c0 1.418-.809 2.07-1.75 2.07zm6.5 1.797a.797.797 0 0 0-.797-.797H12.297a.797.797 0 0 0-.1 1.587l2.563.32a1 1 0 0 1 .863.828l.255 1.53c.08.483.041.978-.114 1.442l-1.343 4.032a.958.958 0 0 0 1.809.631l1.535-4.207a.25.25 0 0 1 .47 0l1.535 4.207a.958.958 0 0 0 1.81-.631l-1.344-4.032a3.001 3.001 0 0 1-.114-1.442l.255-1.53a1 1 0 0 1 .863-.828l2.562-.32a.797.797 0 0 0 .698-.79z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerFriendsFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{d:"M7.25 12.305C7.25 16.207 9.446 18 12 18s4.75-1.793 4.75-5.695C16.75 9.123 14.75 7 12 7s-4.75 2.123-4.75 5.305zM15.082 21.607c.39-.423.262-1.13-.296-1.269A11.576 11.576 0 0 0 12 20c-4.835 0-9 2.985-9 6.665C3 27.405 3.37 28 4.06 28h7.81c.66 0 1.13-.675 1.13-1.335 0-1.97.83-3.697 2.082-5.058zM19.25 12.305C19.25 16.207 21.446 18 24 18s4.75-1.793 4.75-5.695C28.75 9.123 26.75 7 24 7s-4.75 2.123-4.75 5.305zM33 26.665c0 .74-.37 1.335-1.06 1.335H16.06c-.69 0-1.06-.595-1.06-1.335C15 22.985 19.165 20 24 20s9 2.985 9 6.665z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerHouseKeyholeFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M16.162 7.624a3 3 0 0 1 3.676 0l9.642 7.473a1.342 1.342 0 0 1-.822 2.403H27.25a.25.25 0 0 0-.25.25v8.75a2 2 0 0 1-2 2H11a2 2 0 0 1-2-2v-8.75a.25.25 0 0 0-.25-.25H7.342a1.342 1.342 0 0 1-.822-2.403l9.642-7.473zm3.532 10.852c-.203.14-.314.387-.242.622l1.514 4.932a.75.75 0 0 1-.718.97h-4.497a.75.75 0 0 1-.717-.97l1.514-4.932c.072-.235-.04-.483-.242-.622a3 3 0 1 1 3.388 0z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerTextAlignLeftFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{d:"M8 10a1 1 0 0 0-1 1v.5a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V11a1 1 0 0 0-1-1H8zM7 17.75a1 1 0 0 1 1-1h20a1 1 0 0 1 1 1v.5a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1v-.5zM7 24.5a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v.5a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1v-.5z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerWellbeingUnrestrictFailedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("482");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_failed",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingUnrestrictSucceededFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("483");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_succeeded",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingUnrestrictTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("484");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_tapped",a);e=b;g["default"]=e}),98);
__d("YpMessengerFamilyCenterCoreClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4644");b=d("FalcoLoggerInternal").create("yp_messenger_family_center_core_client_event",a);e=b;g["default"]=e}),98);
__d("YpMessengerFamilyCenterSetupClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4648");b=d("FalcoLoggerInternal").create("yp_messenger_family_center_setup_client_event",a);e=b;g["default"]=e}),98);
__d("YpMessengerTimeLimitClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("6453");b=d("FalcoLoggerInternal").create("yp_messenger_time_limit_client_event",a);e=b;g["default"]=e}),98);
__d("addMAWBridgeSearchMessagesToUniversalSearchLazy",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("addMAWBridgeSearchMessagesToUniversalSearch").__setRef("addMAWBridgeSearchMessagesToUniversalSearchLazy");function a(a,b,c,d,e,f){return h.load().then(function(g){return g(a,b,c,d,e,f)})}g["default"]=a}),98);
__d("checkIsUserOptedOutOfAutoRestore",["I64","LSAuthorityLevel","LSIntEnum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);if(b!=null)return;b=await a;a=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_client_state).filter(function(a){a=a.authorityLevel;return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))});var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.auto_restore_opt_out));a=await d("ReQL").firstAsync(a);var g=c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE,j=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_SET_UP_IN_CURRENT_SESSION);e=e.filter(function(a){return a.optOutKey===g}).length>0;if(!e&&a!=null&&j==null){var k="true";c("promiseDone")(b.runInTransaction(function(a){return a.auto_restore_opt_out.upsert([g],{optOutKey:g,optOutValue:k})},"readwrite","background",void 0,f.id+":73"))}}g.default=a}),98);
__d("mwEBSetBackupState",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.setBackupState;a=a.state;switch(a){case 1:break;case 2:b(2);break;case 3:b(3);break;case 4:b(4);break;case-1:b(-1);break;case 0:break}}f["default"]=a}),66);
__d("mwEBUpdateBackupsTable",["LSFactory","LSUpdateBackupsTableStoredProcedure","LSVec"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.backupIds,d=a.deviceIds,e=a.encryptionManagementDelegatorId,g=a.hasOtcEligibleDevices,h=a.isSuccess,i=a.isUserOptedOut,j=a.storage,k=a.virtualDevices;return j.runInTransaction(function(a){return c("LSUpdateBackupsTableStoredProcedure")(c("LSFactory")(a),{backupIds:b,backupMetadata:c("LSVec").ofArray([]),deviceIds:d,encryptionManagementDelegatorId:e,hasOtcEligibleDevices:g,isSuccess:h,isUserOptedOut:i,virtualDevices:k})},"readwrite",void 0,void 0,f.id+":48")}g["default"]=a}),98);
__d("mwProcessBackupIds",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","WebSession"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k="-1";function l(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+"."),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent})}function m(a){var b=a.clientStateData;a=a.encryptedBackupData;a=a==null?void 0:a.backupId;if(a==null){l("NO_BACKUPS_PRESENT");return 2}if((h||(h=d("I64"))).to_string(a)===k){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}if(b==null||!(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){l("DEVICE_NOT_ONBOARDED");return 4}if(!(h||(h=d("I64"))).equal(b.backupId,a)){l("DEVICE_NOT_ONBOARDED_BACKUP_ID_MISMATCH");return 4}l("DEVICE_ONBOARDED");return 3}function a(a){var b=a.clientStateData;a=a.encryptedBackupData;if(a==null)return 0;var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((j||(j=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"JS",sessionTabId:d("WebSession").getId()}}});if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))){l("FETCH_IN_PROGRESS");return 1}else if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return m({clientStateData:b,encryptedBackupData:a});else{d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR_WRONG_AUTHORITY_LEVEL",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}}g["default"]=a}),98);
__d("useMWChatDisplayEncryptedBackupsRestoreToast",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","ReQLSuspense","react","react-compiler-runtime","useMAWEncryptedBackupsRestoreToast","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useState;function a(){var a=d("react-compiler-runtime").c(10),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.encrypted_backups_client_restore_status?(e=function(){return d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status)},a[0]=b.tables.encrypted_backups_client_restore_status,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];var i=d("ReQLSuspense").useArray(e,g,f.id+":27");e=c("useMAWEncryptedBackupsRestoreToast")();var j=e.showInProgressToast,k=e.showSuccessToast;g=m(!1);var o=g[0],p=g[1];a[4]!==o||a[5]!==i||a[6]!==j||a[7]!==k?(e=function(){var a=i.some(n);o&&!a?(p(!1),k()):!o&&a&&(p(!0),j())},g=[o,i,j,k],a[4]=o,a[5]=i,a[6]=j,a[7]=k,a[8]=e,a[9]=g):(e=a[8],g=a[9]);l(e,g)}function n(a){a=a.restoreStatus;return a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS))}g["default"]=a}),98);
__d("useMWChatEncryptedBackupsAutoRestore",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsAddDeviceWithEBKeys","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ReQL","ReQLSuspense","react","react-compiler-runtime","useLabyrinthLogging","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useRef,n=b.useState;function a(){var a=d("react-compiler-runtime").c(21),b=c("MWChatEncryptedBackupsQPLSource.enum").AUTO_RESTORE,e=n(!0),g=e[0],i=e[1],j=(h||(h=c("useReStore")))();e=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var k=e.startFlow,p;a[0]!==g||a[1]!==j?(e=function(){return g?d("ReQL").fromTableAscending(j.tables.secure_encrypted_backups_epochs):d("ReQL").empty()},p=[g,j],a[0]=g,a[1]=j,a[2]=e,a[3]=p):(e=a[2],p=a[3]);var q=d("ReQLSuspense").useFirst(e,p,f.id+":42");a[4]!==g||a[5]!==j?(e=function(){return g?d("ReQL").fromTableAscending(j.tables.secure_encrypted_backups_client_state).filter(o):d("ReQL").empty()},p=[g,j],a[4]=g,a[5]=j,a[6]=e,a[7]=p):(e=a[6],p=a[7]);var r=d("ReQLSuspense").useFirst(e,p,f.id+":49");a[8]===Symbol["for"]("react.memo_cache_sentinel")?(e={entrypoint:c("MWEBEntrypointsKillswitch.enum").AUTO_RESTORE},a[8]=e):e=a[8];var s=c("useMWEBBackupState")(e);a[9]!==g||a[10]!==j?(p=function(){return g?d("ReQL").fromTableAscending(j.tables.experiences_shared_state):d("ReQL").empty()},e=[g,j],a[9]=g,a[10]=j,a[11]=p,a[12]=e):(p=a[11],e=a[12]);var t=d("ReQLSuspense").useArray(p,e,f.id+":66"),u=m(!1);a[13]!==s||a[14]!==r||a[15]!==q||a[16]!==t||a[17]!==k||a[18]!==j?(p=function(){if(u.current||s===1||s===0)return;if(s===3){var a=r==null?void 0:r.deviceId,e=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:"auto_restored"}),f=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}),g=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:j,sharedStateTable:t,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY});e=e||f||g;f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(!e&&f!==""&&r!=null&&q!=null&&a!=null){d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);k({additionalAnnotations:{device_type:"auto_restore"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH,source:b});g=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();k({additionalAnnotations:{eb_session_identifier:g,restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:b});e={backupId:r.backupId,db:j,newDeviceRegistrationId:f,previousDeviceId:a};d("MWChatEncryptedBackupsAddDeviceWithEBKeys").addDeviceWithEBKeys(e)}}u.current=!0;i(!1)},e=[s,r,q,t,b,k,j],a[13]=s,a[14]=r,a[15]=q,a[16]=t,a[17]=k,a[18]=j,a[19]=p,a[20]=e):(p=a[19],e=a[20]);l(p,e)}function o(a){a=a.authorityLevel;return(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g["default"]=a}),98);
__d("useMWEBListenForChangesToBackupStateXDevice",["I64","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useEffect,l=b.useRef;function a(a){var b=d("react-compiler-runtime").c(8),e=(h||(h=c("useReStore")))(),g;b[0]!==e.tables.encrypted_backups_status_trigger?(g=function(){return d("ReQL").fromTableAscending(e.tables.encrypted_backups_status_trigger)},b[0]=e.tables.encrypted_backups_status_trigger,b[1]=g):g=b[1];var j;b[2]!==e?(j=[e],b[2]=e,b[3]=j):j=b[3];var m=d("ReQLSuspense").useFirst(g,j,f.id+":27"),n=l(null);b[4]!==m||b[5]!==a?(g=function(){m!=null&&n.current!==m.pk&&!(i||(i=d("I64"))).equal(m.pk,(i||(i=d("I64"))).of_float(0))&&(n.current=m.pk,a())},j=[m,a],b[4]=m,b[5]=a,b[6]=g,b[7]=j):(g=b[6],j=b[7]);k(g,j)}g["default"]=a}),98);
__d("useMWEBPropagateEbStateChangesThroughRelay",["CometRelay","FBLogger","MAWLoggerDeferred","MAWStateContext.react","ReQL","ReQLSuspense","gkx","promiseDone","react","requireDeferred","useMAWHasUserVisibleErrors","useMAWUnsupportedBrowserNUX","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][useMWEBPropagateEbStateChangesThroughRelay] update: ",""]);j=function(){return a};return a}b=i||d("react");var k=b.useCallback,l=b.useEffect,m=c("requireDeferred")("mwEBSetBackupState").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),n=c("requireDeferred")("mwProcessBackupIds").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),o=c("gkx")("12414");function a(a){var b=a.listenForChangesToBackupState,e=(h||(h=c("useReStore")))(),g=d("CometRelay").useRelayEnvironment(),i=d("ReQLSuspense").useFirst(function(){return b&&!o?d("ReQL").fromTableAscending(e.tables.encrypted_backups):d("ReQL").empty()},[e,b],f.id+":46"),p=d("ReQLSuspense").useFirst(function(){return b&&!o?d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state):d("ReQL").empty()},[e,b],f.id+":53"),q=d("MAWStateContext.react").useMAWSelector(function(a){return o?a.ebState:null}),r=k(function(a){void d("MAWLoggerDeferred").LOG(j(),a),d("CometRelay").commitLocalUpdate(g,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][backup_state] A viewer record does not exist when propagating EB state.");return}b.setValue(a,"backup_state")})},[g]);a=d("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX();a=a.shouldHideEBFlow;var s=c("useMAWHasUserVisibleErrors")(),t=a||s;l(function(){async function a(){var a=q;a==null&&((i!=null||p!=null)&&(a=t?0:(await n.load())({clientStateData:p,encryptedBackupData:i})));a!=null&&(await m.load())({setBackupState:r,state:a})}c("promiseDone")(a())},[p,e,i,g,t,r,q])}g.default=a}),98);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23961239003493663"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql")}},name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24212800704976633"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2Query",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2",["Base64Utils","CometRelay","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsListenForChangesToBackupStateInitPath","Promise","QPLEvent","QPLUserFlow","WebSession","cr:6666","promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore","useMWEBListenForChangesToBackupStateXDevice","useMWEBPropagateEbStateChangesThroughRelay","useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql","useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;e=k||d("react");var o=e.useEffect,p=e.useRef,q=e.useState,r=c("requireDeferred")("mwEBUpdateBackupsTable").__setRef("useMWEncryptedBackupsFetchBackupIdsV2");function s(a){if(a!=null){a=a;a=c("LSEncryptedBackupsOnboardingDecision")[a];return a}return void 0}function t(a){if(a!=null){a=a;a=c("LSEncryptedBackupsBackupTenancy")[a];return(l||(l=d("LSIntEnum"))).ofNumber(a)}return void 0}function u(a){var e=a.data,f=a.dbPromise,g=a.isInitalLoad,h=a.setListenForChangesToBackupState,i=e.xfb_backup,k=i==null?void 0:i.id;if(i!=null&&k!=null){g.current===!0&&b("cr:6666")!=null&&c("promiseDone")(b("cr:6666")(f));var m=!1;(i==null?void 0:i.has_otc_eligible_devices)!=null?m=i==null?void 0:i.has_otc_eligible_devices:c("FBLogger")("labyrinth_web").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var o=c("LSVec").ofArray([d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),backup_tenancy:t(i.backup_tenancy)})]),p=[];i.virtual_devices.forEach(function(a){var b,e=a.client_generated_id;if(k==null||e==null||a.device_type==null){c("FBLogger")("labyrinth_web").warn("Invalid virtual device fetched in fetchBackupsIdsV2.");return}var f="REQUIRES_MIGRATION";f=a.migration_status===f;var g=a.device_type;g=c("LSEncryptedBackupsVirtualDeviceType")[g];p.push(d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),virtual_device_ids:c("LSVec").ofArray([d("LSShape").ofRecord({virtual_device_id:d("Base64Utils").toArrayBuffer(e)})]),virtual_devices:c("LSVec").ofArray([d("LSShape").ofRecord({creation_time:(b=a.creation_time)!=null?b:void 0,device_created_on:(b=a.device_created_on)!=null?b:void 0,requires_hsm_migration:f,virtual_device_id:d("Base64Utils").toArrayBuffer(e),virtual_device_type:(l||(l=d("LSIntEnum"))).ofNumber(g)})])}))});var q=[];(a=i.devices)==null?void 0:a.edges.forEach(function(a){var b;if(((b=a.node)==null?void 0:b.id)==null)return;q.push(d("LSShape").ofRecord({device_id:(n||(n=d("I64"))).of_string((b=a.node)==null?void 0:b.id)}))});var u=i.encryption_management_delegator_id!=null?(n||(n=d("I64"))).of_string(i.encryption_management_delegator_id):void 0;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0],d=a[1];c("promiseDone")(b({backupIds:o,deviceIds:c("LSVec").ofArray(q),encryptionManagementDelegatorId:u,hasOtcEligibleDevices:m,isSuccess:!0,isUserOptedOut:(a=i.is_user_opted_out)!=null?a:void 0,storage:d,virtualDevices:c("LSVec").ofArray(p)}),function(){h(!0),g.current===!0&&(g.current=!1,c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").preloadEBData(d))})})}else{var v=s((a=e.xfb_eb_user_preferences)==null?void 0:a.onboarding_decision)===c("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0];a=a[1];c("promiseDone")(b({backupIds:c("LSVec").ofArray([]),deviceIds:c("LSVec").ofArray([]),hasOtcEligibleDevices:!1,isSuccess:!0,isUserOptedOut:v,storage:a,virtualDevices:c("LSVec").ofArray([])}),function(){h(!0)})})}}function v(a){var e=d("react-compiler-runtime").c(9),f=c("useAsyncReStore")(),g=p(!0),i=p(!1),j=q(!1),k=j[0],l=j[1];j=d("CometRelay").useRefetchableFragment(h!==void 0?h:h=b("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql"),a);var n=j[0],r=j[1];e[0]!==k?(a={listenForChangesToBackupState:k},e[0]=k,e[1]=a):a=e[1];c("useMWEBPropagateEbStateChangesThroughRelay")(a);e[2]!==n||e[3]!==r?(j=function(){var a=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:a,fetchBackupIdsVersion:"GQL",sessionTabId:d("WebSession").getId()}}});r({},{fetchPolicy:"network-only",onComplete:function(a){i.current=!1;if(c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent)))if(a!=null)d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{error:a.message,error_stack:a.stack}},errorName:"fetch_backup_ids_error",event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent});else{d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{isUserOptedOut:(a=n.xfb_backup)==null?void 0:a.is_user_opted_out},string:{backup_id:(a=(a=n.xfb_backup)==null?void 0:a.id)!=null?a:"null"}},event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})}}})},e[2]=n,e[3]=r,e[4]=j):j=e[4];k=j;c("useMWEBListenForChangesToBackupStateXDevice")(k);e[5]!==n||e[6]!==f?(a=function(){if(i.current===!0)return;i.current=!0;u({data:n,dbPromise:f,isInitalLoad:g,setListenForChangesToBackupState:l})},j=[n,f],e[5]=n,e[6]=f,e[7]=a,e[8]=j):(a=e[7],j=e[8]);o(a,j)}function a(){var a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"),{});v(a)}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("LSCleanupSession",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][cleanupSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[1],c.i64.cast([0,0]))?d[2]=c.i64.cast([0,21]):(c.i64.eq(a[1],c.i64.cast([0,1]))?d[10]=c.i64.cast([0,20]):d[10]=c.i64.cast([0,20]),d[2]=d[10]),c.filter(c.db.table(258).fetch(),function(b){return(b.initiatorId===a[0]||b.responderId===a[0])&&c.i64.eq(b.clientType,a[2])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.clientType,a[2])}).next().then(function(f,h){var e=f.done;f=f.value;return e?c.db.table(258).add({sessionId:c.i64.cast([-1,4294967295]),responderId:a[0],initiatorId:a[0],messageType:d[2],clientType:a[2]}):(h=f.item,c.sequence([function(a){return d[19]=h.sessionId,d[20]=h.responderId,d[21]=h.initiatorId,d[17]=h.responderUserId,d[18]=h.initiatorUserId,c.forEach(c.db.table(258).fetch([[[d[19]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return a[0]===d[21]?(c.i64.eq(a[2],c.i64.cast([0,1]))?d[22]=d[17]:d[22]=void 0,d[11]=d[22]):(a[0]===d[20]?(c.i64.eq(a[2],c.i64.cast([0,1]))?d[23]=d[18]:d[23]=void 0,d[22]=d[23]):d[22]=void 0,d[11]=d[22]),c.i64.eq(a[2],c.i64.cast([0,1]))?d[12]=d[17]:d[12]=void 0,c.i64.eq(a[2],c.i64.cast([0,1]))?d[13]=d[18]:d[13]=void 0,d[14]=new c.Map(),d[14].set("session_id",d[19]),d[14].set("responder_id",d[20]),d[14].set("initiator_id",d[21]),d[14].set("message_payload",h.messagePayload),d[14].set("pake_secret",h.pakeSecret),d[14].set("sender_id",a[0]),d[14].set("message_type",d[2]),d[14].set("client_type",a[2]),d[14].set("message_recipient_id",d[11]),d[14].set("initiator_user_id",d[13]),d[14].set("responder_user_id",d[12]),d[15]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[15],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})}]))}):(f=e.item,d[13]=f.sessionId,d[14]=f.responderId,d[15]=f.initiatorId,d[10]=f.messageType,d[11]=f.responderUserId,d[12]=f.initiatorUserId,c.i64.eq(d[10],c.i64.cast([0,15]))||c.i64.eq(d[10],c.i64.cast([0,21]))||c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(0):c.sequence([function(a){return c.forEach(c.db.table(258).fetch([[[d[13]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return a[0]===d[15]?(c.i64.eq(a[2],c.i64.cast([0,1]))?d[22]=d[11]:d[22]=void 0,d[16]=d[22]):(a[0]===d[14]?(c.i64.eq(a[2],c.i64.cast([0,1]))?d[23]=d[12]:d[23]=void 0,d[22]=d[23]):d[22]=void 0,d[16]=d[22]),c.i64.eq(a[2],c.i64.cast([0,1]))?d[17]=d[11]:d[17]=void 0,c.i64.eq(a[2],c.i64.cast([0,1]))?d[18]=d[12]:d[18]=void 0,d[19]=new c.Map(),d[19].set("session_id",d[13]),d[19].set("responder_id",d[14]),d[19].set("initiator_id",d[15]),d[19].set("message_payload",f.messagePayload),d[19].set("pake_secret",f.pakeSecret),d[19].set("sender_id",a[0]),d[19].set("message_type",d[2]),d[19].set("client_type",a[2]),d[19].set("message_recipient_id",d[16]),d[19].set("initiator_user_id",d[18]),d[19].set("responder_user_id",d[17]),d[20]=c.toJSON(d[19]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[20],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][cleanupSession] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"cleanupSession",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesCleanupSessionStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSCleanupSessionStoredProcedure",["LSCleanupSession","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCleanupSession"),e.deviceId,e.cleanupReason,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("CleanupPakeSession",["LSCleanupSessionStoredProcedure","LSFactory","LSIntEnum","MAWOneTimeCodeGating","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=a.cleanupReason,g=a.clientType,j=a.deviceId;a=a.storage;return!d("MAWOneTimeCodeGating").isOneTimeCodeEnabled()?(i||(i=b("Promise"))).resolve():a.runInTransaction(function(a){return c("LSCleanupSessionStoredProcedure")(c("LSFactory")(a),{cleanupReason:(h||(h=d("LSIntEnum"))).ofNumber(e),clientType:h.ofNumber(g),deviceId:j})},"readwrite",void 0,void 0,f.id+":41")}g["default"]=a}),98);
__d("E2EEBackupSecretRestoreModule",["E2EEBackupCommon","QuickPerformanceLogger","VestaClient","VestaClientError","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(235874858,"168");async function a(a,b,e){(h||(h=c("QuickPerformanceLogger"))).markerStart(i);h.markerAnnotate(i,{string:{product_use_case:b.productUseCase}});try{var f=await a.initLogin({clientId:b.clientId,productUseCase:b.productUseCase},e),g=f.islandRsaPub,j=f.islandRsaPubSig,k=f.islandEd25519Pub,l=f.islandEd25519PubSig;f=f.isRegistered;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"init_login_network_call");if(!f){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"NOT_REGISTERED"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NOT_REGISTERED)}f=await Promise.all([d("VestaClient").validateHsmKey(g,j),d("VestaClient").validateHsmKey(k,l)]);g=f[0];j=f[1];if(!g){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"ISLAND_PUB_RSA_KEY_INVALID"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_RSA_KEY_INVALID)}if(!j){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"ISLAND_PUB_ED25519_KEY_INVALID"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_ED25519_KEY_INVALID)}h.markerPoint(i,"verify_island_rsa_key");h.markerPoint(i,"verify_island_ed25519_key");l=b.vestaAccountPin;if(l==null)throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.MISSING_PIN_INPUT);else{f=new TextEncoder();g=await d("VestaClient").beginLogin(f.encode(l));j=g.clientState;f=g.l1Message;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"begin_login_vesta_client");l=await a.beginLogin({clientId:b.clientId,productUseCase:b.productUseCase,opaqueL1:f},e);g=l.opaqueL2;f=l.opaqueL2Sig;h.markerPoint(i,"begin_login_network_call");l=await d("VestaClient").finishLogin(g,f,k,j);g=l.exportKey;f=l.l3Message;k=l.sessionKey;h.markerPoint(i,"finish_login_vesta_client");j=await a.finishLogin({clientId:b.clientId,productUseCase:b.productUseCase,opaqueL3:f},e);l=j.loginSuccess;a=j.loginPayload;h.markerPoint(i,"finish_login_network_call");if(!l){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"VESTA_SERVER_ERROR"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}if(a!=null){b=await d("VestaClient").unpackLoginPayload(a,k,g);f=b.userSecret;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"unpack_login_payload");h.markerEnd(i,2);return f}h.markerAnnotate(i,{string:{failure_reason:"VESTA_SERVER_ERROR"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}}catch(a){if(a instanceof d("E2EEBackupCommon").BackupError)throw a;else if(a instanceof c("VestaClientError")){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"VestaClientException: "+a.name}});h.markerEnd(i,3);if(a.name==="InvalidUserPassword")throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD,a);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_CLIENT_ERROR,a)}else{(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:a.message}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NETWORK_PROVIDER_ERROR,a)}}}g.restoreBackupSecret=a}),98);
__d("FDSAppFacebookCircleFilled20Icon",["cr:14302"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:14302")}),98);
__d("FDSAppFacebookCircleFilled20PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("869051"),20);b=a;g["default"]=b}),98);
__d("FDSTextFilled20Icon",["cr:15777"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:15777")}),98);
__d("FDSTextFilled20PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("486064"),20);b=a;g["default"]=b}),98);
__d("MWPakeQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(231349365,"1751");g.pakeInitiatorQplEvent=a}),98);
__d("PAKEMessageQplLoggingAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});f["default"]=a}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){a=(i||(i=d("I64"))).to_int32(g);switch(a){case c("PAKEMessageQplLoggingAction").ADD_MARKER:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding DS PAKE marker."):c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_FAILURE:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):c("QPLUserFlow").endFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_SUCCESS:c("QPLUserFlow").endSuccess(d("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case c("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:j==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{"int":{errorCode:(i||(i=d("I64"))).to_int32(j)}});break}return(h||(h=b("Promise"))).resolve()};a.__nop_name__="LSQplInteractionHelper";g["default"]=a}),98);
__d("LSDecryptPakeSecret",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptPakeSecret] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NO_SESSION_ONGOING_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[12]="PAKE: Failed to decrypt PAKE secrets as no session was ongoing.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[12]].join("")),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[12]].join(""),d[13],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(e){return d[13]=f.responderId,d[14]=f.initiatorId,d[15]=f.pakeSecret,d[13]!==void 0?c.sequence([function(e){return d[14]!==void 0?c.sequence([function(e){return d[15]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_GENERATE_PAKE_AAD_START",c.i64.cast([0,0]),void 0)},function(a){return d[20]="_",c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[1],c.blobs.of_string(["v1",d[20],c.i64.to_string(a[0]),d[20],d[13],d[20],d[14],d[20],c.i64.to_string(f.clientType)].join("")),d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(e){return d[21]!==void 0?c.resolve((e=[d[21],c.i64.cast([0,0])],d[22]=e[0],d[23]=e[1],e)):c.sequence([function(a){return d[25]="PAKE: Failed to decrypt PAKE secrets as key was incorrect.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,10]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,10]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,10])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[25]].join("")),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[25]].join(""),d[26],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967295])],d[22]=a[0],d[23]=a[1],a}])},function(a){return a=[d[22],d[23]],d[18]=a[0],d[19]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_PAKE_SECRET_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[21]="PAKE: Failed to decrypt PAKE secrets as there was no secret to decrypt.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[21]].join("")),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[21]].join(""),d[22],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[18]=a[0],d[19]=a[1],a}])},function(a){return a=[d[18],d[19]],d[16]=a[0],d[17]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_INITIATOR_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[19]="PAKE: Failed to decrypt PAKE secrets as initiator id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[19]].join("")),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[19]].join(""),d[20],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[16]=a[0],d[17]=a[1],a}])},function(a){return a=[d[16],d[17]],d[11]=a[0],d[12]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[17]="PAKE: Failed to decrypt PAKE secrets as responder id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[17]].join("")),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[17]].join(""),d[18],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[11]=a[0],d[12]=a[1],a}])},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptPakeSecret] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptPakeSecret",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesDecryptPakeSecretStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSDecryptPakeSecretStoredProcedure",["LSDecryptPakeSecret","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptPakeSecret"),e.sessionId,e.encryptionKey,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1434]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[8]?d[9]=!0:d[9]=!1,d[9]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[11]].join("")),d[10]=c.createArray(),void 0!==void 0?d[12]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[11],d[10],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.storedProcedure(b("LSDeleteBackupOnClient"),d.backupId,void 0,!1,void 0,"null",!0))})},function(e){return d[8]=a[0].get("backup_id"),c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(e){return d[9]!==void 0?c.sequence([function(a){return d[11]=d[9].get("device_key"),d[12]=d[9].get("epoch_storage_key"),d[13]=d[9].get("epoch_auth_key"),d[14]=d[11].get("device_private_key"),d[15]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[44]=(d[15].push(c.i64.cast([0,0])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[44]=(d[15].push(c.i64.cast([0,2])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[44]=(d[15].push(c.i64.cast([0,3])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[44]=(d[15].push(c.i64.cast([0,4])),d[15]):0,d[20]="",d[21]=c.i64.of_int32(d[15].length),c.i64.gt(d[21],c.i64.cast([0,0]))?c.loopAsync(d[21],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[20]=[d[20],"_",c.i64.to_string(d[45])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[20],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[14],c.blob("Mg=="),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.blobs.neq(d[23],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[24]=d[44]}]):c.resolve(d[24]=void 0)},function(e){return d[25]=a[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return a=[d[26],d[27],d[44],d[45]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.resolve((a=[d[26],d[27],void 0,void 0],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a))},function(b){return d[32]=d[11].get("device_public_key"),d[33]=d[11].get("device_private_key"),d[34]=d[12].get("epoch_storage_public_key"),d[35]=d[12].get("epoch_storage_private_key"),d[36]=d[13].get("epoch_auth_public_key"),d[37]=d[13].get("epoch_auth_private_key"),d[38]=a[0].get("mailbox_root_key"),d[39]=a[0].get("oblivious_validation_token"),c.forEach(c.filter(c.db.table(168).fetch([[[d[8]]]]),function(a){return c.i64.eq(a.backupId,d[8])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[8],devicePublicKeyBlob:d[32],devicePrivateKeyBlob:d[33],epochStoragePublicKeyBlob:d[34],epochStoragePrivateKeyBlob:d[35],epochAuthPublicKeyBlob:d[36],epochAuthPrivateKeyBlob:d[37],mailboxRootKeyBlob:d[38],ocmfClientStateBlob:d[28],obliviousValidationTokenBlob:d[39],authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1]),revisionVersion:c.i64.cast([0,1]),encryptionVersion:c.i64.cast([0,0])})},function(e){return d[40]=a[0].get("add_peer_epoch_data"),d[41]=c.i64.of_int32(d[40].length),c.i64.gt(d[41],c.i64.cast([0,0]))?c.loopAsync(d[41],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[45].get("epoch_id"),d[48]=d[45].get("epoch_anon_id"),d[49]=d[45].get("epoch_root_key"),d[50]=d[45].get("epoch_status"),c.forEach(c.filter(c.db.table(169).fetch([[[d[47]]]]),function(a){return c.i64.eq(a.epochId,d[47])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[47],authorityLevel:c.i64.cast([0,80]),backupId:d[8],epochAnonIdBlob:d[48],epochRootKeyBlob:d[49],epochStatus:d[50]})}])}):c.resolve()},function(a){return c.count(c.db.table(169).fetch()).then(function(a){return d[42]=a})},function(a){return c.i64.le(d[42],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch().next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[46]="No epoch available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[46]].join("")),d[47]=c.createArray(),void 0!==void 0?d[48]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[46]].join(""),d[47],c.i64.cast([0,3]))},function(a){return d[44]=void 0}]):(e=a.item,d[46]=new c.Map(),d[46].set("epoch_id",e.epochId),d[46].set("backup_id",e.backupId),d[46].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[46].set("epoch_root_key_blob",e.epochRootKeyBlob),d[46].set("epoch_status",e.epochStatus),d[46].set("epoch_head",e.epochHead),d[46].set("authority_level",e.authorityLevel),d[44]=d[46])})},function(a){return d[43]=d[44]}]):c.sequence([function(a){return d[44]="Multiple epochs available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[44]].join("")),d[45]=c.createArray(),void 0!==void 0?d[46]=(d[45].push(void 0),d[45]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[44]].join(""),d[45],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(e){return d[43]!==void 0?c.sequence([function(a){return d[44]=d[43].get("epoch_anon_id_blob"),d[45]=d[43].get("epoch_root_key_blob"),d[46]=d[11].get("device_public_key"),d[47]=c.createArray(),d[51]=(d[47].push(c.i64.cast([0,32])),d[47]),c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[48]].join("")),void 0,d[45],d[47]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[52]=!1:d[52]=!0,d[52]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[55]].join("")),d[54]=c.createArray(),void 0!==void 0?d[57]=(d[54].push(void 0),d[54]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[55],d[54],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[53]=d[56]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],c.i64.cast([0,0])).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[53]=d[54]}])},function(a){return d[49]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[54]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[52],d[51],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[49]=d[53]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[49],d[46]).then(function(a){return a=a,d[50]=a[0],a})},function(e){return c.blobs.neq(d[50],void 0)?c.sequence([function(a){return d[51]=d[11].get("device_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[54]=d[43].get("epoch_root_key_blob"),c.blobs.neq(d[54],void 0)?c.sequence([function(a){return d[81]=c.createArray(),d[87]=(d[81].push(c.i64.cast([0,18])),d[81]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[54],d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]!==void 0?c.sequence([function(a){return d[87]=c.i64.of_int32(d[82].length),c.i64.ge(d[87],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[82],c.i64.cast([0,0])).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[88]=d[89]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[90]].join("")),d[89]=c.createArray(),void 0!==void 0?d[91]=(d[89].push(void 0),d[89]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[90],d[89],c.i64.cast([0,3]))},function(a){return d[88]=void 0}])},function(a){return d[83]=d[88]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[88]].join("")),d[87]=c.createArray(),void 0!==void 0?d[89]=(d[87].push(void 0),d[87]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[88],d[87],c.i64.cast([0,3]))},function(a){return d[83]=void 0}])},function(a){return c.blobs.neq(d[83],void 0)?d[84]=!0:d[84]=!1,d[84]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[83]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]!==void 0?d[86]=d[85]:d[86]="encodingfailed",d[55]=d[86]}]):c.resolve(d[55]="null")},function(a){return d[56]=d[12].get("epoch_storage_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[58]=d[9].get("epoch_storage_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[60]=d[13].get("epoch_auth_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[62]=d[9].get("epoch_auth_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[63]=a[0],a})},function(e){return d[64]=d[11].get("device_private_key"),d[65]=a[0].get("mailbox_root_key"),d[66]=d[12].get("epoch_storage_private_key"),c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"private_key",d[64],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[67]=d[83]}]):c.resolve(d[67]=void 0)},function(a){return c.blobs.neq(d[67],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[67]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[68]=d[81]}]):c.resolve(d[68]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"ocmf_client_state",d[28],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[69]=d[83]}]):c.resolve(d[69]=void 0)},function(a){return c.blobs.neq(d[69],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[69]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[70]=d[81]}]):c.resolve(d[70]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"epoch_storage_private_key",d[66],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[71]=d[83]}]):c.resolve(d[71]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[72]=d[81]}]):c.resolve(d[72]=void 0)},function(e){return d[73]=a[0].get("backup_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[74]=a[0],a})},function(e){return d[75]=a[0].get("server_data_id"),d[76]=d[43].get("epoch_id"),d[77]=new c.Map(),d[77].set("supported_encryption_versions",d[15]),d[77].set("client_version",c.i64.cast([0,1])),d[77].set("version_sig",d[24]==null?"":d[24]),d[78]=new c.Map(),d[78].set("backup_id",d[73]),d[78].set("device_epoch_hmac",d[53]==null?"":d[53]),d[78].set("epoch_root_key_fingerprint",d[55]),d[78].set("device_public_key",d[52]==null?"":d[52]),d[78].set("epoch_auth_pubkey",d[61]==null?"":d[61]),d[78].set("epoch_auth_pubkey_sig",d[63]==null?"":d[63]),d[78].set("epoch_storage_pubkey",d[57]==null?"":d[57]),d[78].set("epoch_storage_pubkey_sig",d[59]==null?"":d[59]),d[78].set("ocmf_rotation_token",d[74]==null?"":d[74]),d[78].set("server_data_id",d[75]),d[78].set("device_registration_id",a[1]),d[78].set("base_epoch_id",d[76]),d[78].set("encryption_version_data",d[77]),d[78].set("private_key_debug_token",d[68]),d[78].set("ocmf_client_state_debug_token",d[70]),d[78].set("epoch_storage_pvtkey_debug_token",d[72]),d[78].set("trace_id",void 0),d[78].set("occam_only_eligible",!0),d[79]=c.toJSON(d[78]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50017]),d[79],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),d[51]=c.createArray(),void 0!==void 0?d[52]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",d[51],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),d[44]=c.createArray(),void 0!==void 0?d[45]=(d[44].push(void 0),d[44]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",d[44],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",d[11],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):(e.item,d[8]="An authoritative row already exists, aborting execution of add peer device",d[8]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[8]].join("")),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",d[8],d[9],c.i64.cast([0,3]))):c.resolve())})},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",c.i64.cast([0,0]),void 0)},function(a){return d[1]=d[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSBase64Decode.nop"),d[1]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=d[0].get("mailbox_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[0].get("oblivious_validation_token"),c.nativeOperation(b("LSBase64Decode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=c.createArray(),d[8]=d[0].get("add_peer_epoch_data_serializable"),d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[15].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Decode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[15].get("epoch_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[15].get("epoch_id"),d[22]=d[15].get("epoch_status"),d[23]=new c.Map(),d[23].set("epoch_id",d[21]),d[23].set("epoch_anon_id",d[18]==null?c.blob(""):d[18]),d[23].set("epoch_root_key",d[20]==null?c.blob(""):d[20]),d[23].set("epoch_status",d[22]),d[24]=(d[7].push(d[23]),d[7])}])}):c.resolve()},function(e){return d[10]=d[0].get("backup_id"),d[11]=d[0].get("server_data_id"),d[12]=new c.Map(),d[12].set("backup_id",d[10]),d[12].set("server_data_id",d[11]),d[12].set("temp_ocmf_client_state",d[2]==null?c.blob(""):d[2]),d[12].set("mailbox_root_key",d[4]==null?c.blob(""):d[4]),d[12].set("oblivious_validation_token",d[6]==null?c.blob(""):d[6]),d[12].set("add_peer_epoch_data",d[7]),d[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSFinishAddPeerDevice"),d[12],a[1])},function(a){return d[13]=!0}]):c.resolve(d[13]=!1)},function(a){return e[0]=d[13]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeserializeSecretsAndAddDevice"),e.serializedPayload,e.deviceRegistrationId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetActiveSession",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getActiveSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.count(c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15]),c.i64.cast([0,23])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))})).then(function(a){return d[2]=a})},function(e){return c.i64.le(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15]),c.i64.cast([0,23])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,17]))},function(a){return a=[c.i64.cast([-1,4294967295]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(e=a.item,c.sequence([function(a){return d[19]=e.responderId,d[19]!==void 0?c.resolve((a=[c.i64.cast([0,0]),e.sessionId,d[19]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a)):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_SESSION_ONGOING_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[16]=a[0],d[17]=a[1],d[18]=a[2],a}])},function(a){return a=[d[16],d[17],d[18]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,18]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getActiveSession] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getActiveSession",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesGetActiveSessionStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSGetActiveSessionStoredProcedure",["LSGetActiveSession","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSGetActiveSession"),e.initiatorId,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSendPakeMessage",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[4]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))}):(f=e.item,d[17]=f.responderId,d[18]=f.initiatorId,d[15]=f.responderUserId,d[16]=f.initiatorUserId,a[1]===d[18]?(c.i64.eq(a[4],c.i64.cast([0,1]))?d[19]=d[15]:d[19]=void 0,d[9]=d[19]):(a[1]===d[17]?(c.i64.eq(a[4],c.i64.cast([0,1]))?d[20]=d[16]:d[20]=void 0,d[19]=d[20]):d[19]=void 0,d[9]=d[19]),c.i64.eq(a[4],c.i64.cast([0,1]))?d[10]=d[15]:d[10]=void 0,c.i64.eq(a[4],c.i64.cast([0,1]))?d[11]=d[16]:d[11]=void 0,d[12]=new c.Map(),d[12].set("session_id",a[0]),d[12].set("responder_id",d[17]),d[12].set("initiator_id",d[18]),d[12].set("message_payload",a[2]==null?f.messagePayload:a[2]),d[12].set("pake_secret",f.pakeSecret),d[12].set("sender_id",a[1]),d[12].set("message_type",a[3]),d[12].set("client_type",a[4]),d[12].set("message_recipient_id",d[9]),d[12].set("initiator_user_id",d[11]),d[12].set("responder_user_id",d[10]),d[13]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[13],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[14]=a[0],a}))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessage] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessage",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesSendPakeMessageStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSSendPakeMessageOne",["LSBase64Encode.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessageOne] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Encode.nop"),a[2]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})}]):(f=e.item,d[10]=f.responderId,d[10]!==void 0?(c.i64.eq(a[3],c.i64.cast([0,1]))?d[11]=f.responderUserId:d[11]=void 0,c.i64.eq(a[3],c.i64.cast([0,1]))?d[12]=f.initiatorUserId:d[12]=void 0,d[13]=new c.Map(),d[13].set("session_id",a[0]),d[13].set("responder_id",d[10]),d[13].set("initiator_id",a[1]),d[13].set("message_payload",d[2]==null?"":d[2]),d[13].set("message_payload_v2",void 0),d[13].set("pake_secret",void 0),d[13].set("sender_id",a[1]),d[13].set("message_type",c.i64.cast([0,1])),d[13].set("client_type",a[3]),d[13].set("message_recipient_id",d[11]),d[13].set("initiator_user_id",d[12]),d[13].set("responder_user_id",d[11]),d[14]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[14],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[15]=a[0],a})):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessageOne] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessageOne",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesSendPakeMessageOneStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSSendPakeMessageOneStoredProcedure",["LSSendPakeMessageOne","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSendPakeMessageOne"),e.sessionId,e.initiatorId,e.messagePayload,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSendPakeMessageStoredProcedure",["LSSendPakeMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSendPakeMessage"),e.sessionId,e.senderId,e.messagePayload,e.messageType,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWChatEncryptedBackupsAccessCodeInput.react",["fbt","BaseTextArea.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useRef,l={input:{backgroundColor:"xjbqb8w",borderTopStyle:"x1ejq31n",borderEndStyle:"xd10rxx",borderBottomStyle:"x1sy0etr",borderStartStyle:"x17r0tee",color:"xzsf02u",fontSize:"x1lkfr7t",fontWeight:"x1s688f",height:"x5yr21d",end:"xds687c",start:"x17qophe",left:null,right:null,letterSpacing:"xoiqa5b",lineHeight:"x11m8ghp",overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingBottom:"x18d9i69",paddingTop:"x1y1aw1k",top:"x1jzctok",width:"xh8yej3","::placeholder_color":"xha3pab",$$css:!0}},m="---- ---- ---- ---- ----\n---- ---- ---- ---- ----",n=40;function a(a){var b=d("react-compiler-runtime").c(30),e=a.autoSubmit,f=a.disabled,g=a.onComplete,i=a.onValueChange,r=a.smallInput,s=a.value,t=e===void 0?!1:e;a=f===void 0?!1:f;e=k();var u=o;b[0]!==t||b[1]!==g||b[2]!==i||b[3]!==s?(f=function(a){a=u(a).substring(0,n);var b=u(s);if(a===b)return;i(a);a.length===n&&t&&(g==null?void 0:g(a))},b[0]=t,b[1]=g,b[2]=i,b[3]=s,b[4]=f):f=b[4];f=f;var v;b[5]!==r?(v={0:{className:"x443n21 x1a2cdl4 xnhgr82 x1qt0ttw xgk8upj x1g2khh7 xyamay9 x2b8uid x10bruuh x1xmf6yo x1m6arcz x13omvei"},1:{className:"x443n21 x1a2cdl4 xnhgr82 x1qt0ttw xgk8upj xyamay9 x2b8uid x10bruuh x12nagc x18d9i69 x1s1gtqi"}}[!!r<<0],b[5]=r,b[6]=v):v=b[6];var w,x,y;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(r=j.jsx(c("MWXText.react"),{type:"meta3",children:h._(/*BTDS*/"Includes numbers and letters")}),w={className:"xwzfr38 xr1yuqi xkrivgy x4ii5y1 x1gryazu x1n2onr6 x1hfn5x7"},x="x5yr21d x10l6tqk xh8yej3",y={fontFamily:"var(--font-family-code)"},b[7]=r,b[8]=w,b[9]=x,b[10]=y):(r=b[7],w=b[8],x=b[9],y=b[10]);var z;b[11]!==s?(z=s===""?m:q(s),b[11]=s,b[12]=z):z=b[12];b[13]!==a||b[14]!==z?(x=j.jsx("div",{className:x,style:y,children:j.jsx(c("BaseTextArea.react"),{disabled:a,maxRows:2,placeholder:m,readOnly:!0,suppressFocusRing:!0,unresizable:!0,value:z,xstyle:l.input})}),b[13]=a,b[14]=z,b[15]=x):x=b[15];b[16]===Symbol["for"]("react.memo_cache_sentinel")?(y="x5yr21d x10l6tqk xh8yej3",z={fontFamily:"var(--font-family-code)"},b[16]=y,b[17]=z):(y=b[16],z=b[17]);var A;b[18]!==s?(A=s===""?s:p(s),b[18]=s,b[19]=A):A=b[19];b[20]!==a||b[21]!==f||b[22]!==A?(y=j.jsx("div",{className:y,style:z,children:j.jsx(c("BaseTextArea.react"),{disabled:a,maxRows:2,onValueChange:f,ref:e,suppressFocusRing:!0,testid:void 0,unresizable:!0,value:A,xstyle:l.input})}),b[20]=a,b[21]=f,b[22]=A,b[23]=y):y=b[23];b[24]!==x||b[25]!==y?(z=j.jsxs("div",babelHelpers["extends"]({},w,{children:[x,y]})),b[24]=x,b[25]=y,b[26]=z):z=b[26];b[27]!==z||b[28]!==v?(e=j.jsxs("div",babelHelpers["extends"]({},v,{children:[r,z]})),b[27]=z,b[28]=v,b[29]=e):e=b[29];return e}function o(a){return a.toUpperCase().replace(/[^A-Z0-9]/g,"")}function p(a){a=a.split("");var b=0,c=[];for(a of a)c.length===24?c.push("\n"):b>0&&b%4===0&&c.push(" "),c.push(a),b+=1;return c.join("")}function q(a){var b=a.split("");return m.split("").map(function(a){if(a===" "||a==="\n"||b.length===0)return a;else{b.pop();return" "}}).join("")}g["default"]=a}),226);
__d("MWChatEncryptedBackupsAccessCodeInputStep.react",["fbt","EBSMGatingUI","FDSProgressButtonIndeterminate.react","MWChatEncryptedBackupsAccessCodeInput.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSetIsDialogPersistedContext","MWEBNoMobileEOTRInformationalDialog.entrypoint","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBVirtualDevicesContext.react","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsOtcRestoreSteps","MWXButton.react","MWXText.react","QPLUserFlow","RelayHooks","promiseDone","qex","react","react-compiler-runtime","requireDeferred","useEncryptedBackupsQplImpressionRef","useLabyrinthLogging","useMAWEncryptedBackupsRestoreToast","useMWChatEncryptedBackupsAddDevice","useMWEBFlowSourceContext","usePushPage","useReStore","useWAInfraMobileDeviceList"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;b.useCallback;var l=b.useContext,m=b.useState,n=c("requireDeferred")("MWEBUseLocalStorage").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),o=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),p=h._(/*BTDS*/"Submit");function a(a){var b=d("react-compiler-runtime").c(53),e=a.onClose,f=a.onComplete,g=a.onForgotRC,j=a.onSkip,r=a.pushPage;a=a.shouldShowForgotButton;a=a===void 0?!0:a;var s=c("useWAInfraMobileDeviceList")();if(b[0]===Symbol["for"]("react.memo_cache_sentinel")){var t;t=(t=c("qex")._("3693"))!=null?t:!1;b[0]=t}else t=b[0];var u=t;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(t={},b[1]=t):t=b[1];t=c("usePushPage")(c("MWEBNoMobileEOTRInformationalDialog.entrypoint"),t);var v=t[0];t=t[1];if(b[2]!==t){t.onHighIntent;var w=babelHelpers.objectWithoutPropertiesLoose(t,["onHighIntent"]);w=w;b[2]=t;b[3]=w}else w=b[3];var x=(i||(i=c("useReStore")))();b[4]===Symbol["for"]("react.memo_cache_sentinel")?(t=h._(/*BTDS*/"Enter your 40-character code to get your chats on this device"),b[4]=t):t=b[4];t=t;var y=m(""),z=y[0],A=y[1];y=m(!1);var B=y[0],C=y[1];y=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var D=y.startFlow,E=l(c("MWChatEncryptedBackupsSetIsDialogPersistedContext")).setIsDialogPersisted;b[5]!==E?(y=function(){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"wrong_recovery_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_RECOVERY_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"invalid_recovery_code_input"),C(!0),E==null?void 0:E(!1)},b[5]=E,b[6]=y):y=b[6];y=y;var F=c("useMAWEncryptedBackupsRestoreToast")(),G=F.showErrorToast,H=c("useMWEBFlowSourceContext")();b[7]!==B?(F=function(a){B&&C(!1),A(a)},b[7]=B,b[8]=F):F=b[8];F=F;var I=d("RelayHooks").useRelayEnvironment(),J;b[9]!==x||b[10]!==f?(J=function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"add_device_success");c("QPLUserFlow").addPoint(a.restoreQplEvent,"restore_auth_finished_and_dismissed");o.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:x,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}))});n.onReady(q);d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:a.restoreQplEvent});d("MWChatEncryptedBackupsLogging").endSuccess({event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH});f()},b[9]=x,b[10]=f,b[11]=J):J=b[11];J=J;var K;b[12]!==E||b[13]!==G?(K=function(a){d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),G(),E==null?void 0:E(!1)},b[12]=E,b[13]=G,b[14]=K):K=b[14];K=K;var L;b[15]!==y||b[16]!==J||b[17]!==K||b[18]!==I?(L={environment:I,onComplete:J,onFailure:K,onInvalidRecoveryCode:y},b[15]=y,b[16]=J,b[17]=K,b[18]=I,b[19]=L):L=b[19];y=c("useMWChatEncryptedBackupsAddDevice")(L);var M=y[0];J=y[1];K=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_IMPRESSION",void 0,function(){O!=null&&c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_OPTION_DISPLAYED_RESTORE_SCREEN")});b[20]!==s||b[21]!==e||b[22]!==f||b[23]!==g||b[24]!==w||b[25]!==v||b[26]!==a?(I=a?k.jsx(c("MWXButton.react"),babelHelpers["extends"]({},u&&s.length===0?w:null,{label:h._(/*BTDS*/"Don\u2019t have 40-character code?"),onPress:function(){u&&s.length===0?v({onClose:e,onComplete:f}):(c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_DONT_HAVE_RC"),g())},testid:void 0,type:"secondary"})):null,b[20]=s,b[21]=e,b[22]=f,b[23]=g,b[24]=w,b[25]=v,b[26]=a,b[27]=I):I=b[27];L=I;b[28]!==e||b[29]!==f||b[30]!==j||b[31]!==r?(y=function(){d("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onClose:e,onOtcComplete:f,onSkip:j,pushPage:r})},b[28]=e,b[29]=f,b[30]=j,b[31]=r,b[32]=y):y=b[32];var N=y;w=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();a=w.virtualDeviceInfo;var O=a.doesUserHaveOtcEligibleDevices?k.jsx(c("MWXButton.react"),{label:h._(/*BTDS*/"Use a one-time code instead"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),N()},reduceEmphasis:!1,testid:void 0,type:"secondary"}):null;I=O!=null?O:L;b[33]!==z||b[34]!==M||b[35]!==H||b[36]!==J||b[37]!==E||b[38]!==D?(y=J?k.jsx(c("FDSProgressButtonIndeterminate.react"),{label:p}):k.jsx(c("MWXButton.react"),{disabled:z.length<40,label:p,onPress:function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_SUBMIT");var b=H();c("QPLUserFlow").addAnnotations(a.restoreQplEvent,{string:{restore_type:"recovery_code",source:b}});D({additionalAnnotations:{device_type:"OFFLINE"},event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH,source:b});c("QPLUserFlow").addPoint(a.restoreDeviceAuthQplEvent,"add_device_begin");E==null?void 0:E(!0);M(z)},testid:void 0}),b[33]=z,b[34]=M,b[35]=H,b[36]=J,b[37]=E,b[38]=D,b[39]=y):y=b[39];w=J?null:I;b[40]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"Restore your end-to-end encrypted chats"),L=k.jsx("div",babelHelpers["extends"]({className:"xwib8y2"},{children:k.jsx(c("MWXText.react"),{type:"meta3",children:t})})),b[40]=a,b[41]=L):(a=b[40],L=b[41]);b[42]!==z||b[43]!==F?(J=k.jsx(c("MWChatEncryptedBackupsAccessCodeInput.react"),{onValueChange:F,smallInput:!1,value:z}),b[42]=z,b[43]=F,b[44]=J):J=b[44];b[45]!==B?(I=B?k.jsx("div",babelHelpers["extends"]({className:"x5ib6vp xc73u3c xz9dl7a"},{children:k.jsx(c("MWXText.react"),{align:"center",color:"negative",testid:void 0,type:"meta3",children:h._(/*BTDS*/"Incorrect 40-character code. Try again.")})})):null,b[45]=B,b[46]=I):I=b[46];b[47]!==K||b[48]!==y||b[49]!==w||b[50]!==J||b[51]!==I?(t=k.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",primaryAction:y,ref:K,secondaryAction:w,showTopMargin:!1,title:a,children:[L,J,I]}),b[47]=K,b[48]=y,b[49]=w,b[50]=J,b[51]=I,b[52]=t):t=b[52];return t}function q(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}g["default"]=a}),226);
__d("MWChatEncryptedBackupsAppFacebookconSmall.react",["ix","FDSAppFacebookCircleFilled20Icon","MWXIcon.react","cr:1376","react","react-compiler-runtime","vulture"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(1);c("vulture")("5_bgF7DNVlMKJlLAZW-sP5bIB00=");if(a[0]===Symbol["for"]("react.memo_cache_sentinel")){var e=b("cr:1376")!=null?new(b("cr:1376"))(h("391025"),16,16):c("FDSAppFacebookCircleFilled20Icon");e=j.jsx(c("MWXIcon.react"),{icon:e,size:20});a[0]=e}else e=a[0];return e}g["default"]=a}),98);
__d("MWChatEncryptedBackupsAppMessengerIconSmall.react",["MWXIconAppMessenger","MWXIconStrict.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx(c("MWXIconStrict.react"),{icon:c("MWXIconAppMessenger"),size:20}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWChatEncryptedBackupsCreatePinInstruction.react",["fbt","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","deferredLoadComponent","react","react-compiler-runtime","requireDeferred","useEncryptedBackupsQplImpressionRef","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useState,l=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsPinCodeRestoreStep.react").__setRef("MWChatEncryptedBackupsCreatePinInstruction.react")),m="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var b=d("react-compiler-runtime").c(31),e=a.onClose,f=a.onComplete,g=a.pushPage;a=k(!0);var i=a[0];a=a[1];var o=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")(),p=o.vestaClientID;i&&p!=null&&a(!1);b[0]!==e||b[1]!==g?(o=function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:e})})},b[0]=e,b[1]=g,b[2]=o):o=b[2];var q=o;b[3]!==e||b[4]!==f||b[5]!==g||b[6]!==p?(a=function(){return g(function(){return p==null?null:j.jsx(l,{onClose:e,onComplete:f,onSkip:e,pushPage:g})})},b[3]=e,b[4]=f,b[5]=g,b[6]=p,b[7]=a):a=b[7];var r=a;o=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_IMPRESSION");b[8]===Symbol["for"]("react.memo_cache_sentinel")?(a=j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),b[8]=a):a=b[8];var s;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(s=h._(/*BTDS*/"Enter PIN"),b[9]=s):s=b[9];var t;b[10]!==r?(t=function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_ENTER_PIN_CLICK"),r()},b[10]=r,b[11]=t):t=b[11];b[12]!==i||b[13]!==t?(s=j.jsx(c("MWXButton.react"),{disabled:i,label:s,onPress:t}),b[12]=i,b[13]=t,b[14]=s):s=b[14];b[15]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"Can\u2019t create PIN?"),b[15]=i):i=b[15];b[16]!==q?(t=j.jsx(c("MWXButton.react"),{label:i,onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_CANT_CREATE_PIN_CLICK"),q()},type:"secondary"}),b[16]=q,b[17]=t):t=b[17];b[18]===Symbol["for"]("react.memo_cache_sentinel")?(i={className:"xewm4ob"},b[18]=i):i=b[18];var u;b[19]===Symbol["for"]("react.memo_cache_sentinel")?(i=j.jsx("div",babelHelpers["extends"]({},i,{children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._(/*BTDS*/"Create a PIN to restore your chats")})})),u={className:"x169t7cy x19f6ikt xm77wn2 xvue9z"},b[19]=i,b[20]=u):(i=b[19],u=b[20]);var v;b[21]===Symbol["for"]("react.memo_cache_sentinel")?(v=h._(/*BTDS*/"Step 1 \u00b7 Find your mobile device"),b[21]=v):v=b[21];var w;b[22]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"It needs to have secure storage turned on."),b[22]=w):w=b[22];b[23]===Symbol["for"]("react.memo_cache_sentinel")?(v=j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:v,level:4,meta:j.jsxs(j.Fragment,{children:[w," ",j.jsx(c("MWXLink.react"),{href:m,onClick:n,rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._(/*BTDS*/"Learn more")})})]})})}),w=j.jsx("br",{}),b[23]=v,b[24]=w):(v=b[23],w=b[24]);var x;b[25]===Symbol["for"]("react.memo_cache_sentinel")?(x=h._(/*BTDS*/"Step 2 \u00b7 Create a PIN on that device"),b[25]=x):x=b[25];b[26]===Symbol["for"]("react.memo_cache_sentinel")?(u=j.jsxs("div",babelHelpers["extends"]({},u,{children:[v,w,j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:x,level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._(/*BTDS*/"1. Go to Messenger Settings"),j.jsx("br",{}),h._(/*BTDS*/"2. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Privacy & safety")}))]),j.jsx("br",{}),h._(/*BTDS*/"3. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"End-to-end encrypted chats")}))]),j.jsx("br",{}),h._(/*BTDS*/"4. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Message storage")}))]),j.jsx("br",{}),h._(/*BTDS*/"5. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Create PIN")}))])]})})})]})),b[26]=u):u=b[26];b[27]!==o||b[28]!==s||b[29]!==t?(v=j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:a,primaryAction:s,ref:o,secondaryAction:t,children:[i,u]}),b[27]=o,b[28]=s,b[29]=t,b[30]=v):v=b[30];return v}function n(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_LEARN_MORE_LINK_CLICK")}g["default"]=a}),226);
__d("pushRCRestoreStep",["MWEncryptedBackupsForgotRCStep","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsAccessCodeInputStep.react").__setRef("pushRCRestoreStep"));function a(a){var b=a.onClose,c=a.onComplete,e=a.onForgotRC,f=a.pushPage,g=a.shouldShowForgotButton;a=function(){d("MWEncryptedBackupsForgotRCStep").pushForgotRCPage({onClose:b,onComplete:c,pushPage:f})};var h=(e=e)!=null?e:a;f(function(){return i.jsx(j,{onClose:b,onComplete:c,onForgotRC:h,onSkip:b,pushPage:f,shouldShowForgotButton:g})})}g["default"]=a}),98);
__d("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWEBHasSeenAutoRestoreNoticeContext","MWXButton.react","MWXLink.react","MWXListCell.react","MWXMultiStepDialogHeader.react","MWXTextPairing.react","QPLUserFlow","cr:6320","cr:6321","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext,l="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var e=a.onClose,f=a.onCloseDialogWithConfirmation,g=a.onComplete,i=a.onDontRestore,m=a.pushPage,n=f!=null;a=k(c("MWEBHasSeenAutoRestoreNoticeContext"));var o=a.hasSeenNotice,p=b("cr:6320")==null?void 0:b("cr:6320")(),q=b("cr:6321")==null?void 0:b("cr:6321")(),r=function(){m(function(){return j.jsxs(j.Fragment,{children:[n?j.jsx(c("MWXMultiStepDialogHeader.react"),{onClose:f,title:null,withCloseButton:!0,withoutBackButton:!0}):null,j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:g,onDontRestore:i})]})})};a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsx(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{label:h._(/*BTDS*/"Enter new code"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_ENTER_CODE"),c("pushRCRestoreStep")({onClose:e,onComplete:function(){p!=null?p({onNextStep:g,pushPage:m}):q!=null?q({hasSeenNotice:o,onNextStep:g,pushPage:m}):e()},pushPage:m,shouldShowForgotButton:!1})},testid:void 0}),ref:a,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._(/*BTDS*/"Can\u2019t generate code?"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_CANT_GENERATE_CODE"),r()},type:"secondary"}),title:h._(/*BTDS*/"Generate a new code to restore your chats"),children:j.jsxs("div",babelHelpers["extends"]({className:"xvue9z"},{children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._(/*BTDS*/"It needs to have secure storage turned on. It\u2019s likely to be the device you used to create your original 40-character code.")," ",j.jsx(c("MWXLink.react"),{display_DEPRECATED:"inline",href:l,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_SCREEN_ACTION_OPEN_LEARN_MORE_LINK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._(/*BTDS*/"Learn more")})})]}),bodyColor:"secondary",headline:h._(/*BTDS*/"Step 1 \u00b7 Find your other device"),level:4})}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._(/*BTDS*/"1. Go to Messenger Settings"),j.jsx("br",{}),h._(/*BTDS*/"2. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Privacy & safety")}))]),j.jsx("br",{}),h._(/*BTDS*/"3. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"End-to-end encrypted chats")}))]),j.jsx("br",{}),h._(/*BTDS*/"4. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Message storage")}))]),j.jsx("br",{}),h._(/*BTDS*/"5. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Generate recovery code")}))])]}),bodyColor:"secondary",headline:h._(/*BTDS*/"Step 2 \u00b7 Generate a new code on that device"),level:4})})]}))})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWEBHasSeenAutoRestoreNoticeContext","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","cr:6320","cr:6321","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));e=i;var k=e.useCallback,l=e.useContext,m=e.useState,n="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var e=a.onClose,f=a.onComplete,g=a.pushPage;a=m(!0);var i=a[0];a=a[1];var o=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")();o=o.offlineDevicesCount;var p=b("cr:6320")==null?void 0:b("cr:6320")(),q=b("cr:6321")==null?void 0:b("cr:6321")(),r=l(c("MWEBHasSeenAutoRestoreNoticeContext")),s=r.hasSeenNotice;i&&o>0&&a(!1);var t=k(function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:e})})},[e,g]),u=k(function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react"),{onClose:e,onComplete:f,pushPage:g})})},[e,f,g]);r=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{disabled:i,label:h._(/*BTDS*/"Enter 40-character code"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_ENTER_CODE_CLICK"),c("pushRCRestoreStep")({onClose:e,onComplete:function(){p!=null?p({onNextStep:e,pushPage:g}):q!=null?q({hasSeenNotice:s,onNextStep:e,pushPage:g}):e()},onForgotRC:u,pushPage:g,shouldShowForgotButton:!1})}}),ref:r,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._(/*BTDS*/"Can\u2019t generate code?"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_CANT_GENERATE_CODE_CLICK"),t()},type:"secondary"}),children:[j.jsx("div",babelHelpers["extends"]({className:"xewm4ob"},{children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._(/*BTDS*/"Generate a 40-character code to restore your chats")})})),j.jsxs("div",babelHelpers["extends"]({className:"x169t7cy x19f6ikt xm77wn2 xvue9z"},{children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._(/*BTDS*/"Step 1 \u00b7 Find your mobile device"),level:4,meta:j.jsxs(j.Fragment,{children:[h._(/*BTDS*/"It needs to have secure storage turned on.")," ",j.jsx(c("MWXLink.react"),{display_DEPRECATED:"inline",href:n,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_LEARN_MORE_LINK_CLICK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._(/*BTDS*/"Learn more")})})]})})}),j.jsx("br",{}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._(/*BTDS*/"Step 2 \u00b7 Generate a 40-character code on that device"),level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._(/*BTDS*/"1. Go to Messenger Settings"),j.jsx("br",{}),h._(/*BTDS*/"2. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Privacy & safety")}))]),j.jsx("br",{}),h._(/*BTDS*/"3. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"End-to-end encrypted chats")}))]),j.jsx("br",{}),h._(/*BTDS*/"4. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Message storage")}))]),j.jsx("br",{}),h._(/*BTDS*/"5. Tap {=m1}",[h._implicitParam("=m1",j.jsx("b",{children:h._(/*BTDS*/"Generate recovery code")}))])]})})})]}))]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsDots3HorizontalIconSmall.react",["ix","FDSDots3HorizontalFilled20Icon","MWXIcon.react","cr:1376","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(1);if(a[0]===Symbol["for"]("react.memo_cache_sentinel")){var e=b("cr:1376")!=null?new(b("cr:1376"))(h("275834"),24,24):c("FDSDots3HorizontalFilled20Icon");e=j.jsx(c("MWXIcon.react"),{color:"primary",icon:e});a[0]=e}else e=a[0];return e}g["default"]=a}),98);
__d("MWChatEncryptedBackupsForgotPINDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29657246047255053"}),null);
__d("MWChatEncryptedBackupsForgotPINDialogQuery$Parameters",["MWChatEncryptedBackupsForgotPINDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWChatEncryptedBackupsForgotPINDialogQuery_facebookRelayOperation"),metadata:{},name:"MWChatEncryptedBackupsForgotPINDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWChatEncryptedBackupsForgotPINDialog.entrypoint",["JSResourceForInteraction","MWChatEncryptedBackupsForgotPINDialogQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("MWChatEncryptedBackupsForgotPINDialogQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWChatEncryptedBackupsForgotPINDialog.react").__setRef("MWChatEncryptedBackupsForgotPINDialog.entrypoint")};g["default"]=a}),98);
__d("MWChatEncryptedBackupsTextIconSmall.react",["ix","FDSTextFilled20Icon","MWXIcon.react","cr:1376","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(1);if(a[0]===Symbol["for"]("react.memo_cache_sentinel")){var e=b("cr:1376")!=null?new(b("cr:1376"))(h("275886"),24,24):c("FDSTextFilled20Icon");e=j.jsx(c("MWXIcon.react"),{color:"primary",icon:e});a[0]=e}else e=a[0];return e}g["default"]=a}),98);
__d("MWChatEncryptedBackupsForgotPinStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsForgotPinInformationalResetPin.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsMobileRotateIconSmall.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWEBHasSeenAutoRestoreNoticeContext","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","cr:6320","cr:6321","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;function a(a){var e=a.isRCDeviceEnabled,f=a.onClose,g=a.onComplete,i=a.pushPage,l=function(){i(function(){return j.jsx(c("MWChatEncryptedBackupsForgotPinInformationalResetPin.react"),{onClose:f,onComplete:g,pushPage:i})})};a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_IMPRESSION");var m=k(c("MWEBHasSeenAutoRestoreNoticeContext")),n=m.hasSeenNotice,o=b("cr:6320")==null?void 0:b("cr:6320")(),p=b("cr:6321")==null?void 0:b("cr:6321")();return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",ref:a,showTopMargin:!1,title:h._(/*BTDS*/"More ways to restore"),children:[j.jsx(c("MWXText.react"),{type:"meta3",children:h._(/*BTDS*/"Here are some others options to get your end-to-end encrypted chats.")}),j.jsxs("div",babelHelpers["extends"]({className:"x9a3u73 x1p5oq8j xfdjxqc"},{children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsMobileRotateIconSmall.react"),{})}),addOnStartVerticalAlign:"center","aria-label":h._(/*BTDS*/"Reset your PIN from your other device."),content:j.jsx(c("MWXTextPairing.react"),{body:h._(/*BTDS*/"Reset your PIN from your other device."),bodyColor:"secondary",headline:h._(/*BTDS*/"Reset your PIN"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_RESET_PIN"),l()},testid:void 0}),e?j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{align:"start",type:"headlineEmphasized4",children:h._(/*BTDS*/"Enter 40-character code")}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_ENTER_RECOVERY_CODE"),c("pushRCRestoreStep")({onClose:f,onComplete:function(){o!=null?o({onNextStep:g,pushPage:i}):p!=null?p({hasSeenNotice:n,onNextStep:g,pushPage:i}):f()},pushPage:i,shouldShowForgotButton:!0})},testid:void 0}):null]}))]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsKVSOnlyRestoreStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsCreatePinInstruction.react","MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react","MWChatEncryptedBackupsDots3HorizontalIconSmall.react","MWChatEncryptedBackupsInterstitialIcon.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWEBChatDoubleInterstitialAlphaIcon.react","MWEBNoMobileEOTRInformationalDialog.entrypoint","MWXButton.react","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","qex","react","react-compiler-runtime","useEncryptedBackupsQplImpressionRef","usePushPage","useWAInfraMobileDeviceList"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));i.useCallback;function a(a){var b=d("react-compiler-runtime").c(37),e=a.onClose,f=a.onComplete,g=a.pushPage;a=c("useWAInfraMobileDeviceList")();var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={},b[0]=i):i=b[0];i=c("usePushPage")(c("MWEBNoMobileEOTRInformationalDialog.entrypoint"),i);var k=i[0];i=i[1];if(b[1]!==i){i.onHighIntent;var l=babelHelpers.objectWithoutPropertiesLoose(i,["onHighIntent"]);l=l;b[1]=i;b[2]=l}else l=b[2];if(b[3]===Symbol["for"]("react.memo_cache_sentinel")){i=(i=c("qex")._("3693"))!=null?i:!1;b[3]=i}else i=b[3];i=i;i=i&&a.length===0;b[4]!==e||b[5]!==f||b[6]!==g?(a=function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsCreatePinInstruction.react"),{onClose:e,onComplete:f,pushPage:g})})},b[4]=e,b[5]=f,b[6]=g,b[7]=a):a=b[7];var m=a;b[8]!==e||b[9]!==f||b[10]!==g?(a=function(){return g(function(){return j.jsx(c("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react"),{onClose:e,onComplete:f,pushPage:g})})},b[8]=e,b[9]=f,b[10]=g,b[11]=a):a=b[11];var n=a;a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_OPTIONS_IMPRESSION");var o;b[12]!==i?(o=i?j.jsx(c("MWEBChatDoubleInterstitialAlphaIcon.react"),{}):j.jsx(c("MWChatEncryptedBackupsInterstitialIcon.react"),{}),b[12]=i,b[13]=o):o=b[13];var p;b[14]!==e||b[15]!==f||b[16]!==l||b[17]!==k||b[18]!==i?(p=i?j.jsx(c("MWXButton.react"),babelHelpers["extends"]({},i?l:null,{label:h._(/*BTDS*/"See options"),onPress:function(){k({onClose:e,onComplete:f})},type:"primary"})):void 0,b[14]=e,b[15]=f,b[16]=l,b[17]=k,b[18]=i,b[19]=p):p=b[19];b[20]!==i?(l=i?h._(/*BTDS*/"Chat history can\u2019t be restored on this device"):h._(/*BTDS*/"Restore your end-to-end encrypted chats with your mobile device"),b[20]=i,b[21]=l):l=b[21];var q;b[22]!==i?(q=i?h._(/*BTDS*/"Some messages may be missing from your chats."):h._(/*BTDS*/"Try one of these methods to get your chats on this device."),b[22]=i,b[23]=q):q=b[23];var r;b[24]!==q?(r=j.jsx(c("MWXText.react"),{color:"secondary",type:"body4",children:q}),b[24]=q,b[25]=r):r=b[25];b[26]!==m||b[27]!==n||b[28]!==i?(q=i?null:j.jsxs("div",babelHelpers["extends"]({className:"x1miatn0 x2b8uid xk68kj7"},{children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsDots3HorizontalIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._(/*BTDS*/"Learn how to create a PIN"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_PIN_CODE_CLICK"),m()}}),j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._(/*BTDS*/"Learn how to generate a 40-character code"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_RECOVERY_CODE_CLICK"),n()}})]})),b[26]=m,b[27]=n,b[28]=i,b[29]=q):q=b[29];b[30]!==a||b[31]!==r||b[32]!==q||b[33]!==o||b[34]!==p||b[35]!==l?(i=j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"row",icon:o,innerContentPaddingVertical:0,primaryAction:p,ref:a,title:l,children:[r,q]}),b[30]=a,b[31]=r,b[32]=q,b[33]=o,b[34]=p,b[35]=l,b[36]=i):i=b[36];return i}g["default"]=a}),226);
__d("MWDeserializeSecretsAndAddDevice",["LSDeserializeSecretsAndAddDeviceStoredProcedure","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.initiatorId,d=a.secrets;a=a.storage;return a.runInTransaction(function(a){return c("LSDeserializeSecretsAndAddDeviceStoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,serializedPayload:d})},"readwrite",void 0,void 0,f.id+":31")}g["default"]=a}),98);
__d("MWEBAutoRestoreNoticeDialogStep.react",["fbt","CometRelay","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSettingsDialog.entrypoint","MWXButton.react","MWXColumn.react","MWXColumnItem.react","MWXDialogHeader.react","MWXDialogPage.react","MWXLink.react","MWXRow.react","MWXRowItem.react","MWXText.react","gkx","react","react-compiler-runtime","useCometRelayEntrypointContextualEnvironmentProvider","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));i.useCallback;var k=c("gkx")("23219");function a(a){var b=d("react-compiler-runtime").c(24),e=a.onComplete,f=a.pushPage;a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_IMPRESSION");var g=c("useCometRelayEntrypointContextualEnvironmentProvider")(),i;b[0]!==g||b[1]!==e||b[2]!==f?(i=function(){var a=d("CometRelay").loadEntryPoint(g,c("MWChatEncryptedBackupsSettingsDialog.entrypoint"),{});f(function(){return j.jsx(d("CometRelay").EntryPointContainer,{entryPointReference:a,props:{onClose:e,pushPageFromParent:f}})},{withoutBackButton:!0})},b[0]=g,b[1]=e,b[2]=f,b[3]=i):i=b[3];i=i;var l;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(l=h._(/*BTDS*/"Changes to secure storage settings"),b[4]=l):l=b[4];b[5]!==e?(l=j.jsx(c("MWXDialogHeader.react"),{onClose:e,title:l,withBackButton:!1,withCloseButton:!0}),b[5]=e,b[6]=l):l=b[6];if(b[7]!==i){var m;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"Settings"),b[9]=m):m=b[9];m=h._(/*BTDS*/"After you restore chat history, messages will continue to sync automatically even if you log out and log back in. You can turn this off in {[Armadillo] Inline settings link parameter.}.",[h._param("[Armadillo] Inline settings link parameter.",j.jsx(c("MWXLink.react"),{color_DEPRECATED:"blueLink",display_DEPRECATED:"inline",onClick:i,weight_DEPRECATED:"semibold",children:m}))]);b[7]=i;b[8]=m}else m=b[8];b[10]!==m?(i=j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:k?8:0,children:j.jsx(c("MWXText.react"),{align:"start",type:"body3",children:m})}),b[10]=m,b[11]=i):i=b[11];b[12]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"OK"),b[12]=m):m=b[12];b[13]!==e?(m=j.jsx(c("MWXColumnItem.react"),{paddingTop:16,children:j.jsx(c("MWXRow.react"),{align:"end",paddingHorizontal:0,paddingTop:16,children:j.jsx(c("MWXRowItem.react"),{expanding:k,children:j.jsx(c("MWXButton.react"),{label:m,onPress:e,padding:"wide",testid:void 0})})})}),b[13]=e,b[14]=m):m=b[14];var n;b[15]!==i||b[16]!==m?(n=j.jsxs(c("MWXColumn.react"),{paddingVertical:k?8:0,children:[i,m]}),b[15]=i,b[16]=m,b[17]=n):n=b[17];b[18]!==a||b[19]!==n?(i=j.jsx("div",{ref:a,children:n}),b[18]=a,b[19]=n,b[20]=i):i=b[20];b[21]!==l||b[22]!==i?(m=j.jsx(c("MWXDialogPage.react"),{footer:null,header:l,children:i}),b[21]=l,b[22]=i,b[23]=m):m=b[23];return m}g["default"]=a}),226);
__d("MWEBOTCDialog.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{}}},root:c("JSResourceForInteraction")("MWEBOTCDialog.react").__setRef("MWEBOTCDialog.entrypoint")};g["default"]=a}),98);
__d("MWEBQPWithPinState.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({INITIAL:0,RESTORE_IN_PROGRESS:1});c=a;f["default"]=c}),66);
__d("MWXIconCommentLeftRight",["MWXSvgIcon","SVGIcon","cr:12380","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:12380")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMobileFilled",["MWXSvgIcon","SVGIcon","cr:12499","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:12499")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconQuestionCircle",["MWXSvgIcon","SVGIcon","cr:12547","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:12547")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWEBRestoreMoreOptionsStep.react",["fbt","FBLogger","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsQPLEvents","MWEBVirtualDevicesContext.react","MWEncryptedBackupsOtcRestoreSteps","MWXColumn.react","MWXColumnItem.react","MWXDialogPage.react","MWXDivider.react","MWXIconChevronRight","MWXIconCommentLeftRight","MWXIconMobileFilled","MWXIconQuestionCircle","MWXIconStrict.react","MWXIconText","MWXListCellPressable.react","MWXMultiStepDialogHeader.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","gkx","pushRCRestoreStep","react","react-compiler-runtime","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k="https://www.facebook.com/help/messenger-app/1084673321594605",l=c("gkx")("23433");function a(a){var b=d("react-compiler-runtime").c(32),e=a.onClose,f=a.onComplete,g=a.onOptOut,i=a.pushPage;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={onVisible:n},b[0]=a):a=b[0];a=c("useVisibilityObserver")(a);var o=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();o=o.virtualDeviceInfo;!o.doesUserHaveOtcEligibleDevices&&o.offlineDevicesCount===0&&(c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_STEP_NO_RESTORE_OPTIONS"),c("FBLogger")("labyrinth_web").warn("[labyrinth][web] User has no restore option when entering more options dialog"));var p,q;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(p=j.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._(/*BTDS*/"More options"),withCloseButton:!1,withoutBackButton:!0,withoutHeaderBottomBorder:!1}),q={0:{className:"x1wsgfga x1rdy4ex"},1:{className:"x1y1aw1k"}}[!!l<<0],b[1]=p,b[2]=q):(p=b[1],q=b[2]);var r;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(r=j.jsx(c("MWXColumnItem.react"),{align:"start",children:j.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._(/*BTDS*/"Choose a way to restore chat history. You can also continue without chat history.")})}),b[3]=r):r=b[3];var s;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(s={className:"xp7jhwk x1n0m28w x2b8uid"},b[4]=s):s=b[4];var t;b[5]!==e||b[6]!==f||b[7]!==i||b[8]!==o.doesUserHaveOtcEligibleDevices?(t=o.doesUserHaveOtcEligibleDevices&&j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconMobileFilled"),size:36})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{body:h._(/*BTDS*/"Get a code sent to a mobile device where you\u2019ve recently used Messenger."),bodyColor:"secondary",headline:h._(/*BTDS*/"Send a one-time code"),headlineColor:"primary",level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_USE_OTC_CLICK"),d("MWEncryptedBackupsOtcRestoreSteps").pushByOneTimeCodePage({onClose:e,onOtcComplete:f,onSkip:e,pushPage:i})},size:"large",testid:void 0})}),b[5]=e,b[6]=f,b[7]=i,b[8]=o.doesUserHaveOtcEligibleDevices,b[9]=t):t=b[9];var u;b[10]!==e||b[11]!==f||b[12]!==i||b[13]!==o.offlineDevicesCount?(u=o.offlineDevicesCount>0?j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconText"),size:36})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{body:h._(/*BTDS*/"Use the 40-character code you generated during setup to see chat history on this device."),bodyColor:"secondary",headline:h._(/*BTDS*/"Enter 40-character code"),headlineColor:"primary",level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_USE_RC_CLICK"),c("pushRCRestoreStep")({onClose:e,onComplete:f,pushPage:i})},size:"large",testid:void 0})}):null,b[10]=e,b[11]=f,b[12]=i,b[13]=o.offlineDevicesCount,b[14]=u):u=b[14];b[15]===Symbol["for"]("react.memo_cache_sentinel")?(o=j.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),b[15]=o):o=b[15];var v;b[16]===Symbol["for"]("react.memo_cache_sentinel")?(v=j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconCommentLeftRight"),size:36})}),b[16]=v):v=b[16];var w;b[17]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"Messages will be missing on this device."),b[17]=w):w=b[17];b[18]===Symbol["for"]("react.memo_cache_sentinel")?(w=j.jsx(c("MWXTextPairing.react"),{body:w,bodyColor:"secondary",headline:h._(/*BTDS*/"Continue without chat history"),headlineColor:"primary",level:4}),b[18]=w):w=b[18];b[19]!==g?(o=j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWXListCellPressable.react"),{addOnEnd:o,addOnEndVerticalAlign:"center",addOnStart:v,addOnStartVerticalAlign:"center",content:w,onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_DO_NOT_RESTORE_CLICK"),g()},size:"large",testid:void 0})}),b[19]=g,b[20]=o):o=b[20];b[21]===Symbol["for"]("react.memo_cache_sentinel")?(v=j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:8,children:j.jsx(c("MWXDivider.react"),{})}),b[21]=v):v=b[21];b[22]===Symbol["for"]("react.memo_cache_sentinel")?(w=j.jsx(c("MWXIconStrict.react"),{color:"secondary",icon:c("MWXIconChevronRight"),size:20}),b[22]=w):w=b[22];var x;b[23]===Symbol["for"]("react.memo_cache_sentinel")?(x=j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWXIconStrict.react"),{backgroundEnabled:!0,icon:c("MWXIconQuestionCircle"),size:36})}),b[23]=x):x=b[23];b[24]===Symbol["for"]("react.memo_cache_sentinel")?(w=j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWXListCellPressable.react"),{addOnEnd:w,addOnEndVerticalAlign:"center",addOnStart:x,addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{bodyColor:"secondary",headline:h._(/*BTDS*/"Need help?"),headlineColor:"primary",level:4}),linkProps:{target:"_blank",url:k},onPress:m,size:"large",testid:void 0})}),b[24]=w):w=b[24];b[25]!==o||b[26]!==t||b[27]!==u?(x=j.jsx(c("MWXColumnItem.react"),{align:"start",expanding:!0,children:j.jsx("div",babelHelpers["extends"]({},s,{children:j.jsxs(c("MWXColumn.react"),{expanding:!0,spacing:8,children:[t,u,o,v,w]})}))}),b[25]=o,b[26]=t,b[27]=u,b[28]=x):x=b[28];b[29]!==a||b[30]!==x?(s=j.jsx(c("MWXDialogPage.react"),{footer:null,header:p,children:j.jsx("div",babelHelpers["extends"]({},q,{children:j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingTop:0,ref:a,spacing:8,children:[r,x]})}))}),b[29]=a,b[30]=x,b[31]=s):s=b[31];return s}function m(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_NEED_HELP_CLICK")}function n(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_STEP_IMPRESSION")}g["default"]=a}),226);
__d("MWEBSyncIcon.react",["ix","CometImageFromIXValue.react","gkx","react","react-compiler-runtime","stylex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||d("react"),l=c("gkx")("23433");function a(a){var b=d("react-compiler-runtime").c(6),e=a.alt,f=a.ref;a=a.xstyle;var g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=l?h("414642"):h("414641"),b[0]=g):g=b[0];g=g;b[1]!==e?(f=k.jsx(c("CometImageFromIXValue.react"),{alt:e,ref:f,source:g}),b[1]=e,b[2]=f):f=b[2];g=f;b[3]!==g||b[4]!==a?(e=a==null?g:k.jsx("div",babelHelpers["extends"]({},(i||(i=c("stylex"))).props(a),{children:g})),b[3]=g,b[4]=a,b[5]=e):e=b[5];return e}g["default"]=a}),98);
__d("pushEBRestoreMoreOptionsStep",["deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWEBRestoreMoreOptionsStep.react").__setRef("pushEBRestoreMoreOptionsStep"));function a(a){var b=a.onClose,c=a.onComplete,d=a.pushPage;d(function(){return i.jsx(j,{onClose:b,onComplete:c,onOptOut:b,pushPage:d})})}g["default"]=a}),98);
__d("MWEBRestoreOTCFirstStep.react",["fbt","MWChatEncryptedBackupsQPLEvents","MWEBSyncIcon.react","MWXColumn.react","MWXColumnItem.react","MWXDialogFooter.react","MWXDialogPage.react","MWXText.react","QPLUserFlow","pushEBRestoreMoreOptionsStep","qex","react","react-compiler-runtime","requireDeferredForDisplay","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("requireDeferredForDisplay")("MWEncryptedBackupsOtcRestoreSteps").__setRef("MWEBRestoreOTCFirstStep.react");function a(a){var b=d("react-compiler-runtime").c(23),e=a.onCloseDialog,f=a.onComplete,g=a.onSkip,i=a.pushPage;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={onVisible:l},b[0]=a):a=b[0];a=c("useVisibilityObserver")(a);var m;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"Send code"),b[1]=m):m=b[1];b[2]!==e||b[3]!==f||b[4]!==g||b[5]!==i?(m={label:m,onPress:function(){k.onReadyImmediately(function(a){a=a.pushByOneTimeCodePage;c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_SEND_CODE_CLICK");a({onClose:e,onOtcComplete:f,onSkip:g,pushPage:i})})}},b[2]=e,b[3]=f,b[4]=g,b[5]=i,b[6]=m):m=b[6];var n;b[7]!==e||b[8]!==f||b[9]!==i?(n=c("qex")._("3474")?void 0:{label:h._(/*BTDS*/"More Options"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_MORE_OPTIONS_CLICK"),c("pushEBRestoreMoreOptionsStep")({onClose:e,onComplete:f,pushPage:i})}},b[7]=e,b[8]=f,b[9]=i,b[10]=n):n=b[10];var o;b[11]!==m||b[12]!==n?(o=j.jsx(c("MWXDialogFooter.react"),{callToActionGroupDirection:"backward",primaryCallToAction:m,secondaryCallToAction:n}),b[11]=m,b[12]=n,b[13]=o):o=b[13];b[14]===Symbol["for"]("react.memo_cache_sentinel")?(m=j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:20,paddingVertical:4}),b[14]=m):m=b[14];b[15]===Symbol["for"]("react.memo_cache_sentinel")?(n=j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:0,paddingVertical:8,children:j.jsx(c("MWEBSyncIcon.react"),{})}),b[15]=n):n=b[15];var p;b[16]===Symbol["for"]("react.memo_cache_sentinel")?(p=j.jsx(c("MWXColumnItem.react"),{align:"center",children:j.jsx(c("MWXText.react"),{align:"center",color:"primary",type:"headlineEmphasized2",children:h._(/*BTDS*/"Send a one-time code to restore your chat history")})}),b[16]=p):p=b[16];var q;b[17]===Symbol["for"]("react.memo_cache_sentinel")?(q=j.jsx(c("MWXColumnItem.react"),{align:"center",children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:h._(/*BTDS*/"Get a one-time code from the Messenger or Facebook mobile app to restore your chat history on this device.")})}),b[17]=q):q=b[17];b[18]!==a?(m=j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,paddingVertical:8,ref:a,spacing:16,children:[m,n,p,q]}),b[18]=a,b[19]=m):m=b[19];b[20]!==m||b[21]!==o?(n=j.jsx(c("MWXDialogPage.react"),{footer:o,header:null,children:m}),b[20]=m,b[21]=o,b[22]=n):n=b[22];return n}function l(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_FIRST_RESTORE_DIALOG_STEP_IMPRESSION")}g["default"]=a}),226);
__d("MWEBRestoreQPWithPin_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEBRestoreQPWithPin_viewer",selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_vestaGetUserInfoResponse"}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"qp_with_pin_state",storageKey:null}]}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("MWEBRestoreQPWithPin.react",["fbt","CometRelay","EncryptedBackupsSupportedPlatformUtils","FBLogger","FocusRegion.react","JSResourceForInteraction","MWChatEBPinCodeVerifyIndicator.react","MWChatEncryptedBackupsForgotPINDialog.entrypoint","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBFlowSourceContextProvider.react","MWEBOTCDialog.entrypoint","MWEBQPWithPinState.enum","MWEBRestoreQPWithPin_viewer.graphql","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWLogInteraction","MWXCircleButton.react","MWXColumn.react","MWXColumnItem.react","MWXIconCross","MWXImage.react","MWXLink.react","MWXRow.react","MWXRowItem.react","MWXText.react","QPLUserFlow","cr:6334","cr:6335","focusScopeQueries","getMWEBRestoreQPCautionCircleProperties","gkx","promiseDone","react","react-compiler-runtime","useAsyncReStore","useLabyrinthLogging","useMWChatEncryptedBackupsPinCodeRestore","useMWChatEncryptedBackupsVestaUserInfo","useMWEBFlowSourceContext","useMWXEntryPointDialog","useMWXLazyDialog","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));e=j;var l=e.useCallback,m=e.useContext,n=e.useEffect,o=e.useMemo,p=e.useRef,q=e.useState,r=c("JSResourceForInteraction")("MWChatEncryptedBackupsPinCodeBlockedDialog.react").__setRef("MWEBRestoreQPWithPin.react"),s="chat-encrypted-backups-jewel-qp-with-pin-input",t={icon:{paddingTop:"x889kno",$$css:!0}};function u(a){var e=a.clientID,f=a.doesUserHaveOtcEligibleDevices,g=a.fragmentKey,j=a.isInbox,u=a.setClosed,v=a.setDismissed,w=d("CometRelay").useFragment(i!==void 0?i:i=b("MWEBRestoreQPWithPin_viewer.graphql"),g),x=d("CometRelay").useRelayEnvironment(),y=l(function(a){return d("CometRelay").commitLocalUpdate(x,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][jewel_softblock_state] A viewer record does not exist when propagating EB restore qp with pin state");return}b.setValue(a,"qp_with_pin_state")})},[x]);g=w==null?void 0:(a=w.messenger_default_encrypted_backup)==null?void 0:a.vesta_user_info;var z=c("useMWChatEncryptedBackupsVestaUserInfo")({vestaGetUserInfoResponse$key:g}),A=z.attemptsRemaining===0||z.loginTimeoutRemainingSecs!=null;a=q(!1);var B=a[0],C=a[1],D=p(!1);g=c("useMWXLazyDialog")(r);var E=g[0];n(function(){A&&B===!0&&D.current!==!0&&(D.current=!0,E({attemptsRemaining:z.attemptsRemaining,loginTimeoutRemainingSecs:z.loginTimeoutRemainingSecs,onDismiss:function(){}}))},[A,E,B,z.attemptsRemaining,z.loginTimeoutRemainingSecs]);a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var F=a.startFlow,G=c("useAsyncReStore")(),H=c("useMWEBFlowSourceContext")(),I=o(function(){return H()},[H]),J=l(function(a){c("promiseDone")(G.then(function(b){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:b,onFetch:function(b){var e=b.ebsmWiped,g=b.firstUpsellTime,h=b.hasEbKeysLocally,i=b.hasEBSM,j=b.hasPDB,k=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;F({additionalAnnotations:{eb_session_identifier:g,ebsm_wiped:e,has_eb_keys_locally:h,has_ebsm:i,has_pdb:j,has_user_restored_before:k,has_user_restored_before_temp:b,is_otc_eligible:f.toString(),is_pin_set:"true",restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:I});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a)}})}))},[G,F,f,I]);g=l(function(){var a=j?"RESTORE_QP_WITH_PIN_INBOX_DISMISSED":"RESTORE_QP_WITH_PIN_JEWEL_DISMISSED";J(a);d("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"thread_list_qp_with_pin",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent});u();v()},[j,u,v,J]);a=m(c("MWJewelPopoverDialogContext.react"));var K=a.setIsOpenForDialog,L=b("cr:6334")==null?void 0:b("cr:6334")(),M=b("cr:6335")==null?void 0:b("cr:6335")();a=l(function(){u();if(L!=null)L(I);else if(M!=null){var a;M({hasSeenNotice:(a=w==null?void 0:(a=w.encrypted_backup)==null?void 0:a.has_seen_eb_auto_restore_notice)!=null?a:!1,source:I})}K(!0);y(c("MWEBQPWithPinState.enum").INITIAL)},[u,L,M,y,I,K,w==null?void 0:(a=w.encrypted_backup)==null?void 0:a.has_seen_eb_auto_restore_notice]);e=d("useMWChatEncryptedBackupsPinCodeRestore").useMWChatEncryptedBackupsPinCodeRestore({clientID:e,focusRegionId:s,onSubmitPin:function(){C(!0),d("MWLogInteraction").logPopoverOpenCancel("initiate_restore"),y(c("MWEBQPWithPinState.enum").RESTORE_IN_PROGRESS)},onSubmitPinFailure:function(){y(c("MWEBQPWithPinState.enum").INITIAL)},onVestaComplete:a});a=e.inputProps;var N=e.isInProgress,O=e.isLabyrinthError,P=e.isPinCodeIncorrect;e=e.isVestaError;N=(w==null?void 0:w.qp_with_pin_state)===c("MWEBQPWithPinState.enum").RESTORE_IN_PROGRESS||N;var Q=c("useVisibilityObserver")({onVisible:function(){d("FocusRegion.react").focusRegionById(s,d("focusScopeQueries").tabbableScopeQuery);var a=j?"RESTORE_QP_WITH_PIN_INBOX_IMPRESSION":"RESTORE_QP_WITH_PIN_JEWEL_IMPRESSION";J(a)}}),R=c("useMWXEntryPointDialog")(c("MWChatEncryptedBackupsForgotPINDialog.entrypoint"),{}),S=R[0];R=c("useMWXEntryPointDialog")(c("MWEBOTCDialog.entrypoint"),{});var T=R[0],U=l(function(){T({source:j?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP},function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_CLOSE_DIALOG_CLICK")})},[j,T]),V=l(function(){S({onDismiss:function(){}})},[S]);R=P?h._(/*BTDS*/"Incorrect PIN. Try again."):O||e?h._(/*BTDS*/"There was an error while using the PIN Code, please try again"):void 0;if(A===!0){u();return null}P=c("gkx")("23219");return k.jsx("div",babelHelpers["extends"]({},{0:{className:"xlhe6ec x1lq5wgf xgqcy7u x30kzoy x9jhf4c xe4pinz x14vqqas xktsk01 xod5an3 x1d52u69 xz9dl7a xn6708d xsag5q8 x1ye3gou"},1:{className:"x1lq5wgf xgqcy7u x30kzoy x9jhf4c xe4pinz x14vqqas xktsk01 xod5an3 x1d52u69 xz9dl7a xn6708d xsag5q8 x1ye3gou x1jx94hy"}}[!!P<<0],{children:k.jsxs(c("MWXColumn.react"),{ref:Q,testid:void 0,children:[k.jsx(c("MWXColumnItem.react"),{children:k.jsxs(c("MWXRow.react"),{paddingHorizontal:0,paddingVertical:0,spacing:12,children:[k.jsx(c("MWXRowItem.react"),{xstyle:t.icon,children:k.jsx(c("MWXImage.react"),{src:c("getMWEBRestoreQPCautionCircleProperties")()})}),k.jsx(c("MWXRowItem.react"),{expanding:!0,children:k.jsxs(c("MWXColumn.react"),{paddingTop:8,spacing:12,children:[k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXText.react"),{align:"start",numberOfLines:2,type:"headlineEmphasized4",children:h._(/*BTDS*/"Chat history is missing")})}),k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXText.react"),{align:"start",color:P?"secondary":"primary",numberOfLines:2,type:"body4",children:h._(/*BTDS*/"Enter your PIN to restore chat history.")})})]})}),k.jsx(c("MWXRowItem.react"),{children:k.jsx(c("MWXCircleButton.react"),{color:"primary",icon:c("MWXIconCross"),label:h._(/*BTDS*/"Close"),onPress:g,size:P?24:32,testid:void 0})})]})}),k.jsx(c("MWXColumnItem.react"),{paddingTop:16,children:k.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:R,inputSize:"small",children:k.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,id:s,children:k.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({},a,{color:P?"primary":"secondary",disabled:N,inputSize:"small",testid:void 0}))})})}),N&&k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",babelHelpers["extends"]({className:"xfitlp5 x9otpla"},{children:k.jsx(c("MWChatEBPinCodeVerifyIndicator.react"),{isMessenger:P})}))}),!N&&k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",babelHelpers["extends"]({},{0:{},2:{className:"xod5an3"},1:{className:"x12nagc x1iorvi4"},3:{className:"x12nagc x1iorvi4"}}[!!(R==null)<<1|!!(R!=null)<<0],{children:k.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:f===!0?k.jsx(c("MWXLink.react"),{onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),K(!0),U()},children:h._(/*BTDS*/"Use a one-time code instead")}):k.jsx(c("MWXLink.react"),{onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_FORGOT_PIN_CLICK"),K(!0),V()},children:h._(/*BTDS*/"Forgot PIN?")})})}))})]})}))}u.displayName=u.name+" [from "+f.id+"]";function a(a){var b=d("react-compiler-runtime").c(10),e=a.clientID,f=a.currentSupportedPlatform,g=a.doesUserHaveOtcEligibleDevices,h=a.fragmentKey,i=a.setClosed;a=a.setDismissed;f=f!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM;var j=f?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP_WITH_PIN:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP_WITH_PIN,l;b[0]!==e||b[1]!==g||b[2]!==h||b[3]!==f||b[4]!==i||b[5]!==a?(l=k.jsx(u,{clientID:e,doesUserHaveOtcEligibleDevices:g,fragmentKey:h,isInbox:f,setClosed:i,setDismissed:a}),b[0]=e,b[1]=g,b[2]=h,b[3]=f,b[4]=i,b[5]=a,b[6]=l):l=b[6];b[7]!==j||b[8]!==l?(e=k.jsx(c("MWEBFlowSourceContextProvider.react"),{source:j,children:l}),b[7]=j,b[8]=l,b[9]=e):e=b[9];return e}g["default"]=a}),226);
__d("MWEncryptedBackupsDeviceUtils",[],(function(a,b,c,d,e,f){"use strict";a=[6628568379,173847642670370,350685531728];b=[173847642670370];f.FB_APP_IDS=a;f.TABLET_APP_IDS=b}),66);
__d("MWEncryptedBackupsDeviceListCell.react",["fbt","AddOnStartOverride.react","BaseMiddot.react","FDSRelativeTimestamp.react","I64","MWEncryptedBackupsDeviceUtils","MWXIconForListCell.react","MWXIconMobile","MWXIconTablet","MWXListCell.react","MWXTextPairing.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react")),l=i.useMemo;function a(a){var b=a.device;a=l(function(){return b.appId!=null?(j||(j=d("I64"))).to_float(b.appId):null},[b.appId]);var e=d("MWEncryptedBackupsDeviceUtils").TABLET_APP_IDS.includes(a);a=d("MWEncryptedBackupsDeviceUtils").FB_APP_IDS.includes(a)?h._(/*BTDS*/"Facebook"):h._(/*BTDS*/"Messenger");return k.jsx(c("MWXListCell.react"),{addOnStart:k.jsx(c("AddOnStartOverride.react"),{children:k.jsx(c("MWXIconForListCell.react"),{icon:e?c("MWXIconTablet"):c("MWXIconMobile"),size:"large"})}),content:k.jsx(c("MWXTextPairing.react"),{body:b.lastUploadTime!=null&&h._(/*BTDS*/"Last seen {last_seen}",[h._param("last_seen",k.jsx(c("FDSRelativeTimestamp.react"),{date:new Date(Number(b.lastUploadTime)*1e3)}))]),bodyColor:"secondary",headline:b.model!=null?k.jsxs(k.Fragment,{children:[a,k.jsx(c("BaseMiddot.react"),{}),b.model]}):a,level:4})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWEncryptedBackupsEligibleDeviceCell.react",["I64","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsAppFacebookconSmall.react","MWChatEncryptedBackupsAppMessengerIconSmall.react","MWEncryptedBackupsDeviceUtils","MWXListCell.react","MWXText.react","react","react-compiler-runtime","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react");function a(a){var b=d("react-compiler-runtime").c(10),e=a.deviceAppId,f=a.deviceManufacturer,g=a.deviceModel;a=a.eligibleDeviceCellId;c("vulture")("iW767kCcZ_qtlopGSscOQ1HRA4Y=");if(b[0]!==e){var h;h=(h=e!=null&&d("MWEncryptedBackupsDeviceUtils").FB_APP_IDS.includes((i||(i=d("I64"))).to_float(e)))!=null?h:!1;b[0]=e;b[1]=h}else h=b[1];e=h;b[2]!==e?(h=j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:e?j.jsx(c("MWChatEncryptedBackupsAppFacebookconSmall.react"),{}):j.jsx(c("MWChatEncryptedBackupsAppMessengerIconSmall.react"),{})}),b[2]=e,b[3]=h):h=b[3];e=f+" "+g;b[4]!==e?(f=j.jsx(c("MWXText.react"),{type:"headline4",children:e}),b[4]=e,b[5]=f):f=b[5];b[6]!==a||b[7]!==h||b[8]!==f?(g=j.jsx(c("MWXListCell.react"),{addOnStart:h,addOnStartVerticalAlign:"center",content:f,size:"large",testid:void 0}),b[6]=a,b[7]=h,b[8]=f,b[9]=g):g=b[9];return g}g["default"]=a}),98);
__d("MWEncryptedBackupsFetchBackupIds",["LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1})},"readwrite",void 0,void 0,f.id+":19")}g.encryptedBackupsFetchBackupIds=a}),98);
__d("MWXIconExclamationMarkCircleOutline",["MWXSvgIcon","SVGIcon","cr:12406","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:12406")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWEncryptedBackupsOTCEligibleDevicesList.react",["fbt","AddOnStartOverride.react","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceListCell.react","MWXGlimmer.react","MWXIconExclamationMarkCircleOutline","MWXIconForListCell.react","MWXLink.react","MWXList.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","react","react-compiler-runtime","useFetchOTCEligibleEBDevices"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useEffect,l=b.useRef,m={glimmerBody:{borderTopStartRadius:"xa9qn9j",borderTopEndRadius:"x1trwbdj",borderBottomEndRadius:"x6a0fk7",borderBottomStartRadius:"xuyh7jl",height:"xlzyvqe",width:"x3hqpx7",$$css:!0},glimmerHeadline:{borderTopStartRadius:"xa9qn9j",borderTopEndRadius:"x1trwbdj",borderBottomEndRadius:"x6a0fk7",borderBottomStartRadius:"xuyh7jl",height:"xlzyvqe",width:"xktia5q",$$css:!0},glimmerIcon:{borderTopStartRadius:"xlid4zk",borderTopEndRadius:"x13tp074",borderBottomEndRadius:"x1qns1p2",borderBottomStartRadius:"xipx5yg",height:"xc9qbxq",width:"x14qfxbe",$$css:!0}};function n(){var a=d("react-compiler-runtime").c(2),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("AddOnStartOverride.react"),{children:j.jsx(c("MWXGlimmer.react"),{index:0,xstyle:m.glimmerIcon})}),a[0]=b):b=a[0];a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("MWXListCell.react"),{addOnStart:b,content:j.jsx(c("MWXTextPairing.react"),{body:j.jsx(c("MWXGlimmer.react"),{index:2,xstyle:m.glimmerBody}),headline:j.jsx(c("MWXGlimmer.react"),{index:1,xstyle:m.glimmerHeadline}),level:4})}),a[1]=b):b=a[1];return b}function a(){var a=d("react-compiler-runtime").c(13),b=c("useFetchOTCEligibleEBDevices")(),e=b.failedToFetchOtcDevices,f=b.isFetchOtcDevicesInFlight,g=b.otcEligibleDevices;b=b.triggerFetchOtcEligibleDevices;var i=l(!1),m,q;a[0]!==e||a[1]!==f||a[2]!==g.length?(m=function(){f||(c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{"int":{otc_eligible_devices:g.length}}),e?i.current||(i.current=!0,c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_DEVICES_LIST_FAILURE")):!i.current&&g.length>0&&(i.current=!0,c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_DEVICES_LIST_LOADED")))},q=[e,f,g.length],a[0]=e,a[1]=f,a[2]=g.length,a[3]=m,a[4]=q):(m=a[3],q=a[4]);k(m,q);if(f){a[5]===Symbol["for"]("react.memo_cache_sentinel")?(m=j.jsx(n,{}),a[5]=m):m=a[5];return m}else if(e){a[6]===Symbol["for"]("react.memo_cache_sentinel")?(q=j.jsx(c("AddOnStartOverride.react"),{children:j.jsx(c("MWXIconForListCell.react"),{icon:c("MWXIconExclamationMarkCircleOutline"),size:"large"})}),a[6]=q):q=a[6];a[7]!==b?(m=j.jsx(c("MWXListCell.react"),{addOnStart:q,content:j.jsx(c("MWXText.react"),{type:"headlineEmphasized4",children:h._(/*BTDS*/"Unable to show your devices. {try_again}",[h._param("try_again",j.jsx(c("MWXText.react"),{color:"blueLink",type:"headlineEmphasized4",children:j.jsx(c("MWXLink.react"),{onClick:b,children:h._(/*BTDS*/"Refresh")})}))])})}),a[7]=b,a[8]=m):m=a[8];return m}else{a[9]!==g?(q=g.toSorted(p).map(o),a[9]=g,a[10]=q):q=a[10];a[11]!==q?(b=j.jsx(c("MWXList.react"),{testid:void 0,children:q}),a[11]=q,a[12]=b):b=a[12];return b}}function o(a){return j.jsx(c("MWEncryptedBackupsDeviceListCell.react"),{device:a},a.deviceId)}o.displayName=o.name+" [from "+f.id+"]";function p(a,b){return Number(b.lastUploadTime)-Number(a.lastUploadTime)}g["default"]=a}),226);
__d("MWEncryptedBackupsOTCEligibleDevicesPopover.react",["MWEncryptedBackupsOTCEligibleDevicesList.react","MWXPopover.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=d("react-compiler-runtime").c(1);var b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx(c("MWXPopover.react"),{withArrow:!0,children:i.jsx("div",babelHelpers["extends"]({className:"x1xiyphd x1odjw0f x1y1aw1k x1sxyh0 xwib8y2 xurb0ha x168biu4"},{children:i.jsx(c("MWEncryptedBackupsOTCEligibleDevicesList.react"),{})}))}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWEncryptedBackupsThreadListPersistentBanner.react",["fbt","EncryptedBackupsSupportedPlatformUtils","MAWEncryptedBackupsRestoreDialog.entrypoint","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWXLink.react","MWXText.react","QPLUserFlow","promiseDone","react","react-compiler-runtime","requireDeferred","useLabyrinthLogging","useMWXEntryPointDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useRef,n=c("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEncryptedBackupsThreadListPersistentBanner.react");function a(a){var b=d("react-compiler-runtime").c(23),e=a.onDismissUpsell;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={},b[0]=a):a=b[0];a=c("useMWXEntryPointDialog")(c("MAWEncryptedBackupsRestoreDialog.entrypoint"),a);var f=a[0];a=d("EncryptedBackupsSupportedPlatformUtils").useMWEncryptedBackupsGetCurrentSupportedPlatform();var g=a!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM;a=l(c("MWJewelPopoverDialogContext.react"));var j=a.setIsOpenForDialog,o=(i||(i=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var p=a.startFlow,q=m(!1),r=g?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_PERSISTENT_BANNER:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_PERSISTENT_BANNER;b[1]!==o||b[2]!==r||b[3]!==p?(a=function(a){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:o,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,g=b.hasEbKeysLocally,h=b.hasEBSM,i=b.hasPDB,j=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;p({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:g,has_ebsm:h,has_pdb:i,has_user_restored_before:j,has_user_restored_before_temp:b,restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:r});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a);q.current===!1&&(q.current=!0,c("promiseDone")(n.load(),function(a){return a(g)}))}})},b[1]=o,b[2]=r,b[3]=p,b[4]=a):a=b[4];var s=a;b[5]!==g||b[6]!==s?(a={onVisible:function(){s(g?"RESTORE_THREAD_LIST_PERSISTENT_BANNER_IMPRESSION_INBOX":"RESTORE_THREAD_LIST_PERSISTENT_BANNER_IMPRESSION")}},b[5]=g,b[6]=s,b[7]=a):a=b[7];a=c("useVisibilityObserver")(a);var t;b[8]===Symbol["for"]("react.memo_cache_sentinel")?(t={className:"xlhe6ec x1lq5wgf xgqcy7u x30kzoy x9jhf4c x1xmf6yo x1e56ztr x1d52u69 xktsk01 x6ikm8r x10wlt62 xyamay9 x1l90r2v x1swvt13 x1pi30zi x1qh3cfz"},b[8]=t):t=b[8];var u;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(u=h._(/*BTDS*/"Missing chat history."),b[9]=u):u=b[9];var v;b[10]!==g||b[11]!==e||b[12]!==j||b[13]!==f||b[14]!==r||b[15]!==s?(v=function(){j(!0),s(g?"RESTORE_THREAD_LIST_PERSISTENT_BANNER_CTA_CLICKED_INBOX":"RESTORE_THREAD_LIST_PERSISTENT_BANNER_CTA_CLICKED"),f({onDismissUpsell:e,source:r})},b[10]=g,b[11]=e,b[12]=j,b[13]=f,b[14]=r,b[15]=s,b[16]=v):v=b[16];var w;b[17]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"Restore now"),b[17]=w):w=b[17];b[18]!==v?(u=k.jsx(c("MWXText.react"),{color:"primary",type:"body4",children:k.jsxs(k.Fragment,{children:[u," ",k.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:k.jsx(c("MWXLink.react"),{onClick:v,target:"_blank",testid:void 0,children:w})})]})}),b[18]=v,b[19]=u):u=b[19];b[20]!==a||b[21]!==u?(w=k.jsx("div",babelHelpers["extends"]({},t,{ref:a,children:u})),b[20]=a,b[21]=u,b[22]=w):w=b[22];return w}g["default"]=a}),226);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapper_viewer"}],storageKey:null}],type:"Query",abstractKey:null};e.exports=a}),null);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapper_viewer",selections:[{args:null,kind:"FragmentSpread",name:"MWEBRestoreQPWithPin_viewer"}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("MWEncryptedBackupsVerifyDeviceNux.react",["fbt","EncryptedBackupsSupportedPlatformUtils","MAWEncryptedBackupsRestoreDialog.entrypoint","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWXQPCard.react","QPLUserFlow","getMWEBRestoreQPCautionCircleProperties","promiseDone","react","react-compiler-runtime","requireDeferred","useLabyrinthLogging","useMWXEntryPointDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useRef,n=c("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEncryptedBackupsVerifyDeviceNux.react");function a(a){var b=d("react-compiler-runtime").c(26),e=a.children,f=a.currentSupportedPlatform,g=a.setClosed,j=a.setDismissed;a=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState();var o;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(o={},b[0]=o):o=b[0];o=c("useMWXEntryPointDialog")(c("MAWEncryptedBackupsRestoreDialog.entrypoint"),o);var p=o[0],q=(i||(i=c("useReStore")))(),r=f!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM,s=r?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP;o=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var t=o.startFlow,u=m(!1);f=l(c("MWJewelPopoverDialogContext.react"));var v=f.setIsOpenForDialog;o=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();f=o.virtualDeviceInfo;var w=f.vestaClientID!=null;o=f.offlineDevicesCount>0;var x=f.doesUserHaveOtcEligibleDevices;f=!w&&x;var y=function(a){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:q,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,g=b.hasEbKeysLocally,h=b.hasEBSM,i=b.hasPDB,j=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;t({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:g,has_ebsm:h,has_pdb:i,has_user_restored_before:j,has_user_restored_before_temp:b,is_otc_eligible:x.toString(),is_pin_set:w.toString(),restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:s});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a);u.current===!1&&(u.current=!0,c("promiseDone")(n.load(),function(a){return a(g)}))}})},z=c("useVisibilityObserver")({onVisible:function(){var a=r?"VERIFY_DEVICE_INBOX_QP_THREAD_LIST_IMPRESSION":"VERIFY_DEVICE_QP_THREAD_LIST_IMPRESSION";y(a)}}),A=function(){var a=r?"USER_CLICKED_INBOX_THREAD_LIST_VERIFY_DEVICE":"USER_CLICKED_FB_THREAD_LIST_VERIFY_DEVICE";y(a);v(!0);g()},B=function(){var a=r?"USER_CLOSED_INBOX_THREAD_LIST_VERIFY_DEVICE_NUX":"USER_CLOSED_FB_THREAD_LIST_VERIFY_DEVICE_NUX";y(a);d("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"thread_list_nux",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent});C()},C=function(){j(),g()};if(!w&&!o&&!x)return e;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"Chat history is missing"),b[1]=o):o=b[1];e=o;b[2]!==x||b[3]!==a||b[4]!==w||b[5]!==f?(o=a&&x?h._(/*BTDS*/"Restore now"):w?h._(/*BTDS*/"Enter PIN"):f?h._(/*BTDS*/"Restore now"):h._(/*BTDS*/"Enter 40-character code"),b[2]=x,b[3]=a,b[4]=w,b[5]=f,b[6]=o):o=b[6];var D;b[7]!==C||b[8]!==A||b[9]!==s||b[10]!==p?(D=function(){A(),p({onDismissUpsell:C,source:s})},b[7]=C,b[8]=A,b[9]=s,b[10]=p,b[11]=D):D=b[11];var E;b[12]!==o||b[13]!==D?(E={label:o,onPress:D,testid:"mw-encrypted-backups-in-thread-verify-device-nux-verify-now-button"},b[12]=o,b[13]=D,b[14]=E):E=b[14];b[15]!==x||b[16]!==a||b[17]!==w||b[18]!==f?(o=a&&x?h._(/*BTDS*/"Send a one-time code to restore your chat history"):w?h._(/*BTDS*/"Enter your PIN to see messages that aren't loaded on this device."):f?h._(/*BTDS*/"Send a one-time code to restore your chat history"):h._(/*BTDS*/"Enter your 40-character code to see messages that aren't loaded on this device."),b[15]=x,b[16]=a,b[17]=w,b[18]=f,b[19]=o):o=b[19];b[20]===Symbol["for"]("react.memo_cache_sentinel")?(D={props:{src:c("getMWEBRestoreQPCautionCircleProperties")()},type:"image"},b[20]=D):D=b[20];b[21]!==B||b[22]!==z||b[23]!==E||b[24]!==o?(a=k.jsx(c("MWXQPCard.react"),{addOnPrimary:E,body:o,headline:e,icon:D,onClose:B,ref:z}),b[21]=B,b[22]=z,b[23]=E,b[24]=o,b[25]=a):a=b[25];return a}g["default"]=a}),226);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper.react",["CometRelay","EncryptedBackupsSupportedPlatformUtils","MWEBEntrypointsKillswitch.enum","MWEBRestoreQPWithPin.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","MWEncryptedBackupsThreadListPersistentBanner.react","MWEncryptedBackupsThreadListQPWrapper.react","MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql","MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql","MWEncryptedBackupsVerifyDeviceNux.react","react","react-compiler-runtime","useHasRestoreInterstitialSoftblockBeenDismissed","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||d("react");function m(a){var e=d("react-compiler-runtime").c(32),f=a.backupState,g=a.children,i=a.currentSupportedPlatform,k=a.fragmentKey,m=a.setHasDismissedQp,n=a.setHasDismissedQpWithPin;a=d("CometRelay").useFragment(h!==void 0?h:h=b("MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql"),k);var o=(j||(j=c("useReStore")))();k=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();k=k.virtualDeviceInfo;var p=i===d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM,q=k.doesUserHaveOtcEligibleDevices,r=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),s;e[0]!==f||e[1]!==r?(s={backupState:f,isCooldownOrLockOutState:r},e[0]=f,e[1]=r,e[2]=s):s=e[2];f=c("useHasRestoreInterstitialSoftblockBeenDismissed")(s);if(!q&&r&&f)return null;else if(r&&f){e[3]!==m?(s=function(){m(!0)},e[3]=m,e[4]=s):s=e[4];e[5]!==o?(q=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL})},e[5]=o,e[6]=q):q=e[6];e[7]!==g||e[8]!==i||e[9]!==s||e[10]!==q?(r=l.jsx(c("MWEncryptedBackupsVerifyDeviceNux.react"),{children:g,currentSupportedPlatform:i,setClosed:s,setDismissed:q}),e[7]=g,e[8]=i,e[9]=s,e[10]=q,e[11]=r):r=e[11];return r}else if(p&&k.vestaClientID!=null&&c("MWEBRestoreQPWithPin.react")){e[12]!==n?(f=function(){n(!0)},e[12]=n,e[13]=f):f=e[13];e[14]!==o?(s=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL})},e[14]=o,e[15]=s):s=e[15];e[16]!==i||e[17]!==a||e[18]!==f||e[19]!==s||e[20]!==k.doesUserHaveOtcEligibleDevices||e[21]!==k.vestaClientID?(q=l.jsx(c("MWEBRestoreQPWithPin.react"),{clientID:k.vestaClientID,currentSupportedPlatform:i,doesUserHaveOtcEligibleDevices:k.doesUserHaveOtcEligibleDevices,fragmentKey:a,setClosed:f,setDismissed:s}),e[16]=i,e[17]=a,e[18]=f,e[19]=s,e[20]=k.doesUserHaveOtcEligibleDevices,e[21]=k.vestaClientID,e[22]=q):q=e[22];return q}else{e[23]!==m?(r=function(){m(!0)},e[23]=m,e[24]=r):r=e[24];e[25]!==o?(p=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL})},e[25]=o,e[26]=p):p=e[26];e[27]!==g||e[28]!==i||e[29]!==r||e[30]!==p?(a=l.jsx(c("MWEncryptedBackupsVerifyDeviceNux.react"),{children:g,currentSupportedPlatform:i,setClosed:r,setDismissed:p}),e[27]=g,e[28]=i,e[29]=r,e[30]=p,e[31]=a):a=e[31];return a}}function a(a){var e=d("react-compiler-runtime").c(12),f=a.children,g=a.currentSupportedPlatform,h=a.fragmentKey,k=a.hasDismissedQps,n=a.setHasDismissedBanner,o=a.setHasDismissedQp,p=a.setHasDismissedQpWithPin;a=a.trigger;h=d("CometRelay").useFragment(i!==void 0?i:i=b("MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql"),h);var q=(j||(j=c("useReStore")))(),r;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(r={entrypoint:c("MWEBEntrypointsKillswitch.enum").INBOX_THREADLIST},e[0]=r):r=e[0];r=c("useMWEBBackupState")(r);var s;e[1]!==r||e[2]!==f||e[3]!==g||e[4]!==(h==null?void 0:h.viewer)||e[5]!==q||e[6]!==k||e[7]!==n||e[8]!==o||e[9]!==p||e[10]!==a?(s=k?l.jsx(d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsThreadListQPWrapper,{trigger:a,children:l.jsx(c("MWEncryptedBackupsThreadListPersistentBanner.react"),{onDismissUpsell:function(){n(!0),d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:q,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.PERSISTENT_BANNER_JEWEL})}})}):l.jsx(d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsThreadListQPWrapper,{trigger:a,children:l.jsx(m,{backupState:r,children:f,currentSupportedPlatform:g,fragmentKey:h==null?void 0:h.viewer,setHasDismissedQp:o,setHasDismissedQpWithPin:p})}),e[1]=r,e[2]=f,e[3]=g,e[4]=h==null?void 0:h.viewer,e[5]=q,e[6]=k,e[7]=n,e[8]=o,e[9]=p,e[10]=a,e[11]=s):s=e[11];return s}g["default"]=a}),98);
__d("MWEncryptedBackupsViewAllOtcEligibleDialogStep.react",["fbt","CometScrollableArea.react","FBLogger","FDSListCellGlimmer.react","MWChatEncryptedBackupsQPLEvents","MWEncrypedBackupsSendOTCNotifications","MWEncryptedBackupsEligibleDeviceCell.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXMultiStepDialogHeader.react","MWXText.react","QPLUserFlow","gkx","react","react-compiler-runtime","useFetchOTCEligibleEBDevices","useVisibilityObserver","vulture"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useEffect,l=b.useRef,m=c("gkx")("23219"),n="https://www.facebook.com/help/messenger-app/431055522328649?ref=learn_more",o={cellsScrollableAreaFds:{marginStart:"x1mh8g0r",maxHeight:"xwazeda",paddingBottom:"x10b6aqq",width:"xh8yej3",$$css:!0},cellsScrollableAreaMds:{marginStart:"x1hk0nng",maxHeight:"x8vp032",width:"xh8yej3",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(25),e=a.onResendCodeFailure,f=a.onReturn;c("vulture")("M4MnY8ZVVhhosM03vjXSb-8ScsU=");b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={onVisible:r},b[0]=a):a=b[0];a=c("useVisibilityObserver")(a);var g=l(!1),i=d("MWEncrypedBackupsSendOTCNotifications").useSendOTCNotifications(),s=i[0];i=i[1];var t=c("useFetchOTCEligibleEBDevices")(),u=t.failedToFetchOtcDevices,v=t.isFetchOtcDevicesInFlight;t=t.otcEligibleDevices;var w=v?null:t.length,x,y;b[1]!==u||b[2]!==w||b[3]!==f?(x=function(){(w===0||u)&&g.current===!1&&(g.current=!0,f())},y=[u,w,f],b[1]=u,b[2]=w,b[3]=f,b[4]=x,b[5]=y):(x=b[4],y=b[5]);k(x,y);b[6]===Symbol["for"]("react.memo_cache_sentinel")?(x=j.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._(/*BTDS*/"Your devices"),withCloseButton:!1,withoutBackButton:!0}),b[6]=x):x=b[6];b[7]===Symbol["for"]("react.memo_cache_sentinel")?(y=h._(/*BTDS*/"Resend code"),b[7]=y):y=b[7];var z;b[8]!==e||b[9]!==f||b[10]!==s?(z=function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_RESEND_CODE_CLICK"),s().then(f)["catch"](function(){c("FBLogger")("labyrinth_web").mustfix("OTC: Send otc notifications sproc failed."),f(),e()})},b[8]=e,b[9]=f,b[10]=s,b[11]=z):z=b[11];b[12]!==i||b[13]!==z?(y={label:y,loading:i,onPress:z},b[12]=i,b[13]=z,b[14]=y):y=b[14];b[15]===Symbol["for"]("react.memo_cache_sentinel")?(i={label:h._(/*BTDS*/"Can\u2019t access the code?"),linkProps:{target:"_blank",url:n},onPress:q},b[15]=i):i=b[15];b[16]===Symbol["for"]("react.memo_cache_sentinel")?(z={className:"x977yut xyamay9"},b[16]=z):z=b[16];b[17]===Symbol["for"]("react.memo_cache_sentinel")?(z=j.jsx(c("MWXColumnItem.react"),{align:"start",children:j.jsx("div",babelHelpers["extends"]({},z,{children:j.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._(/*BTDS*/"Open your app on one of these devices to get a one-time code.")})}))}),b[17]=z):z=b[17];b[18]!==v||b[19]!==t?(z=j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:16,children:[z,j.jsx(c("MWXColumnItem.react"),{align:"start",children:v?j.jsx("div",babelHelpers["extends"]({className:"x889kno x65xoit"},{children:j.jsx(c("FDSListCellGlimmer.react"),{imageStyle:"circle",paddingHorizontal:0})})):j.jsx(c("CometScrollableArea.react"),{horizontal:!1,xstyle:m?o.cellsScrollableAreaMds:o.cellsScrollableAreaFds,children:j.jsx(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:0,children:t.map(p)})})})]}),b[18]=v,b[19]=t,b[20]=z):z=b[20];b[21]!==a||b[22]!==z||b[23]!==y?(v=j.jsxs(j.Fragment,{children:[x,j.jsx(c("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",primaryCallToAction:y,ref:a,secondaryCallToAction:i,children:z})]}),b[21]=a,b[22]=z,b[23]=y,b[24]=v):v=b[24];return v}function p(a,b){var d=a.appId,e=a.deviceId,f=a.manufacturer;a=a.model;return a!=null&&f!=null?j.jsx(c("MWXColumnItem.react"),{align:"start",children:j.jsx(c("MWEncryptedBackupsEligibleDeviceCell.react"),{deviceAppId:d,deviceManufacturer:f,deviceModel:a,eligibleDeviceCellId:"mw-chat-encrypted-backups-eligible-otc-device-"+b})},e):null}function q(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_CANT_ACCESS_CODE_CLICK")}function r(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_VIEW_ALL_DEVICES_SCREEN")}g["default"]=a}),226);
__d("MessengerExclamationMarkCircleOutline.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{d:"M16.594 13.497a1.41 1.41 0 1 1 2.812 0l-.344 5.505a1.064 1.064 0 0 1-2.124 0l-.344-5.505zM19.25 22.75a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0z"}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M29 18c0 6.075-4.925 11-11 11S7 24.075 7 18 11.925 7 18 7s11 4.925 11 11zm-2.5 0a8.5 8.5 0 1 1-17 0 8.5 8.5 0 0 1 17 0z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("PAKEDecryptSecretSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,WRONG_KEYS:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEGetActiveSessionSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,NO_SESSION:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEMessageTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({AWAITING_CLIENT:0,PAKE_MESSAGE_1:1,PAKE_MESSAGE_2_AND_SECRET:2,SESSION_EXPIRED_ERROR:3,MAX_ATTEMPTS_ERROR:4,GENERIC_ERROR:5,MESSAGE_SENT_ERROR:6,PREVIOUS_MESSAGE_MISSING_ERROR:7,INVALID_PREVIOUS_MESSAGE_ERROR:8,ENCRYPTION_ERROR:9,DECRYPTION_ERROR:10,CPACE_STEP_2_ERROR:11,FETCH_SECRETS_ERROR:12,CPACE_STEP_1_ERROR:13,CPACE_STEP_3_ERROR:14,PAKE_HANDSHAKE_SUCCESS:15,SERIALIZATION_ERROR:16,NO_ACTIVE_SESSION:17,MULTIPLE_ACTIVE_SESSIONS_ERROR:18,PROCESS_SECRETS_ERROR:19,TIMEOUT_ERROR:20,FLOW_ABANDONED_ERROR:21,DESERIALIZE_SECRETS_ERROR:22,CODE_REQUESTED:23,PQ_PAKE_MESSAGE_2:24,PQ_PAKE_MESSAGE_3:25,PQ_PAKE_SECRETS:26});f["default"]=a}),66);
__d("PakeInitiatorSprocCalls",["LSDecryptPakeSecretStoredProcedure","LSFactory","LSGetActiveSessionStoredProcedure","LSIntEnum","LSSendPakeMessageOneStoredProcedure","LSSendPakeMessageStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.clientType,e=a.initiatorId,g=a.messagePayload,i=a.sessionId;a=a.storage;c("promiseDone")(a.runInTransaction(function(a){return c("LSSendPakeMessageOneStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e,messagePayload:g,sessionId:i})},"readwrite",void 0,void 0,f.id+":45"))}function b(a){var b=a.clientType,e=a.initiatorId;a=a.storage;return a.runInTransaction(function(a){return c("LSGetActiveSessionStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e})},"readwrite",void 0,void 0,f.id+":71")}function e(a){var b=a.clientType,e=a.encryptionKey,g=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSDecryptPakeSecretStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),encryptionKey:e,sessionId:g})},"readwrite",void 0,void 0,f.id+":92")}function i(a){var b=a.clientType,e=a.messagePayload,g=a.messageType,i=a.senderId,j=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSSendPakeMessageStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),messagePayload:e,messageType:h.ofNumber(g),senderId:i,sessionId:j})},"readwrite",void 0,void 0,f.id+":116")}g.sendPakeMessageOne=a;g.joinPakeSession=b;g.decryptPakeSecret=e;g.sendPakeMessage=i}),98);
__d("PakeQplLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","ODS","QPLEvent","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){c("QPLUserFlow").getActiveFlowIDs().includes((h||(h=d("QPLEvent"))).getMarkerId(a))||((i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").START),c("QPLUserFlow").start(a,{annotations:{string:babelHelpers["extends"]({},b)}}))}function b(a){var b=a.annotations,e=a.errorName,f=a.event;a=a.isUserError;c("QPLUserFlow").endFailure(f,e,{annotations:b});f=a===!0?c("MWEBODSEntityKey.enum").SUCCESS:c("MWEBODSEntityKey.enum").FAIL;(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,f)}function e(a,b){c("QPLUserFlow").endSuccess(a,{annotations:b}),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").SUCCESS)}g.startPakeQPLFlow=a;g.endPakeQPLFlowFailure=b;g.endPakeQPLFlowSuccess=e}),98);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9747954008656745"}),null);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql",["VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"begin_login_request",variableName:"input"}],concreteType:"VestaBeginLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_begin_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2_sig",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderBeginLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9611648865601020"}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql",["VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"finish_login_request",variableName:"input"}],concreteType:"VestaFinishLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_login_payload",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderFinishLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9285801411531503"}),null);
__d("VestaServerGraphQLLoginProviderInitQuery.graphql",["VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"}],c=[{alias:null,args:[{kind:"Variable",name:"vesta_init_request",variableName:"request"}],concreteType:"VestaInitIqResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_login_init",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderInitQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderInitQuery",selections:c},params:{id:b("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderInitQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProvider",["E2EEBackupUtil","RelayHooks","RelayModern","VestaServerGraphQLLoginProviderBeginLoginMutation.graphql","VestaServerGraphQLLoginProviderFinishLoginMutation.graphql","VestaServerGraphQLLoginProviderInitQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a,c){c=c.environment;c=await d("RelayHooks").fetchQuery(c,h!==void 0?h:h=b("VestaServerGraphQLLoginProviderInitQuery.graphql"),{request:{fbid:a.clientId,product_use_case:a.productUseCase,vesta_client_api_version:6}}).toPromise();a=c==null?void 0:c.fbid_based_auth_layer_vesta_login_init;c=a==null?void 0:a.base64url_encoded_island_rsa_pub;var e=a==null?void 0:a.base64url_encoded_island_rsa_pub_signature,f=a==null?void 0:a.base64url_encoded_opaque_pub,g=a==null?void 0:a.base64url_encoded_opaque_pub_signature,i=a==null?void 0:a.base64url_encoded_island_ed25519_pub,j=a==null?void 0:a.base64url_encoded_island_ed25519_pub_signature,k=a==null?void 0:a.is_registered;a=a==null?void 0:a.attempts_remaining;if(c!=null&&e!=null&&f!=null&&g!=null&&i!=null&&j!=null&&k!=null){var l;return{islandRsaPub:(l=d("E2EEBackupUtil")).decodeBase64Url(c),islandRsaPubSig:l.decodeBase64Url(e),opaquePub:l.decodeBase64Url(f),opaquePubSig:l.decodeBase64Url(g),islandEd25519Pub:l.decodeBase64Url(i),islandEd25519PubSig:l.decodeBase64Url(j),isRegistered:k,loginAttemptsRemaining:a}}throw new Error("GraphQL Response is Null")}function c(a,c){var e=c.environment,f=i!==void 0?i:i=b("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql"),g={input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l1:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL1)}};return new Promise(function(a,b){d("RelayModern").commitMutation(e,{mutation:f,variables:g,onCompleted:function(c){c=c.fbid_based_auth_layer_vesta_begin_login;var e=c==null?void 0:c.base64url_encoded_opaque_l2;c=c==null?void 0:c.base64url_encoded_opaque_l2_sig;if(e!=null&&c!=null){a({opaqueL2:d("E2EEBackupUtil").decodeBase64Url(e),opaqueL2Sig:d("E2EEBackupUtil").decodeBase64Url(c)});return}b(new Error("GraphQL Response is Null"))},onError:function(a){b(a)}})})}function e(a,c){var e=c.environment,f=c.updater;return new Promise(function(c,g){d("RelayModern").commitMutation(e,{mutation:j!==void 0?j:j=b("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql"),variables:{input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l3:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL3)}},onCompleted:function(a){a=a.fbid_based_auth_layer_vesta_finish_login;var b=a==null?void 0:a.base64url_encoded_login_payload,e=a==null?void 0:a.login_success;a=a==null?void 0:a.attempts_remaining;if(e!=null){c({loginSuccess:e,loginPayload:b==null?b:d("E2EEBackupUtil").decodeBase64Url(b),attemptsRemaining:a});return}g(new Error("GraphQL Response is Null"))},onError:function(a){g(a)},updater:f})})}g.initLogin=a;g.beginLogin=c;g.finishLogin=e}),98);
__d("deserializeSecretsAndAddDevice",["EBMainThreadEBDBApiDeferred","EBWorkerODSEntityName.enum","FBLogger","I64","LSAuthorityLevel","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","MWDeserializeSecretsAndAddDevice","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWPakeQPLEvents","PAKEMessageTypeEnum","PakeQplLogging","QPLUserFlow","ReQL","cr:17321","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.db,e=a.initiatorId,f=a.onAddDeviceFailure,g=a.onAddDeviceFinish;a=a.secrets;var k=function(){};c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_START");return c("MWDeserializeSecretsAndAddDevice")({initiatorId:e,secrets:a,storage:b}).then(function(a){a=a[0];a||(c("FBLogger")("labyrinth_web").mustfix("PAKE: deserializeSecretsAndAddDevice sproc failed"),d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}},errorName:"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),f());k=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.recoveryCodeStatus;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").VALID))){k();c("QPLUserFlow").addPoint((e=d("MWPakeQPLEvents")).pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_END");void d("EBMainThreadEBDBApiDeferred").addNewDevice();g();c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_START");d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:b,onFailure:function(){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1}},errorName:"MEB_INITIALIZE_RESTORE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1})}});c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_END");d("PakeQplLogging").endPakeQPLFlowSuccess(e.pakeInitiatorQplEvent);c("promiseDone")(j(b))}else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))c("FBLogger")("labyrinth_web").mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}},errorName:"MEB_FINISH_ADD_PEER_DEVICE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),f();else{e="PAKE: Unexpected recovery code status: "+(h||(h=d("I64"))).to_int32(a);c("FBLogger")("labyrinth_web").mustfix(e)}}});return k}).catch(function(a){a="PAKE: error when adding new device using OTC, "+a;c("FBLogger")("labyrinth_web").mustfix(a);d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR},string:{exceptionMessage:a}},errorName:"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_EXCEPTION",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});f();k();return function(){}})}async function j(a){if(b("cr:17321")!=null){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).filter(function(a){a=a.authorityLevel;return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}));if(a!=null&&a.deviceId!=null){var e=a.deviceId;void (b("cr:17321")==null?void 0:b("cr:17321").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:a.backupId,deviceRegistrationId:d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),isAutoRestore:!1,previousDeviceId:e,source:c("EBWorkerODSEntityName.enum").MW_EB_OTC_MAIN_THREAD}))}}}g.default=a}),98);
__d("establishPakeHandshakeAsInitiator",["Base64Utils","FBLogger","I64","MWEncryptedBackupsDeviceRegistrationId","MWPakeQPLEvents","PAKECleanupSessionReasonEnum","PAKEDecryptSecretSprocStatusEnum","PAKEGetActiveSessionSprocStatusEnum","PAKEMessageTypeEnum","PakeCpaceUtils","PakeCpaceWasm","PakeQplLogging","QPLUserFlow","ReQL","clearTimeout","promiseDone","requireDeferred","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("CleanupPakeSession").__setRef("establishPakeHandshakeAsInitiator"),j=c("requireDeferred")("PakeInitiatorSprocCalls").__setRef("establishPakeHandshakeAsInitiator"),k=(h||(h=d("I64"))).of_int32(-1),l=3e3,m="PAKE_INITIATOR_FAILURE";async function a(a){var b=a.clientType,e=a.onGeneralFailure,f=a.onMaxAttemptsReached,g=a.onNoSessionExists,n=a.onSessionExpired,o=a.onSuccessfulSecretDecryption,p=a.onWrongOtc,q=a.otc,r=a.pakeCpaceModule,s=a.storage,t=a.timeout,u=function(){},v=function(){z&&c("clearTimeout")(z)},w=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(w===""){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return{pakeClient:null,stopTimeout:v,unsubFromMessagesTable:u}}var x=(a=r)!=null?a:await d("PakeCpaceWasm").PakeCPaceWasm(),y=x.createCPaceClient(w),z=null,A=null,B=!1,C=d("ReQL").fromTableAscending(s.tables.pake_messages),D=function(){z&&c("clearTimeout")(z),z=c("setTimeout")(function(){e(),u(),i.onReady(function(a){c("promiseDone")(a({cleanupReason:c("PAKECleanupSessionReasonEnum").TIMEOUT,clientType:b,deviceId:w,storage:s}))}),c("FBLogger")("labyrinth_web").mustfix("PAKE handshake failed by timeout")},t)},E=function(){A&&c("clearTimeout")(A),A=c("setTimeout")(function(){c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_RETRY_JOIN_SESSION"),B=!0,M()},l)},F=function(a){var d=a.messageType,f=a.sessionId;e();j.onReady(function(a){c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:d,senderId:w,sessionId:f,storage:s}))})},G=function(a){var e=a.messagePayload,f=a.responderId,g=a.sessionId;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_THREE_START");if(e==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake messagePayload was null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return}if(f==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake responderId was null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return}a=d("Base64Utils").toArrayBuffer(e);var i;try{f=x.clientFinalize(y,new Uint8Array(a));i=f.clientKey1}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR,sessionId:g});d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 3")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_START");j.onReady(function(a){c("promiseDone")(a.decryptPakeSecret({clientType:b,encryptionKey:d("PakeCpaceUtils").typedArrayToBuffer(i),sessionId:g,storage:s}),function(e){var f=e[0];e=e[1];v();switch((h||(h=d("I64"))).to_int32(e)){case c("PAKEDecryptSecretSprocStatusEnum").SUCCESS:if(f==null){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: decryptedSecret is null despite SPROC success")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_END");c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:c("PAKEMessageTypeEnum").PAKE_HANDSHAKE_SUCCESS,senderId:w,sessionId:g,storage:s}));o({decryptedSecret:f,initiatorId:w});break;case c("PAKEDecryptSecretSprocStatusEnum").WRONG_KEYS:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!0}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!0});p();break;case c("PAKEDecryptSecretSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g});break}},function(a){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},string:{exceptionMessage:a}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g})})})},H=function(a){var b=a.annotations,e=a.fbLoggerMessage,f=a.isUserError,g=a.messageType,h=a.onFinish;a=a.unsubFromTable;v();a();h();e!=null&&c("FBLogger")("labyrinth_web").mustfix(e,g);d("PakeQplLogging").endPakeQPLFlowFailure({annotations:b,errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:f})},I=function(a){var b=a.onPakeStepOneSuccess;u=C.subscribe(function(a,f){if(f.operation!=="put"&&f.operation!=="add")return;a=f.value;f=(h||(h=d("I64"))).to_int32(a.messageType);switch(f){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_1:c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_PAKE_MESSAGE_ONE_END");u();b();break;case c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR:case c("PAKEMessageTypeEnum").PREVIOUS_MESSAGE_MISSING_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one due to invalid state",isUserError:!1,messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").MESSAGE_SENT_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one",isUserError:!1,messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:break}})},J=function(a){var b=a.sessionId;u=C.subscribe(function(a,g){if(g.operation!=="put"&&g.operation!=="add")return;a=g.value;g=(h||(h=d("I64"))).to_int32(a.messageType);switch(g){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_2_AND_SECRET:u();G({messagePayload:a.messagePayload,responderId:a.responderId,sessionId:b});break;case c("PAKEMessageTypeEnum").MAX_ATTEMPTS_ERROR:return H({annotations:{bool:{isUserError:!0},int:{errorCode:g}},isUserError:!0,messageType:g,onFinish:function(){return f()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").SESSION_EXPIRED_ERROR:return H({annotations:{bool:{isUserError:!0},int:{errorCode:g}},isUserError:!0,messageType:g,onFinish:function(){return n()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").GENERIC_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Something went wrong in the responder device",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FETCH_SECRETS_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Responder device failed to fetch secrets.",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FLOW_ABANDONED_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Responder device flow was abandoned.",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:return H({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},fbLoggerMessage:"PAKE: Unexpected Message Type when listening for pake step two success "+g,isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}})}})},K=function(a){var f=a.onJoinSessionSuccess;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_GET_ACTIVE_SESSION_START");j.onReady(function(a){c("promiseDone")(a.joinPakeSession({clientType:b,initiatorId:w,storage:s}),function(a){var b=a[0],i=a[1];a=a[2];i=(i=i)!=null?i:k;switch((h||(h=d("I64"))).to_int32(b)){case c("PAKEGetActiveSessionSprocStatusEnum").SUCCESS:if(a==null||i===k){c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, responderId or joinedSessionId were unexpectedly null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});e();return}f(a,i);c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{string:{session_id:(h||(h=d("I64"))).to_string(i)}});break;case c("PAKEGetActiveSessionSprocStatusEnum").NO_SESSION:if(B===!1){E();return}d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!0},int:{errorCode:c("PAKEMessageTypeEnum").NO_ACTIVE_SESSION}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!0});g();v();break;case c("PAKEGetActiveSessionSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed");e();v();break}},function(){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed"),e(),v()})})},L=function(a){var e=a.responderId,f=a.sessionId,g;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_ONE_START");try{g=x.clientBegin(y,q,e)}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR,sessionId:f});d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 1")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_MESSAGE_ONE_START");j.onReady(function(a){a.sendPakeMessageOne({clientType:b,initiatorId:w,messagePayload:d("PakeCpaceUtils").typedArrayToBuffer(g),sessionId:f,storage:s})});I({onPakeStepOneSuccess:function(){J({sessionId:f})}})},M=function(){D();d("PakeQplLogging").startPakeQPLFlow(d("MWPakeQPLEvents").pakeInitiatorQplEvent);K({onJoinSessionSuccess:function(a,b){L({responderId:a,sessionId:b})}});return{pakeClient:y,stopTimeout:v,unsubFromMessagesTable:u}};return M()}g.default=a}),98);
__d("mwEBAddDevice",["EBSMAPI","MAWCurrentUser","cr:17321"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.environment,f=a.onFailure,g=a.onInvalidRecoveryCode,h=a.onStart,i=a.onSuccess,j=a.recoveryCode,k=a.storage,l=a.traceId,m=a.trackAddingDevice;a=a.trackOverprompting;return c("EBSMAPI").addDeviceWithRecoveryCode({environment:e,isInWorker:!1,onFailure:f,onInvalidRecoveryCode:g,onStart:h,onSuccess:i,recoveryCode:j,storage:k,traceId:l,trackAddingDevice:m,trackOverprompting:a,userId:d("MAWCurrentUser").getID()}).then(function(){b("cr:17321")==null?void 0:b("cr:17321").fireAndForget("backend","addDeviceWithPinInWorker",{recoveryCode:j,userId:d("MAWCurrentUser").getID()})})}g.EBAddDevice=a}),98);
__d("vestaBackupSecretRestore",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("E2EEBackupSecretRestoreModule").__setRef("vestaBackupSecretRestore"),i=c("requireDeferred")("VestaServerGraphQLLoginProvider").__setRef("vestaBackupSecretRestore");async function a(a){var b=a.input;a=a.environment;var c=await Promise.all([i.load(),h.load()]),d=c[0],e=d.beginLogin,f=d.finishLogin;d=d.initLogin;c=c[1].restoreBackupSecret;return c({beginLogin:e,finishLogin:f,initLogin:d},b,{environment:a})}g.default=a}),98);
__d("mwEBGetPINSecretFromVesta",["CometRelay","E2EEBackupCommon","FBLogger","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWTraceUtils","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSettingsDialogQuery.graphql","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","QPLUserFlow","promiseDone","vestaBackupSecretRestore"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a){var b=a.addDevice,e=a.clientID,f=a.environment,g=a.getSourceFromContext,i=a.onSubmitPin,j=a.onSubmitPinFailure,k=a.onVestaSecretFetch,l=a.pinCode,m=a.productUseCase,n=a.setIsInProgress,o=a.setIsPinCodeIncorrect,p=a.setIsVestaError;a=a.startFlow;var q=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_LOGIN),d("MAWTraceUtils").CONTEXT_VESTA_LOGIN);n(!0);i==null?void 0:i();i=g();c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"pin_code",source:i}});g=new TextDecoder();var r;a({additionalAnnotations:{device_type:"HSM"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH,source:i});try{c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_begin"),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_SUBMIT"),d("MAWTraceUtils").recordCheckpointForTrace(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_CALLING_VESTA_LOGIN),[],!1),r=g.decode(await c("vestaBackupSecretRestore")({environment:f,input:{clientId:e,productUseCase:m,vestaAccountPin:l}})),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_success"),d("MAWTraceUtils").recordCheckpointForTrace(q,h.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_LOGIN_COMPLETION),[],!1)}catch(b){j==null?void 0:j();c("promiseDone")(d("CometRelay").fetchQuery(f,c("MWChatEncryptedBackupsSettingsDialogQuery.graphql"),{}).toPromise());if(b.errorType===d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD)n(!1),o(!0),d("MWChatEncryptedBackupsLogging").endFailure({errorName:"incorrect_pin_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_PIN_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"incorrect_pin_code"),d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Incorrect pin code");else{d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorMessage:b.message,errorType:b.errorType}},errorName:"vesta_login_failure",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH});c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"pin_code_error");n(!1);p(!0);a="Error when restoring using PIN: "+b;c("FBLogger")("labyrinth_web").mustfix(a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],b.toString())}throw b}r!=null&&(d("MAWTraceUtils").recordCheckpointForTrace(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_ADD_DEVICE),[],!1),k==null?void 0:k(),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_begin"),b(r,q,l))}g.default=a}),98);
__d("updateUpsellsStateInRelayStore",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.updateValue;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][upsells] A viewer record does not exist when updating upsell state.");return}a.setValue(e,"is_eb_restore_upsells_dismissed")})}g["default"]=a}),98);
__d("useMWEBAutoRestoreNoticeDialog",["JSResourceForInteraction","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","QPLUserFlow","ReQL","ReQLSuspense","react","react-compiler-runtime","useLabyrinthLogging","useMWEBSetHasSeenNotice","useMWXLazyDialog","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useCallback;var j=c("JSResourceForInteraction")("MWEBAutoRestoreNoticeDialog.react").__setRef("useMWEBAutoRestoreNoticeDialog");function a(){var a=d("react-compiler-runtime").c(9),b=d("useLabyrinthLogging").useLabyrinthLoggingFlow(),e=b.startFlow;b=c("useMWXLazyDialog")(j);var g=b[0],i=(h||(h=c("useReStore")))();a[0]!==i.tables.auto_restore_opt_out?(b=function(){return d("ReQL").fromTableAscending(i.tables.auto_restore_opt_out)},a[0]=i.tables.auto_restore_opt_out,a[1]=b):b=a[1];var l;a[2]!==i?(l=[i],a[2]=i,a[3]=l):l=a[3];var m=d("ReQLSuspense").useArray(b,l,f.id+":45"),n=c("useMWEBSetHasSeenNotice")();a[4]!==m||a[5]!==n||a[6]!==g||a[7]!==e?(b=function(a){var b=a.hasSeenNotice;a=a.source;var f=m.filter(k).length>0;e({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,source:a});if(f){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_OPTED_OUT");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent});return}c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_OPTED_IN");d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);if(b){d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent});return}n();g({})},a[4]=m,a[5]=n,a[6]=g,a[7]=e,a[8]=b):b=a[8];return b}function k(a){return a.optOutKey===c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(b){return c.db.table(185).add({pk:c.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:c.i64.cast([0,1])})},function(a){return c.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[2]!==void 0?c.sequence([function(e){return d[11]=d[2].get("epoch_keys"),d[12]=d[11].get("epoch_id"),d[13]=new c.Map(),d[13].set("existing_device_id",a[1]),d[13].set("base_epoch_id",d[12]),d[14]=new c.Map(),d[14].set("success",d[13]),d[15]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[15],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[4]=void 0}]):c.sequence([function(a){return d[3]!==void 0?c.sequence([function(a){return d[12]=d[3].get("error_message"),d[13]=d[3].get("error_code"),d[14]=new c.Map(),d[14].set("error_code",d[13]),d[14].set("stored_procedure","onboardFromExistingDeviceStart"),d[14].set("error_message",d[12]),d[15]=new c.Map(),d[15].set("failure",d[14]),d[16]=c.toJSON(d[15]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[16],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[18]=new c.Map(),d[18].set("error_code",d[13]),d[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[18].set("error_message",""),d[11]=d[18]}]):c.sequence([function(a){return d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,603])),d[12].set("stored_procedure","onboardFromExistingDeviceStart"),d[12].set("error_message","Unknown error encountered"),d[13]=new c.Map(),d[13].set("failure",d[12]),d[14]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[14],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,603])),d[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[16].set("error_message",""),d[11]=d[16]}])},function(a){return d[4]=d[11]}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][onboardFromExistingDeviceStart] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure";a.__tables__=["experiences_shared_state","device_metadata"];e.exports=a}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOnboardFromExistingDeviceStart"),e.backupId,e.previousDeviceId,e.newDeviceRegistrationId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeRestoreDeferred",["MWChatEncryptedBackupsQPLEvents","QPLUserFlow","WALogger","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error initializing restore: ",""]);h=function(){return a};return a}var i=c("requireDeferred")("MWEncryptedBackupsInitializeRestore").__setRef("MWEncryptedBackupsInitializeRestoreDeferred");function a(a){var b=a.db,e=a.onFailure,f=a.onSuccess;i.onReady(function(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore_sproc"),c("promiseDone")(a.initializeRestore(b),f,function(a){d("WALogger").ERROR(h(),a),e==null?void 0:e("failed_to_initialize_restore")})})}g.encryptedBackupsInitializeRestoreDeferred=a}),98);
__d("EBAddDeviceWithKeys",["ClientConsistencyEventEmitter","CurrentAppID","EBAPIQPLPoints","EBSMAPI","EBSMGatingUI","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MAWEncryptedBackupsPersistedDB","MAWIndexedDbMetadata","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ODS","Promise","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","err","getErrorSafe","gkx","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore success"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore failed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys client state row added"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithKeys sproc failed, isInWorker: ",", error: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys caling LSOnboardFromExistingDeviceStartStoredProcedure"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys start"]);s=function(){return a};return a}var t=c("requireDeferred")("MWEBUseLocalStorage").__setRef("EBAddDeviceWithKeys");function a(a){var e=a.backupId,g=a.db,v=a.isInWorker,w=a.newDeviceRegistrationId,x=a.previousDeviceId,y=a.source,z=a.trackAddingDevice;return new(k||(k=b("Promise")))(function(a,b){d("WALogger").LOG(s());v||u("START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC",d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent);var k=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")()),A=c("qpl")._(521473756,"2768"),B=y;c("QPLUserFlow").start(A,{annotations:{bool:{isEBAddDeviceWithKeys:!0,isGraphQL:!1,isInWorker:v},string:{restore_type:B}},instanceKey:k,timeoutInMs:c("justknobx")._("4226")});c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START,{instanceKey:k});(h||(h=d("ODS"))).bumpEntityKey(7319,B,"start");d("WALogger").LOG(r());g.runInTransaction(function(a){return c("LSOnboardFromExistingDeviceStartStoredProcedure")(c("LSFactory")(a),{backupId:e,newDeviceRegistrationId:w,previousDeviceId:x})},"readwrite",void 0,void 0,f.id+":113").then(function(e){e=e[0];v||u("END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC",d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent);c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END,{instanceKey:k});if(e!=null){var f=d("LSShape").toRecord(e).error_message;v||(v||u("FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM",d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent),v||u("FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM",d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent),d("MWChatEncryptedBackupsLogging").endFailure({errorName:f,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:f,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}));c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{annotations:{string:{error_code:(i||(i=d("I64"))).to_string(d("LSShape").toRecord(e).error_code),error_message:f}},instanceKey:k});(h||(h=d("ODS"))).bumpEntityKey(7319,B,"fail");d("WALogger").ERROR(q(),v.toString(),f);e=c("gkx")("11709")&&v?d("MAWIndexedDbMetadata").EBSM_WORKER_DB_PREFIX:"";c("promiseDone")(d("MAWEncryptedBackupsPersistedDB").deleteEBIDB(e));if(!v)switch(d("CurrentAppID").getAppID()){case 772021112871879..toString():c("ClientConsistencyEventEmitter").emit("hardRefresh","eb_autorestore_error");break;default:c("ClientConsistencyEventEmitter").emit("softRefresh","eb_autorestore_error")}b(c("err")(f))}c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_START,{instanceKey:k});var l=d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_client_state).subscribe(function(b,e){if(e.operation==="add"||e.operation==="put"){b=e.value;e=b.authorityLevel;b=b.deviceId;(i||(i=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(v||u("END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK",d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent),c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_END,{instanceKey:k}),l(),c("promiseDone")(d("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:g,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),d("WALogger").LOG(p()),v||(t.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),z(b),d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:g,onFailure:function(){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").ERROR(o())},onSuccess:function(){c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").LOG(n())}})),c("EBSMAPI").fetchBackupIds(g)["catch"](function(a){d("WALogger").ERROR(m(),c("getErrorSafe")(a).message)}),c("QPLUserFlow").endSuccess(c("qpl")._(521473756,"2768"),{instanceKey:k}),(h||(h=d("ODS"))).bumpEntityKey(7319,B,"success"),a())}})})["catch"](function(a){a="[wmi][ebsm] EBAPI addDeviceWithKeys sproc error, isInWorker: "+v.toString()+", error: "+c("getErrorSafe")(a).message;v||(d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}));c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{annotations:{string:{error_message:a}},instanceKey:k});(h||(h=d("ODS"))).bumpEntityKey(7319,B,"fail");d("WALogger").ERROR(l(),a);b(c("err")(a))})})}function u(a,b){c("QPLUserFlow").addPoint(b,a)}g.addDeviceWithEBKeys=a}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1415]),c.i64.cast([0,2]),a[1],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})},function(e){return a[2]?c.resolve(0):a[1]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",a[1]].join("")),d[7]=c.createArray(),void 0!==void 0?d[8]=(d[7].push(void 0),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",a[1],d[7],c.i64.cast([0,3]))):c.resolve()},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure";a.__tables__=["secure_encrypted_backups_recovery_code_status"];e.exports=a}),null);
__d("GaloisField32",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=c("FBLogger")("labyrinth_web"),i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,5,7,1,3,13,15,9,11,21,23,17,19,29,31,25,27,0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,21,22,19,16,25,26,31,28,13,14,11,8,1,2,7,4,0,4,8,12,16,20,24,28,5,1,13,9,21,17,29,25,10,14,2,6,26,30,18,22,15,11,7,3,31,27,23,19,0,5,10,15,20,17,30,27,13,8,7,2,25,28,19,22,26,31,16,21,14,11,4,1,23,18,29,24,3,6,9,12,0,6,12,10,24,30,20,18,21,19,25,31,13,11,1,7,15,9,3,5,23,17,27,29,26,28,22,16,2,4,14,8,0,7,14,9,28,27,18,21,29,26,19,20,1,6,15,8,31,24,17,22,3,4,13,10,2,5,12,11,30,25,16,23,0,8,16,24,5,13,21,29,10,2,26,18,15,7,31,23,20,28,4,12,17,25,1,9,30,22,14,6,27,19,11,3,0,9,18,27,1,8,19,26,2,11,16,25,3,10,17,24,4,13,22,31,5,12,23,30,6,15,20,29,7,14,21,28,0,10,20,30,13,7,25,19,26,16,14,4,23,29,3,9,17,27,5,15,28,22,8,2,11,1,31,21,6,12,18,24,0,11,22,29,9,2,31,20,18,25,4,15,27,16,13,6,1,10,23,28,8,3,30,21,19,24,5,14,26,17,12,7,0,12,24,20,21,25,13,1,15,3,23,27,26,22,2,14,30,18,6,10,11,7,19,31,17,29,9,5,4,8,28,16,0,13,26,23,17,28,11,6,7,10,29,16,22,27,12,1,14,3,20,25,31,18,5,8,9,4,19,30,24,21,2,15,0,14,28,18,29,19,1,15,31,17,3,13,2,12,30,16,27,21,7,9,6,8,26,20,4,10,24,22,25,23,5,11,0,15,30,17,25,22,7,8,23,24,9,6,14,1,16,31,11,4,21,26,18,29,12,3,28,19,2,13,5,10,27,20,0,16,5,21,10,26,15,31,20,4,17,1,30,14,27,11,13,29,8,24,7,23,2,18,25,9,28,12,19,3,22,6,0,17,7,22,14,31,9,24,28,13,27,10,18,3,21,4,29,12,26,11,19,2,20,5,1,16,6,23,15,30,8,25,0,18,1,19,2,16,3,17,4,22,5,23,6,20,7,21,8,26,9,27,10,24,11,25,12,30,13,31,14,28,15,29,0,19,3,16,6,21,5,22,12,31,15,28,10,25,9,26,24,11,27,8,30,13,29,14,20,7,23,4,18,1,17,2,0,20,13,25,26,14,23,3,17,5,28,8,11,31,6,18,7,19,10,30,29,9,16,4,22,2,27,15,12,24,1,21,0,21,15,26,30,11,17,4,25,12,22,3,7,18,8,29,23,2,24,13,9,28,6,19,14,27,1,20,16,5,31,10,0,22,9,31,18,4,27,13,1,23,8,30,19,5,26,12,2,20,11,29,16,6,25,15,3,21,10,28,17,7,24,14,0,23,11,28,22,1,29,10,9,30,2,21,31,8,20,3,18,5,25,14,4,19,15,24,27,12,16,7,13,26,6,17,0,24,21,13,15,23,26,2,30,6,11,19,17,9,4,28,25,1,12,20,22,14,3,27,7,31,18,10,8,16,29,5,0,25,23,14,11,18,28,5,22,15,1,24,29,4,10,19,9,16,30,7,2,27,21,12,31,6,8,17,20,13,3,26,0,26,17,11,7,29,22,12,14,20,31,5,9,19,24,2,28,6,13,23,27,1,10,16,18,8,3,25,21,15,4,30,0,27,19,8,3,24,16,11,6,29,21,14,5,30,22,13,12,23,31,4,15,20,28,7,10,17,25,2,9,18,26,1,0,28,29,1,31,3,2,30,27,7,6,26,4,24,25,5,19,15,14,18,12,16,17,13,8,20,21,9,23,11,10,22,0,29,31,2,27,6,4,25,19,14,12,17,8,21,23,10,3,30,28,1,24,5,7,26,16,13,15,18,11,22,20,9,0,30,25,7,23,9,14,16,11,21,18,12,28,2,5,27,22,8,15,17,1,31,24,6,29,3,4,26,10,20,19,13,0,31,27,4,19,12,8,23,3,28,24,7,16,15,11,20,6,25,29,2,21,10,14,17,5,26,30,1,22,9,13,18],j=[0,1,18,28,9,23,14,12,22,4,25,16,7,15,6,13,11,24,2,29,30,26,8,5,17,10,21,31,3,19,20,27],k="ACDEFHJKLMNPQRSTUVWXYZ0123456789",l=function(){var a={};for(var b=0;b<k.length;b++)a[k[b]]=b;return a}();function m(a,b){return i[a*32+b]}function a(a){var b=[];for(var c=0;c<a.length;c++){if(!(a[c]in l)){h.mustfix("gf32: tried to convert invalid string to GF32 matrix: %s",a);return null}b[c]=l[a[c]]}return b}function b(a){var b=[];for(a of a)b.push(k[a]);return b.join("")}function n(a){return a===0||a===1||a===2||a===3||a===4||a===5||a===6||a===7||a===8||a===9||a===10||a===11||a===12||a===13||a===14||a===15||a===16||a===17||a===18||a===19||a===20||a===21||a===22||a===23||a===24||a===25||a===26||a===27||a===28||a===29||a===30||a===31?a:null}function d(a){var b=[];for(var c=0;c<a.length;c++){var d=n(a[c]);if(d==null)throw h.mustfixThrow("gf32: tried to convert bad value to GF32 element: %s",a[c]);b.push(d)}return b}function o(a,b){var c=a^b,d=n(c);if(d==null)throw h.mustfixThrow("gf32: xor of gf32 elements returned a non-element (should be impossible): %s ^ %s = %s",a,b,c);return d}function p(a,b,c,d,e){for(var f=0;f<b;f++)a[c*b+f]=o(a[c*b+f],m(a[d*b+f],e))}function q(a,b,c,d){for(var e=0;e<b;e++){var f=a[c*b+e];a[c*b+e]=a[d*b+e];a[d*b+e]=f}}function r(a,b,c,d){for(var e=0;e<b;e++)a[c*b+e]=m(a[c*b+e],d)}function s(a,b){if(b===0)throw h.mustfixThrow("gf32: tried to divide by 0");return m(a,j[b])}function t(a){var b=Array(a*a).fill(0);for(var c=0;c<a;c++)b[c*a+c]=1;return b}function e(a,b){a=a.slice();var c=t(b);for(var d=0;d<b;d++){var e=d;if(a[d*b+e]===0){var f=!1;for(var g=d+1;g<b;g++)if(a[g*b+e]!==0){q(a,b,d,g);q(c,b,d,g);f=!0;break}if(!f)return null}for(g=d+1;g<b;g++){f=s(a[g*b+e],a[d*b+e]);p(a,b,g,d,f);p(c,b,g,d,f)}}for(f=b-1;f>=0;f--){e=f;for(g=f-1;g>=0;g--){d=s(a[g*b+e],a[f*b+e]);p(a,b,g,f,d);p(c,b,g,f,d)}}for(d=0;d<b;d++){e=a[d*b+d];if(e===0)return null;r(c,b,d,j[e])}return c}f=0;g.zero=f;g.matrixToSymbols=b;g.symbolsToMatrix=a;g.invert=e;g.xor=o;g.multiply=m;g.asGf32MatExn=d}),98);
__d("GF32RecoveryCodes",["FBLogger","GaloisField32"],(function(a,b,c,d,e,f,g){"use strict";var h=c("FBLogger")("labyrinth_web"),i=34,j=4,k=3,l=i+j,m=d("GaloisField32").asGf32MatExn([18,24,16,12,8,20,2,19,4,22,21,5,28,5,14,21,7,16,15,10,3,9,28,22,11,30,19,6,7,7,9,18,16,2,9,12,18,14,7,6,5,16,9,24,16,28,19,2,14,8,2,4,1,21,26,21,10,27,16,25,18,14,20,17,11,22,21,22,16,20,2,5,0,9,6,7,23,23,23,11,6,5,3,31,29,30,17,28,0,30,28,7,13,5,11,22,12,16,25,3,20,22,26,22,14,29,5,14,5,19,12,19,18,8,25,7,30,7,8,12,0,26,15,10,17,21,2,29,14,4,31,7,29,6,29,1,14,16,17,15,4,16,7,4,7,4,8,26,10,23,24,26]);function n(a,b,c){c===void 0&&(c=1);var d=[];for(a=a;a<b;a+=c)d.push(a);return d}var o={};function p(a,b){function c(a,b,d,e){if(b<=0)return[[]];if(e-d<=b)return[n(d,e)];var f=a|b<<8|d<<16|e<<24,g=o[f];if(g!=null)return g;var h=[];c(a-1,b-1,d+1,e).forEach(function(a){a=a.slice();a.splice(0,0,d);h.push(a)});c(a-1,b,d+1,e).forEach(function(a){h.push(a.slice())});o[f]=h;return h}return c(a,b,0,a)}function q(a,b){var c=a.length,d=Array(c*c).fill(0),e=0;for(var f=0;f<j;f++){if(f===b)continue;for(var g=0;g<c;g++){var h=a[g];d[e*c+g]=m[f*l+h]}e++}return d}function r(a,b){for(var c=0;c<j;c++){var e=q(a,c);e=d("GaloisField32").invert(e,b);if(e!=null)return{excludeRow:c,submatInv:e}}return null}function a(a){var b=Array(j).fill(0);for(var c=0;c<j;c++)for(var e=0;e<i;e++)b[c]=d("GaloisField32").xor(b[c],d("GaloisField32").multiply(m[c*l+e],a[e]));e=Array(j*j);for(a=0;a<j;a++)for(c=0;c<j;c++)e[a*j+c]=m[a*l+i+c];c=d("GaloisField32").invert(e,j);if(c==null)throw h.mustfixThrow("gf32: failed to invert error code submatrix (should be impossible): %s",JSON.stringify(e));a=Array(j).fill(0);for(e=0;e<j;e++)for(var f=0;f<j;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(c[e*j+f],b[f]));return a}function b(a){var b=new Set(),c=d("GaloisField32").symbolsToMatrix(a);if(c==null){h.warn("gf32: recovery code %s could not be converted to GF32 matrix",a);return[a]}a=Array(j).fill(0);for(var e=0;e<j;e++)for(var f=0;f<l;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(m[e*l+f],c[f]));f=p(l,k);for(e of f){f=a.slice();for(var g=0;g<j;g++)for(var i of e)f[g]=d("GaloisField32").xor(f[g],d("GaloisField32").multiply(m[g*l+i],c[i]));i=r(e,k);if(i==null){h.warn("gf32: no submat inverse found for error locs %s",JSON.stringify(e));continue}g=i.excludeRow;i=i.submatInv;var n=Array(k).fill(0),o=f.slice();o.splice(g,1);for(var q=0;q<k;q++)for(var s=0;s<k;s++)n[q]=d("GaloisField32").xor(n[q],d("GaloisField32").multiply(i[q*k+s],o[s]));s=d("GaloisField32").zero;for(q=0;q<k;q++)s=d("GaloisField32").xor(s,d("GaloisField32").multiply(m[g*l+e[q]],n[q]));if(s===f[g]){i=c.slice();for(o=0;o<e.length;o++)i[e[o]]=n[o];b.add(d("GaloisField32").matrixToSymbols(i))}}return Array.from(b)}g.getEccForCode=a;g.getCandidateCodes=b}),98);
__d("checkLSRecoveryCodeMatch",["LSBinaryToHex.nop","LSShape","LSVec","Promise","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f,g,i){i=c("LSVec").toArray(i).map(function(a){return d("LSShape").toRecord(a)});var j=c("LSBinaryToHex.nop")(a,e,c("nullthrows")(f)),k=function(d,i){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);d=c("LSBinaryToHex.nop")(a,e,i.virtual_device_id);return(h||(h=b("Promise"))).all([j,d]).then(function(a){var c=a[0],d=a[1];a=c.length===d.length&&c.every(function(a,b){return a===d[b]});if(a)return(h||(h=b("Promise"))).resolve([f,g]);else return(h||(h=b("Promise"))).resolve([void 0,void 0])})})};return i.reduce(k,(h||(h=b("Promise"))).resolve([void 0,void 0]))}g["default"]=a}),98);
__d("deriveLSKey",["I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g){g=g==="1"?(h||(h=d("I64"))).of_string("8"):(h||(h=d("I64"))).of_string("16");g=c("LSVec").ofArray([g,(h||(h=d("I64"))).of_string("32")]);return c("LSCreateDerivedKeys.nop")(a,b,d("LSCryptoUtils").strToBuf(f),void 0,d("LSCryptoUtils").strToBuf(e),g).then(function(a){a=a[0];if(a==null)return[void 0,void 0];a=c("LSVec").toArray(a);return a.length===2?[a[0],a[1]]:[void 0,void 0]})}g["default"]=a}),98);
__d("parseLSRecoveryCode",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=a.substring(0,1);if(a.length!==40||c!=="1"&&c!=="2")return;var d=c==="1"?35:34,e=a.substring(1,2);a=a.substring(2,d+2);d="BackupRecoveryCode_v"+c+"_"+e+"_"+b;return[a,d,c]}f["default"]=a}),66);
__d("LSParseRecoveryCode_v2.nop",["CryptoLogger","GF32RecoveryCodes","Promise","checkLSRecoveryCodeMatch","deriveLSKey","parseLSRecoveryCode"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("parse_recovery_code_v2");f=c("parseLSRecoveryCode")(f,g);if(f!=null)return c("deriveLSKey")(a,e,f[0],f[1],f[2]);else{i&&j.mustfix("could not parse recovery code with uid");return(h||(h=b("Promise"))).resolve([void 0,void 0])}}var j=new Map([["B","8"],["G","C"],["I","1"],["O","0"]]),k=new RegExp("["+Array.from(j.keys()).join("")+"]","g");function l(a){return a.replace(k,function(a){return j.get(a)||a})}a=function(a,e,f,g,j){if(f.length!==40)return(h||(h=b("Promise"))).resolve([void 0,void 0]);var k=f.substring(0,2),m=l(f.substring(2,40));f=d("GF32RecoveryCodes").getCandidateCodes(m);var n=function(d,f){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);else return i(a,e,k+f,g,!1).then(function(d){var f=d[0];if(f==null)return(h||(h=b("Promise"))).resolve([void 0,void 0]);else return c("checkLSRecoveryCodeMatch")(a,e,f,d[1],j)}).then(function(a){if(a[0]==null)return[void 0,void 0];else return a})})};return f.reduce(n,(h||(h=b("Promise"))).resolve([void 0,void 0])).then(function(c){return c[0]==null?i(a,e,k+m,g,!0):(h||(h=b("Promise"))).resolve(c)})};a.__nop_name__="LSParseRecoveryCode_v2";g["default"]=a}),98);
__d("LSAddDevice",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),c("justknobx")._("946")?d.sequence([function(a){return e[8]=d.createArray(),d.forEach(d.db.table(179).fetch(),function(a){var b=a.item;return d.sequence([function(a){return e[15]=b.taskId,d.db.table(2).fetch([[[e[15]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?e[13]=!1:(a.item,e[13]=!0)})},function(a){return e[13]?0:e[16]=(e[8].push(e[15]),e[8])}])})},function(a){return e[9]=d.i64.of_int32(e[8].length),d.i64.gt(e[9],d.i64.cast([0,0]))?d.loopAsync(e[9],function(a){return e[13]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[8],e[13]).then(function(a){return a=a,e[14]=a[0],e[15]=a[1],a})},function(a){return d.forEach(d.db.table(179).fetch([[[e[14]]]]),function(a){return a["delete"]()})}])}):d.resolve()},function(a){return d.db.table(179).fetch().next().then(function(a,b){b=a.done;a=a.value;return b?e[10]=!1:(a.item,e[10]=!0)})},function(c){return e[10]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] add device task already pending"),e[14]="add device task already pending",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",e[14]].join("")),e[13]=d.createArray(),void 0!==void 0?e[15]=(e[13].push(void 0),e[13]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",e[14],e[13],d.i64.cast([0,3]))},function(a){return e[12]=d.i64.cast([0,1])}]):d.sequence([function(b){return e[13]=d.createArray(),d.forEach(d.filter(d.db.table(184).fetch(),function(b){return d.i64.eq(b.backupId,a[0])}),function(a){a=a.item;return e[19]=new d.Map(),e[19].set("virtual_device_id",a.virtualDeviceId),e[20]=(e[13].push(e[19]),e[13])})},function(a){return d.db.table(172).fetch().next().then(function(a,b){var c=a.done;a=a.value;return c?e[14]=void 0:(b=a.item,e[20]=b.encryptionManagementDelegatorId,d.i64.neq(e[20],void 0)?(d.i64.neq(e[20],d.i64.cast([0,0]))?e[21]=d.i64.to_string(e[20]):e[21]=void 0,e[19]=e[21]):e[19]=void 0,e[14]=e[19])})},function(a){return d.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,e[16]=a[0],a})},function(c){return d.nativeOperation(b("LSParseRecoveryCode_v2.nop"),a[1],e[14]==null?d.i64.to_string(e[16]):e[14],e[13]).then(function(a){return a=a,e[17]=a[0],e[18]=a[1],a})},function(c){return d.blobs.neq(e[17],void 0)?d.blobs.neq(e[18],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[17]).then(function(a){return a=a,e[19]=a[0],a})},function(a){return d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,1])})},function(c){return e[24]=d.i64.cast([0,1e3]),e[20]=e[24],e[21]=new d.Map(),e[21].set("backup_id",a[0]),e[21].set("virtual_device_id",e[19]==null?"":e[19]),e[21].set("trace_id",a[4]),e[22]=d.toJSON(e[21]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50007]),e[22],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,e[20]).then(function(a){return a=a,e[23]=a[0],a})},function(b){return d.db.table(185).add({pk:d.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:e[23]})},function(a){return d.db.table(179).add({taskId:e[23],virtualDeviceId:e[17],blobDecryptionKey:e[18]})}]):d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. blob_decryption_key is null",!0):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null"),e[20]="Invalid recovery code. virtual_device_id is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",e[20]].join("")),e[19]=d.createArray(),void 0!==void 0?e[21]=(e[19].push(void 0),e[19]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",e[20],e[19],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Invalid recovery code. virtual_device_id is null",!0)}])},function(a){return e[12]=d.i64.cast([0,0])}])},function(a){return e[1]=e[12]}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsAddDeviceStoredProcedure";a.__tables__=["secure_recovery_code_data","pending_tasks","encrypted_backups_virtual_devices","encrypted_backups","secure_encrypted_backups_recovery_code_status","device_metadata"];d=a;g["default"]=d}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSAddDevice"),e.backupId,e.recoveryCode,e.deviceRegistrationId,e.backupTenancy,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSEncryptedBackupsRecoveryCodeStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({OPTIMISTIC:1,VALID:2,INVALID:3,SYSTEM_ERROR:4});f["default"]=a}),66);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.onFailure,e=a.onInvalidRecoveryCode,f=a.onSuccess;a=a.recoveryCodeStatusData;if((a==null?void 0:a.length)!==1)return;a=a[0].recoveryCodeStatus;switch((h||(h=d("I64"))).to_int32(a)){case c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case c("LSEncryptedBackupsRecoveryCodeStatus").INVALID:e==null?void 0:e();return c("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case c("LSEncryptedBackupsRecoveryCodeStatus").VALID:f==null?void 0:f();return c("LSEncryptedBackupsRecoveryCodeStatus").VALID;case c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:b==null?void 0:b();return c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:b==null?void 0:b(),c("FBLogger")("labyrinth_web").mustfix("Invalid Recovery Code Status type")}}g.encryptedBackupsGetRecoveryCodeStatus=a}),98);
__d("EBAddDeviceWithRecoveryCode",["EBAPIQPLPoints","EBAPIWorkerCheck","FBLogger","I64","LSAddDeviceStoredProcedure","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","MAWWaitForBackendSetup","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsRecoveryCodeStatus","Promise","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","cr:10885","isInstamadilloEB","justknobx","promiseDone","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc success"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device sproc start"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql success"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql start"]);n=function(){return a};return a}var o=10;function p(a){var e=a.count,f=a.storage;return new(j||(j=b("Promise")))(function(a,b){if(e===o)return a();c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.tables.encrypted_backups)),function(b){b=b==null?void 0:b.backupId;if(b!=null)return a(b);window.setTimeout(function(){a(p({count:e+1,storage:f}))},1e3)},function(a){return b(a)})})}var q=c("qpl")._(521484295,"1460");function a(a){var e=a.environment,g=a.isInWorker,o=a.onFailure,t=a.onInvalidRecoveryCode,u=a.onStart,v=a.onSuccess,w=a.recoveryCode,x=a.storage,y=a.traceId,z=a.trackAddingDevice,A=a.trackOverprompting,B=a.userId,C=function(){},D=!1,E=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());a=new(j||(j=b("Promise")))(function(a,b){window.setTimeout(function(){if(D)return;var a="Add device failed by timeout 90 sec";c("FBLogger")("labyrinth_web").warn(a);o("add_device_timeout");s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT,E);b(a)},9e4)});var F=new j(function(a,j){c("QPLUserFlow").start(c("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1,isGraphQL:b("cr:10885")!=null,isInWorker:g}},instanceKey:E,timeoutInMs:c("justknobx")._("4226")}),void A(q),s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ON_START_BEGIN,E,{string:{traceId:y}}),u(),s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ON_START_SUCCESS,E,{string:{traceId:y}}),C=x.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(e,f){if(f.operation==="delete")return;f.operation==="add"&&b("cr:10885")==null&&s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_OPTIMISTIC_STATUS,E);e=[f.value];s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS,E,{string:{traceId:y}});d("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){var a="LSEncryptedBackupsRecoveryCodeStatus system error";r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS,{bool:{is_backend_setup:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful()},string:{traceId:y}});C();o("add_device_failed_to_get_rc_status");j(a)},onInvalidRecoveryCode:function(){var a="Invalid recovery code";r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE,{bool:{is_backend_setup:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful()},string:{traceId:y}});C();t();j(a)},onSuccess:function(){c("QPLUserFlow").addAnnotations(c("qpl")._(521473756,"2768"),{bool:{is_backend_setup:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful()}},{instanceKey:E}),s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_END,E),c("QPLUserFlow").endSuccess(c("qpl")._(521473756,"2768"),{instanceKey:E}),C(),!c("isInstamadilloEB")()?g||d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:x,onFailure:o,onSuccess:v}):c("QPLUserFlow").endSuccess(q),z()["finally"](function(){v(),a()})},recoveryCodeStatusData:e})}),c("promiseDone")(p({count:0,storage:x}),function(a){if(a!=null)if(b("cr:10885")!=null){d("WALogger").LOG(n());s(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_START,E);var p=!d("EBAPIWorkerCheck").runningInWorker()&&e!=null?b("cr:10885").addDeviceGraphQL({backupId:a,environment:e,qplInstanceKey:E,recoveryCode:w,storage:x,userId:B}):b("cr:10885").addDeviceGraphQLWorker({backupId:a,qplInstanceKey:E,recoveryCode:w,storage:x,userId:B});return p.then(function(a){if(a.success)s(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_END,E),s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START,E),d("WALogger").LOG(m());else{r(E,d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,{bool:{is_backend_setup:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful()},string:{fail_result:a.error}});s(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,E);C();o("add_device_graphql_error");return j("Add device gql failed")}})}else{d("WALogger").LOG(l());var q=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(q===""){r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL);C();o("deviceRegistrationId is not defied");return j("deviceRegistrationId is not defined")}s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START,E);return x.runInTransaction(function(b){return c("LSAddDeviceStoredProcedure")(c("LSFactory")(b),{backupId:a,backupTenancy:(h||(h=d("I64"))).of_int32(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:q,recoveryCode:w})},"readwrite",void 0,void 0,f.id+":330").then(function(a){a=a[0];if(!(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").SUCCESS))){r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{bool:{is_backend_setup:g?!0:d("MAWWaitForBackendSetup").isBackendSetupSuccessful()}});C();o("add_device_error_add_device_sproc_failure");return j("Add device sproc failed")}s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END,E);s(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START,E);d("WALogger").LOG(k())})["catch"](function(a){c("QPLUserFlow").addAnnotations(c("qpl")._(521473756,"2768"),{string:{error_message:a.message}},{instanceKey:E});throw a})}else{r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND);C();o("add_device_error_backup_id_not_defined");return j("backupId is not defined")}},function(a){var b="Add device failed. Could not find backup.";c("FBLogger")("labyrinth_web").catching(a).mustfix(b);r(E,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{string:{error_message:a.message}});C();o("add_device_error_could_not_read_backup_table");return j(b)})});return g?F.then(function(){D=!0}):(j||(j=b("Promise"))).race([F,a]).then(function(){D=!0})}var r=function(a,b,d){c("QPLUserFlow").endFailure(c("qpl")._(521473756,"2768"),b,{annotations:d,instanceKey:a})};function s(a,b,d){c("QPLUserFlow").addPoint(c("qpl")._(521473756,"2768"),a,{data:d,instanceKey:b})}g.addDeviceWithRecoveryCode=a}),98);
__d("EBFetchBackupIds",["ExecutionEnvironment","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","Promise","err","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=c("justknobx")._("3868");function a(a){return new(k||(k=b("Promise")))(function(b,e){var g,k=a.tables.encrypted_backups.subscribe(function(a,e){if(e.operation==="delete"||!(i||(i=d("I64"))).equal(e.value.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return;k();window.clearTimeout(g);b()});c("promiseDone")(a.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1}).then(function(){g=window.setTimeout(function(){e(c("err")("[wmi][ebapi] Timeout fetching backup ids, isInWorker: "+(h||(h=c("ExecutionEnvironment"))).isInWorker.toString()))},l)})},"readwrite",void 0,void 0,f.id+":51"))})}g.fetchBackupIds=a}),98);
__d("EBGetEBStateQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23909871918604871"}),null);
__d("EBGetEBStateQuery.graphql",["EBGetEBStateQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};a={alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},a,{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},a,{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBGetEBStateQuery",selections:[{kind:"RequiredField",field:a,action:"LOG",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBGetEBStateQuery",selections:[a]},params:{id:b("EBGetEBStateQuery_facebookRelayOperation"),metadata:{},name:"EBGetEBStateQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBGetEBState",["EBGetEBStateQuery.graphql","FBLogger","MAWOneTimeCodeGating","RelayHooks","WAResultOrError","XPlatRelayEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("EBGetEBStateQuery.graphql");async function a(){try{var a,b,e=await d("RelayHooks").fetchQuery(d("XPlatRelayEnvironment").getRelayEnvironment(),i,{}).toPromise().then(function(a){return a});a=e==null?void 0:(a=e.viewer)==null?void 0:a.backup_state;if(a===1||a===0)return d("WAResultOrError").makeResult({backupStatus:a});a=(a=e==null?void 0:(a=e.viewer)==null?void 0:(a=a.encrypted_backup)==null?void 0:a.virtual_devices)!=null?a:[];var f=a.filter(function(a){return a.device_type==="HSM"});a=a.filter(function(a){return a.device_type===1});return d("WAResultOrError").makeResult({backupStatus:(e==null?void 0:(b=e.viewer)==null?void 0:b.backup_state)!=null?e.viewer.backup_state:0,ebState:{backupMetadata:{backupId:(b=e==null?void 0:(b=e.viewer)==null?void 0:(b=b.encrypted_backup)==null?void 0:b.id)!=null?b:"",creationTime:(b=e==null?void 0:(b=e.viewer)==null?void 0:(b=b.encrypted_backup)==null?void 0:b.backup_creation_time)!=null?b:0,deviceCreatedOn:(b=f[0].device_created_on)!=null?b:"",removalStatus:"",requiresHsmMigration:f[0].migration_status!=="DOES_NOT_REQUIRE_MIGRATION",virtualDeviceCreationTime:(b=(b=f[0])==null?void 0:b.creation_time)!=null?b:0,virtualDeviceId:(b=(b=f[0])==null?void 0:b.id)!=null?b:"",virtualDeviceType:(b=(b=f[0])==null?void 0:b.device_type)!=null?b:""},backupTenancy:(b=e==null?void 0:(b=e.viewer)==null?void 0:(b=b.encrypted_backup)==null?void 0:b.backup_tenancy)!=null?b:"PRODUCTION",hasOtcEligibleDevices:!!(d("MAWOneTimeCodeGating").isOneTimeCodeEnabled&&(e==null?void 0:(b=e.viewer)==null?void 0:(b=b.encrypted_backup)==null?void 0:b.has_otc_eligible_devices)!==!1),hasSeenEbAutoRestoreNotice:(b=e==null?void 0:(b=e.viewer)==null?void 0:(b=b.encrypted_backup)==null?void 0:b.has_seen_eb_auto_restore_notice)!=null?b:!1,isPINCodeRegistered:((b=f[0])==null?void 0:b.id)!=null,isUserOptedOut:(e=e==null?void 0:(f=e.viewer)==null?void 0:(b=f.encrypted_backup)==null?void 0:b.is_user_opted_out)!=null?e:!1,offlineDevicesCount:a.length}})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to check EB enabled");return d("WAResultOrError").makeResult({backupStatus:0})}}g.GetEbState=a}),98);
__d("EBGetLatestChatJids",["I64","MAWBridgeSafeActionsWorkerAndUI","ReQL","WAResultOrError","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i=50;async function a(a,b){b===void 0&&(b=i);try{b=await d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("getLatestChatJids",{count:b});a=await a.runInTransaction(function(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).map(function(a){a=a.jid;return(h||(h=d("I64"))).to_string(a)}))},"readonly",void 0,void 0,f.id+":47");var e=[];if(a.length>0){var g=new Set(a);b.forEach(function(a){var b=a.split("@")[0];g.has(b)&&e.push(a)})}return d("WAResultOrError").makeResult(e)}catch(a){return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}g.getLatestChatJids=a}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop");a=function(a,b){return h.load().then(function(a){return c("LSResult")(a.scalar.getRandom().buffer)})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),a).mustfix("Failed to init OCMF client.");throw a})};a.__nop_name__="LSOcmfClientInit_v2";g["default"]=a}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){a=d("CryptoLogger").CryptoLogger("ope_encrypt");if((i||(i=d("I64"))).gt(f,c("LSMaxInt32"))){a.mustfix("numBytes '"+String(f)+"' too large. Returning an empty array");return(h||(h=b("Promise"))).resolve(c("LSResult")(new Uint8Array(0).buffer))}e=(i||(i=d("I64"))).to_int32(f);a=new Uint8Array(e);f=65536;for(var g=0;g<e;g+=f){var j=a.subarray(g,g+Math.min(e-g,f));d("XPlatReactCrypto").getRandomValues(j)}return(h||(h=b("Promise"))).resolve(c("LSResult")(a.buffer))};a.__nop_name__="LSRandom";g["default"]=a}),98);
__d("LSGenerateInitialDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateInitialDeviceSetupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[32]=new c.Map(),d[32].set("error_msg","Expected a nonempty query result"),d[32].set("code",c.i64.cast([0,3])),d[32].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[33]=c.createArray(),d[34]=(d[33].push(d[32]),d[33]),e=[void 0,d[33]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[32]=new c.Map(),d[32].set("backup_id",b.backupId),d[32].set("device_public_key_blob",b.devicePublicKeyBlob),d[32].set("device_private_key_blob",b.devicePrivateKeyBlob),d[32].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[32].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[32].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[32].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[32].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[32].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[32].set("orf_client_state_v2_blob",void 0),d[32].set("orf_v2_authority_level",void 0),d[32].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[32].set("device_id",b.deviceId),d[32].set("backup_tenancy",b.backupTenancy),d[32].set("encryption_version",b.encryptionVersion),d[32].set("revision_version",b.revisionVersion),d[32].set("initialize_restore_result",void 0),d[32].set("authority_level",b.authorityLevel),e=[d[32],void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[32]=d[6].get("backup_id"),d[33]=d[6].get("device_public_key_blob"),d[34]=d[6].get("device_private_key_blob"),d[35]=d[6].get("epoch_storage_public_key_blob"),d[36]=d[6].get("epoch_storage_private_key_blob"),d[37]=d[6].get("epoch_auth_public_key_blob"),d[38]=d[6].get("epoch_auth_private_key_blob"),d[39]=d[6].get("mailbox_root_key_blob"),d[40]=d[6].get("ocmf_client_state_blob"),d[41]=d[6].get("orf_client_state_v2_blob"),d[42]=d[6].get("orf_v2_authority_level"),d[43]=d[6].get("oblivious_validation_token_blob"),d[44]=d[6].get("device_id"),d[45]=d[6].get("backup_tenancy"),d[46]=d[6].get("encryption_version"),d[47]=d[6].get("revision_version"),d[48]=d[6].get("initialize_restore_result"),d[49]=d[6].get("authority_level"),c.i64.neq(d[44],void 0)?c.sequence([function(a){return d[67]=void 0,c.i64.neq(d[67],void 0)?c.resolve(d[68]=d[67]):c.sequence([function(a){return d[71]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[72]=a[0],a})},function(a){return d[72]?d[81]=(d[71].push(c.i64.cast([0,0])),d[71]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[73]?d[81]=(d[71].push(c.i64.cast([0,2])),d[71]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[81]=(d[71].push(c.i64.cast([0,3])),d[71]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[81]=(d[71].push(c.i64.cast([0,4])),d[71]):0,d[76]=c.createArray(),d[77]=c.i64.of_int32(d[71].length),c.i64.gt(d[77],c.i64.cast([0,0]))?c.loopAsync(d[77],function(a){return d[81]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[71],d[81]).then(function(a){return a=a,d[82]=a[0],d[83]=a[1],a})},function(a){return d[84]=(d[76].push(d[82]),d[76])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[81]=c.createArray(),d[82]=c.i64.of_int32(d[76].length),c.i64.gt(d[82],c.i64.cast([0,0]))?c.loopAsync(d[82],function(a){return d[84]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[76],d[84]).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return d[87]=(d[81].push(c.i64.to_string(d[85])),d[81])}])}):c.resolve()},function(a){return d[83]=d[81].join(","),d[78]=d[83]}])},function(a){return d[76].some(function(a){return c.i64.eq(d[46],a)})?d[79]=d[46]:d[79]=void 0,c.i64.neq(d[79],void 0)?d[80]=d[79]:d[80]=void 0,d[68]=d[80]}])},function(a){return c.i64.neq(d[68],void 0)?d[69]=d[68]:d[69]=c.i64.cast([0,0]),c.i64.neq(d[45],void 0)?d[70]=d[45]:d[70]=c.i64.cast([0,1]),a=[d[32],d[44],d[39],d[40],void 0,void 0,d[69],d[70],d[37],d[38],d[33],d[34],d[35],d[36],d[43],d[49],void 0],d[50]=a[0],d[51]=a[1],d[52]=a[2],d[53]=a[3],d[54]=a[4],d[55]=a[5],d[56]=a[6],d[57]=a[7],d[58]=a[8],d[59]=a[9],d[60]=a[10],d[61]=a[11],d[62]=a[12],d[63]=a[13],d[64]=a[14],d[65]=a[15],d[66]=a[16],a}]):c.sequence([function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return d[67]=c.i64.random(),d[68]=c.i64.random(),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[69]=a[0],d[70]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[73]=a[0],d[74]=a[1],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[76]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[77]=a[0],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[79]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[105]=(d[79].push(c.i64.cast([0,0])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[105]=(d[79].push(c.i64.cast([0,2])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[105]=(d[79].push(c.i64.cast([0,3])),d[79]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]?d[105]=(d[79].push(c.i64.cast([0,4])),d[79]):0,d[84]=c.i64.of_int32(d[79].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],c.i64.sub(d[84],c.i64.cast([0,1]))).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(168).fetch([[[d[67]]]]),function(a){return c.i64.eq(a.backupId,d[67])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[67],deviceId:d[68],devicePublicKeyBlob:d[70],devicePrivateKeyBlob:d[69],epochStoragePublicKeyBlob:d[72],epochStoragePrivateKeyBlob:d[71],epochAuthPublicKeyBlob:d[74],epochAuthPrivateKeyBlob:d[73],mailboxRootKeyBlob:d[75],ocmfClientStateBlob:d[76],obliviousValidationTokenBlob:d[78],authorityLevel:c.i64.cast([0,20]),encryptionVersion:d[85],revisionVersion:c.i64.cast([0,1]),backupTenancy:c.i64.cast([0,1])})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0],d[87]=f[0],d[88]=f[1],d[89]=f[2],d[90]=f[3],d[91]=f[4],d[92]=f[5],d[93]=f[6],d[94]=f[7],d[95]=f[8],d[96]=f[9],d[97]=f[10],d[98]=f[11],d[99]=f[12],d[100]=f[13],d[101]=f[14],d[102]=f[15],d[103]=f[16],f):(e=a.item,c.sequence([function(a){return d[110]=e.backupTenancy,d[109]=e.encryptionVersion,d[105]=void 0,c.i64.neq(d[105],void 0)?c.resolve(d[106]=d[105]):c.sequence([function(a){return d[111]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[112]=a[0],a})},function(a){return d[112]?d[121]=(d[111].push(c.i64.cast([0,0])),d[111]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[113]?d[121]=(d[111].push(c.i64.cast([0,2])),d[111]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[114]=a[0],a})},function(a){return d[114]?d[121]=(d[111].push(c.i64.cast([0,3])),d[111]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[115]=a[0],a})},function(a){return d[115]?d[121]=(d[111].push(c.i64.cast([0,4])),d[111]):0,d[116]=c.createArray(),d[117]=c.i64.of_int32(d[111].length),c.i64.gt(d[117],c.i64.cast([0,0]))?c.loopAsync(d[117],function(a){return d[121]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[111],d[121]).then(function(a){return a=a,d[122]=a[0],d[123]=a[1],a})},function(a){return d[124]=(d[116].push(d[122]),d[116])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[121]=c.createArray(),d[122]=c.i64.of_int32(d[116].length),c.i64.gt(d[122],c.i64.cast([0,0]))?c.loopAsync(d[122],function(a){return d[124]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[116],d[124]).then(function(a){return a=a,d[125]=a[0],d[126]=a[1],a})},function(a){return d[127]=(d[121].push(c.i64.to_string(d[125])),d[121])}])}):c.resolve()},function(a){return d[123]=d[121].join(","),d[118]=d[123]}])},function(a){return d[116].some(function(a){return c.i64.eq(d[109],a)})?d[119]=d[109]:d[119]=void 0,c.i64.neq(d[119],void 0)?d[120]=d[119]:d[120]=void 0,d[106]=d[120]}])},function(a){return c.i64.neq(d[106],void 0)?d[107]=d[106]:d[107]=c.i64.cast([0,0]),c.i64.neq(d[110],void 0)?d[108]=d[110]:d[108]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[107],d[108],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0],d[87]=a[0],d[88]=a[1],d[89]=a[2],d[90]=a[3],d[91]=a[4],d[92]=a[5],d[93]=a[6],d[94]=a[7],d[95]=a[8],d[96]=a[9],d[97]=a[10],d[98]=a[11],d[99]=a[12],d[100]=a[13],d[101]=a[14],d[102]=a[15],d[103]=a[16],a}]))})},function(a){return a=[d[87],d[88],d[89],d[90],d[91],d[92],d[93],d[94],d[95],d[96],d[97],d[98],d[99],d[100],d[101],d[102],d[103]],d[50]=a[0],d[51]=a[1],d[52]=a[2],d[53]=a[3],d[54]=a[4],d[55]=a[5],d[56]=a[6],d[57]=a[7],d[58]=a[8],d[59]=a[9],d[60]=a[10],d[61]=a[11],d[62]=a[12],d[63]=a[13],d[64]=a[14],d[65]=a[15],d[66]=a[16],a}])},function(a){return a=[d[50],d[51],d[52],d[53],d[54],d[55],d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66]],d[7]=a[0],d[8]=a[1],d[9]=a[2],d[10]=a[3],d[11]=a[4],d[12]=a[5],d[13]=a[6],d[14]=a[7],d[15]=a[8],d[16]=a[9],d[17]=a[10],d[18]=a[11],d[19]=a[12],d[20]=a[13],d[21]=a[14],d[22]=a[15],d[23]=a[16],a}]):c.sequence([function(a){return d[32]=d[5].get("errors"),d[33]=d[5].get("errors"),c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return d[34]=c.i64.random(),d[35]=c.i64.random(),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[38]=a[0],d[39]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[72]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[72]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[72]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[72]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.i64.of_int32(d[46].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],c.i64.sub(d[51],c.i64.cast([0,1]))).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(168).fetch([[[d[34]]]]),function(a){return c.i64.eq(a.backupId,d[34])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[34],deviceId:d[35],devicePublicKeyBlob:d[37],devicePrivateKeyBlob:d[36],epochStoragePublicKeyBlob:d[39],epochStoragePrivateKeyBlob:d[38],epochAuthPublicKeyBlob:d[41],epochAuthPrivateKeyBlob:d[40],mailboxRootKeyBlob:d[42],ocmfClientStateBlob:d[43],obliviousValidationTokenBlob:d[45],authorityLevel:c.i64.cast([0,20]),encryptionVersion:d[52],revisionVersion:c.i64.cast([0,1]),backupTenancy:c.i64.cast([0,1])})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0],d[54]=f[0],d[55]=f[1],d[56]=f[2],d[57]=f[3],d[58]=f[4],d[59]=f[5],d[60]=f[6],d[61]=f[7],d[62]=f[8],d[63]=f[9],d[64]=f[10],d[65]=f[11],d[66]=f[12],d[67]=f[13],d[68]=f[14],d[69]=f[15],d[70]=f[16],f):(e=a.item,c.sequence([function(a){return d[77]=e.backupTenancy,d[76]=e.encryptionVersion,d[72]=void 0,c.i64.neq(d[72],void 0)?c.resolve(d[73]=d[72]):c.sequence([function(a){return d[78]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]?d[88]=(d[78].push(c.i64.cast([0,0])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[88]=(d[78].push(c.i64.cast([0,2])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[88]=(d[78].push(c.i64.cast([0,3])),d[78]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[88]=(d[78].push(c.i64.cast([0,4])),d[78]):0,d[83]=c.createArray(),d[84]=c.i64.of_int32(d[78].length),c.i64.gt(d[84],c.i64.cast([0,0]))?c.loopAsync(d[84],function(a){return d[88]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[78],d[88]).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[91]=(d[83].push(d[89]),d[83])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[88]=c.createArray(),d[89]=c.i64.of_int32(d[83].length),c.i64.gt(d[89],c.i64.cast([0,0]))?c.loopAsync(d[89],function(a){return d[91]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[83],d[91]).then(function(a){return a=a,d[92]=a[0],d[93]=a[1],a})},function(a){return d[94]=(d[88].push(c.i64.to_string(d[92])),d[88])}])}):c.resolve()},function(a){return d[90]=d[88].join(","),d[85]=d[90]}])},function(a){return d[83].some(function(a){return c.i64.eq(d[76],a)})?d[86]=d[76]:d[86]=void 0,c.i64.neq(d[86],void 0)?d[87]=d[86]:d[87]=void 0,d[73]=d[87]}])},function(a){return c.i64.neq(d[73],void 0)?d[74]=d[73]:d[74]=c.i64.cast([0,0]),c.i64.neq(d[77],void 0)?d[75]=d[77]:d[75]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[74],d[75],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0],d[54]=a[0],d[55]=a[1],d[56]=a[2],d[57]=a[3],d[58]=a[4],d[59]=a[5],d[60]=a[6],d[61]=a[7],d[62]=a[8],d[63]=a[9],d[64]=a[10],d[65]=a[11],d[66]=a[12],d[67]=a[13],d[68]=a[14],d[69]=a[15],d[70]=a[16],a}]))})},function(a){return a=[d[54],d[55],d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67],d[68],d[69],d[70]],d[7]=a[0],d[8]=a[1],d[9]=a[2],d[10]=a[3],d[11]=a[4],d[12]=a[5],d[13]=a[6],d[14]=a[7],d[15]=a[8],d[16]=a[9],d[17]=a[10],d[18]=a[11],d[19]=a[12],d[20]=a[13],d[21]=a[14],d[22]=a[15],d[23]=a[16],a}])},function(e){return c.i64.neq(d[7],void 0)?c.sequence([function(e){return c.blobs.neq(d[18],void 0)?c.sequence([function(e){return c.blobs.neq(d[17],void 0)?c.sequence([function(e){return c.blobs.neq(d[19],void 0)?c.sequence([function(e){return c.blobs.neq(d[15],void 0)?c.sequence([function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(e){return c.blobs.neq(d[9],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[18],c.blob("MA=="),d[19]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[18],c.blob("MQ=="),d[15]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),c.i64.to_string(d[7])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[10],d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(b){return d[50]=new c.Map(),d[50].set("optimistic_backup_id",d[7]),d[50].set("device_private_key",d[18]),d[50].set("device_public_key",d[17]),d[50].set("epoch_storage_public_key",d[19]),d[50].set("epoch_storage_public_key_sig",d[44]==null?c.blob("bnVsbA=="):d[44]),d[50].set("epoch_auth_public_key",d[15]),d[50].set("epoch_auth_public_key_sig",d[45]==null?c.blob("bnVsbA=="):d[45]),d[50].set("ocmf_client_state",d[10]),d[50].set("mailbox_partial_id",d[49]==null?"":d[49]),d[50].set("mailbox_root_key",d[9]),d[50].set("device_registration_id",a[0]),d[50].set("orf_client_state_v2",void 0),b=[d[50],void 0],d[42]=b[0],d[43]=b[1],b}]):c.resolve((d[44]=new c.Map(),d[44].set("error_code",c.i64.cast([0,9])),d[44].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[44].set("error_message",""),e=[void 0,d[44]],d[42]=e[0],d[43]=e[1],e))},function(a){return a=[d[42],d[43]],d[40]=a[0],d[41]=a[1],a}]):c.resolve((d[42]=new c.Map(),d[42].set("error_code",c.i64.cast([0,9])),d[42].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[42].set("error_message",""),e=[void 0,d[42]],d[40]=e[0],d[41]=e[1],e))},function(a){return a=[d[40],d[41]],d[38]=a[0],d[39]=a[1],a}]):c.resolve((d[40]=new c.Map(),d[40].set("error_code",c.i64.cast([0,9])),d[40].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[40].set("error_message",""),e=[void 0,d[40]],d[38]=e[0],d[39]=e[1],e))},function(a){return a=[d[38],d[39]],d[36]=a[0],d[37]=a[1],a}]):c.resolve((d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,9])),d[38].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[38].set("error_message",""),e=[void 0,d[38]],d[36]=e[0],d[37]=e[1],e))},function(a){return a=[d[36],d[37]],d[34]=a[0],d[35]=a[1],a}]):c.resolve((d[36]=new c.Map(),d[36].set("error_code",c.i64.cast([0,9])),d[36].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[36].set("error_message",""),e=[void 0,d[36]],d[34]=e[0],d[35]=e[1],e))},function(a){return a=[d[34],d[35]],d[32]=a[0],d[33]=a[1],a}]):c.resolve((d[34]=new c.Map(),d[34].set("error_code",c.i64.cast([0,9])),d[34].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[34].set("error_message",""),e=[void 0,d[34]],d[32]=e[0],d[33]=e[1],e))},function(a){return a=[d[32],d[33]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((d[32]=new c.Map(),d[32].set("error_code",c.i64.cast([0,9])),d[32].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[32].set("error_message",""),e=[void 0,d[32]],d[24]=e[0],d[25]=e[1],e))},function(a){return d[26]=c.i64.of_float(Date.now()),d[27]=c.i64.random(),d[29]="Finishing execution. Execution time: ",d[30]=c.i64.to_string(c.i64.sub(d[26],d[0])),d[31]=" ms",d[28]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateInitialDeviceSetupPayload] ",d[28],d[29],d[28],d[30],d[28],d[31]].join("")),c.i64.eq(c.i64.mod_(d[27],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[32]=",",d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialDeviceSetupPayload",[d[29],d[32],d[30],d[32],d[31]].join(""),d[33],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[24],d[25]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSCreateSymmetricEncryptionSecretKey.nop",["CryptoLogger","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e){return(h||(h=b("Promise"))).resolve(c("LSResult")(d("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer))["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("create_symmetric_encryption_secret_key"),a).mustfix("Creation of symmetric encryption secret key failed");throw a})};a.__nop_name__="LSCreateSymmetricEncryptionSecretKey";g["default"]=a}),98);
__d("LSGenerateInitialEpochSetupPayload",["LSCreateMinosEpochParams.nop","LSCreateSymmetricEncryptionSecretKey.nop","LSGetNextEpochAnonId.nop","LSLogMebClientEvent.nop","LSStoreEpoch"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateInitialEpochSetupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.epochStatus,c.i64.cast([0,1]))&&c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Generating new initial epoch."),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),void 0).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSymmetricEncryptionSecretKey.nop")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.sequence([function(a){return c.nativeOperation(b("LSCreateMinosEpochParams.nop"),d[17],d[16],void 0,void 0,void 0).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],d[24]=a[4],d[25]=a[5],a})},function(a){return d[18]=d[23]}])},function(e){return d[19]=c.i64.random(),c.storedProcedure(b("LSStoreEpoch"),d[19],a[0],d[16],d[17],c.i64.cast([0,1]),c.i64.cast([0,20]),!1)},function(a){return a=[d[19],d[16],d[17],void 0,void 0,d[18]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],a}]):(f=e.item,function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Using local optimistic initial epoch."),g=[f.epochId,f.epochAnonIdBlob,f.epochRootKeyBlob,void 0,void 0,f.epochHead],d[2]=g[0],d[3]=g[1],d[4]=g[2],d[5]=g[3],d[6]=g[4],d[7]=g[5],g)})},function(a){return d[9]=new c.Map(),d[9].set("optimistic_epoch_id",d[2]),d[9].set("epoch_anon_id",d[3]),d[9].set("epoch_root_key",d[4]),d[10]=c.i64.of_float(Date.now()),d[11]=c.i64.random(),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[10],d[0])),d[15]=" ms",d[12]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateInitialEpochSetupPayload] ",d[12],d[13],d[12],d[14],d[12],d[15]].join("")),c.i64.eq(c.i64.mod_(d[11],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[16]=",",d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialEpochSetupPayload",[d[13],d[16],d[14],d[16],d[15]].join(""),d[17],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[9],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),d[11]="Querying latest epoch keys with authority level: ",a[0]?d[1]="OPTIMISTIC":d[1]="AUTHORITATIVE",d[2]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[2],d[11],d[2],d[1]].join("")),c.resolve()},function(e){return a[0]?d[3]="OPTIMISTIC":d[3]="AUTHORITATIVE",c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2842]),c.i64.cast([0,2]),void 0,d[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2844]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(b){return d[4]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[16]=(d[4].push(c.blobs.to_string(a.epochAnonIdBlob)),d[4])})},function(a){return d[5]=c.i64.of_int32(d[4].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.sequence([function(a){return d[16]=c.i64.of_int32(d[4].length),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2845]),c.i64.cast([0,2]),void 0,c.i64.to_string(d[16])):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[24],d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],c.i64.cast([0,0])).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(a){return d[19]=d[17],d[20]=c.i64.of_int32(d[4].length),c.i64.gt(d[20],c.i64.cast([0,0]))?c.loopAsync(d[20],function(a){return d[21]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],d[21]).then(function(a){return a=a,d[22]=a[0],d[23]=a[1],a})},function(a){return c.i64.eq([0,d[19].length],[0,d[22].length])?(d[19]===d[22]?d[25]=d[19]:(d[19]>d[22]?d[26]=d[19]:d[26]=d[22],d[25]=d[26]),d[24]=d[25]):(c.i64.gt([0,d[19].length],[0,d[22].length])?d[25]=d[19]:d[25]=d[22],d[24]=d[25]),d[19]=d[24]}])}):c.resolve()},function(a){return d[6]=d[19]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),d[17]="Epoch anon ID list is empty.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[17],d[16],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2846]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]=void 0}])},function(a){return d[6]!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2863]),c.i64.cast([0,2]),void 0,d[6]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2864]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.blobs.of_string(d[6]),c.blobs.neq(d[12],void 0)?c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2847]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[12])}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),d[19]="Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[19],d[18],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2848]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[16]=void 0}]):(e=a.item,c.sequence([function(a){return d[22]=e.epochAnonIdBlob,d[20]="Using latest epoch: ",d[21]=c.blobs.to_string(d[22]),d[18]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[18],d[20],d[18],d[21]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("epoch_id",e.epochId),d[19].set("epoch_root_key",e.epochRootKeyBlob),d[19].set("epoch_anon_id",d[22]),d[16]=d[19]}]))})},function(a){return d[7]=d[16]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),d[17]="No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[17],d[16],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2843]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,"get_open_epoch_keys",!0,void 0,"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(a){return d[7]=void 0}])},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[15]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[10],d[13],d[10],d[14],d[10],d[15]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[16]=",",d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[d[13],d[16],d[14],d[16],d[15]].join(""),d[17],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[7]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGetOpenEpochKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSHandleCreateVirtualDeviceFailure",["LSAppendDataTraceAddon","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Beginning execution."),c.sequence([function(d){return a[2]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[2],c.i64.cast([0,1412]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(e){return a[1]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Failure when creating virtual device, deleting backup"),d[8]="Failure when creating virtual device, deleting backup",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",d[8]].join("")),d[7]=c.createArray(),void 0!==void 0?d[9]=(d[7].push(void 0),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",d[8],d[7],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSDeleteBackupOnClient"),a[0],void 0,!1,a[2],void 0,!1)}]):c.sequence([function(e){return d[7]="Failure when creating virtual device",d[7]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",d[7]].join("")),d[8]=c.createArray(),a[2]!==void 0?d[9]=(d[8].push(a[2]),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",d[7],d[8],c.i64.cast([0,3]))):c.resolve()},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})}])},function(e){return c.sequence([function(d){return a[2]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[2]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure";a.__tables__=["secure_encrypted_backups_recovery_code_status"];e.exports=a}),null);
__d("LSGenerateInitialVirtualDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.db.table(174).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] No recovery code found in recovery code table"),d[12]="No recovery code found in recovery code table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[14]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[12],d[11],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,501])),d[13].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(a){return d[11]=c.createArray(),c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nativeOperation(b("LSParseRecoveryCode_v2.nop"),f.recoveryCode,void 0==null?c.i64.to_string(d[12]):void 0,d[11]).then(function(a){return a=a,d[13]=a[0],d[14]=a[1],a})},function(e){return c.blobs.neq(d[14],void 0)?c.sequence([function(e){return c.blobs.neq(d[13],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSGetOpenEpochKeys"),!0).then(function(a){return a=a,d[19]=a[0],a})},function(e){return d[19]!==void 0?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?(d[29]=new c.Map(),d[29].set("error_msg","Expected a nonempty query result"),d[29].set("code",c.i64.cast([0,3])),d[29].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[30]=c.createArray(),d[31]=(d[30].push(d[29]),d[30]),a=[void 0,d[30]],d[22]=a[0],d[23]=a[1],a):(e=b.item,d[29]=new c.Map(),d[29].set("backup_id",e.backupId),d[29].set("device_public_key_blob",e.devicePublicKeyBlob),d[29].set("device_private_key_blob",e.devicePrivateKeyBlob),d[29].set("epoch_storage_public_key_blob",e.epochStoragePublicKeyBlob),d[29].set("epoch_storage_private_key_blob",e.epochStoragePrivateKeyBlob),d[29].set("epoch_auth_public_key_blob",e.epochAuthPublicKeyBlob),d[29].set("epoch_auth_private_key_blob",e.epochAuthPrivateKeyBlob),d[29].set("mailbox_root_key_blob",e.mailboxRootKeyBlob),d[29].set("ocmf_client_state_blob",e.ocmfClientStateBlob),d[29].set("orf_client_state_v2_blob",void 0),d[29].set("orf_v2_authority_level",void 0),d[29].set("oblivious_validation_token_blob",e.obliviousValidationTokenBlob),d[29].set("device_id",e.deviceId),d[29].set("backup_tenancy",e.backupTenancy),d[29].set("encryption_version",e.encryptionVersion),d[29].set("revision_version",e.revisionVersion),d[29].set("initialize_restore_result",void 0),d[29].set("authority_level",e.authorityLevel),a=[d[29],void 0],d[22]=a[0],d[23]=a[1],a)})},function(a){return d[25]=new c.Map(),d[25].set("value",d[22]),d[25].set("errors",d[23]),d[26]=d[25].get("value"),d[26]!==void 0?c.sequence([function(a){return d[29]=d[26].get("backup_id"),d[30]=d[26].get("device_public_key_blob"),d[31]=d[26].get("device_private_key_blob"),d[32]=d[26].get("epoch_storage_public_key_blob"),d[33]=d[26].get("epoch_storage_private_key_blob"),d[34]=d[26].get("epoch_auth_public_key_blob"),d[35]=d[26].get("epoch_auth_private_key_blob"),d[36]=d[26].get("mailbox_root_key_blob"),d[37]=d[26].get("ocmf_client_state_blob"),d[38]=d[26].get("orf_client_state_v2_blob"),d[39]=d[26].get("orf_v2_authority_level"),d[40]=d[26].get("oblivious_validation_token_blob"),d[41]=d[26].get("device_id"),d[42]=d[26].get("backup_tenancy"),d[43]=d[26].get("encryption_version"),d[44]=d[26].get("revision_version"),d[45]=d[26].get("initialize_restore_result"),d[46]=d[26].get("authority_level"),c.i64.neq(d[41],void 0)?c.sequence([function(a){return d[49]=void 0,c.i64.neq(d[49],void 0)?c.resolve(d[50]=d[49]):c.sequence([function(a){return d[101]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[102]?d[111]=(d[101].push(c.i64.cast([0,0])),d[101]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[103]=a[0],a})},function(a){return d[103]?d[111]=(d[101].push(c.i64.cast([0,2])),d[101]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[104]=a[0],a})},function(a){return d[104]?d[111]=(d[101].push(c.i64.cast([0,3])),d[101]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[105]=a[0],a})},function(a){return d[105]?d[111]=(d[101].push(c.i64.cast([0,4])),d[101]):0,d[106]=c.createArray(),d[107]=c.i64.of_int32(d[101].length),c.i64.gt(d[107],c.i64.cast([0,0]))?c.loopAsync(d[107],function(a){return d[111]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[101],d[111]).then(function(a){return a=a,d[112]=a[0],d[113]=a[1],a})},function(a){return d[114]=(d[106].push(d[112]),d[106])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[111]=c.createArray(),d[112]=c.i64.of_int32(d[106].length),c.i64.gt(d[112],c.i64.cast([0,0]))?c.loopAsync(d[112],function(a){return d[114]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[106],d[114]).then(function(a){return a=a,d[115]=a[0],d[116]=a[1],a})},function(a){return d[117]=(d[111].push(c.i64.to_string(d[115])),d[111])}])}):c.resolve()},function(a){return d[113]=d[111].join(","),d[108]=d[113]}])},function(a){return d[106].some(function(a){return c.i64.eq(d[43],a)})?d[109]=d[43]:d[109]=void 0,c.i64.neq(d[109],void 0)?d[110]=d[109]:d[110]=void 0,d[50]=d[110]}])},function(a){return c.i64.neq(d[50],void 0)?d[51]=d[50]:d[51]=c.i64.cast([0,0]),c.i64.neq(d[42],void 0)?d[52]=d[42]:d[52]=c.i64.cast([0,1]),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[53],c.blob("MA=="),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[58]=d[19].get("epoch_anon_id"),d[59]=d[19].get("epoch_root_key"),d[60]=c.createArray(),d[101]=(d[60].push(c.i64.cast([0,32])),d[60]),c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[61]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[61]].join("")),void 0,d[59],d[60]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[101]?d[102]=!1:d[102]=!0,d[102]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[105]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[105]].join("")),d[104]=c.createArray(),void 0!==void 0?d[107]=(d[104].push(void 0),d[104]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[105],d[104],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[106]=a[0],a})},function(a){return d[103]=d[106]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[101],c.i64.cast([0,0])).then(function(a){return a=a,d[104]=a[0],d[105]=a[1],a})},function(a){return d[103]=d[104]}])},function(a){return d[62]=d[103]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[102]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[104]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[102],d[101],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[103]=a[0],a})},function(a){return d[62]=d[103]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[62],d[54]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return c.blobs.neq(d[63],void 0)?c.resolve(d[64]=d[63]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),d[102]="device_epoch_hmac is null!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[104]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[103]=a[0],a})},function(a){return d[64]=d[103]}])},function(a){return d[65]=d[19].get("epoch_root_key"),d[66]=c.createArray(),d[101]=(d[66].push(c.i64.cast([0,18])),d[66]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[65],d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return d[67]!==void 0?c.sequence([function(a){return d[101]=c.i64.of_int32(d[67].length),c.i64.ge(d[101],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[67],c.i64.cast([0,0])).then(function(a){return a=a,d[103]=a[0],d[104]=a[1],a})},function(a){return d[102]=d[103]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[104]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[104]].join("")),d[103]=c.createArray(),void 0!==void 0?d[105]=(d[103].push(void 0),d[103]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[104],d[103],c.i64.cast([0,3]))},function(a){return d[102]=void 0}])},function(a){return d[68]=d[102]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[102]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[102],d[101],c.i64.cast([0,3]))},function(a){return d[68]=void 0}])},function(a){return c.blobs.neq(d[68],void 0)?d[69]=!0:d[69]=!1,d[69]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[37]).then(function(a){return a=a,d[70]=a[0],d[71]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[101]=a[0],d[102]=a[1],a})},function(a){return a=[d[70],d[71],d[101],d[102]],d[72]=a[0],d[73]=a[1],d[74]=a[2],d[75]=a[3],a}]):c.resolve((a=[d[70],d[71],void 0,void 0],d[72]=a[0],d[73]=a[1],d[74]=a[2],d[75]=a[3],a))},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),d[76]==null?"":d[76]).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]!==void 0?d[78]=d[77]:d[78]="",d[78]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),d[102]="encrypted_device_private_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[55]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),d[79]==null?"":d[79]).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]!==void 0?d[81]=d[80]:d[81]="",d[81]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),d[102]="encrypted_epoch_storage_private_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[72]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),d[82]==null?"":d[82]).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]!==void 0?d[84]=d[83]:d[84]="",d[84]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),d[102]="encrypted_orf_client_state_v1_shape is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[40]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),d[85]==null?"":d[85]).then(function(a){return a=a,d[86]=a[0],a})},function(a){return d[86]!==void 0?d[87]=d[86]:d[87]="",d[87]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),d[102]="encrypted_oblivious_validation_token is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[88]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),d[88]==null?"":d[88]).then(function(a){return a=a,d[89]=a[0],a})},function(a){return d[89]!==void 0?d[90]=d[89]:d[90]="",d[90]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),d[102]="encrypted_mailbox_root_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return d[91]=d[19].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[91]).then(function(a){return a=a,d[92]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),d[92]==null?"":d[92]).then(function(a){return a=a,d[93]=a[0],a})},function(a){return d[93]!==void 0?d[94]=d[93]:d[94]="",d[94]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),d[102]="encrypted_epoch_anon_id is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return d[95]=d[19].get("epoch_root_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[95]).then(function(a){return a=a,d[96]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),d[96]==null?"":d[96]).then(function(a){return a=a,d[97]=a[0],a})},function(a){return d[97]!==void 0?d[98]=d[97]:d[98]="",d[98]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),d[102]="encrypted_epoch_root_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[102]].join("")),d[101]=c.createArray(),void 0!==void 0?d[103]=(d[101].push(void 0),d[101]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[102],d[101],c.i64.cast([0,3]))):c.resolve()},function(a){return d[99]=new c.Map(),d[99].set("encrypted_device_private_key",d[78]),d[99].set("encrypted_epoch_storage_private_key",d[81]),d[99].set("encrypted_ocmf_client_state",d[84]),d[99].set("encrypted_orf_client_state_v2",void 0),d[99].set("encrypted_oblivious_validation_token_blob",d[87]),d[99].set("encrypted_mailbox_root_key_blob",d[90]),d[99].set("encrypted_epoch_anon_id",d[94]),d[99].set("encrypted_epoch_root_key",d[98]),d[100]=new c.Map(),d[100].set("virtual_device_public_key",d[54]),d[100].set("virtual_device_id",d[13]),d[100].set("virtual_device_epoch_storage_public_key",d[56]),d[100].set("virtual_device_epoch_storage_public_key_sig",d[57]==null?c.blob("bnVsbA=="):d[57]),d[100].set("device_epoch_hmac",d[64]),d[100].set("epoch_root_key_fingerprint",d[68]),d[100].set("virtual_device_type",f.virtualDeviceType),d[100].set("action_type",c.i64.cast([0,1])),d[100].set("ocmf_rotation_token",d[73]),d[100].set("encrypted_secret_values_payload",d[99]),d[100].set("cloud_service_account",f.cloudServiceAccount),d[100].set("hsm_pin_normalization_status",f.hsmPinNormalizationStatus),d[100].set("security_question_type",void 0),d[100].set("trusted_contact_id",void 0),a=[d[100],void 0],d[47]=a[0],d[48]=a[1],a}]):c.resolve((d[49]=new c.Map(),d[49].set("error_code",c.i64.cast([0,9])),d[49].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[49].set("error_message",""),a=[void 0,d[49]],d[47]=a[0],d[48]=a[1],a))},function(a){return a=[d[47],d[48]],d[27]=a[0],d[28]=a[1],a}]):c.resolve((d[29]=d[25].get("errors"),d[30]=d[25].get("errors"),d[31]=new c.Map(),d[31].set("error_code",c.i64.cast([0,9])),d[31].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[31].set("error_message",""),a=[void 0,d[31]],d[27]=a[0],d[28]=a[1],a))},function(a){return a=[d[27],d[28]],d[20]=a[0],d[21]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),d[23]="Epoch keys are unavailable.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[25]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[23],d[22],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,11])),d[24].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[24].set("error_message",""),a=[void 0,d[24]],d[20]=a[0],d[21]=a[1],a}])},function(a){return a=[d[20],d[21]],d[17]=a[0],d[18]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),d[20]="Invalid Recovery Code Provided",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[22]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[20],d[19],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,10])),d[21].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[21].set("error_message",""),a=[void 0,d[21]],d[17]=a[0],d[18]=a[1],a}])},function(a){return a=[d[17],d[18]],d[15]=a[0],d[16]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),d[18]="Invalid Recovery Code Provided",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[20]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[18],d[17],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,10])),d[19].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[15]=a[0],d[16]=a[1],a}])},function(a){return a=[d[15],d[16]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialVirtualDeviceSetupPayload",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_generated_recovery_code","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSInitializeBackupV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateMinosEpochParams.nop","LSCreateSignature_v2.nop","LSGenerateInitialDeviceSetupPayload","LSGenerateInitialEpochSetupPayload","LSGenerateInitialVirtualDeviceSetupPayload","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][initializeBackupV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSGenerateInitialDeviceSetupPayload"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[2]!==void 0?c.sequence([function(a){return d[15]=d[2].get("device_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[17]=d[2].get("epoch_storage_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[2].get("epoch_storage_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[2].get("epoch_auth_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=d[2].get("epoch_auth_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[25]=d[2].get("ocmf_client_state"),c.nativeOperation(b("LSBase64Encode.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[27]=d[2].get("mailbox_root_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[29]=d[2].get("device_private_key"),d[30]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[44]=(d[30].push(c.i64.cast([0,0])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[44]=(d[30].push(c.i64.cast([0,2])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[44]=(d[30].push(c.i64.cast([0,3])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[44]=(d[30].push(c.i64.cast([0,4])),d[30]):0,d[35]="",d[36]=c.i64.of_int32(d[30].length),c.i64.gt(d[36],c.i64.cast([0,0]))?c.loopAsync(d[36],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[30],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[35]=[d[35],"_",c.i64.to_string(d[45])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[35],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[29],c.blob("Mg=="),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.blobs.neq(d[38],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[38]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[39]=d[44]}]):c.resolve(d[39]=void 0)},function(b){return d[40]=d[2].get("optimistic_backup_id"),d[41]=d[2].get("mailbox_partial_id"),d[42]=new c.Map(),d[42].set("supported_encryption_versions",d[30]),d[42].set("client_version",c.i64.cast([0,1])),d[42].set("version_sig",d[39]==null?"":d[39]),d[43]=new c.Map(),d[43].set("device_public_key",d[16]==null?"":d[16]),d[43].set("epoch_storage_public_key",d[18]==null?"":d[18]),d[43].set("epoch_storage_public_key_sig",d[20]==null?"":d[20]),d[43].set("epoch_auth_public_key",d[22]==null?"":d[22]),d[43].set("epoch_auth_public_key_sig",d[24]==null?"":d[24]),d[43].set("device_registration_id",a[0]),d[43].set("ocmf_client_state",d[26]==null?"":d[26]),d[43].set("mailbox_partial_id",d[41]),d[43].set("mailbox_root_key",d[28]==null?"":d[28]),d[43].set("encryption_version_data",d[42]),b=[d[43],d[40],!0,c.i64.cast([0,0])],d[4]=b[0],d[5]=b[1],d[6]=b[2],d[7]=b[3],b}]):c.resolve((d[3]!==void 0?(d[19]=d[3].get("error_code"),e=[void 0,c.i64.cast([-1,4294967295]),!1,d[19]],d[15]=e[0],d[16]=e[1],d[17]=e[2],d[18]=e[3],e):(e=[void 0,c.i64.cast([-1,4294967295]),!1,c.i64.cast([0,12])],d[15]=e[0],d[16]=e[1],d[17]=e[2],d[18]=e[3],e),e=[d[15],d[16],d[17],d[18]],d[4]=e[0],d[5]=e[1],d[6]=e[2],d[7]=e[3],e))},function(e){return d[6]?c.sequence([function(e){return d[4]!==void 0?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[25]=new c.Map(),d[25].set("error_msg","Expected a nonempty query result"),d[25].set("code",c.i64.cast([0,3])),d[25].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[26]=c.createArray(),d[27]=(d[26].push(d[25]),d[26]),e=[void 0,d[26]],d[16]=e[0],d[17]=e[1],e):(b=a.item,d[25]=new c.Map(),d[25].set("backup_id",b.backupId),d[25].set("device_public_key_blob",b.devicePublicKeyBlob),d[25].set("device_private_key_blob",b.devicePrivateKeyBlob),d[25].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[25].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[25].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[25].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[25].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[25].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[25].set("orf_client_state_v2_blob",void 0),d[25].set("orf_v2_authority_level",void 0),d[25].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[25].set("device_id",b.deviceId),d[25].set("backup_tenancy",b.backupTenancy),d[25].set("encryption_version",b.encryptionVersion),d[25].set("revision_version",b.revisionVersion),d[25].set("initialize_restore_result",void 0),d[25].set("authority_level",b.authorityLevel),e=[d[25],void 0],d[16]=e[0],d[17]=e[1],e)})},function(a){return d[19]=new c.Map(),d[19].set("value",d[16]),d[19].set("errors",d[17]),d[20]=d[19].get("value"),d[20]!==void 0?c.sequence([function(a){return d[25]=d[20].get("backup_id"),d[26]=d[20].get("device_public_key_blob"),d[27]=d[20].get("device_private_key_blob"),d[28]=d[20].get("epoch_storage_public_key_blob"),d[29]=d[20].get("epoch_storage_private_key_blob"),d[30]=d[20].get("epoch_auth_public_key_blob"),d[31]=d[20].get("epoch_auth_private_key_blob"),d[32]=d[20].get("mailbox_root_key_blob"),d[33]=d[20].get("ocmf_client_state_blob"),d[34]=d[20].get("orf_client_state_v2_blob"),d[35]=d[20].get("orf_v2_authority_level"),d[36]=d[20].get("oblivious_validation_token_blob"),d[37]=d[20].get("device_id"),d[38]=d[20].get("backup_tenancy"),d[39]=d[20].get("encryption_version"),d[40]=d[20].get("revision_version"),d[41]=d[20].get("initialize_restore_result"),d[42]=d[20].get("authority_level"),c.i64.neq(d[37],void 0)?c.sequence([function(a){return d[46]=void 0,c.i64.neq(d[46],void 0)?c.resolve(d[47]=d[46]):c.sequence([function(a){return d[57]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[58]?d[67]=(d[57].push(c.i64.cast([0,0])),d[57]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[59]?d[67]=(d[57].push(c.i64.cast([0,2])),d[57]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[60]=a[0],a})},function(a){return d[60]?d[67]=(d[57].push(c.i64.cast([0,3])),d[57]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[61]?d[67]=(d[57].push(c.i64.cast([0,4])),d[57]):0,d[62]=c.createArray(),d[63]=c.i64.of_int32(d[57].length),c.i64.gt(d[63],c.i64.cast([0,0]))?c.loopAsync(d[63],function(a){return d[67]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[57],d[67]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],a})},function(a){return d[70]=(d[62].push(d[68]),d[62])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[67]=c.createArray(),d[68]=c.i64.of_int32(d[62].length),c.i64.gt(d[68],c.i64.cast([0,0]))?c.loopAsync(d[68],function(a){return d[70]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[62],d[70]).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(a){return d[73]=(d[67].push(c.i64.to_string(d[71])),d[67])}])}):c.resolve()},function(a){return d[69]=d[67].join(","),d[64]=d[69]}])},function(a){return d[62].some(function(a){return c.i64.eq(d[39],a)})?d[65]=d[39]:d[65]=void 0,c.i64.neq(d[65],void 0)?d[66]=d[65]:d[66]=void 0,d[47]=d[66]}])},function(a){return c.i64.neq(d[47],void 0)?d[48]=d[47]:d[48]=c.i64.cast([0,0]),c.i64.neq(d[38],void 0)?d[49]=d[38]:d[49]=c.i64.cast([0,1]),d[50]=new c.Map(),d[50].set("device_id",d[37]),d[50].set("public_key",d[26]),d[51]=c.createArray(),d[57]=(d[51].push(d[50]),d[51]),c.storedProcedure(b("LSGenerateInitialEpochSetupPayload"),d[25],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[52]!==void 0?c.sequence([function(a){return d[57]=d[52].get("epoch_anon_id"),d[58]=d[52].get("epoch_root_key"),c.blobs.neq(d[58],void 0)?c.sequence([function(a){return d[75]=c.createArray(),d[81]=(d[75].push(c.i64.cast([0,18])),d[75]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[58],d[75]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]!==void 0?c.sequence([function(a){return d[81]=c.i64.of_int32(d[76].length),c.i64.ge(d[81],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[76],c.i64.cast([0,0])).then(function(a){return a=a,d[83]=a[0],d[84]=a[1],a})},function(a){return d[82]=d[83]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[84]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[84]].join("")),d[83]=c.createArray(),void 0!==void 0?d[85]=(d[83].push(void 0),d[83]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[84],d[83],c.i64.cast([0,3]))},function(a){return d[82]=void 0}])},function(a){return d[77]=d[82]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[82]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[82]].join("")),d[81]=c.createArray(),void 0!==void 0?d[83]=(d[81].push(void 0),d[81]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[82],d[81],c.i64.cast([0,3]))},function(a){return d[77]=void 0}])},function(a){return c.blobs.neq(d[77],void 0)?d[78]=!0:d[78]=!1,d[78]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[77]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]!==void 0?d[80]=d[79]:d[80]="encodingfailed",d[59]=d[80]}]):c.resolve(d[59]="null")},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],c.i64.cast([0,0])).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=d[60].get("public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[64]=d[60].get("public_key"),d[65]=c.createArray(),d[75]=(d[65].push(c.i64.cast([0,32])),d[65]),c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return d[66]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[66]].join("")),void 0,d[58],d[65]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[76]=!1:d[76]=!0,d[76]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[79]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[79]].join("")),d[78]=c.createArray(),void 0!==void 0?d[81]=(d[78].push(void 0),d[78]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[79],d[78],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[77]=d[80]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[75],c.i64.cast([0,0])).then(function(a){return a=a,d[78]=a[0],d[79]=a[1],a})},function(a){return d[77]=d[78]}])},function(a){return d[67]=d[77]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[76]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[76]].join("")),d[75]=c.createArray(),void 0!==void 0?d[78]=(d[75].push(void 0),d[75]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[76],d[75],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[67]=d[77]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[67],d[64]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return c.sequence([function(a){return c.nativeOperation(b("LSCreateMinosEpochParams.nop"),d[58],d[57],void 0,void 0,void 0).then(function(a){return a=a,d[75]=a[0],d[76]=a[1],d[77]=a[2],d[78]=a[3],d[79]=a[4],d[80]=a[5],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[75]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]!==void 0?d[82]=d[81]:d[82]="",c.nativeOperation(b("LSBase64Encode.nop"),d[77]).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]!==void 0?d[84]=d[83]:d[84]="",c.nativeOperation(b("LSBase64Encode.nop"),d[76]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]!==void 0?d[86]=d[85]:d[86]="",c.nativeOperation(b("LSBase64Encode.nop"),d[78]).then(function(a){return a=a,d[87]=a[0],a})},function(a){return d[87]!==void 0?d[88]=d[87]:d[88]="",c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),void 0).then(function(a){return a=a,d[95]=a[0],a})},function(a){return d[95]!==void 0?d[96]=d[95]:d[96]="",d[89]=d[96]}]):c.resolve(d[89]=void 0)},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[79]).then(function(a){return a=a,d[90]=a[0],a})},function(a){return d[90]!==void 0?d[91]=d[90]:d[91]="",c.blobs.neq(d[80],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[80]).then(function(a){return a=a,d[95]=a[0],a})},function(a){return d[95]!==void 0?d[96]=d[95]:d[96]="",d[92]=d[96]}]):c.resolve(d[92]=void 0)},function(a){return d[93]=new c.Map(),d[93].set("mailbox_encryption_public_key",d[82]),d[93].set("mailbox_auth_public_key",d[84]),d[93].set("mailbox_signing_public_key",d[86]),d[93].set("epoch_head",d[88]),d[93].set("previous_epoch_head",d[89]),d[93].set("self_signature",d[91]),d[93].set("prev_signature",d[92]),d[93]!==void 0?c.resolve(d[94]=d[93]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochUtils] Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair"),d[96]="Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochUtils] ","",d[96]].join("")),d[95]=c.createArray(),void 0!==void 0?d[97]=(d[95].push(void 0),d[95]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochUtils",d[96],d[95],c.i64.cast([0,3]))},function(a){return d[94]=void 0}])},function(a){return d[69]=d[94]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[71]=d[52].get("optimistic_epoch_id"),c.blobs.neq(d[68],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[68]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[72]=d[75]}]):c.resolve(d[72]=void 0)},function(a){return d[73]=new c.Map(),d[73].set("device_pub",d[63]==null?"":d[63]),d[73].set("hmac",d[72]==null?"":d[72]),d[73].set("encrypted_epoch_key",void 0),d[73].set("epoch_root_key_fingerprint",d[59]),d[74]=new c.Map(),d[74].set("epoch_data",""),d[74].set("epoch_anon_id",d[70]==null?"":d[70]),d[74].set("minos_epoch_creation_params",d[69]),d[74].set("optimistic_epoch_id",d[71]),d[74].set("membership",d[73]),a=[d[74],!0,c.i64.cast([0,0])],d[54]=a[0],d[55]=a[1],d[56]=a[2],a}]):c.resolve((d[53]!==void 0?(d[60]=d[53].get("error_code"),a=[void 0,!1,d[60]],d[57]=a[0],d[58]=a[1],d[59]=a[2],a):(a=[void 0,!1,c.i64.cast([0,14])],d[57]=a[0],d[58]=a[1],d[59]=a[2],a),a=[d[57],d[58],d[59]],d[54]=a[0],d[55]=a[1],d[56]=a[2],a))},function(a){return a=[d[54],d[55],d[56]],d[43]=a[0],d[44]=a[1],d[45]=a[2],a}]):c.resolve((a=[void 0,!1,c.i64.cast([0,9])],d[43]=a[0],d[44]=a[1],d[45]=a[2],a))},function(a){return a=[d[43],d[44],d[45]],d[21]=a[0],d[22]=a[1],d[23]=a[2],a}]):c.resolve((d[25]=d[19].get("errors"),d[26]=d[19].get("errors"),a=[void 0,!1,c.i64.cast([0,9])],d[21]=a[0],d[22]=a[1],d[23]=a[2],a))},function(e){return d[22]?c.sequence([function(e){return d[21]!==void 0?c.sequence([function(a){return c.storedProcedure(b("LSGenerateInitialVirtualDeviceSetupPayload"),d[5]).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[26]!==void 0?c.sequence([function(a){return d[32]=d[26].get("virtual_device_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=d[26].get("virtual_device_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=d[26].get("virtual_device_epoch_storage_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[38]=d[26].get("virtual_device_epoch_storage_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[38]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[40]=d[26].get("device_epoch_hmac"),c.nativeOperation(b("LSBase64Encode.nop"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[42]=d[26].get("epoch_root_key_fingerprint"),c.blobs.neq(d[42],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[42]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[43]=d[54]}]):c.resolve(d[43]=void 0)},function(a){return d[44]=d[26].get("ocmf_rotation_token"),c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[46]=d[26].get("encrypted_secret_values_payload"),d[47]=d[26].get("virtual_device_type"),d[48]=d[26].get("action_type"),d[49]=d[26].get("cloud_service_account"),d[50]=d[26].get("hsm_pin_normalization_status"),d[51]=d[26].get("security_question_type"),d[52]=d[26].get("trusted_contact_id"),d[53]=new c.Map(),d[53].set("virtual_device_public_key",d[33]==null?"":d[33]),d[53].set("virtual_device_id",d[35]==null?"":d[35]),d[53].set("virtual_device_epoch_storage_public_key",d[37]==null?"":d[37]),d[53].set("virtual_device_epoch_storage_public_key_sig",d[39]==null?"":d[39]),d[53].set("encrypted_secret_values",d[46]),d[53].set("device_epoch_hmac",d[41]==null?"":d[41]),d[53].set("epoch_root_key_fingerprint",d[43]),d[53].set("ocmf_rotation_token",d[45]==null?"":d[45]),d[53].set("virtual_device_type",d[47]),d[53].set("action_type",d[48]),d[53].set("cloud_service_account",d[49]),d[53].set("hsm_pin_normalization_status",d[50]),d[53].set("security_question_type",d[51]),d[53].set("trusted_contact_id",d[52]),a=[d[53],!0,c.i64.cast([0,0])],d[28]=a[0],d[29]=a[1],d[30]=a[2],a}]):c.resolve((d[27]!==void 0?(d[35]=d[27].get("error_code"),a=[void 0,!1,d[35]],d[32]=a[0],d[33]=a[1],d[34]=a[2],a):(a=[void 0,!1,c.i64.cast([0,16])],d[32]=a[0],d[33]=a[1],d[34]=a[2],a),a=[d[32],d[33],d[34]],d[28]=a[0],d[29]=a[1],d[30]=a[2],a))},function(e){return d[29]?c.sequence([function(e){return d[28]!==void 0?c.sequence([function(e){return d[33]=new c.Map(),d[33].set("optimistic_backup_id",d[5]),d[33].set("device_payload",d[4]),d[33].set("epoch_payload",d[21]),d[33].set("virtual_device_payload",d[28]),d[38]=c.i64.cast([0,1e3]),d[34]=d[38],d[35]=new c.Map(),d[35].set("success",d[33]),d[35].set("request_id",a[1]),d[36]=c.toJSON(d[35]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[36],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[34]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[32]=c.i64.cast([0,0])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null virtual device payload"),d[34]="Null virtual device payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[34]].join("")),d[33]=c.createArray(),void 0!==void 0?d[39]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[34],d[33],c.i64.cast([0,3]))},function(e){return d[35]=new c.Map(),d[35].set("error_code",d[30]),d[35].set("error_message","Null virtual device payload"),d[35].set("stored_procedure","initializeBackupV2"),d[36]=new c.Map(),d[36].set("failure",d[35]),d[36].set("request_id",a[1]),d[37]=c.toJSON(d[36]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[37],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[32]=c.i64.cast([0,1])}])},function(a){return d[31]=d[32]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create virtual device payload"),d[33]="Could not create virtual device payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[33]].join("")),d[32]=c.createArray(),void 0!==void 0?d[38]=(d[32].push(void 0),d[32]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[33],d[32],c.i64.cast([0,3]))},function(e){return d[34]=new c.Map(),d[34].set("error_code",d[30]),d[34].set("error_message","Could not create virtual device payload"),d[34].set("stored_procedure","initializeBackupV2"),d[35]=new c.Map(),d[35].set("failure",d[34]),d[35].set("request_id",a[1]),d[36]=c.toJSON(d[35]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[36],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[31]=c.i64.cast([0,1])}])},function(a){return d[25]=d[31]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null epoch payload"),d[27]="Null epoch payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[27]].join("")),d[26]=c.createArray(),void 0!==void 0?d[32]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[27],d[26],c.i64.cast([0,3]))},function(e){return d[28]=new c.Map(),d[28].set("error_code",d[23]),d[28].set("error_message","Null epoch payload"),d[28].set("stored_procedure","initializeBackupV2"),d[29]=new c.Map(),d[29].set("failure",d[28]),d[29].set("request_id",a[1]),d[30]=c.toJSON(d[29]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[30],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[25]=c.i64.cast([0,1])}])},function(a){return d[24]=d[25]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create epoch payload"),d[26]="Could not create epoch payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[26]].join("")),d[25]=c.createArray(),void 0!==void 0?d[31]=(d[25].push(void 0),d[25]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[26],d[25],c.i64.cast([0,3]))},function(e){return d[27]=new c.Map(),d[27].set("error_code",d[23]),d[27].set("error_message","Could not create epoch payload"),d[27].set("stored_procedure","initializeBackupV2"),d[28]=new c.Map(),d[28].set("failure",d[27]),d[28].set("request_id",a[1]),d[29]=c.toJSON(d[28]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[29],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[24]=c.i64.cast([0,1])}])},function(a){return d[15]=d[24]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null device payload"),d[17]="Null device payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[22]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[17],d[16],c.i64.cast([0,3]))},function(e){return d[18]=new c.Map(),d[18].set("error_code",d[7]),d[18].set("error_message","Null device payload"),d[18].set("stored_procedure","initializeBackupV2"),d[19]=new c.Map(),d[19].set("failure",d[18]),d[19].set("request_id",a[1]),d[20]=c.toJSON(d[19]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[20],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[15]=c.i64.cast([0,1])}])},function(a){return d[8]=d[15]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create device payload"),d[16]="Could not create device payload",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[21]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",d[16],d[15],c.i64.cast([0,3]))},function(e){return d[17]=new c.Map(),d[17].set("error_code",d[7]),d[17].set("error_message","Could not create device payload"),d[17].set("stored_procedure","initializeBackupV2"),d[18]=new c.Map(),d[18].set("failure",d[17]),d[18].set("request_id",a[1]),d[19]=c.toJSON(d[18]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50033]),d[19],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[8]=c.i64.cast([0,1])}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][initializeBackupV2] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"initializeBackupV2",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[8]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsInitializeBackupV2StoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSInitializeBackupV2StoredProcedure",["LSInitializeBackupV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSInitializeBackupV2"),e.deviceRegistrationId,e.requestId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupV2StoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){return a.runInTransaction(function(a){return c("LSInitializeBackupV2StoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,requestId:(a=d)!=null?a:""})},"readwrite",void 0,void 0,f.id+":25")}g.initializeBackupStoredProcedure=a}),98);
__d("EBInitializeBackup",["EBAPIQPLPoints","EBMainThreadEBDBApiDeferred","EBSMAPI","I64","LSAuthorityLevel","LSDatabaseSingleton","LSEncryptedBackupsOpStatus","LSIntEnum","MAWTraceUtils","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeBackup","QPLUserFlow","Random","ReQL","WAResultOrError","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a){var b,e=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton,f=(b=a.traceId)!=null?b:d("MAWTraceUtils").createTraceId(),g=(b=a.instanceKey)!=null?b:d("Random").uint32(),k=c("qpl")._(521478750,"2850");c("QPLUserFlow").start(k,{annotations:{int:{instanceKey:g}},instanceKey:g,timeoutInMs:c("justknobx")._("4211")});d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_START,void 0,g);d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_START,void 0,g);return new Promise(async function(a,b){b=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();b===""&&a(d("WAResultOrError").makeError("device_registration_id_null"));b=await d("MWEncryptedBackupsInitializeBackup").initializeBackupStoredProcedure(e,b,f);b=b[0];(i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE))&&(d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_FAIL,void 0,g),a(d("WAResultOrError").makeError("sproc_failure")));d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_END,void 0,g);var h=e.tables.secure_encrypted_backups_client_state.subscribe(async function(b,f){if(f.operation==="delete")return;b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state));if(b!=null){f=b[0];b=f.authorityLevel;f=f.backupId;if((i||(i=d("I64"))).equal(b,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){(b=d("EBAPIQPLPoints")).ebAPIAddQPLPoint(!1,k,b.EBBackupInitQPLPoints.INITIALIZE_BACKUP_END,void 0,g);h();b.ebAPIAddQPLPoint(!1,k,b.EBBackupInitQPLPoints.FETCH_BACKUP_IDS_START,void 0,g);c("EBSMAPI").fetchBackupIds(e).finally(function(){d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_END,void 0,g),d("EBAPIQPLPoints").ebAPIEndSuccess(!1,k,g),void d("EBMainThreadEBDBApiDeferred").addNewDevice()});a(d("WAResultOrError").makeResult(f))}d("EBAPIQPLPoints").ebAPIAddQPLPoint(!1,k,d("EBAPIQPLPoints").EBBackupInitQPLPoints.OPTIMISTIC_CLIENT_STATE,void 0,g);return}d("EBAPIQPLPoints").ebAPIEndFailure(!1,k,"empty_client_state",g);h();return a(d("WAResultOrError").makeError("empty_client_state"))})})}g.initializeBackup=a}),98);
__d("EBMessageRangeQueryForThreadsWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29234169046230621"}),null);
__d("EBMessageRangeQueryForThreadsWithPersistenceQuery.graphql",["EBMessageRangeQueryForThreadsWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_strings"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_strings",variableName:"restore_payload_strings"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessageRangeQueryForThreadsWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_from_selected_threads",plural:!0,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessageRangeQueryForThreadsWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_from_selected_threads",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageRangeQueryForThreadsWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQueryForThreadsWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBMessageRangeQueryForThreadsWithPersistence",["Base64Utils","EBAPIQPLPoints","EBAPIWorkerCheck","EBMessageRangeQueryForThreadsWithPersistenceQuery.graphql","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSEncryptedBackupsMessagesRangeQueryDirection","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWCurrentUser","MAWJobDefinitions","QPLUserFlow","WAGetSafeQPLError","WAHashStringToNumber","WAJids","WAResultOrError","createMainThreadQuery","handleRestoreMessagesGraphQLResponse","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("CometRelayEnvironment").__setRef("EBMessageRangeQueryForThreadsWithPersistence"),l=c("requireDeferred")("LSEBUnifiedRestoreUtils").__setRef("EBMessageRangeQueryForThreadsWithPersistence"),m=h!==void 0?h:h=b("EBMessageRangeQueryForThreadsWithPersistenceQuery.graphql");function n(){return k.load().then(function(a){var b=function(b,c){var e=d("createMainThreadQuery").getWorkerLikeRelayEnvironment(a);return d("createMainThreadQuery").createMainThreadQuery(b,c,e)};return b})}async function a(a){var b=a.instanceKey,e=a.restoreType,g=a.source,h=a.storage,k=a.threads,l=d("WAHashStringToNumber").hashStringToNumber((a=b)!=null?a:c("uuidv4")()),p=c("qpl")._(521473850,"2910");try{var q;c("QPLUserFlow").start(p,{annotations:{int:{source:(a=g)!=null?a:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:l,timeoutInMs:c("justknobx")._("2950")});if(d("EBAPIWorkerCheck").runningInWorker()){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.UNSUPPORTED_CONTEXT,{instanceKey:l});return d("WAResultOrError").makeError("unsupported-context")}if(k.length===0){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_PARAMETERS,{instanceKey:l});return d("WAResultOrError").makeError("invalid-parameters")}a=await d("handleRestoreMessagesGraphQLResponse").getClientState(h);c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{data:{string:{device_id:(i||(i=d("I64"))).to_string((q=a==null?void 0:a.device_id)!=null?q:(i||(i=d("I64"))).zero)}},instanceKey:l});if(a==null){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:l});return d("WAResultOrError").makeError("no-client-state")}var r=a.backupId,s=a.device_id,t=a.locally_available_epochs,u=a.mailboxRootKey,v=a.ocmfClientStateBlob;if(r==null||s==null||u==null||v==null){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{bool:{hasBackupId:r!=null,hasDeviceId:s!=null,hasMailboxRootKey:u!=null,hasOcmfClientStateBlob:v!=null},string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:l});return d("WAResultOrError").makeError("invalid-client-state")}a=""+((q=d("MAWCurrentUser").getAppID())!=null?q:0);q=k.map(function(a){var b=a.direction,e=a.from;e=e[0];a=a.chatJid;b=b==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER;a=d("WAJids").threadIdForChatJid(a);return JSON.stringify({restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(a),site:"www",tam_thread_subtype:0},success:babelHelpers.extends({device_context:{device_id:(i||(i=d("I64"))).to_string(s),locally_available_epochs:t,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(u),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(v)}},direction:b,server_thread_key:a},e!=null?{reference_timestamp:e}:{})})});a={app_id:a,restore_payload_strings:q,restore_type:e==="initial"?"INITIAL_RESTORE":"RANGE_QUERY_RESTORE"};c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_START,{instanceKey:l});q=await n();c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_END,{instanceKey:l});c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:l});e=await q(m,a);c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:l});q=e==null?void 0:(q=e.viewer)==null?void 0:(a=q.encrypted_backup)==null?void 0:(e=a.mailbox)==null?void 0:e.messages_from_selected_threads;if(q==null){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:l});return d("WAResultOrError").makeError("invalid-graphql-response")}var w=!1,x=!1;a=await Promise.all(q.map(async function(a,e){try{a=a;if(a==null)return d("WAResultOrError").makeError("invalid-graphql-response");if(w===!0)return d("WAResultOrError").makeError("server-side-exception");var m=a.backup_id,n=a.encrypted_messages,q=a.epoch_derivation_set,t=a.exception_string,u=a.message_range_info,v=a.should_delete_mailbox;a=a.thread_not_found;if(t!=null){if(a!=null&&a){c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.THREAD_NOT_FOUND_ON_SERVER,{data:{string:{exception:t}},instanceKey:l});c("QPLUserFlow").endSuccess(p,{instanceKey:l});return d("WAResultOrError").makeError("thread-not-found-on-server")}if(v===!0){w===!1&&(await h.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:s})},"readwrite",void 0,void 0,f.id+":430"),w=!0,c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,{instanceKey:l}));c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{data:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:t}},instanceKey:l});return d("WAResultOrError").makeError("server-side-exception")}}x===!1&&(c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:l}),c("QPLUserFlow").addAnnotations(p,{bool:{hasEpochs:q!=null&&q.epoch_edges.length>0}},{instanceKey:l}),await d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(q,h,s,b),c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:l}),x=!0);a=u||{};v=a.has_more_after;t=a.has_more_before;q=a.next_message_timestamp_ms_after;u=a.next_message_timestamp_ms_before;if(t==null||v==null||q==null||u==null){c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{data:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:l});return d("WAResultOrError").makeError("missing-message-range-info")}a=k[e];e=a.chatJid;a=a.from;a=a[0];var y=d("WAJids").threadIdForChatJid(e);m==null&&c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:l});c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_START,{instanceKey:l});n=d("handleRestoreMessagesGraphQLResponse").processMessageArray(n,m!=null?m:(i||(i=d("I64"))).to_string(r));m=n.encryptedLSEchoMessages;n=n.encryptedMessagesWithProtobufs;n=await o(h,y,e,(y=n)!=null?y:[],(e=m)!=null?e:[],{has_more_after:v,has_more_before:t,next_message_timestamp_ms_after:q,next_message_timestamp_ms_before:u},a,g,l,p);if(n.success===!0){c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,{instanceKey:l});return d("WAResultOrError").makeResult()}else{c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_FAILURE,{instanceKey:l});c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,{instanceKey:l});return d("WAResultOrError").makeError("decryption-error")}}catch(a){return d("WAResultOrError").makeError("runtime-error")}}));a.every(function(a){a=a.success;return a===!1})?c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BATCH_RESTORE_AND_DECRYPT_FAILURE,{instanceKey:l}):c("QPLUserFlow").endSuccess(p,{annotations:{int:{attemptCount:q.length,errorCount:a.reduce(function(a,b){b=b.success;return b===!1?a+1:a},0)}},instanceKey:l});return d("WAResultOrError").makeResult(a)}catch(a){c("QPLUserFlow").endFailure(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:l});return d("WAResultOrError").makeError("runtime-error")}}async function o(a,b,e,g,h,k,m,n,o,p){n===void 0&&(n=c("LSMEBTaskCreationSource").UNKNOWN);try{var q=k.has_more_after,r=k.has_more_before,s=k.next_message_timestamp_ms_after,t=k.next_message_timestamp_ms_before;k=await a.runInTransaction(async function(f){var a=[],e=null;if(h.length>0){c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:o});var i=await c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(f),{actThreadId:b,encryptedMessages:c("LSVec").ofArray(h)}),j=i[0];i=i[1];j!=null&&(a=c("LSVec").toArray(j).map(function(a){return d("LSShape").toRecord(a).value}));i!=null&&c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECRYPTION_FAILURE,{instanceKey:o});c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:o})}if(g.length>0){c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:o});j=await c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(f),{actThreadId:b,encryptedMessagesWithProtobufs:c("LSVec").ofArray(g)});i=j[0];f=j[1];i!=null&&(e=i);f!=null&&c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,{instanceKey:o});c("QPLUserFlow").addPoint(p,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:o})}return{decryptedEchoMsgs:a,decryptedProtobufMsgs:e}},"readwrite",void 0,void 0,f.id+":700");var u=k.decryptedEchoMsgs,v=k.decryptedProtobufMsgs;c("promiseDone")(l.load().then(function(a){return a.echoProtobufConsolidatedRestoreHelper(b,(a=v)!=null?a:c("LSVec").ofArray([]),r,(i||(i=d("I64"))).of_string(t),q,i.of_string(s),!1,void 0,""+m,void 0,c("LSVec").ofArray(u),(j||(j=d("LSIntEnum"))).ofNumber(n),e,!0)}));return d("WAResultOrError").makeResult()}catch(a){return d("WAResultOrError").makeError("runtime-error")}}g.messageRangeQueryForThreadsWithPersistence=a}),98);
__d("EBSetRestoreStatusForInitialRestore",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","WAJids","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a,b){var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status).map(function(a){a=a.threadId;return a}));return b.runInTransaction(async function(b){var f=[],g=[];e.forEach(function(a){f.push(b.encrypted_backups_client_restore_status.delete(a))});await Promise.all(f);a.forEach(function(a){g.push(b.encrypted_backups_client_restore_status.put({lastUpdated:(j||(j=d("I64"))).of_float((h||(h=c("performanceAbsoluteNow")))()),restoreStatus:(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS),threadId:d("WAJids").threadIdForChatJid(a)}))});await Promise.all(g)},"readwrite",void 0,void 0,f.id+":37")}async function b(a){var b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups_client_restore_status).map(function(a){a=a.threadId;return a}));return a.runInTransaction(async function(a){var c=[];b.forEach(function(b){c.push(a.encrypted_backups_client_restore_status.delete(b))});await Promise.all(c)},"readwrite",void 0,void 0,f.id+":75")}g.setRestoreStatusForInitialRestore=a;g.resetClientRestoreStatus=b}),98);
__d("LSCreateDataTrace",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(153).add({traceId:a[0],initTimestampMs:c[0],traceType:a[4],shouldFlush:!1,contextOne:a[1],contextTwo:a[2],contextThree:a[3]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSDataTraceCreateDataTraceStoredProcedure";a.__tables__=["data_trace_meta"];e.exports=a}),null);
__d("LSCreateDataTraceID.nop",["LSRequestId","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d){return(h||(h=b("Promise"))).resolve(c("LSResult")(c("LSRequestId").generate()))};a.__nop_name__="LSCreateDataTraceID";g["default"]=a}),98);
__d("LSInitializeRestore",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSGetLatestThreadIds.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueMessageRangeQueryTask","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] Beginning execution."),d[1]=c.i64.cast([0,1e3]),c.nativeOperation(b("LSGetLatestThreadIds.nop"),"AdvancedCrypto",d[1],!0).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(a){return c.forEach(c.db.table(231).fetch(),function(a){return a["delete"]()})},function(e){return d[3]?d[2]!==void 0?(d[10]=c.i64.of_int32(d[2].length),c.i64.gt(d[10],c.i64.cast([0,0]))?(d[11]=c.i64.cast([0,0]),d[12]=c.i64.of_int32(d[2].length),c.i64.gt(d[12],c.i64.cast([0,0]))?c.loopAsync(d[12],function(e){return d[13]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[2],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return d[19]=c.i64.add(d[11],c.i64.cast([0,1])),a[0]!==void 0?c.resolve(d[16]=a[0]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0],d[20]=f[0],d[21]=f[1],d[22]=f[2],d[23]=f[3],d[24]=f[4],d[25]=f[5],d[26]=f[6],d[27]=f[7],d[28]=f[8],d[29]=f[9],d[30]=f[10],d[31]=f[11],d[32]=f[12],d[33]=f[13],d[34]=f[14],d[35]=f[15],d[36]=f[16],f):(e=a.item,c.sequence([function(a){return d[45]=e.backupTenancy,d[44]=e.encryptionVersion,d[40]=void 0,c.i64.neq(d[40],void 0)?c.resolve(d[41]=d[40]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[44],a)})?d[54]=d[44]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[41]=d[55]}])},function(a){return c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=c.i64.cast([0,0]),c.i64.neq(d[45],void 0)?d[43]=d[45]:d[43]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[42],d[43],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],d[24]=a[4],d[25]=a[5],d[26]=a[6],d[27]=a[7],d[28]=a[8],d[29]=a[9],d[30]=a[10],d[31]=a[11],d[32]=a[12],d[33]=a[13],d[34]=a[14],d[35]=a[15],d[36]=a[16],a}]))})},function(a){return c.i64.eq(d[35],c.i64.cast([0,80]))&&c.i64.eq(d[27],c.i64.cast([0,2]))?d[38]=c.i64.or_(c.i64.cast([0,73]),c.i64.cast([0,128])):d[38]=c.i64.cast([0,73]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.sequence([function(a){return d[44]="EncryptedBackups MCD Trace ID",d[45]=c.i64.to_string(d[38]),d[43]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[43],d[44],d[43],d[45]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[40],void 0,void 0,"restore_messages",d[38])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[42]=!0:d[42]=!1,d[42]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[44]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[44],d[43],c.i64.cast([0,3]))):c.resolve()},function(a){return d[39]=d[40]}])},function(a){return d[16]=d[39]}])},function(a){return c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,2506]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[17]=c.i64.of_float(Date.now()),c.db.table(231).add({threadId:d[14],lastUpdated:d[17],restoreStatus:c.i64.cast([0,1])})},function(a){return c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,3602]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.i64.gt(d[19],c.i64.cast([0,20]))?d[18]="encrypted_backups_restore":d[18]=["encrypted_backups_restore",":",d[14]].join(""),c.storedProcedure(b("LSIssueMessageRangeQueryTask"),d[14],c.i64.cast([0,20]),void 0,!1,d[16],c.i64.cast([0,0]),c.i64.cast([-1,4294967295]),!1)},function(a){return d[11]=d[19]}])}):c.resolve()):(d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,113])),d[11].set("error_message",void 0==null?"":void 0),d[11].set("stored_procedure","initializeRestore"),d[12]=new c.Map(),d[12].set("act_thread_id",""),d[12].set("source",c.i64.cast([-1,4294967295])),d[12].set("restore_operation_type",c.i64.cast([0,3])),d[12].set("request_id",void 0),d[12].set("device_id",void 0),d[13]=new c.Map(),d[13].set("restore_context",d[12]),d[13].set("failure",d[11]),d[14]=d[13].get("queue_name"),d[14]!==void 0?d[15]=d[14]:(d[17]=d[13].get("restore_context"),d[18]=d[17].get("act_thread_id"),d[15]=["encrypted_backups_restore",":",d[18]].join("")),d[16]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewTask"),d[15],c.i64.cast([0,50030]),d[16],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))):(d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,107])),d[10].set("error_message",void 0==null?"":void 0),d[10].set("stored_procedure","initializeRestore"),d[11]=new c.Map(),d[11].set("act_thread_id",""),d[11].set("source",c.i64.cast([-1,4294967295])),d[11].set("restore_operation_type",c.i64.cast([0,3])),d[11].set("request_id",void 0),d[11].set("device_id",void 0),d[12]=new c.Map(),d[12].set("restore_context",d[11]),d[12].set("failure",d[10]),d[13]=d[12].get("queue_name"),d[13]!==void 0?d[14]=d[13]:(d[16]=d[12].get("restore_context"),d[17]=d[16].get("act_thread_id"),d[14]=["encrypted_backups_restore",":",d[17]].join("")),d[15]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewTask"),d[14],c.i64.cast([0,50030]),d[15],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):(d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,107])),d[10].set("error_message",void 0==null?"":void 0),d[10].set("stored_procedure","initializeRestore"),d[11]=new c.Map(),d[11].set("act_thread_id",""),d[11].set("source",c.i64.cast([-1,4294967295])),d[11].set("restore_operation_type",c.i64.cast([0,3])),d[11].set("request_id",void 0),d[11].set("device_id",void 0),d[12]=new c.Map(),d[12].set("restore_context",d[11]),d[12].set("failure",d[10]),d[13]=d[12].get("queue_name"),d[13]!==void 0?d[14]=d[13]:(d[16]=d[12].get("restore_context"),d[17]=d[16].get("act_thread_id"),d[14]=["encrypted_backups_restore",":",d[17]].join("")),d[15]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewTask"),d[14],c.i64.cast([0,50030]),d[15],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeRestoreStoredProcedure",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsInitializeRestoreStoredProcedure";a.__tables__=["encrypted_backups_client_restore_status","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSInitializeRestoreStoredProcedure",["LSInitializeRestore","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSInitializeRestore"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeRestore",["EBGetLatestChatJids","EBMessageRangeQueryForThreadsWithPersistence","EBSetRestoreStatusForInitialRestore","ExecutionEnvironment","I64","LSEncryptedBackupsOpStatus","LSFactory","LSInitializeRestoreStoredProcedure","LSIntEnum","LSMEBTaskCreationSource","LSRequestId","MAWEBRestoreTrackingUtils","MpsTypes","getErrorSafe","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function k(a,b){try{d("MAWEBRestoreTrackingUtils").markEBRestoreInitial({querySource:"GQL_MAIN_THREAD",traceId:b});var e=await d("EBGetLatestChatJids").getLatestChatJids(a);if(e.success===!1)return;var f=e.value.map(function(a){return{chatJid:a,direction:"before",from:[d("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),void 0]}});await d("EBSetRestoreStatusForInitialRestore").setRestoreStatusForInitialRestore(e.value,a);e=await d("EBMessageRangeQueryForThreadsWithPersistence").messageRangeQueryForThreadsWithPersistence({instanceKey:b,restoreType:"initial",source:c("LSMEBTaskCreationSource").EB_ADD_DEVICE,storage:a,threads:f});e.success===!1&&(d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(j||(j=c("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed: "+e.error),await d("EBSetRestoreStatusForInitialRestore").resetClientRestoreStatus(a));e.success===!0&&e.value.some(function(a){a=a.success;return a===!1})&&await d("EBSetRestoreStatusForInitialRestore").resetClientRestoreStatus(a)}catch(e){d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(j||(j=c("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed: "+c("getErrorSafe")(e).message);await d("EBSetRestoreStatusForInitialRestore").resetClientRestoreStatus(a);throw e}}function l(a,b){d("MAWEBRestoreTrackingUtils").markEBRestoreInitial({querySource:"LS",traceId:b});return a.runInTransaction(function(a){return c("LSInitializeRestoreStoredProcedure")(c("LSFactory")(a),{traceId:b})},"readwrite",void 0,void 0,f.id+":117").then(function(a){a=a[0];(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").SUCCESS))||d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(j||(j=c("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed")}).catch(function(a){d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(j||(j=c("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed: "+a.message);throw a})}function a(a){var b=c("LSRequestId").generate();if(c("gkx")("12983"))return k(a,b);else return l(a,b)}g.initializeRestore=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){async function a(a,b){a=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);b=await d("WAComms").sendSmaxStanza(a,b);var c=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(b,a);if(c.success)return{name:"RotateSignedResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(b,a);if(e.success)return{name:"RotateSignedResponseValidationError",value:e.value};var f=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(b,a);if(f.success)return{name:"RotateSignedResponseRequestError",value:f.value};b=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(b,a);if(b.success)return{name:"RotateSignedResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:c,ValidationError:e,RequestError:f,ServerError:b}))}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);async function a(){n.LOG(m());try{var a=await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0});n.LOG(l());a=await d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)});switch(a.name){case"RotateSignedResponseValidationError":var b=a.value,c=b.errorCode,e=b.errorText;b=b.errorIdentityKeyMixin;n.ERROR(k(),c,e);return d("WAResultOrError").makeError({type:"validation-error",identity:b.elementValue});case"RotateSignedResponseRequestError":c=a.value.errorRequestErrors.value.code;e=a.value.errorRequestErrors.name;n.ERROR(j(),c,e);return d("WAResultOrError").makeError({type:"request-error"});case"RotateSignedResponseServerError":b=a.value.errorServerErrors.value.code;c=a.value.errorServerErrors.name;n.ERROR(i(),b,c);return d("WAResultOrError").makeError({type:"server-error"});default:a.name;n.LOG(h());return d("WAResultOrError").makeResult()}}catch(a){e=d("WAErrorMessage").maybeGetMessageFromError(a);if(e.includes("No lastSignedPrekeyId and registration")){await d("WAHandleFailureUtils").reregisterPhone();return d("WAResultOrError").makeError({type:"no-prekey-reregistered"})}throw a}}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);async function a(a){a=await d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol();if(a.success||a.error.type==="no-prekey-reregistered")return;if(a.error.type==="validation-error"){k.ERROR(j());d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"}).catch(function(a){k.ERROR(i(),a)});return Promise.resolve()}k.ERROR(h());throw c("err")("rotateSignedPreKey RPC failed: "+a.error.type)}g.rotateSignedPreKey=a}),98);/*FB_PKG_DELIM*/
__d("MessageFeedbackType",[],(function(a,b,c,d,e,f){a=Object.freeze({POSITIVE:0,NEGATIVE:1});f["default"]=a}),66);
__d("LSSubmitMessageFeedback",["LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("feedback_type",a[0]),d[0].set("message_id",a[1]),d[0].set("page_id",a[2]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),"submit_message_feedback",c.i64.cast([0,811]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxSubmitMessageFeedbackStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSSubmitMessageFeedbackStoredProcedure",["LSSubmitMessageFeedback","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSubmitMessageFeedback"),e.feedbackType,e.messageId,e.pageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("useSubmitBusinessMessageFeedbackAction",["LSFactory","LSIntEnum","LSSubmitMessageFeedbackStoredProcedure","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;(j||d("react")).useCallback;function a(a,b,e,g){var j=d("react-compiler-runtime").c(6),k=(h||(h=c("useReStore")))(),l;j[0]!==g||j[1]!==k||j[2]!==e||j[3]!==a||j[4]!==b?(l=function(){c("promiseDone")(k.runInTransaction(function(f){return c("LSSubmitMessageFeedbackStoredProcedure")(c("LSFactory")(f),{feedbackType:(i||(i=d("LSIntEnum"))).ofNumber(e),messageId:a,pageId:b})},"readwrite",void 0,void 0,f.id+":38"),g)},j[0]=g,j[1]=k,j[2]=e,j[3]=a,j[4]=b,j[5]=l):l=j[5];return l}g["default"]=a}),98);
__d("useBusinessMessageNegativeFeedback",["fbt","MessageFeedbackType","react-compiler-runtime","useGenAiFeedbackSubmittedToast","useSubmitBusinessMessageFeedbackAction"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=d("react-compiler-runtime").c(3),e=c("useGenAiFeedbackSubmittedToast")(a);a=c("useSubmitBusinessMessageFeedbackAction")(a==null?void 0:a.messageId,a==null?void 0:a.senderId,c("MessageFeedbackType").NEGATIVE,e);b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"Bad response"),b[0]=e):e=b[0];e=e;b[1]!==a?(e=[a,e],b[1]=a,b[2]=e):e=b[2];return e}g["default"]=a}),226);
__d("BusinessMessageNegativeFeedbackMenuItem.react",["MWXMenuItem.react","react","react-compiler-runtime","useBusinessMessageNegativeFeedback"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.message;a=c("useBusinessMessageNegativeFeedback")(a);var e=a[0];a=a[1];var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWXMenuItem.react"),{"aria-label":a,onClick:e,primaryText:a,testid:void 0}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("useBusinessMessagePositiveFeedback",["fbt","MessageFeedbackType","react-compiler-runtime","useGenAiFeedbackSubmittedToast","useSubmitBusinessMessageFeedbackAction"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=d("react-compiler-runtime").c(3),e=c("useGenAiFeedbackSubmittedToast")(a);a=c("useSubmitBusinessMessageFeedbackAction")(a==null?void 0:a.messageId,a==null?void 0:a.senderId,c("MessageFeedbackType").POSITIVE,e);b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"Good response"),b[0]=e):e=b[0];e=e;b[1]!==a?(e=[a,e],b[1]=a,b[2]=e):e=b[2];return e}g["default"]=a}),226);
__d("BusinessMessagePositiveFeedbackMenuItem.react",["MWXMenuItem.react","react","react-compiler-runtime","useBusinessMessagePositiveFeedback"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.message;a=c("useBusinessMessagePositiveFeedback")(a);var e=a[0];a=a[1];var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWXMenuItem.react"),{"aria-label":a,onClick:e,primaryText:a,testid:void 0}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("CDSToast.react",["fbt","BaseToast.react","CDSIcon.react","CDSIconButton.react","CDSText.react","CDSThemeConfig","MetaBrandXFilled24.svg.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={header:{marginBottom:"x1e56ztr",$$css:!0},link:{paddingTop:"x1iorvi4",paddingBottom:"xjkvuk6",wordBreak:"xdnwjd9",$$css:!0}};b={margin20:{marginBottom:"xieb3on",$$css:!0},margin32:{marginBottom:"x1iymm2a",$$css:!0},margin48:{marginBottom:"x13ihpsm",$$css:!0},margin64:{marginBottom:"x16bybu0",$$css:!0}};var l={20:b.margin20,32:b.margin32,48:b.margin48,64:b.margin64};function a(a){var b=d("react-compiler-runtime").c(18),e=a.action,f=a.addOnStart,g=a.density,i=a.header,n=a.message,o=a.offsetFooter,p=a.onDismiss,q=a.ref,r=a.size,s=a.testid;a=a.withoutCloseButton;r=r===void 0?"full-width":r;a=a===void 0?!1:a;var t;b[0]!==e?(t=e!=null?{label:e.label,labelRenderer:m,onPress:e.onPress,testid:e.testid}:void 0,b[0]=e,b[1]=t):t=b[1];b[2]!==p||b[3]!==a?(e=!a&&j.jsx(c("CDSIconButton.react"),{"aria-label":h._(/*BTDS*/"Close"),onPress:p,children:j.jsx(c("CDSIcon.react"),{color:"toast-DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",icon:c("MetaBrandXFilled24.svg.react"),size:24})}),b[2]=p,b[3]=a,b[4]=e):e=b[4];b[5]!==i||b[6]!==n?(a=function(a){a=a.toastMessageId;return j.jsxs("div",babelHelpers["extends"]({className:"x78zum5 xdt5ytf"},{id:a,children:[i!=null&&j.jsx(c("CDSText.react"),{color:"toastText_DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",textStyle:"bodyEmphasized",xstyle:k.header,children:i}),j.jsx(c("CDSText.react"),{color:"toastText_DO_NOT_USE_WILL_BE_DELETED_WITHOUT_NOTICE",textStyle:"body",children:n})]}))},b[5]=i,b[6]=n,b[7]=a):a=b[7];o=o&&l[o];b[8]!==f||b[9]!==g||b[10]!==p||b[11]!==r||b[12]!==t||b[13]!==e||b[14]!==a||b[15]!==o||b[16]!==s?(q=j.jsx(c("BaseToast.react"),{action:t,addOnStart:f,closeButton:e,density:g,message:a,offsetStyles:o,onDismiss:p,size:r,testid:void 0,themeConfigOverride:c("CDSThemeConfig"),toastRef:q}),b[8]=f,b[9]=g,b[10]=p,b[11]=r,b[12]=t,b[13]=e,b[14]=a,b[15]=o,b[16]=s,b[17]=q):q=b[17];return q}function m(a){return j.jsx(c("CDSText.react"),{color:"toastTextLink",textStyle:"body",xstyle:k.link,children:a})}m.displayName=m.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("ChangeVoteFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5497");b=d("FalcoLoggerInternal").create("change_vote",a);e=b;g["default"]=e}),98);
__d("CometFRXQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9535840966543722"}),null);
__d("CometFRXQuery$Parameters",["CometFRXQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("CometFRXQuery_facebookRelayOperation"),metadata:{},name:"CometFRXQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("CometFRX.entrypoint",["CometFRXQuery$Parameters","JSResourceForInteraction","WebPixelRatio"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){var b=a.conformed_interface_override,e=a.entryPoint,f=a.id,g=a.location;a=a.responsible_id;return{queries:{frx:{parameters:c("CometFRXQuery$Parameters"),variables:{input:{conformed_interface_override:b,entry_point:e,id:f,location:g,responsible_id:a},scale:d("WebPixelRatio").get()}}}}},root:c("JSResourceForInteraction")("CometFRX.react").__setRef("CometFRX.entrypoint")};g["default"]=a}),98);
__d("cometMessengerFileUploadComposerPluginSupportedTypes",[],(function(a,b,c,d,e,f){"use strict";a=["photo","video","file"];b=a;f["default"]=b}),66);
__d("useCometLexicalDragAndDrop",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(a,b){var c=d("react-compiler-runtime").c(8),e=b.onDragEnter,f=b.onDragLeave,g=b.onDragOver,h=b.onDrop,j=b.onPaste,k;c[0]!==a||c[1]!==e||c[2]!==f||c[3]!==g||c[4]!==h||c[5]!==j?(b=function(){if(a!=null)return a.registerRootListener(function(a,b){b!=null&&(e&&b.removeEventListener("dragenter",e),f&&b.removeEventListener("dragleave",f),g&&b.removeEventListener("dragover",g),h&&b.removeEventListener("drop",h,!0),j&&b.removeEventListener("paste",j,!0)),a!==null&&(e&&a.addEventListener("dragenter",e),f&&a.addEventListener("dragleave",f),g&&a.addEventListener("dragover",g),h&&a.addEventListener("drop",h,!0),j&&a.addEventListener("paste",j,!0))})},k=[a,e,f,g,h,j],c[0]=a,c[1]=e,c[2]=f,c[3]=g,c[4]=h,c[5]=j,c[6]=b,c[7]=k):(b=c[6],k=c[7]);i(b,k)}g["default"]=a}),98);
__d("useCometLexicalFileDragAndDrop",["react","react-compiler-runtime","useCometLexicalDragAndDrop"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useRef;function a(a){var b=d("react-compiler-runtime").c(26),e=a.editor,f=a.isMimeTypeAcceptable,g=a.onHover;a=a.onSubmit;var h=g===void 0?l:g,m=a===void 0?k:a,n=i(0);b[0]!==f?(g=function(a){return Array.from(a).filter(f)},b[0]=f,b[1]=g):g=b[1];var o=g;b[2]!==o||b[3]!==h?(a=function(a){n.current=n.current+1;var b=a.dataTransfer;if(b==null)return h([],!0);b=o(b.items);b.length>0&&a.preventDefault();return h(b,!0)},b[2]=o,b[3]=h,b[4]=a):a=b[4];g=a;b[5]!==h?(a=function(a){n.current=n.current-1;if(n.current===0)return h([],!1)},b[5]=h,b[6]=a):a=b[6];a=a;var p;b[7]!==o||b[8]!==h?(p=function(a){var b=a.dataTransfer;if(b==null)return h([],!0);b=o(b.items);b.length>0&&a.preventDefault();return h(b,!0)},b[7]=o,b[8]=h,b[9]=p):p=b[9];p=p;var q;b[10]!==o||b[11]!==m?(q=function(a,b){b=o(b.items);b=b.map(j).filter(Boolean);if(b.length>0){a.stopPropagation();a.preventDefault();return m(b)}else return m([])},b[10]=o,b[11]=m,b[12]=q):q=b[12];var r=q;b[13]!==r||b[14]!==h||b[15]!==m?(q=function(a){var b=a.dataTransfer;n.current=0;h([],!1);if(b!=null)return r(a,b);else return m([])},b[13]=r,b[14]=h,b[15]=m,b[16]=q):q=b[16];q=q;var s;b[17]!==r||b[18]!==m?(s=function(a){var b=a.clipboardData;if(b==null)return m([]);var c=b.types;c=c.includes("text/plain")&&c.includes("text/html")||c.includes("text/rtf");return c?m([]):r(a,b)},b[17]=r,b[18]=m,b[19]=s):s=b[19];s=s;var t;b[20]!==g||b[21]!==a||b[22]!==p||b[23]!==q||b[24]!==s?(t={onDragEnter:g,onDragLeave:a,onDragOver:p,onDrop:q,onPaste:s},b[20]=g,b[21]=a,b[22]=p,b[23]=q,b[24]=s,b[25]=t):t=b[25];c("useCometLexicalDragAndDrop")(e,t)}function j(a){return a.getAsFile()}function k(){}function l(){}g["default"]=a}),98);
__d("useCometMessengerFileUploadPaste",["react","react-compiler-runtime","useCometLexicalFileDragAndDrop"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(a){var b=d("react-compiler-runtime").c(6),e=a.editor,f=a.handlePastedFiles;a=a.isMimeTypeAcceptable;var g;b[0]!==f?(g=function(a){a.length>0&&f(a)},b[0]=f,b[1]=g):g=b[1];g=g;var h;b[2]!==e||b[3]!==a||b[4]!==g?(h={editor:e,isMimeTypeAcceptable:a,onSubmit:g},b[2]=e,b[3]=a,b[4]=g,b[5]=h):h=b[5];c("useCometLexicalFileDragAndDrop")(h)}g["default"]=a}),98);
__d("CometMessengerHandlePastedFileComposerPlugin",["cometIsMimeTypeForMedia","cometMessengerFileUploadComposerPluginSupportedTypes","react-compiler-runtime","useCometMessengerFileUploadPaste"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a.kind!=="file")return!1;for(var b of c("cometMessengerFileUploadComposerPluginSupportedTypes"))switch(b){case"photo":if(d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a.type))return!0;break;case"video":if(d("cometIsMimeTypeForMedia").isMimeTypeForVideo(a.type))return!0;break;case"file":if(d("cometIsMimeTypeForMedia").isMimeTypeForFile(a.type))return!0;break;default:b}return!1}function a(a){var b=d("react-compiler-runtime").c(3),e=a.editor;a=a.handlePastedFiles;var f;b[0]!==e||b[1]!==a?(f={editor:e,handlePastedFiles:a,isMimeTypeAcceptable:h},b[0]=e,b[1]=a,b[2]=f):f=b[2];c("useCometMessengerFileUploadPaste")(f);return null}g["default"]=a}),98);
__d("ExistingPollSubmitErrorFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5498");b=d("FalcoLoggerInternal").create("existing_poll_submit_error",a);e=b;g["default"]=e}),98);
__d("ExistingPollSubmitSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5499");b=d("FalcoLoggerInternal").create("existing_poll_submit_success",a);e=b;g["default"]=e}),98);
__d("FRXEntryPoint",[],(function(a,b,c,d,e,f){a=Object.freeze({ACTIVITY_LOG:"activity_log",AGORA_GROUPS:"agora_groups",AGORA_RECENT_NEWS:"agora_recent_news",BLOCK_BUTTON:"block_button",BLOCK_COMPOSER:"block_composer",BUSINESS_NOTIFICATION_MESSAGE_REPORT_BUTTON:"business_notification_message_report_button",CHEVRON_BUTTON:"chevron_button",CHEVRON_TAGS:"chevron_tags",COLLEGES_LIVE_CHAT_REPORT_TO_FB:"colleges_live_chat_report_to_fb",COMMENT:"comment",CONFIRMATION_SCREEN:"confirmation_screen",CONTENT_OVERLAY:"content_overlay",CROWDSOURCING_REPORT:"crowdsourcing_report",DELETE_CONTENT_REPORT:"delete_content_report",DELETE_CONVERSATION_REPORT:"delete_conversation_report",DEVELOPER_FEEDBACK_BUTTON:"developer_feedback_button",EVENTS_REPORTING:"events_reporting",FEEDBACK_BUTTON:"feedback_button",FOX_CHEVRON_TAGS:"fox_chevron_tags",GEMSTONE_MEDIA:"gemstone_media",GEMSTONE_MESSAGING:"gemstone_messaging",GEMSTONE_PROFILE:"gemstone_profile",GROUP_MALL_RELATED_GROUPS_CHAINING:"group_mall_related_groups_chaining",GROUP_MALL_RHC:"group_mall_rhc",GROUPS_ADMIN_FEEDBACK:"groups_admin_feedback",GROUPS_DISCOVER:"groups_discover_page",GROUPS_DISCOVER_HIDE_BUTTON:"groups_discover_hide_button",GROUPS_JOIN_QUESTION:"groups_join_question",GROUPS_LEAVE:"groups_leave",GROUPS_LEAVE_BROWSE:"groups_leave_browse",GROUPS_LEAVE_SPECIAL:"groups_leave_special",GROUPS_PARTICIPATION_QUESTION:"groups_participation_question",GROUPS_PENDING_QUEUE:"groups_pending_queue",GROUPS_POLL:"groups_poll",GROUPS_REPORT:"groups_report",GROUPS_REPORT_LONG_PRESS_TO_ADMIN:"groups_report_long_press_to_admin",GROUPS_REPORT_TO_ADMIN:"groups_report_to_admin",GROUPS_RULE:"groups_rule",GROUPS_TAB_CHAT_ROW:"groups_tab_chat_row",GROUPS_TAB_DISCOVER_FIRST:"groups_tab_discover_first",GROUPS_TRANSPARENCY:"groups_transparency",HATE_CTA:"hate_cta",HELP_NAV_BUTTON:"help_nav_button",HIDE_AD_BUTTON:"hide_ad_button",HIDE_AD_XOUT_BUTTON:"hide_ad_xout_button",IN_PROFILE_MEDIA_SELECTOR:"in_profile_media_selector",INSTANT_GAMES_BOT_FEEDBACK_LINK:"instant_games_bot_feedback_link",LEAVE_CONVERSATION_REPORT:"leave_conversation_report",LOCAL_COMMUNITY_DEMOTE_CONTENT:"local_community_demote_content",LOCAL_COMMUNITY_MOD_HUB_DEMOTE:"local_community_mod_hub_demote",LOCAL_COMMUNITY_POST_REPORT_TO_MOD:"local_community_post_report_to_mod",LOCAL_LIVE_CHAT_REPORT_TO_FB:"local_live_chat_report_to_fb",MARK_AS_SOLD_BUTTON:"mark_as_sold_button",MARK_AS_SUSPICIOUS_BUTTON:"mark_as_suspicious_button",MARKETPLACE_SUBCOMPONENT_REPORT_BUTTON:"marketplace_subcomponent_report_button",MESSAGE_MEDIA_BUBBLE_REPORT:"message_media_bubble_report",MOBILE_GYSJ:"mobile_gysj",NOTE_REPORT_BUTTON:"note_report_button",NOTIFICATIONS_JEWEL:"notifications_jewel",PAGE_UNFOLLOW:"page_unfollow",PAGE_UNFOLLOW_CHEVRON:"page_unfollow_chevron",PAGE_UNLIKE:"page_unlike",PAGE_VERIFICATION_BADGE_OPTION:"page_verification_badge_option",PAGE_VERIFICATION_PAGE_OPTION:"page_verification_page_option",POLITICAL_AD_VERIFIED_VOICE:"political_ad_verified_voice",PROACTIVE_WARNING_BANNER:"proactive_warning_banner",PROACTIVE_WARNING_COMPOSER_BLOCK:"proactive_warning_composer_block",PROACTIVE_WARNING_POPOVER:"proactive_warning_popover",PROACTIVE_WARNING_STRAP:"proactive_warning_strap",PROFILE_REPORT_BUTTON:"profile_report_button",PROFILE_REPORT_FLOW:"profile_report_flow",PROFILE_SUBMIT_FEEDBACK:"profile_submit_feedback",QUICK_REPORT_ACTION:"quick_report_action",RELATED_SEARCHES:"related_searches",REPORT_AD_BUTTON:"report_ad_button",REPORT_AD_XOUT_BUTTON:"report_ad_xout_button",REPORT_BUTTON:"report_button",REPORT_BUTTON_DETAILED_FRX:"report_button_detailed_frx",REPORT_FROM_PREVIEW:"report_from_preview",REPORT_JOB_BUTTON:"report_job_button",REPORT_LONG_PRESS:"report_long_press",ROOMS_POST_CALL_HIGH_RATING:"rooms_post_call_high_rating",ROOMS_POST_CALL_LOW_RATING:"rooms_post_call_low_rating",ROOMS_POST_CALL_LOW_RATING_DETAILED:"rooms_post_call_low_rating_detailed",SCHOOL_COMMUNITY_TAGS:"school_community_tags",SEARCH_META_AI_PROMPT_SUGGESTION:"search_meta_ai_prompt_suggestion",SEARCH_TYPEAHEAD:"search_typeahead",SNACKBAR:"snackbar",STORY_ATTACHMENT_SHARE:"story_attachment_share",STRUCTURED_REPORT_BUTTON:"structured_report_button",THREADLIST_MENU_REPORT:"threadlist_menu_report",TOMBSTONE:"tombstone",TOOLBAR_REPORT_ACTION:"toolbar_report_action",UNKNOWN:"unknown",UNOWNED_PAGE_ACTION_MENU_REPORT_PAGE:"unowned_page_action_menu_report_page",UPSELL_AFTER_BLOCK_BOTTOM_SHEET:"upsell_after_block_bottom_sheet",USER_CONTROL_MENU:"user_control_menu",WORKPLACE_REPORT_AND_HIDE_BUTTON:"workplace_report_and_hide_button",WORKPLACE_REPORT_BUTTON:"workplace_report_button",WORKROOM_MEETING_REPORT_BUTTON:"workroom_meeting_report_button",WORKROOM_REPORT_BUTTON:"workroom_report_button",WORKROOM_USER_REPORT_BUTTON:"workroom_user_report_button",X_OUT:"x_out"});f["default"]=a}),66);
__d("GroupPollEvent",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({START_NEW_POLL:"start_new_poll",SUBMIT_NEW_POLL:"submit_new_poll",NEW_POLL_SUBMIT_ERROR:"new_poll_submit_error",NEW_POLL_SUBMIT_SUCCESS:"new_poll_submit_success",OPEN_EXISTING_POLL:"open_existing_poll",CHANGE_VOTE:"change_vote",SHOW_VOTERS:"show_voters",SUBMIT_EXISTING_POLL:"submit_existing_poll",EXISTING_POLL_SUBMIT_ERROR:"existing_poll_submit_error",EXISTING_POLL_SUBMIT_SUCCESS:"existing_poll_submit_success"});c=a;f["default"]=c}),66);
__d("LSDeleteMessageStoredProcedure",["LSDeleteMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteMessage"),e.threadKey,e.messageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticSetOrUnsetPinnedMessage",["LSIssueNewTask","LSShimThreadPinMessage.nop","LSShimThreadUnpinMessage.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.i64.neq(a[1],void 0)?c.i64.eq(a[3],c.i64.cast([0,1]))||c.i64.eq(a[3],c.i64.cast([0,2]))?c.sequence([function(d){return c.nativeOperation(b("LSShimThreadPinMessage.nop"),a[0],a[2],a[1])},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,1]):(b=a.item,d[6]=b.syncGroup,c.i64.neq(d[6],void 0)?d[5]=d[6]:d[5]=c.i64.cast([0,1]),d[0]=d[5])})},function(e){return d[2]=new c.Map(),d[2].set("armadillo_thread_key",a[1]),d[2].set("offline_threading_id",a[0]),d[2].set("timestamp_ms",a[2]),d[2].set("sync_group",d[0]),d[3]=d[2].get("timestamp_ms"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["e2ee_pin_msg","_",c.i64.to_string(d[3])].join(""),c.i64.cast([0,1010]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(d){return c.nativeOperation(b("LSShimThreadUnpinMessage.nop"),a[0],a[1])},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,1]):(b=a.item,d[6]=b.syncGroup,c.i64.neq(d[6],void 0)?d[5]=d[6]:d[5]=c.i64.cast([0,1]),d[0]=d[5])})},function(e){return d[2]=new c.Map(),d[2].set("armadillo_thread_key",a[1]),d[2].set("offline_threading_id",a[0]),d[2].set("timestamp_ms",a[2]),d[2].set("sync_group",d[0]),d[3]=d[2].get("timestamp_ms"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["e2ee_unpin_msg","_",c.i64.to_string(d[3])].join(""),c.i64.cast([0,1011]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.resolve()},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxOptimisticSetOrUnsetPinnedMessageStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSOptimisticSetOrUnsetPinnedMessageStoredProcedure",["LSOptimisticSetOrUnsetPinnedMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticSetOrUnsetPinnedMessage"),e.offlineThreadingId,e.threadKey,e.timestampMs,e.state);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticSetPinnedMessage",["LSIssueNewTaskWithExtraOperations","LSSetPinnedMessage"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(d){return c.i64.eq(a[3],c.i64.cast([0,2]))?c.storedProcedure(b("LSSetPinnedMessage"),a[0],a[1],a[2],c.i64.cast([0,1])):c.storedProcedure(b("LSSetPinnedMessage"),a[0],a[1],a[2],a[3])},function(e){return c.i64.eq(a[3],c.i64.cast([0,2]))?(d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("message_id",a[1]),d[0].set("timestamp_ms",a[2]),d[0].set("pinned_location",c.i64.cast([0,1])),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),["pin_msg_v2","_",c.i64.to_string(d[1])].join(""),c.i64.cast([0,430]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))):c.i64.eq(a[3],c.i64.cast([0,1]))?(d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("message_id",a[1]),d[0].set("timestamp_ms",a[2]),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),["pin_msg_v2","_",c.i64.to_string(d[1])].join(""),c.i64.cast([0,430]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))):c.i64.eq(a[3],c.i64.cast([0,0]))?(d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("message_id",a[1]),d[0].set("timestamp_ms",a[2]),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),["unpin_msg_v2","_",c.i64.to_string(d[1])].join(""),c.i64.cast([0,431]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))):c.resolve(0)}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticSetPinnedMessageStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSOptimisticSetPinnedMessageStoredProcedure",["LSOptimisticSetPinnedMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticSetPinnedMessage"),e.threadKey,e.messageId,e.pinnedTimestampMs,e.state);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSPinnedMessageState",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_PINNED:0,PINNED:1,PINNED_AND_FEATURED:2});f["default"]=a}),66);
__d("LSReportMessageInCommunityChannel",["LSIssueNewError","LSIssueNewTaskAndGetTaskID","LSLocalize"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.sortBy(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?c.sequence([function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,2285622730]),void 0).then(function(a){return d[7]=a})},function(a){return b("LSLocalize").localizeV2Async(c.i64.cast([0,1919524925]),void 0).then(function(a){return d[8]=a})},function(a){return c.storedProcedure(b("LSIssueNewError"),void 0,c.i64.cast([0,1545093]),d[7],d[8],void 0,void 0)}]):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("thread_key",a[0]),d[2].set("message_id",a[1]),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[7]=c.i64.of_float(Date.now()),d[3]=c.i64.add(d[7],c.i64.cast([0,0]))):d[3]=c.i64.cast([0,0]),d[4]=d[2].get("thread_key"),d[5]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),c.i64.to_string(d[4]),c.i64.cast([0,374]),d[5],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[3],c.i64.cast([0,0])).then(function(a){return a=a,d[6]=a[0],a})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxReportMessageInCommunityChannelStoredProcedure";a.__tables__=["user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSReportMessageInCommunityChannelStoredProcedure",["LSReportMessageInCommunityChannel","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSReportMessageInCommunityChannel"),e.threadKey,e.messageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("useTriggerEditAction",["MAWEditMessageContext.react","MWPActor.react","MWPReplyContext.react","react","react-compiler-runtime","useLogMAWEditMessage"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useContext;function a(a,b,e){var f=d("react-compiler-runtime").c(11),g=c("useLogMAWEditMessage")(),h=i(d("MAWEditMessageContext.react").Context),j=h.setEditMessageData;h=i(d("MWPReplyContext.react").MWPReplyContext);var k=h.clearReply,l=h.reply,m=d("MWPActor.react").useActor();f[0]!==m||f[1]!==k||f[2]!==g||f[3]!==a.messageId||f[4]!==a.threadKey||f[5]!==a.timestampMs||f[6]!==e||f[7]!==l||f[8]!==j||f[9]!==b?(h=function(){l!=null&&k(a.threadKey,!0),j({messageId:a.messageId,threadKey:a.threadKey,threadType:b,timestampMs:a.timestampMs}),g(b,a.threadKey,a.messageId,m,"EDIT_MESSAGE_TAP"),e==null?void 0:e()},f[0]=m,f[1]=k,f[2]=g,f[3]=a.messageId,f[4]=a.threadKey,f[5]=a.timestampMs,f[6]=e,f[7]=l,f[8]=j,f[9]=b,f[10]=h):h=f[10];return h}g["default"]=a}),98);
__d("MAWEditMenuItem.react",["fbt","MWXMenuItem.react","react","react-compiler-runtime","useTriggerEditAction"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(8),e=a.disableReason,f=a.message,g=a.onEditClickCallback;a=a.threadType;var i=g===void 0?null:g,k=c("useTriggerEditAction")(f,a);b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Edit"),b[0]=g):g=b[0];f=g;a=e!==void 0;b[1]!==i||b[2]!==k?(g=function(){k(),i&&i()},b[1]=i,b[2]=k,b[3]=g):g=b[3];b[4]!==e||b[5]!==a||b[6]!==g?(f=j.jsx(c("MWXMenuItem.react"),{"aria-label":f,disabled:a,onClick:g,primaryText:f,secondaryText:e,testid:void 0}),b[4]=e,b[5]=a,b[6]=g,b[7]=f):f=b[7];return f}g["default"]=a}),226);
__d("MAWMessageIntegrityChecker",["FBLogger","MAWMessagesCompare","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a.externalId===b.externalId)return 0;if(a.sortOrderMs>b.sortOrderMs)return 1;return a.sortOrderMs<b.sortOrderMs?-1:-1}function i(a,b){var c=b.reduce(function(a,b){b.externalId!=null&&a.set(b.externalId,b.sortOrderMs);return a},new Map());return a.map(function(a){var b;return babelHelpers.extends({},a,{sortOrderMs:(b=a.externalId!=null?c.get(a.externalId):null)!=null?b:a.sortOrderMs})}).sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"))}function j(a,b,c){a=new Set(a.map(function(a){return a.externalId}).filter(Boolean));return b.toSorted(d("MAWMessagesCompare").makeCompareMessageMetadataForDescOrderFn(a)).slice(0,c)}function a(a,b,d,e,f){var g=new Set(a.map(function(a){return a.externalId})),l=new Set(b.map(function(a){return a.externalId})),m=k(g,l);l=k(l,g);g=i(a,b);a=j(g,b,d);b=0;var n=0,o=0,p=0,q=[],r=null;while(b<g.length&&n<a.length){var s=g[b],t=a[n];if(r!=null&&h(t,r)===0){n+=1;r=t;c("FBLogger")("messenger_web_missing_messages").mustfix("Detected duplicate messages in reference. Target source: %s, reference source: %s",e,f);continue}var u=h(s,t);u===0?(b+=1,n+=1,r=t,q.push([s,{result:"consistent"}])):u<0?(n+=1,r=t,o+=1,q.push([t,{result:"missing_in_target"}])):(b+=1,p+=1,q.push([s,{result:"missing_in_reference"}]))}while(b<g.length){u=g[b];b+=1;a.length<d?(p+=1,q.push([u,{result:"missing_in_reference"}])):q.push([u,{result:"skipped_in_target"}])}while(n<a.length){t=a[n];n+=1;g.length<d?(o+=1,q.push([t,{result:"missing_in_target"}])):q.push([t,{result:"skipped_in_reference"}])}if(o===0&&p===0)return{detailedResults:q,result:"consistent",setDifferenceInReference:l,setDifferenceInTarget:m};else if(o>0&&p===0)return{detailedResults:q,numOfMissingMessages:o,result:"missing_in_target",setDifferenceInReference:l,setDifferenceInTarget:m};else if(o===0&&p>0)return{detailedResults:q,numOfMissingMessages:p,result:"missing_in_reference",setDifferenceInReference:l,setDifferenceInTarget:m};else return{detailedResults:q,numOfMissingMessages:p+o,result:"missing_in_both",setDifferenceInReference:l,setDifferenceInTarget:m}}async function b(a,b,d){a=d.filter(function(a){a[0];a=a[1];return a.result==="missing_in_target"}).map(function(a){var b=a[0];a[1];return b.externalId});var e={admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1},f=await b.fetchMessagesByExternalId(a,e),g=new Set(f.map(function(a){return a.externalId}));return Promise.all(d.map(async function(a){var b=a[0];a=a[1];if(!g.has(b.externalId))return[b,a];a=f.find(function(a){return a.externalId===b.externalId});if(!a){c("FBLogger")("messenger_web_missing_messages").mustfix("Failed to find msg with external id: %s in MAW",b.externalId);return[b,{result:"missing_in_target_invalid_sortOrder"}]}var d={sortOrderSkewMs:a.sortOrderMs-b.sortOrderMs,sortOrderSkewNumberOfMsg:0},e={result:"missing_in_target_invalid_sortOrder",sortOrderSkewMs:0};d.sortOrderSkewNumberOfMsg!=null&&(e=babelHelpers.extends({},e,{sortOrderSkewNumberOfMsg:d.sortOrderSkewNumberOfMsg}));return[babelHelpers.extends({},b,{msgType:a.msgType}),e]}))}async function e(a,b){var c=b.filter(function(a){a[0];a=a[1];return a.result==="missing_in_target"}).map(function(a){var b=a[0];a[1];return b.externalId});if(c.length===0)return b;c=c.map(function(b){return d("ReQL").fromTableAscending(a.tables.messages.index("optimistic")).getKeyRange(b)});c=c.length>1?d("ReQL").union.apply(void 0,c):c[0];var e=await d("ReQL").toArrayAsync(c);return b.map(function(a){var b=a[0];a=a[1];var c=e.find(function(a){return a.offlineThreadingId===b.externalId});return c!=null?[b,{result:"missing_in_target_exists_in_lsdb",transportKey:c.transportKey}]:[b,a]})}function k(a,b){var c=0;for(a of a)b.has(a)||(c+=1);return c}g.checkIntegrityforMessageList=a;g.checkMsgsExistenceInMAWAndDecomposeTargetConsistencyResult=b;g.checkMsgsExistenceInLSDB=e}),98);
__d("MAWMessageIntegrityMissingInTargetCategory",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.hasEBFetchFailed,c=a.mawVsEB;a=a.uiVsEB;var d=i(a);a=c.detailedResults.filter(function(a){var b=a[0];a[1];return d.has(b.externalId)});return a.map(function(a){var c=a[0];a=a[1];a=h(c.externalId,a,b);return a==null?null:[c,a]}).filter(Boolean)}function h(a,b,d){switch(b.result){case"consistent":return"client_inconsistency";case"missing_in_target":return d?"eb_restore_timeout":"message_not_persisted_after_eb_restore";case"missing_in_target_invalid_sortOrder":return b.sortOrderSkewMs==null||b.sortOrderSkewMs===0?"message_out_of_order_same_timestamp":"message_out_of_order_different_timestamp";case"skipped_in_target":return"client_inconsistency_skipped";case"skipped_in_reference":return"unknown_skipped";case"missing_in_reference":case"missing_in_target_exists_in_lsdb":c("FBLogger")("messenger_web_missing_messages").mustfix("Unexpected consistency result %s for message with externalId %s when calculating missing in target category",b.result,a);return null;default:b.result;return null}}function i(a){return a.detailedResults.reduce(function(a,b){var c=b[0];b=b[1];b.result==="missing_in_target"&&a.add(c.externalId);return a},new Set())}g.calculateMissingInTargetCategory=a}),98);
__d("MAWMessageIntegrityCompareMessagesData",["I64","MAWMessageIntegrityChecker","MAWMessageIntegrityMissingInTargetCategory","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get detailed results for UI vs MAW comparison: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing message detected for ",", result: ",", num of messages missing: ",""]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["MissingMessages"]);async function a(a,b,c,e,f,g){var m=f.messages,n=m.backendMessages,o=m.ebMessages,p=m.mpsMessages;m=m.uiMessages;f=f.pageSize;var q=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(m,n,f,"ui","maw"),r=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(m,o,f,"ui","eb"),s=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(n,o,f,"maw","eb");n=p?d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(p,n,f,"mps","maw"):null;p=p?d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(p,o,f,"mps","eb"):null;r.result!=="consistent"&&k.WARN(j(),(h||(h=d("I64"))).to_float(e),r.result,r.numOfMissingMessages);(r.result==="missing_in_target"||r.result==="missing_in_both")&&(r.detailedResults=l(r.detailedResults,m));(s.result==="missing_in_target"||s.result==="missing_in_both")&&(s.detailedResults=await d("MAWMessageIntegrityChecker").checkMsgsExistenceInMAWAndDecomposeTargetConsistencyResult(c,b,s.detailedResults));if(q.result==="missing_in_target"||q.result==="missing_in_both")try{q.detailedResults=await d("MAWMessageIntegrityChecker").checkMsgsExistenceInLSDB(a,q.detailedResults)}catch(a){k.ERROR(i(),a)}o=d("MAWMessageIntegrityMissingInTargetCategory").calculateMissingInTargetCategory({hasEBFetchFailed:g,mawVsEB:s,uiVsEB:r});return{mawVsEB:s,missingInTargetCategory:o,mpsVsEB:p,mpsVsMaw:n,pageSize:f,uiVsEB:r,uiVsMaw:q}}function l(a,b){var c=new Set(b.map(function(a){return a.externalId}));return a.map(function(a){var b=a[0];a=a[1];return a.result==="missing_in_target"&&c.has(b.externalId)?[b,babelHelpers.extends({},a,{existingInUISamePage:!0})]:[b,a]})}g.compareMessagesData=a}),98);
__d("MAWMpsMessageIntegrityFetch",["MAWCurrentUser","MAWMessagesDirection","MpsOverBridge","MpsTypes"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,c,e,f){b=await d("MpsOverBridge").mps().loadMessages({config:{shouldFetchSupplementals:!1,shouldIgnoreLocalOnly:!0,strategy:"full-fetch"},debug:{purpose:"integrity-check"},direction:d("MAWMessagesDirection").translateMawDirectionToMwpDirection(b),from:[c,e!=null?d("MpsTypes").toMessageId(e):null],numMessages:f,threadId:d("MpsTypes").toThreadId(a)});return b.success===!1?null:b.value.messages.map(function(a){return{externalId:a.toplevelProtobuf.messageId,isOutgoing:a.toplevelProtobuf.senderId!==d("MAWCurrentUser").getID(),msgType:"",sortOrderMs:a.toplevelProtobuf.timestampMs}})}g.mpsMessageIntegrityFetch=a}),98);
__d("MAWMessageIntegrityFetchMessagesData",["I64","MAWBridgeSendAndReceive","MAWDbMsg","MAWEBDeanonFetch","MAWMessagesCompare","MAWMpsGating","MAWMpsMessageIntegrityFetch","WAResultOrError","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c,e,f,g){var m=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","identifyXMAWithAssociatedTextByExternalId",{externalIds:g.map(function(a){return d("WAStanzaUtils").toStanzaId(a.offlineThreadingId)})}),n=g.filter(function(a){return!m.includes(a.offlineThreadingId)});g=g.length-n.length;g=e-g;a=await Promise.all([l(n),i(a,b,c,f,e).then(function(a){return a.filter(function(a){return!m.includes(a.externalId)})}),j(c,f,g),d("MAWMpsGating").isMpsEnabled()?d("MAWMpsMessageIntegrityFetch").mpsMessageIntegrityFetch(c,"before",(f==null?void 0:f.primarySortKey)!=null?(h||(h=d("I64"))).to_float(f==null?void 0:f.primarySortKey):Date.now(),(n=f==null?void 0:f.offlineThreadingId)!=null?n:null,g):null]);b=a[0];e=a[1];c=a[2];f=a[3];n=c==null?void 0:c.processed;if(n==null||n.length===0)return d("WAResultOrError").makeError("EB result not available");a=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");c=[].concat(e).sort(a).slice(0,g);e=[].concat(n).sort(a).slice(0,g);n=b.map(function(a){return k(a)}).sort(a);b=f!=null?[].concat(f).sort(a).slice(0,g):null;return d("WAResultOrError").makeResult({messages:{backendMessages:c,ebMessages:e,mpsMessages:b,uiMessages:n},pageSize:g})}async function i(a,b,c,d,e){b=await b.requestMessages(a,c,d!=null?d.primarySortKey:null,d==null?void 0:d.messageId,"before",e,{admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1},"integrity");return b.msgs}async function j(a,b,c){var e=b==null?null:d("MAWDbMsg").toMsgId(b.messageId);e=await (e==null?Promise.resolve(null):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:e}));var f=(e=e==null?void 0:e.externalId)!=null?e:b==null?void 0:b.offlineThreadingId;e=(b==null?void 0:b.primarySortKey)==null?d("WATimeUtils").millisTime():(h||(h=d("I64"))).to_float(b==null?void 0:b.primarySortKey);b=await d("MAWEBDeanonFetch").fetchMessagesMetadataFromEBDeanon({chatJid:a,count:c+5,direction:"before",includeReferenceTimestamp:!0,referenceExternalId:f,referenceTimestampMs:e});if(b.success===!1)return null;a=b.value.sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"));c=a.findIndex(function(a){return a.externalId===f});return{processed:a.slice(c+1),unprocessed:b.value}}function k(a){return{externalId:a.offlineThreadingId,msgType:(h||(h=d("I64"))).to_string(a.displayedContentTypes),sortOrderMs:h.to_float(a.primarySortKey)}}function l(a){var b=function(a){var b=d("MAWDbMsg").toMsgId(a.messageId);return b==null?Promise.resolve(a):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:b}).then(function(b){return babelHelpers.extends({},a,{offlineThreadingId:(b=b==null?void 0:b.externalId)!=null?b:a.offlineThreadingId})})};return Promise.all(a.map(b))}g.fetchMessagesDataForComparison=a}),98);
__d("MAWSecureDataSource",[],(function(a,b,c,d,e,f){"use strict";a=10;f.DEFAULT_NUM_MESSAGES=a}),66);
__d("MAWSecureLocalDBDataSource",["I64","MAWBridgeSendAndReceive","MAWDataSourceLogger","MAWDbMsg","MAWMessagesDirection","MAWMessagesPaginationUtils","MAWMiActOnActThreadReady","MAWPutMessagesToDB","MAWSecureDataSource","MAWSecureLocalDBFetch","MLV2DataSourceLogger","ReQL","WAStanzaUtils","WATagsLogger","err","isEbEnabledWithIGDEligibilityCheck","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetching "," messages by external id, which is not optimal.\n      Consider migrating 'loadMsgsByExternalId' backend request to a batch version "]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch messages: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["useFetchSecureMessages: threadJid: "," minMsgSortOrderTsResponse ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch more: ",""]);l=function(){return a};return a}var m=c("requireDeferred")("MAWEBFetch").__setRef("MAWSecureLocalDBDataSource"),n=d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]);function o(a){return a.msgs.map(function(a){return{externalId:a.externalId,isOutgoing:a.isAuthorMe,msgType:a.type_,sortOrderMs:a.sortOrderMs}})}a=function(){function a(){}var b=a.prototype;b.$1=async function(a,b,e,g,i,j,o,p,q){if(i==="after")return;i;n.LOG(l(),b);d("MAWDataSourceLogger").logLoadMoreMsgsThreadWaiting(o,"before",b);i=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,b,"MAWSecureLocalDBDataSource");i=i.chatJid;d("MAWDataSourceLogger").logLoadMoreMsgsThreadReadyFetchMsgs(o);d("MAWDataSourceLogger").logLoadMessagesFromLocalDBStart(o);var r=g.minMessageId,s=await d("MAWMessagesPaginationUtils").getExternalIdByMsgId(r);p=await c("MAWSecureLocalDBFetch")({actionType:p,chatJid:i,config:{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0},count:j,direction:"before",offsetMsg:{externalId:s,includeOriginalMsg:!1,messageId:r},timestampMs:e});if(p.success===!1){throw(s=p.payload)!=null?s:c("err")(p.error)}var t=p.value;d("MAWDataSourceLogger").logLoadMessagesFromLocalDBEnd(o);d("MAWDataSourceLogger").logInsertMessageResponseToLSDBStart(o);d("MAWMessagesPaginationUtils").populateExternalIdCache(t.msgs);var u=t.msgs.length>0?t.msgs[t.msgs.length-1].msgId:g.minMessageId;await a.runInTransaction(async function(b){var c;await d("MAWPutMessagesToDB").insertMessageResponseToDBInExistingTransaction(a,b,t,q,o);c=await (c=b.messages_ranges_v2__generated).get.apply(c,[g.threadKey,g.minTimestampMs,g.minMessageId]);if(c==null)return;var e=t.hasMoreBefore;t.hasMoreBefore===!1&&await d("isEbEnabledWithIGDEligibilityCheck").isEbEnabledWithIGDEligibilityCheck(a)&&(e=!0);await b.messages_ranges_v2__generated.upsert([c.threadKey,c.minTimestampMs,c.minMessageId],{hasMoreAfter:!1,hasMoreBefore:e,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:c.maxMessageId,maxTimestampMs:c.maxTimestampMs,minMessageId:u,minTimestampMs:(h||(h=d("I64"))).zero,threadKey:g.threadKey})},"readwrite","ui",void 0,f.id+":145");d("MAWDataSourceLogger").logInsertMessageResponseToLSDBEnd(o);d("MAWDataSourceLogger").logLoadMoreMsgsFetched(o,t.hasMoreBefore);if(t.hasMoreBefore){d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(o);return}r=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMaybeNextNonAdminMsgSortOrderMs",{chatJid:i,mayBeAdminMsgId:d("MAWDbMsg").toMsgId(g.minMessageId)});d("WATagsLogger").TAGS(["labyrinth_web","useFetchSecureMessages"]).LOG(k(),i,r.minMsgTimestampMs);d("MAWDataSourceLogger").logLoadMoreMsgsRangeQuery(o,r.minMsgTimestampMs);e=await m.load();s=await e({chatJid:i,count:j,db:a,direction:"before",timestampMs:(h||(h=d("I64"))).of_float(r.minMsgTimestampMs)});s.success&&s.value.hasMoreBefore===!1&&await a.runInTransaction(async function(c){var e=g.minTimestampMs,f=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.messages_ranges_v2__generated).getKeyRange(b).bounds({lte:[e]}).filter(function(a){var b=a.maxTimestampMs;a=a.minTimestampMs;return(h||(h=d("I64"))).ge(e,a)&&(h||(h=d("I64"))).le(e,b)}));if(f==null)return;await c.messages_ranges_v2__generated.upsert([f.threadKey,f.minTimestampMs,f.minMessageId],babelHelpers.extends({},f,{hasMoreBefore:!1,isLoadingBefore:!1}))},"readwrite","ui",void 0,f.id+":230");d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(o)};b.requestMessages=async function(a,b,e,f,g,h,i,j){a=await d("MAWMessagesPaginationUtils").getExternalIdByMsgId(f);b=await c("MAWSecureLocalDBFetch")({actionType:j,chatJid:b,config:i,count:(j=h)!=null?j:d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES,direction:g,offsetMsg:f==null?null:{externalId:a,includeOriginalMsg:!1,messageId:f},timestampMs:e});if(b.success===!1){throw(i=b.payload)!=null?i:c("err")(b.error)}h=b.value;d("MAWMessagesPaginationUtils").populateExternalIdCache(h.msgs);j=h.msgs.map(function(a){return{externalId:a.externalId,isOutgoing:a.isAuthorMe,msgType:a.type_,sortOrderMs:a.sortOrderMs}});return{hasMoreAfter:h.hasMoreAfter,hasMoreBefore:h.hasMoreBefore,msgs:j}};b.fetchSecureMessagesProtocol=function(a,b,c,e,f,g,h,i,k){h===void 0&&(h=d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES);c=d("MAWDataSourceLogger").logLoadMoreMsgsStart(c);return this.$1(a,b,e,f,g,h,c,i,k).catch(function(a){var c;n.ERROR(j(),a);(c=d("MLV2DataSourceLogger").getMLV2LoggerForThread(b,d("MAWMessagesDirection").translateMawDirectionToMwpDirection(g)))==null?void 0:c.markQPLFailure(a)})};b.fetchMessagesByExternalId=function(a,b){a.length>2&&n.WARN(i(),a.length);a=a.map(function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMsgsByExternalId",{config:b,externalId:d("WAStanzaUtils").toStanzaId(a)})});return Promise.all(a).then(function(a){return a.map(function(a){return o(a)}).flat()})};return a}();g.default=a}),98);
__d("MAWMessageIntegrityFetchAndCompareData",["MAWMessageIntegrityCompareMessagesData","MAWMessageIntegrityFetchMessagesData","MAWMiActOnActThreadReady","MAWSecureLocalDBDataSource","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("MAWSecureLocalDBDataSource"))();async function a(a){var b=a.db,c=a.hasEbFetchFailed,e=a.lastItemFromPreviousPage,f=a.localMessages,g=a.pageSize;a=a.threadKey;var i=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(b.tables,a,"fetchAndCompareMessagesData");i=i.chatJid;g=await d("MAWMessageIntegrityFetchMessagesData").fetchMessagesDataForComparison(b,h,i,g,e,f);if(g.success===!1)return g;e=await d("MAWMessageIntegrityCompareMessagesData").compareMessagesData(b,h,i,a,g.value,c);return d("WAResultOrError").makeResult(e)}g.fetchAndCompareMessagesData=a}),98);
__d("MAWMessagesIntegrityEphemeralSettings",["I64","MAWGetEphemeralSettings","MAWMiActOnActThreadReady","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){a=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,b,"getIsEphemeralMessagesEnabledForPage");a=a.chatJid;a=await d("MAWGetEphemeralSettings").getEphemeralSetting(a,b);if(a==null||a.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME)return"disabled";return d("WATimeUtils").castUnixTimeToMillisTime(a.ephemeralLastUpdatedOrSetTimestamp)<(h||(h=d("I64"))).to_float(c)?a.ephemeralExpirationInSec>0?"enabled":"disabled":a.ephemeralExpirationInSec>0?"maybeDisabled":"maybeEnabled"}g.getEphemeralMessagesStatusForPage=a}),98);
__d("MAWMessageIntegrityCheck",["CometDebounce","DateConsts","EbFetchTimeoutMsForMLv2","I64","MAWMediaGalleryM2Utils","MAWMessageIntegrityCheckFlytrapResultCache","MAWMessageIntegrityEBFetchStatus","MAWMessageIntegrityFetchAndCompareData","MAWMessageIntegrityTruncateStatus","MAWMessagesIntegrityEphemeralSettings","MAWMpsGating","WATagsLogger","gkx","isEbEnabledWithIGDEligibilityCheck","logMessengerWebFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check Truncate state - threadKey: ",", state: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check Flytrap result - threadKey: ",", missingInTargetCategory: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", Mps results:  MPS (target) vs MAW (reference): ",", MPS (target) vs EB (reference): ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", result against EB data: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", result against backend data: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check skipped for threadKey: ",", lastItem: ",", reason: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check skipped for threadKey: ",", lastItem: ",", reason: check was scheduled more than 2 minutes ago"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["run Message Integrity Check - threadKey: ",", lastItem: ",", pageSize: ",""]);p=function(){return a};return a}var q="10",r=1e3*60*2,s=d("WATagsLogger").TAGS(["MissingMessages"]),t=c("CometDebounce")(c("logMessengerWebFalcoEvent"));async function a(a,b,e,f,g,w,y,z,A,B){s.LOG(p(),(h||(h=d("I64"))).to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey),g);if(Date.now()-A>r){s.LOG(o(),(h||(h=d("I64"))).to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey));return}A=c("gkx")("1626");var C=await d("isEbEnabledWithIGDEligibilityCheck").isEbEnabledWithIGDEligibilityCheck(a),D=d("MAWMessageIntegrityEBFetchStatus").hasEBFailure(b),E=d("MAWMessageIntegrityTruncateStatus").getThreadThuncateState(b);g=await d("MAWMessageIntegrityFetchAndCompareData").fetchAndCompareMessagesData({db:a,hasEbFetchFailed:D,lastItemFromPreviousPage:w,localMessages:y,pageSize:g,threadKey:b});if(g.success===!1){s.LOG(n(),(h||(h=d("I64"))).to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey),g.error);return}g=g.value;c("gkx")("4852")&&g.uiVsEB.detailedResults.some(function(a){a[0];a=a[1];return a==="missing_in_target"})&&B();B=d("MAWMessageIntegrityCheckFlytrapResultCache").generateMessageIntegrityCheckPageKey(b,y);d("MAWMessageIntegrityCheckFlytrapResultCache").cacheMessageIntegrityCheckResult(B,g.missingInTargetCategory);s.LOG(m(),h.to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey),JSON.stringify(g.uiVsMaw));s.LOG(l(),h.to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey),JSON.stringify(g.uiVsEB));s.LOG(k(),h.to_float(b),w==null?"null":(h||(h=d("I64"))).to_float(w.primarySortKey),JSON.stringify(g.mpsVsMaw),JSON.stringify(g.mpsVsEB));s.LOG(j(),h.to_float(b),JSON.stringify(g.missingInTargetCategory));s.LOG(i(),h.to_float(b),JSON.stringify(E));B=v(g.mawVsEB);var F=v(g.uiVsEB),G=v(g.uiVsMaw),H=g.mpsVsMaw!=null?v(g.mpsVsMaw):{},I=g.mpsVsEB!=null?v(g.mpsVsEB):{};y=x(y);a=await d("MAWMessagesIntegrityEphemeralSettings").getEphemeralMessagesStatusForPage(a,b,y);t({threadKey:b,threadType:e},"message_integrity_check",f,{MAW_vs_EB_detailedResults:B.detailedResults,MAW_vs_EB_numOfMissingInReference:B.numOfMissingInReference,MAW_vs_EB_numOfMissingInTarget:B.numOfMissingInTarget,MAW_vs_EB_numOfMissingInTargetInvalidSortOrder:B.numOfMissingInTargetInvalidSortOrder,MAW_vs_EB_setNumOfMissingInReference:B.setDifferenceInReference,MAW_vs_EB_setNumOfMissingInTarget:B.setDifferenceInTarget,MPS_vs_EB_detailedResults:(b=I.detailedResults)!=null?b:"",MPS_vs_EB_numOfMissingInReference:(e=I.numOfMissingInReference)!=null?e:"",MPS_vs_EB_numOfMissingInTarget:(f=I.numOfMissingInTarget)!=null?f:"",MPS_vs_MAW_detailedResults:(B=H.detailedResults)!=null?B:"",MPS_vs_MAW_numOfMissingInReference:(b=H.numOfMissingInReference)!=null?b:"",MPS_vs_MAW_numOfMissingInTarget:(e=H.numOfMissingInTarget)!=null?e:"",UI_vs_EB_detailedResults:F.detailedResults,UI_vs_EB_numOfMissingInReference:F.numOfMissingInReference,UI_vs_EB_numOfMissingInTarget:F.numOfMissingInTarget,UI_vs_EB_setNumOfMissingInReference:F.setDifferenceInReference,UI_vs_EB_setNumOfMissingInTarget:F.setDifferenceInTarget,UI_vs_MAW_detailedResults:G.detailedResults,UI_vs_MAW_numOfMissingInReference:G.numOfMissingInReference,UI_vs_MAW_numOfMissingInTarget:G.numOfMissingInTarget,UI_vs_MAW_setNumOfMissingInReference:G.setDifferenceInReference,UI_vs_MAW_setNumOfMissingInTarget:G.setDifferenceInTarget,ebTimeoutSec:(c("EbFetchTimeoutMsForMLv2")()/d("DateConsts").MS_PER_SEC).toString(),endRangeTimestampMs:h.to_string(y),ephemeralMessagesStatus:a+"",hasAdditionalData:u(A),hasEBFetchFailed:u(D),isDogfooding:u(c("gkx")("2972")),isEbEnabled:u(C),isEbGraphQL:C?"false":u(c("gkx")("7083")),isJidOptimisationInRestoreEnabled:u(c("gkx")("3137")),isMAWRangeFixEnabled:u(c("gkx")("1042")),isMediaGalleryRestoreEnabled:u(d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()),isMpsEnabled:u(d("MAWMpsGating").isMpsEnabled()),isRejectingEbPromiseUponFailureEnabled:u(c("gkx")("9376")),isUsingLsInitCache:u(c("gkx")("10384")),lastItemExternalId:(I=w==null?void 0:w.offlineThreadingId)!=null?I:"null",lastItemTimestamp:h.to_string((f=w==null?void 0:w.primarySortKey)!=null?f:(h||(h=d("I64"))).zero),missingInTargetCategory:JSON.stringify(g.missingInTargetCategory),pageIndex:z+"",pageSize:g.pageSize+"",truncateState:(B=JSON.stringify(E))!=null?B:"null",version:C?q:"0"})}function u(a){return a===!0?"true":"false"}function v(a){var b=0,c=0,d=0;a.detailedResults.forEach(function(a){a[0];a=a[1];switch(a.result){case"missing_in_target":case"missing_in_target_exists_in_lsdb":b+=1;break;case"missing_in_target_invalid_sortOrder":c+=1;b+=1;break;case"missing_in_reference":d+=1;break;case"consistent":case"skipped_in_target":case"skipped_in_reference":break;default:a.result}});return{detailedResults:w(a.detailedResults),numOfMissingInReference:d+"",numOfMissingInTarget:b+"",numOfMissingInTargetInvalidSortOrder:c+"",setDifferenceInReference:a.setDifferenceInReference+"",setDifferenceInTarget:a.setDifferenceInTarget+""}}function w(a){a=a.map(function(a){var b=a[0];a=a[1];var d=a.existingInUISamePage,e=a.result,f=a.sortOrderSkewMs;a=a.sortOrderSkewNumberOfMsg;return babelHelpers.extends({existingInUISamePage:d,externalId:b.externalId,isOutgoing:b.isOutgoing},c("gkx")("1626")?{msgType:b.msgType,sortOrderMs:b.sortOrderMs}:{},{result:e,sortOrderSkewMs:(d=f)!=null?d:0,sortOrderSkewNumberOfMsg:(b=a)!=null?b:0})});return JSON.stringify(a)}function x(a){return a.length===0?(h||(h=d("I64"))).min_int:a.map(function(a){return a.timestampMs}).sort((h||(h=d("I64"))).compare)[0]}b={runMessageIntegrityCheck:a};g.default=b}),98);
__d("MLCHealthLoggerEvent",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({DAILY_INTERACTION_WITH_SURFACE:"daily_interaction_with_surface",COMMIT_CREATE:"commit_create",COMMIT_EDIT:"commit_edit"});c=a;f["default"]=c}),66);
__d("MlcHealthBizappEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2646");b=d("FalcoLoggerInternal").create("mlc_health_bizapp_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthFacebookAndWorkplaceEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2647");b=d("FalcoLoggerInternal").create("mlc_health_facebook_and_workplace_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthFacebookEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2648");b=d("FalcoLoggerInternal").create("mlc_health_facebook_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthInstagramEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("3766");b=d("FalcoLoggerInternal").create("mlc_health_instagram_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthInternalToolsEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2649");b=d("FalcoLoggerInternal").create("mlc_health_internal_tools_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthMessagingLightswitchEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2650");b=d("FalcoLoggerInternal").create("mlc_health_messaging_lightswitch_event",a);e=b;g["default"]=e}),98);
__d("MlcHealthWorkplaceEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2651");b=d("FalcoLoggerInternal").create("mlc_health_workplace_event",a);e=b;g["default"]=e}),98);
__d("MLCHealthInstrumentationPlugin__INTERNAL.react",["Lexical","LexicalComposerContext","LexicalUtils","MLCInstrumentationCommands","MlcHealthBizappEventFalcoEvent","MlcHealthFacebookAndWorkplaceEventFalcoEvent","MlcHealthFacebookEventFalcoEvent","MlcHealthInstagramEventFalcoEvent","MlcHealthInternalToolsEventFalcoEvent","MlcHealthMessagingLightswitchEventFalcoEvent","MlcHealthWorkplaceEventFalcoEvent","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useLayoutEffect,j=new Set();function k(a){switch(a){case"facebook":return c("MlcHealthFacebookEventFalcoEvent");case"workplace":return c("MlcHealthWorkplaceEventFalcoEvent");case"facebook_and_workplace":return c("MlcHealthFacebookAndWorkplaceEventFalcoEvent");case"internal_tools":return c("MlcHealthInternalToolsEventFalcoEvent");case"messaging_lightswitch":return c("MlcHealthMessagingLightswitchEventFalcoEvent");case"bizapp":return c("MlcHealthBizappEventFalcoEvent");case"instagram":return c("MlcHealthInstagramEventFalcoEvent");default:return null}}function l(a,b,c){(a=k(a))==null?void 0:a.log(function(){return{event:c,surface:b}})}function a(a){var b=a.policyProduct,c=a.surface;a=d("LexicalComposerContext").useLexicalComposerContext();var e=a[0];i(function(){var a=function(){};j.has(c)||(a=e.registerUpdateListener(function(d){var f=d.dirtyLeaves;d=d.tags;if(j.has(c)){a();return}if(f.size===0||d.has("history-merge")||!e.isEditable())return;j.add(c);l(b,c,"daily_interaction_with_surface");a()}));return d("LexicalUtils").mergeRegister(a,e.registerCommand(d("MLCInstrumentationCommands").COMMIT_COMMAND,function(a){a==="create"?l(b,c,"commit_create"):l(b,c,"commit_edit");return!1},d("Lexical").COMMAND_PRIORITY_CRITICAL))},[e,b,c]);return null}g["default"]=a}),98);
__d("MLCInteractionInstrumentationPlugin__INTERNAL.react",["cr:3286","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return b("cr:3286")&&i.jsx(b("cr:3286"),babelHelpers["extends"]({},a))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MLCTextLengthBucket",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["S","M","L","XL"]);function a(a){if(a<=500)return g.S;if(a<=1e3)return g.M;return a<=2500?g.L:g.XL}f.TextLengthBucketEnum=g;f.getTextLengthBucket=a}),66);
__d("MLCTypingPerformancePlugin__INTERNAL.react",["LexicalComposerContext","LexicalText","MLCTextLengthBucket","cr:2012305","cr:308","cr:3287","gkx","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useLayoutEffect,k=c("gkx")("3849"),l=b("cr:2012305")||b("cr:308"),m=new RegExp("[^,;\\s]{200,}"),n=new RegExp("[^,;\\s]{100,199}"),o=new RegExp("[^,;\\s]{50,99}");function p(a){if(a==="")return 0;if(m.test(a))return 200;else if(n.test(a))return 100;else if(o.test(a))return 50;else return 0}function a(a){if(l===null)return null;b("cr:3287")&&b("cr:3287")();return i.jsx(q,babelHelpers["extends"]({},a))}a.displayName=a.name+" [from "+f.id+"]";function q(a){var b=a.format__DEPRECATED,e=a.surface;a=a.typingPerformanceID;var f=a===void 0?"":a;a=d("LexicalComposerContext").useLexicalComposerContext();var g=a[0];j(function(){var a=babelHelpers["extends"]({largeWord:p(g.getEditorState().read(d("LexicalText").$rootTextContent))},k?{textLengthBucket:d("MLCTextLengthBucket").getTextLengthBucket(g.getEditorState().read(d("LexicalText").$rootTextContent).length)}:null,e==="FeedComposerCometStatusArea"?{autolinkFastPath:String(c("gkx")("8927"))}:null),h;i();function i(){h==null?void 0:h();if(l===null)return;var c=null,d=g.registerRootListener(function(d){if(d===c)return;c!==null&&l.unregisterTypingPerf(c);if(d!==null){var g;l.trackTypingPerf(d,e,c,babelHelpers["extends"]({},a,{editor:"LexicalEditor",format:(g=b)!=null?g:"",typingPerformanceID:f}))}c=d});h=function(){d(),c!==null&&l.unregisterTypingPerf(c)}}var j=g.registerTextContentListener(function(b){b=p(b);b!==a.largeWord&&(a.largeWord=b,i())}),m=k?g.registerTextContentListener(function(b){b=d("MLCTextLengthBucket").getTextLengthBucket(b.length);b!==a.textLengthBucket&&(a.textLengthBucket=b,i())}):null;return function(){h==null?void 0:h(),j==null?void 0:j(),m==null?void 0:m()}},[f,g,b,e]);return null}q.displayName=q.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MLCInstrumentationPlugin__INTERNAL.react",["MLCHealthInstrumentationPlugin__INTERNAL.react","MLCInteractionInstrumentationPlugin__INTERNAL.react","MLCTypingPerformancePlugin__INTERNAL.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");b="facebook";b;function a(a){return i.jsxs(i.Fragment,{children:[i.jsx(c("MLCTypingPerformancePlugin__INTERNAL.react"),babelHelpers["extends"]({},a)),i.jsx(c("MLCHealthInstrumentationPlugin__INTERNAL.react"),babelHelpers["extends"]({},a)),i.jsx(c("MLCInteractionInstrumentationPlugin__INTERNAL.react"),babelHelpers["extends"]({},a))]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWCMCreateSubthreadMenuItem.react",["I64","Int64Hooks","LsFalcoEventEntryPoint","MWXMenuItem.react","SubthreadCreationStrings.react","react","react-compiler-runtime","requireDeferred","useMWCMCreateSubthread","useOpenSubthreadView"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react"),k=c("requireDeferred")("LsMessageActionFalcoEvent").__setRef("MWCMCreateSubthreadMenuItem.react");function a(a){var b=d("react-compiler-runtime").c(12),e=a.message;a=c("useMWCMCreateSubthread")(e);var f=a[0];a=a[1];var g=c("useOpenSubthreadView")(),h=e.subthreadKey,l,m;b[0]!==e.messageId||b[1]!==e.threadKey||b[2]!==f||b[3]!==g||b[4]!==h?(l=function(){k.onReady(function(a){return a.log(function(){var a={};return{action:{container_module:"MWCMCreateSubthreadMenuItem",type:h!=null?105:104},error:{message:void 0},extra:a,message:{attachment_type:"",entry_point:d("LsFalcoEventEntryPoint").messageActions,id:e.messageId,recipient_id:void 0},thread:{group_size:(i||(i=d("I64"))).to_string(i.zero),id:i.to_string(e.threadKey),type:18}}})}),h!=null?g(h):f()},m=[e.messageId,e.threadKey,f,g,h],b[0]=e.messageId,b[1]=e.threadKey,b[2]=f,b[3]=g,b[4]=h,b[5]=l,b[6]=m):(l=b[5],m=b[6]);l=d("Int64Hooks").useCallbackInt64(l,m);m=h!=null?d("SubthreadCreationStrings.react").viewSubthreadLabel:d("SubthreadCreationStrings.react").createSubthreadLabel;var n=h!=null?d("SubthreadCreationStrings.react").viewSubthreadLabel:d("SubthreadCreationStrings.react").createSubthreadLabel,o;b[7]!==a||b[8]!==l||b[9]!==m||b[10]!==n?(o=j.jsx(c("MWXMenuItem.react"),{"aria-label":m,disabled:a,onClick:l,primaryText:n}),b[7]=a,b[8]=l,b[9]=m,b[10]=n,b[11]=o):o=b[11];return o}g["default"]=a}),98);
__d("useMWChatPromptSuggestions",["fbt","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i;(i||d("react")).useMemo;var j=[h._(/*BTDS*/"How did you learn about this channel?"),h._(/*BTDS*/"What should I use this channel for?"),h._(/*BTDS*/"What song are you listening to?"),h._(/*BTDS*/"Make me laugh \ud83d\udc80"),h._(/*BTDS*/"Favorite thing right now \ud83d\udc98"),h._(/*BTDS*/"Favorite travel destination \u2708\ufe0f"),h._(/*BTDS*/"Your happy place \u2763\ufe0f"),h._(/*BTDS*/"Best part of 2024 so far?"),h._(/*BTDS*/"Something you're proud of \ud83d\udc9f"),h._(/*BTDS*/"Ten years ago, I was..."),h._(/*BTDS*/"What are you grateful for today? \ud83e\udef6"),h._(/*BTDS*/"What would your dream job be if money didn't matter?"),h._(/*BTDS*/"What's inspiring you right now? \ud83c\udf1f"),h._(/*BTDS*/"What's something unique about yourself?"),h._(/*BTDS*/"A movie you enjoyed recently \ud83c\udfa5"),h._(/*BTDS*/"Health is wealth \ud83d\udcaa\ud83e\udd57"),h._(/*BTDS*/"The last concert you went to \ud83d\udc69\u200d\ud83c\udfa4"),h._(/*BTDS*/"Today I learned..."),h._(/*BTDS*/"What are you doing tonight?")];function k(a){a=a.slice();for(var b=a.length-1;b>=0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a}function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=k(j),a[0]=b):b=a[0];a=b;return a}g["default"]=a}),226);
__d("MWChatPromptFlyoutSuggestions.react",["FocusGroup.react","MWXPressable.react","MWXScrollableArea.react","MWXText.react","focusScopeQueries","react","react-compiler-runtime","useMWChatPromptSuggestions"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={pressable:{borderTopStartRadius:"xyi19xy",borderTopEndRadius:"x1ccrb07",borderBottomEndRadius:"xtf3nb5",borderBottomStartRadius:"x1pc53ja",marginTop:"xw7yly9",marginBottom:"x1yztbdb",marginStart:"x1i64zmx",marginEnd:"x1emribx",marginLeft:null,marginRight:null,$$css:!0},scrollArea:{maxWidth:"x193iq5w",$$css:!0}};function k(a){var b=d("react-compiler-runtime").c(6),e=a.onPress;a=a.text;var f;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(f={className:"x6s0dn4 xx7qk4p xyi19xy x1ccrb07 xtf3nb5 x1pc53ja xwflfxt x78zum5 x2lah0s x1vqgdyp xl56j7k x1kbpmyu x1y1aw1k x1sxyh0 xwib8y2 xurb0ha x2b8uid"},b[0]=f):f=b[0];b[1]!==a?(f=i.jsx("div",babelHelpers["extends"]({},f,{children:i.jsx(c("MWXText.react"),{color:"secondary",numberOfLines:2,type:"body4",children:a})})),b[1]=a,b[2]=f):f=b[2];b[3]!==e||b[4]!==f?(a=i.jsx(c("MWXPressable.react"),{onPress:e,overlayRadius:"inherit",xstyle:j.pressable,children:f}),b[3]=e,b[4]=f,b[5]=a):a=b[5];return a}b=d("FocusGroup.react").createFocusGroup(d("focusScopeQueries").tabbableScopeQuery);var l=b[0],m=b[1];function a(a){var b=d("react-compiler-runtime").c(11),e=a.onPressSuggestion;a=c("useMWChatPromptSuggestions")();var f;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx("div",{className:"x2lah0s x1xc55vz"}),b[0]=f):f=b[0];if(b[1]!==e||b[2]!==a){var g;b[4]!==e?(g=function(a,b){return i.jsx(m,{children:i.jsx(k,{onPress:function(){return e(a)},text:a})},b)},b[4]=e,b[5]=g):g=b[5];g=a.map(g);b[1]=e;b[2]=a;b[3]=g}else g=b[3];b[6]!==g?(a=i.jsx(l,{orientation:"horizontal",tabScopeQuery:d("focusScopeQueries").tabbableScopeQuery,wrap:!0,children:g}),b[6]=g,b[7]=a):a=b[7];b[8]===Symbol["for"]("react.memo_cache_sentinel")?(g=i.jsx("div",{className:"x2lah0s x1xc55vz"}),b[8]=g):g=b[8];b[9]!==a?(f=i.jsxs(c("MWXScrollableArea.react"),{horizontal:!0,vertical:!1,xstyle:j.scrollArea,children:[f,a,g]}),b[9]=a,b[10]=f):f=b[10];return f}g["default"]=a}),98);
__d("MWChatPromptDialog.react",["fbt","FBLogger","FocusRegion.react","I64","MWChatPromptFlyoutFrontCard.react","MWChatPromptFlyoutSuggestions.react","MWPromptCreationUtils","MWXDialog.react","MWXDialogFooter.react","MWXDialogHeader.react","MWXText.react","MessengerDiscoverableBroadcastChatsClientEventsFalcoEvent","RollCallPromptType","react","react-compiler-runtime","useMWXPushToast","useReStore","useSinglePartialViewImpression"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l;b=l||d("react");var m=i||(i=c("react"));b.useCallback;var n=b.useState;function a(a){var b=d("react-compiler-runtime").c(44),e=a.onClose,f=a.threadKey,g=(k||(k=c("useReStore")))(),i=c("useMWXPushToast")();a=n("");var l=a[0],p=a[1];a=n(!1);var q=a[0],r=a[1];b[0]!==e||b[1]!==f?(a=function(){e(),c("MessengerDiscoverableBroadcastChatsClientEventsFalcoEvent").log(function(){return{action_name:1,event_name:303,source:156,surface:7,thread_id:(j||(j=d("I64"))).to_string(f)}})},b[0]=e,b[1]=f,b[2]=a):a=b[2];var s=a;b[3]!==g||b[4]!==s||b[5]!==l||b[6]!==i||b[7]!==f?(a=function(){(async function(){r(!0),await d("MWPromptCreationUtils").createAuthoritiativeRollCall(g,f,l,c("RollCallPromptType").TEXT),s()})().catch(function(a){r(!1),c("FBLogger")("messenger_web").catching(a).mustfix("Creating prompt"),i({body:h._(/*BTDS*/"Could not create prompt")})}),c("MessengerDiscoverableBroadcastChatsClientEventsFalcoEvent").log(function(){return{action_name:1,event_name:304,source:17,surface:101,thread_id:(j||(j=d("I64"))).to_string(f)}})},b[3]=g,b[4]=s,b[5]=l,b[6]=i,b[7]=f,b[8]=a):a=b[8];a=a;var t;b[9]===Symbol.for("react.memo_cache_sentinel")?(t=function(a){p(a.toString())},b[9]=t):t=b[9];t=t;var u=o,v;b[10]!==f?(v={onImpressionStart:function(){c("MessengerDiscoverableBroadcastChatsClientEventsFalcoEvent").log(function(){return{action_name:2,event_name:301,source:156,surface:7,thread_id:(j||(j=d("I64"))).to_string(f)}})}},b[10]=f,b[11]=v):v=b[11];v=c("useSinglePartialViewImpression")(v);var w;b[12]!==q||b[13]!==l?(w=q||l.trim()==="",b[12]=q,b[13]=l,b[14]=w):w=b[14];b[15]===Symbol.for("react.memo_cache_sentinel")?(q=h._(/*BTDS*/"Send"),b[15]=q):q=b[15];b[16]!==a||b[17]!==w?(q={disabled:w,label:q,onPress:a},b[16]=a,b[17]=w,b[18]=q):q=b[18];b[19]===Symbol.for("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"Cancel"),b[19]=a):a=b[19];b[20]!==s?(w={label:a,onPress:s},b[20]=s,b[21]=w):w=b[21];b[22]!==q||b[23]!==w?(a=m.jsx(c("MWXDialogFooter.react"),{callToActionGroupDirection:"backward",primaryCallToAction:q,secondaryCallToAction:w}),b[22]=q,b[23]=w,b[24]=a):a=b[24];b[25]===Symbol.for("react.memo_cache_sentinel")?(q=h._(/*BTDS*/"New prompt"),b[25]=q):q=b[25];b[26]!==s?(w=m.jsx(c("MWXDialogHeader.react"),{onClose:s,title:q,withCloseButton:!0}),b[26]=s,b[27]=w):w=b[27];b[28]===Symbol.for("react.memo_cache_sentinel")?(q={className:"x6s0dn4 x9f619 x78zum5 xdt5ytf"},b[28]=q):q=b[28];var x;b[29]===Symbol.for("react.memo_cache_sentinel")?(x={className:"x1y1aw1k x1n2onr6"},b[29]=x):x=b[29];var y;b[30]===Symbol.for("react.memo_cache_sentinel")?(y=function(a){p(a.target.value)},b[30]=y):y=b[30];b[31]!==l?(x=m.jsx("div",babelHelpers.extends({},x,{children:m.jsx(c("MWChatPromptFlyoutFrontCard.react"),{maxLength:75,onChange:y,showFacepile:!1,value:l})})),b[31]=l,b[32]=x):x=b[32];b[33]===Symbol.for("react.memo_cache_sentinel")?(y=m.jsx(c("MWChatPromptFlyoutSuggestions.react"),{onPressSuggestion:t}),t={className:"xyamay9 x2b8uid"},b[33]=y,b[34]=t):(y=b[33],t=b[34]);b[35]===Symbol.for("react.memo_cache_sentinel")?(t=m.jsx("div",babelHelpers.extends({},t,{children:m.jsx(c("MWXText.react"),{type:"meta4",children:h._(/*BTDS*/"Members can respond with text for 24 hours.")})})),b[35]=t):t=b[35];b[36]!==v||b[37]!==x?(u=m.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:u,children:m.jsxs("div",babelHelpers.extends({},q,{ref:v,children:[x,y,t]}))}),b[36]=v,b[37]=x,b[38]=u):u=b[38];b[39]!==s||b[40]!==a||b[41]!==w||b[42]!==u?(q=m.jsx(c("MWXDialog.react"),{footer:a,header:w,onClose:s,size:"small",children:u}),b[39]=s,b[40]=a,b[41]=w,b[42]=u,b[43]=q):q=b[43];return q}function o(a){return a==="textarea"}g.default=a}),226);
__d("NewPollSubmitErrorFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5500");b=d("FalcoLoggerInternal").create("new_poll_submit_error",a);e=b;g["default"]=e}),98);
__d("NewPollSubmitSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5501");b=d("FalcoLoggerInternal").create("new_poll_submit_success",a);e=b;g["default"]=e}),98);
__d("OpenExistingPollFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5502");b=d("FalcoLoggerInternal").create("open_existing_poll",a);e=b;g["default"]=e}),98);
__d("ShowVotersFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5503");b=d("FalcoLoggerInternal").create("show_voters",a);e=b;g["default"]=e}),98);
__d("StartNewPollFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5504");b=d("FalcoLoggerInternal").create("start_new_poll",a);e=b;g["default"]=e}),98);
__d("SubmitExistingPollFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5505");b=d("FalcoLoggerInternal").create("submit_existing_poll",a);e=b;g["default"]=e}),98);
__d("SubmitNewPollFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5506");b=d("FalcoLoggerInternal").create("submit_new_poll",a);e=b;g["default"]=e}),98);
__d("MWGroupPollLogger",["ChangeVoteFalcoEvent","ExistingPollSubmitErrorFalcoEvent","ExistingPollSubmitSuccessFalcoEvent","NewPollSubmitErrorFalcoEvent","NewPollSubmitSuccessFalcoEvent","OpenExistingPollFalcoEvent","ShowVotersFalcoEvent","StartNewPollFalcoEvent","SubmitExistingPollFalcoEvent","SubmitNewPollFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a){case"start_new_poll":c("StartNewPollFalcoEvent").log(function(){return b});break;case"submit_new_poll":c("SubmitNewPollFalcoEvent").log(function(){return b});break;case"open_existing_poll":c("OpenExistingPollFalcoEvent").log(function(){return b});break;case"submit_existing_poll":c("SubmitExistingPollFalcoEvent").log(function(){return b});break;case"change_vote":c("ChangeVoteFalcoEvent").log(function(){return b});break;case"show_voters":c("ShowVotersFalcoEvent").log(function(){return b});break;case"existing_poll_submit_error":c("ExistingPollSubmitErrorFalcoEvent").log(function(){return b});break;case"existing_poll_submit_success":c("ExistingPollSubmitSuccessFalcoEvent").log(function(){return b});break;case"new_poll_submit_error":c("NewPollSubmitErrorFalcoEvent").log(function(){return b});break;case"new_poll_submit_success":c("NewPollSubmitSuccessFalcoEvent").log(function(){return b});break}}g.log=a}),98);
__d("MWOpenMediaManagerUtils",["fbt","I64","LSFactory","LSGenerateTraceId","LSIntEnum","LSMarkSubJobCompletedV2StoredProcedure","MWConsole","MWPComposerMediaUploadUtil","MWPOpenComposerUtils","ReQL","cr:6057","emptyFunction","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function a(a){b("cr:6057").preload();if(c("gkx")("3918"))return Promise.all(a.map(function(a){var b=a[0];a=a[1];if(b.type==="application/zip")return Promise.reject("invalid file type");b={file:b,offlineAttachmentId:a};return Promise.resolve(b)}));else return Promise.resolve(a.map(function(a){var b=a[0];a=a[1];return{file:b,offlineAttachmentId:a}}))}function e(a,b,e,g,j,l,m,n,o,p,q){j===void 0&&(j=c("emptyFunction"));l===void 0&&(l=c("emptyFunction"));m===void 0&&(m=c("emptyFunction"));var r=function(b,e){e=e.event;if(!e.lengthComputable)return;var g=e.loaded/e.total;c("promiseDone")(a.runInTransaction(function(a){return d("MWPOpenComposerUtils").updateMediaStaging(a,b,function(a){return babelHelpers.extends({},a,{progress:g})})},"readwrite",void 0,void 0,f.id+":95"))},s=function(j,n){if(n==null||n.length===0){var o="";if(!c("justknobx")._("899"))return;c("promiseDone")(a.runInTransaction(function(a){return d("MWPOpenComposerUtils").deleteMediaStaging(a,j).then(function(){return k(a,j)}).then(function(){var a=e.find(function(a){return a.offlineAttachmentId===j});a!=null&&a.file.type==="application/zip"?(g(h._(/*BTDS*/"_j[\"Invalid file format\",\"f90fb65f92ad8ac33f140b8be3c9eed1\",1]"),h._(/*BTDS*/"The file you have selected is not a valid format.")),o="null_fbid_invalid_file_format"):(g(h._(/*BTDS*/"Upload failed")),o="null_fbid_other")})},"readwrite",void 0,void 0,f.id+":118"),function(){return m(o,j)});return}c("promiseDone")(a.runInTransaction(function(a){var e=d("MWPOpenComposerUtils").updateMediaStaging(a,j,function(a){return babelHelpers.extends({},a,{fbid:(i||(i=d("I64"))).of_string(n),progress:1})}),f=a.media_send_jobs.get(j).then(function(e){if(e==null)return Promise.resolve();var f=c("LSFactory")(a),g=e.offlineThreadingId,h=e.offlineAttachmentId;return c("LSMarkSubJobCompletedV2StoredProcedure")(f,{fbid:(i||(i=d("I64"))).of_string(n),offlineAttachmentId:j}).then(function(){return d("MWPOpenComposerUtils").deleteMediaStaging(a,j)}).then(function(){return d("MWPOpenComposerUtils").updateAttachment(a,b,g,h,function(a){return babelHelpers.extends({},a,{attachmentFbid:n.toString()})})}).then(function(){return d("MWPOpenComposerUtils").resumeSendJob(f,g,c("LSGenerateTraceId")())})});return Promise.all([e,f])},"readwrite",void 0,void 0,f.id+":157"),function(){return l(j)})},t=function(b,e){c("promiseDone")(a.runInTransaction(function(a){return d("MWPOpenComposerUtils").updateMediaStaging(a,b,function(a){return babelHelpers.extends({},a,{hasError:!0})}).then(function(){return k(a,b)})},"readwrite",void 0,void 0,f.id+":210"),function(){var a;m((a=e.response.getErrorDescriptionString())!=null?a:"unknown_upload_failure",b)})};if(c("gkx")("3918")&&e.length===0)return Promise.resolve();var u=e.map(function(a){return a.offlineAttachmentId}),v=e.map(function(a){return a.file});return d("MWPComposerMediaUploadUtil").startUpload(j,r,s,t,void 0,v,u,n,o,void 0,p,q)}async function k(a,b){b=await a.media_send_jobs.get(b);if(b==null)return;b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages.index("optimistic")).getKeyRange(b.offlineThreadingId));if(b==null)return;b=babelHelpers.extends({},b,{sendStatusV2:(j||(j=d("LSIntEnum"))).ofNumber(4)});await a.messages.put(b)}g.preprocess=a;g.upload=e}),226);
__d("MWPReplyLogging",["I64","QPLUserFlow","deepEquals","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a){var b=Date.now()|0;i.set((h||(h=d("I64"))).to_string(a),b);return b}function k(a){var b=i.get((h||(h=d("I64"))).to_string(a));if(b==null)return j(a);else return b}function a(a,b,e){if(e){a?c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:k(b)}):c("QPLUserFlow").endSuccess(c("qpl")._(25298086,"3996"),{instanceKey:k(b)});i["delete"]((h||(h=d("I64"))).to_string(b));return}}function b(a,b,d){if(a!=null){if(c("deepEquals")(a,b)){c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"same_message",{instanceKey:k(d)});return}if(!c("deepEquals")(a,b)){a=k(d);c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"switch_message",{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:a});c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4});return}}c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:j(d),timeoutInMs:6e4})}e={logClearReply:a,logSetReply:b};g["default"]=e}),98);
__d("MWPinnedMessagesDialogNUXFactoryRequireNUX.react",["nux:345"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return b("nux:345")==null?void 0:b("nux:345")("WEB_MSGR_PINNED_MESSAGES_NUX")};c=a;g["default"]=c}),98);
__d("useMAWToggleSecurePinMessage",["I64","LSFactory","LSOptimisticSetOrUnsetPinnedMessageStoredProcedure","LSPinnedMessageState","MWPBumpEntityKey","MessengerWebUXLogger","ReQL","ServerTime","react","useAsyncReStore","useMWPIsMessagePinned"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useCallback;function a(a,b){var e=c("useAsyncReStore")(),g=c("useMWPIsMessagePinned")(a),h=a.offlineThreadingId,k=a.threadKey,l=d("ServerTime").getMillis(),m=c("MessengerWebUXLogger").useInteractionLogger();a=async function(){var a=await e,j=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads,["threadType"]).getKeyRange(k));await a.runInTransaction(function(a){var e=g?c("LSPinnedMessageState").NOT_PINNED:c("LSPinnedMessageState").PINNED,f=g?"unpin_message":"pin_message",n=g?"unpin":"pin";b==="message_dot_menu"?m==null?void 0:m({eventName:f,threadKey:k,threadType:j==null?void 0:j.threadType}):n==="unpin"&&b==="pinned_message_list_dot_menu"&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw_pinned_messages","unpin");return c("LSOptimisticSetOrUnsetPinnedMessageStoredProcedure")(c("LSFactory")(a),{offlineThreadingId:h,state:(i||(i=d("I64"))).of_int32(e),threadKey:k,timestampMs:i.of_int32(l)})},"readwrite",void 0,void 0,f.id+":51")};return j(a,[e,g,k,l,h,b,m])}g.default=a}),98);
__d("useMWPinnedMessageLimitReached",["ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=50;function a(a){var b=d("react-compiler-runtime").c(12),e=(h||(h=c("useReStore")))(),g;b[0]!==e.tables.msg_pinned_messages_v2||b[1]!==a?(g=function(){return d("ReQL").fromTableAscending(e.tables.msg_pinned_messages_v2).getKeyRange(a)},b[0]=e.tables.msg_pinned_messages_v2,b[1]=a,b[2]=g):g=b[2];var j;b[3]!==e||b[4]!==a?(j=[e,a],b[3]=e,b[4]=a,b[5]=j):j=b[5];g=d("ReQLSuspense").useArray(g,j,f.id+":27").length;b[6]!==e.tables.client_web_pinned_messages||b[7]!==a?(j=function(){return d("ReQL").fromTableAscending(e.tables.client_web_pinned_messages).getKeyRange(a)},b[6]=e.tables.client_web_pinned_messages,b[7]=a,b[8]=j):j=b[8];var k;b[9]!==e||b[10]!==a?(k=[e,a],b[9]=e,b[10]=a,b[11]=k):k=b[11];b=d("ReQLSuspense").useArray(j,k,f.id+":35").length;return g>=i||b>=i}g["default"]=a}),98);
__d("useMWTogglePinMessage",["I64","LSFactory","LSOptimisticSetPinnedMessageStoredProcedure","LSPinnedMessageState","MWPActor.react","MWPBumpEntityKey","MessengerWebUXLogger","ReQL","ServerTime","promiseDone","react","requireDeferred","useAsyncReStore","useMWPIsMessagePinned"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useCallback,k=c("requireDeferred")("MWLogMessageAction").__setRef("useMWTogglePinMessage");function a(a,b){var e=c("useAsyncReStore")(),g=c("useMWPIsMessagePinned")(a),h=a.messageId,l=a.senderId,m=a.threadKey,n=d("ServerTime").getMillis(),o=d("MWPActor.react").useActor(),p=c("MessengerWebUXLogger").useInteractionLogger();a=async function(){var a=await e,j=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads,["threadType"]).getKeyRange(m));await a.runInTransaction(function(e){var f=g?c("LSPinnedMessageState").NOT_PINNED:c("LSPinnedMessageState").PINNED,q=g?"unpin_message":"pin_message",r=g?"unpin":"pin";b==="message_dot_menu"?(k.onReady(function(d){return c("promiseDone")(d.log(a,h,m,b,r,void 0,void 0,void 0,l,void 0,o))}),p==null?void 0:p({eventName:q,threadKey:m,threadType:j==null?void 0:j.threadType})):r==="unpin"&&b==="pinned_message_list_dot_menu"&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw_pinned_messages","unpin");return c("LSOptimisticSetPinnedMessageStoredProcedure")(c("LSFactory")(e),{messageId:h,pinnedTimestampMs:(i||(i=d("I64"))).of_int32(n),state:i.of_int32(f),threadKey:m})},"readwrite",void 0,void 0,f.id+":58")};return j(a,[o,e,g,m,n,b,h,l,p])}g.default=a}),98);
__d("MWPinMessageMenuItem.react",["fbt","JSResourceForInteraction","LSMessagingThreadTypeUtil","MWLSThread","MWPinnedMessagesDialogNUXFactoryRequireNUX.react","MWXMenuItem.react","promiseDone","react","useMAWToggleSecurePinMessage","useMWPIsMessagePinned","useMWPinnedMessageLimitReached","useMWTogglePinMessage","useMWXLazyDialog","useSharedNUX"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("JSResourceForInteraction")("MWPinnedMessageLimitReachedDialog.react").__setRef("MWPinMessageMenuItem.react");function a(a){var b=a.message,e=a.onClick,f=a.onPinCompleted,g=h._(/*BTDS*/"Pin"),i=h._(/*BTDS*/"Unpin"),l=c("useMWPIsMessagePinned")(b),m=c("MWPinnedMessagesDialogNUXFactoryRequireNUX.react")();a=c("useMWXLazyDialog")(k);var n=a[0];a=d("MWLSThread").useThread(b.threadKey);a=a!=null&&d("LSMessagingThreadTypeUtil").isArmadilloSecure(a==null?void 0:a.threadType);var o=c("useMWTogglePinMessage")(b,"message_dot_menu"),p=c("useMAWToggleSecurePinMessage")(b,"message_dot_menu"),q=a?p:o,r=c("useMWPinnedMessageLimitReached")(b.threadKey);a=c("useSharedNUX")("WEB_MSGR_PINNED_MESSAGES_NUX");var s=a[0];p=function(a){return m!=null?m({children:a,dialogProps:{onClose:function(){},pinMessageHandler:function(){return c("promiseDone")(q(),f)}}}):j.jsx(j.Fragment,{children:a(function(){return c("promiseDone")(q(),f)})})};o=function(a){return j.jsx(c("MWXMenuItem.react"),{"aria-haspopup":!l&&s?"dialog":void 0,onClick:function(d){if(r&&!l)return n({threadKey:b.threadKey},function(){});!l?a():c("promiseDone")(q());e&&e(l)},primaryText:l?i:g})};return p(o)}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWPinnedMessagesDialogNUXFactory.react",["JSResourceForInteraction","MWInboxPersistedUIState","declareNUXRequireable","react","useMWXLazyDialog","useSharedNUX"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));b=h;var i=b.useCallback,j=b.useMemo,k=c("JSResourceForInteraction")("MWPinnedMessagesDialogNUX.react").__setRef("MWPinnedMessagesDialogNUXFactory.react");function a(a){function b(b){var e=b.children,f=b.dialogProps;b=c("useSharedNUX")(a);var g=b[0],h=b[1];b=d("MWInboxPersistedUIState").usePersistedUIState(void 0,"__MWSimpleNux."+a+"__");b[0];var l=b[1],m=i(function(){l(void 0),h.onDismiss()},[h,l]),n=j(function(){return{onDismiss:m,pinMessageHandler:f.pinMessageHandler}},[f,m]);b=c("useMWXLazyDialog")(k);var o=b[0];b=function(){return o(n)};return g?e(b):e(f.pinMessageHandler)}b.displayName=b.name+" [from "+f.id+"]";return b}e=c("declareNUXRequireable")(a);g["default"]=e}),98);
__d("MWV2ChatHotlikeSoundsConfig",["bx"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("bx")).getURL(a("273031"));d=a.getURL(a("273032"));e=a.getURL(a("273039"));f=a.getURL(a("273040"));c=a.getURL(a("273033"));var h=a.getURL(a("273034")),i=a.getURL(a("273035")),j=a.getURL(a("273036")),k=a.getURL(a("273037"));a=a.getURL(a("273038"));g.hotlikeGrowMp3Url=b;g.hotlikeGrowOggUrl=d;g.hotlikePopMp3Url=e;g.hotlikePopOggUrl=f;g.hotlikeOutgoingLargeMp3Url=c;g.hotlikeOutgoingLargeOggUrl=h;g.hotlikeOutgoingMediumMp3Url=i;g.hotlikeOutgoingMediumOggUrl=j;g.hotlikeOutgoingSmallMp3Url=k;g.hotlikeOutgoingSmallOggUrl=a}),98);
__d("MWV2ChatHotlikeSounds",["LSHotEmojiSize","MWChatSettingsQuery","MWV2ChatHotlikeSoundsConfig","Sound"],(function(a,b,c,d,e,f,g){"use strict";var h=[(f=d("MWV2ChatHotlikeSoundsConfig")).hotlikeGrowMp3Url,f.hotlikeGrowOggUrl],i=[f.hotlikePopMp3Url,f.hotlikePopOggUrl],j=[f.hotlikeOutgoingSmallMp3Url,f.hotlikeOutgoingSmallOggUrl],k=[f.hotlikeOutgoingMediumMp3Url,f.hotlikeOutgoingMediumOggUrl],l=[f.hotlikeOutgoingLargeMp3Url,f.hotlikeOutgoingLargeOggUrl],m=!1;function a(){m=!1,o(h)}function n(){m=!0,d("Sound").stop(h)}function b(){n(),o(i)}function e(a){n(),a===c("LSHotEmojiSize").SMALL?o(j):a===c("LSHotEmojiSize").MEDIUM?o(k):a===c("LSHotEmojiSize").LARGE&&o(l)}function o(a){d("MWChatSettingsQuery").areChatTabsSoundsOn(function(b){var c=a===h&&m;!c&&b!=null&&b===!0&&d("Sound").play(a,void 0,!1)})}g.start=a;g.pop=b;g.snap=e}),98);
__d("MWV2ForwardMenuItem.react",["fbt","I64","LSMessagingThreadTypeUtil","MWPActor.react","MWXMenuItem.react","MessengerWebUXLogger","WebUserFlowLoggingDataContextProvider.react","justknobx","react","react-compiler-runtime","useMWV2MessageForwardAction","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react")),l=i.useContext;function a(a){var b=d("react-compiler-runtime").c(14),e=a.message,f=a.threadType,g=c("MessengerWebUXLogger").useInteractionLogger();a=l(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext);var i=a.setLoggingData,m=d("MWPActor.react").useActor();b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a=c("justknobx")._("4219"),b[0]=a):a=b[0];a=a;var n;b[1]!==f?(n=d("LSMessagingThreadTypeUtil").isArmadilloSecure(f),b[1]=f,b[2]=n):n=b[2];n=n;var o=c("useMWV2MessageForwardAction")(n,e,f);b[3]!==m||b[4]!==o||b[5]!==g||b[6]!==e||b[7]!==i||b[8]!==f?(n=function(){var a=e.threadKey,b=(j||(j=d("I64"))).equal(e.senderId,m);b={extraData:{actor_type:b?"sender":"receiver",component:"MWV2ForwardMenuItem"},flowInstanceId:c("uuidv4")(),threadKey:a,threadType:f};g==null?void 0:g(babelHelpers["extends"]({},b,{eventName:"open_forward_message_dialog"}));i(b);o()},b[3]=m,b[4]=o,b[5]=g,b[6]=e,b[7]=i,b[8]=f,b[9]=n):n=b[9];n=n;var p;b[10]===Symbol["for"]("react.memo_cache_sentinel")?(p=h._(/*BTDS*/"Forward"),b[10]=p):p=b[10];p=p;b[11]!==o||b[12]!==n?(a=a?k.jsx(c("MWXMenuItem.react"),{"aria-label":p,onClick:n,primaryText:p,testid:void 0}):k.jsx(c("MWXMenuItem.react"),{"aria-label":p,loggingEvent:"open_forward_message_dialog",onClick:o,primaryText:p,testid:void 0}),b[11]=o,b[12]=n,b[13]=a):a=b[13];return a}g["default"]=a}),226);
__d("MWV2MessageReactionMenuItem.react",["fbt","MWChatReactionsActionContainer.react","MWV2MessageRowActionsContext.react","MWXMenuItem.react","ODS","emptyFunction","react","useMWChatReactionsActionContainerProps.react","useMWV2ShouldDisableReactions.react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react"));b=i;var l=b.useCallback,m=b.useEffect;function a(a){var b=a.closeActionsMenu,e=a.message,f=a.onReactionsSendLogger,g=a.reactionsPopoverResource;a=a.threadType;var i=h._(/*BTDS*/"React"),n=c("useMWV2ShouldDisableReactions.react")(a,e.threadKey),o=d("MWV2MessageRowActionsContext.react").useMessageRowActionsContext(),p=o.openReactionsMenu,q=l(function(){p.current=c("emptyFunction");return},[p]);m(function(){return q},[q]);o=c("useMWChatReactionsActionContainerProps.react")(e,b,a,f,c("emptyFunction"),g);return n?null:k.jsx(c("MWChatReactionsActionContainer.react"),babelHelpers["extends"]({},o,{children:function(a,b,e,f,g,h){e=function(){b(),(j||(j=d("ODS"))).bumpEntityKey(3185,"mwchat_actions","reaction")};p.current=e;return k.jsx(c("MWXMenuItem.react"),{"aria-label":i,loggingEvent:"click_react_to_message",onClick:e,onHoverIn:f,onHoverOut:g,onPressIn:h,preventClosingMenuOnSelect:!0,primaryText:i,ref:a})}}))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWV2RemoveMenuItem.react",["fbt","I64","Int64Hooks","JSResourceForInteraction","LSDeleteMessageStoredProcedure","LSFactory","LSIntEnum","LSMessagingThreadTypeUtil","MWCMThreadTypes.react","MWMessageDeliveryStatus","MWPActor.react","MWV2LogMessageClick","MWV2OnlyGlobalRemoveMessageDialog.entrypoint","MWXMenuItem.react","MessengerWebUXLogger","WebUserFlowLoggingDataContextProvider.react","gkx","isDeliveryStatusErrorState","mwCMIsAnyCMThread","promiseDone","react","react-compiler-runtime","useGetMediaGroupInformation","useHandleRemoveLocalMessage","useIsSecureMessage","useMWXEntryPointDialog","useMWXLazyDialog","useReStore","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||(l=d("react"));b=l;var n=b.useContext,o=b.useRef,p=c("JSResourceForInteraction")("MWV2RemoveMessageDialog.react").__setRef("MWV2RemoveMenuItem.react");function a(a){var b=d("react-compiler-runtime").c(59),e=a.canRemoveMessageGlobally,g=a.canRemoveMessageLocally,l=a.learnMoreOnMessageRemove,q=a.message,r=a.onRemoveMessageLogger,s=a.threadType;a=a.title;var t=(i||(i=c("useReStore")))(),u=q.messageId,v=q.threadKey,w;b[0]!==s?(w={fallbackThreadType:s},b[0]=s,b[1]=w):w=b[1];w=c("useIsSecureMessage")(t,q,w);w=c("useGetMediaGroupInformation")(q,w);var x;b[2]!==q.sendStatusV2||b[3]!==s?(x=c("mwCMIsAnyCMThread")(s)&&(j||(j=d("I64"))).equal(q.sendStatusV2,(k||(k=d("LSIntEnum"))).ofNumber(4)),b[2]=q.sendStatusV2,b[3]=s,b[4]=x):x=b[4];var y=x,z;b[5]!==t||b[6]!==u||b[7]!==v?(x=function(){c("promiseDone")(t.runInTransaction(function(a){return c("LSDeleteMessageStoredProcedure")(c("LSFactory")(a),{messageId:u,threadKey:v})},"readwrite",void 0,void 0,f.id+":80"))},z=[t,v,u],b[5]=t,b[6]=u,b[7]=v,b[8]=x,b[9]=z):(x=b[8],z=b[9]);var A=d("Int64Hooks").useCallbackInt64(x,z);x=o(null);z=d("MWPActor.react").useActor();var B;b[10]!==z||b[11]!==q.senderId?(B=(j||(j=d("I64"))).equal(q.senderId,z),b[10]=z,b[11]=q.senderId,b[12]=B):B=b[12];var C=B;z=C&&e;b[13]!==l||b[14]!==q||b[15]!==a?(B={learnMoreOnMessageRemove:l,message:q,title:a},b[13]=l,b[14]=q,b[15]=a,b[16]=B):B=b[16];var D=B;b[17]!==e||b[18]!==g||b[19]!==l||b[20]!==q||b[21]!==r||b[22]!==s||b[23]!==a?(B={canRemoveMessageGlobally:e,canRemoveMessageLocally:g,learnMoreOnMessageRemove:l,message:q,removeLogger:r,threadType:s,title:a},b[17]=e,b[18]=g,b[19]=l,b[20]=q,b[21]=r,b[22]=s,b[23]=a,b[24]=B):B=b[24];var E=B,F=c("MessengerWebUXLogger").useInteractionLogger();e=n(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext);var G=e.setLoggingData;b[25]===Symbol["for"]("react.memo_cache_sentinel")?(g={},b[25]=g):g=b[25];l=c("useMWXEntryPointDialog")(c("MWV2OnlyGlobalRemoveMessageDialog.entrypoint"),g);var H=l[0];a=c("useMWXLazyDialog")(p);var I=a[0],J=c("useHandleRemoveLocalMessage")(s,q,r);b[26]!==E||b[27]!==D||b[28]!==C||b[29]!==q.isUnsent||b[30]!==q.sendStatusV2||b[31]!==J||b[32]!==I||b[33]!==H||b[34]!==s?(B=function(a){if(c("isDeliveryStatusErrorState")(d("MWMessageDeliveryStatus").getFromSendStatus(q.sendStatusV2))){J(a);return}d("MWCMThreadTypes.react").isJoinedCMThread(s)||d("LSMessagingThreadTypeUtil").isDiscoverableChannel(s)||C&&!c("gkx")("24140")&&!q.isUnsent||d("LSMessagingThreadTypeUtil").isCMSubthread(s)?H(D):I(E)},b[26]=E,b[27]=D,b[28]=C,b[29]=q.isUnsent,b[30]=q.sendStatusV2,b[31]=J,b[32]=I,b[33]=H,b[34]=s,b[35]=B):B=b[35];var K=B;b[36]!==t||b[37]!==A||b[38]!==y||b[39]!==C||b[40]!==F||b[41]!==q||b[42]!==K||b[43]!==G||b[44]!==v||b[45]!==s?(e=function(){var a={extraData:{actor_type:C?"sender":"receiver"},flowInstanceId:c("uuidv4")(),threadKey:v,threadType:s};F==null?void 0:F(babelHelpers["extends"]({},a,{eventName:"message_remove_attempt"}));G(a);d("MWV2LogMessageClick").log(t,q,45);return q.subscriptErrorMessage!=null&&y?A():K(a)},b[36]=t,b[37]=A,b[38]=y,b[39]=C,b[40]=F,b[41]=q,b[42]=K,b[43]=G,b[44]=v,b[45]=s,b[46]=e):e=b[46];g=e;b[47]!==z?(l=z?h._(/*BTDS*/"Unsend message"):h._(/*BTDS*/"Remove message"),b[47]=z,b[48]=l):l=b[48];b[49]!==z?(a=z?h._(/*BTDS*/"Unsend"):h._(/*BTDS*/"Remove"),b[49]=z,b[50]=a):a=b[50];b[51]!==C||b[52]!==w?(r=w!=null&&((w==null?void 0:w.hasMissingMessages)||(w==null?void 0:w.hasMissingMedia))?C?h._(/*BTDS*/"Images that failed to load won't be unsent"):h._(/*BTDS*/"Images that failed to load won't be removed"):void 0,b[51]=C,b[52]=w,b[53]=r):r=b[53];b[54]!==g||b[55]!==l||b[56]!==a||b[57]!==r?(B=m.jsx(c("MWXMenuItem.react"),{"aria-label":l,onClick:g,primaryText:a,ref:x,secondaryText:r,testid:void 0}),b[54]=g,b[55]=l,b[56]=a,b[57]=r,b[58]=B):B=b[58];return B}g["default"]=a}),226);
__d("MWV2ReplyMenuItem.react",["fbt","MWPReplyContext.react","MWXMenuItem.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;function a(a){var b=d("react-compiler-runtime").c(8),e=a.message;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"Reply"),b[0]=a):a=b[0];a=a;var f=k(d("MWPReplyContext.react").MWPReplyContext),g=f.setReply;b[1]!==e.messageId||b[2]!==e.offlineThreadingId||b[3]!==e.sendStatusV2||b[4]!==e.threadKey||b[5]!==e.timestampMs||b[6]!==g?(f=j.jsx(c("MWXMenuItem.react"),{"aria-label":a,onClick:function(){return g({messageId:e.messageId,offlineThreadingId:e.offlineThreadingId,sendStatusV2:e.sendStatusV2,threadKey:e.threadKey,timestampMs:e.timestampMs},e.threadKey)},primaryText:a,testid:void 0}),b[1]=e.messageId,b[2]=e.offlineThreadingId,b[3]=e.sendStatusV2,b[4]=e.threadKey,b[5]=e.timestampMs,b[6]=g,b[7]=f):f=b[7];return f}g["default"]=a}),226);
__d("useMWLSMessageReportingToken",["I64","Int64Hooks","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var c=d("react-compiler-runtime").c(4),e,f;c[0]!==a||c[1]!==b?(e=function(){return btoa("message_thread:"+(h||(h=d("I64"))).to_string(b)+":"+a)},f=[a,b],c[0]=a,c[1]=b,c[2]=e,c[3]=f):(e=c[2],f=c[3]);return d("Int64Hooks").useMemoInt64(e,f)}g["default"]=a}),98);
__d("useReStoreIfAvailable",["useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=c("useReStore")))()}g["default"]=a}),98);
__d("useMWV2ReportMessage.react",["fbt","I64","LSFactory","LSIntEnum","LSInternetConnectionState","LSReportMessageInCommunityChannelStoredProcedure","ReQL","promiseDone","react","react-compiler-runtime","useMWXConfirmationDialog","useMWXPushToast","useReStoreIfAvailable"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;(i||d("react")).useCallback;function a(a,b){var e=d("react-compiler-runtime").c(10),f=c("useReStoreIfAvailable")(),g=c("useMWXConfirmationDialog")(),i;e[0]!==a?(i=(j||(j=d("I64"))).isI64(a)?a:(j||(j=d("I64"))).of_string(a),e[0]=a,e[1]=i):i=e[1];var l=i,m=c("useMWXPushToast")();e[2]!==f||e[3]!==l||e[4]!==b||e[5]!==m?(a=function(){if(f==null)return;c("promiseDone")(async function(){await f.runInTransaction(function(a){return c("LSReportMessageInCommunityChannelStoredProcedure")(c("LSFactory")(a),{messageId:b,threadKey:l})},"readwrite");var a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.tables.connectivity_status));a!=null&&(j||(j=d("I64"))).equal(a.internetConnectionState,(k||(k=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").CONNECTED))&&m({body:h._(/*BTDS*/"You've reported a message to the group admins.")})}())},e[2]=f,e[3]=l,e[4]=b,e[5]=m,e[6]=a):a=e[6];var n=a;e[7]!==n||e[8]!==g?(i=function(){return g({body:h._(/*BTDS*/"If you report this message, it will be sent to group admins for review."),confirm:h._(/*BTDS*/"Report"),title:h._(/*BTDS*/"Report message to group admins?")},n)},e[7]=n,e[8]=g,e[9]=i):i=e[9];a=i;return a}g.default=a}),226);
__d("MWV2ReportMessageMenuItem.react",["fbt","CometFRX.entrypoint","MWXMenuItem.react","gkx","react","react-compiler-runtime","useMWLSMessageReportingToken","useMWV2ReportMessage.react","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(9),e=a.isSubthread;a=a.message;e=e===void 0?!1:e;var f=c("useMWLSMessageReportingToken")(a.messageId,a.threadKey);e=e?"messenger_community_messaging_subthread_view":"messenger_community_messaging_group_thread_details";var g;b[0]!==f||b[1]!==e?(g={entryPoint:"groups_report_long_press_to_admin",id:f,location:e},b[0]=f,b[1]=e,b[2]=g):g=b[2];f=c("useMWXEntryPointDialog")(c("CometFRX.entrypoint"),g);var i=f[0];e=c("useMWV2ReportMessage.react")(a.threadKey,a.messageId);b[3]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Report to group admins"),b[3]=g):g=b[3];f=g;a=c("gkx")("24042");b[4]!==e||b[5]!==i?(g=a?function(){return i({})}:e,b[4]=e,b[5]=i,b[6]=g):g=b[6];b[7]!==g?(a=j.jsx(c("MWXMenuItem.react"),{"aria-label":f,onClick:g,primaryText:f,testid:void 0}),b[7]=g,b[8]=a):a=b[8];return a}g["default"]=a}),226);
__d("MWV2ReportMessageToFBMenuItem.react",["CometFRX.entrypoint","MWXMenuItem.react","react","react-compiler-runtime","useMWLSMessageReportingToken","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.icon,f=a.isSubthread,g=a.menuItemLabel,h=a.messageId,j=a.onReportLogger;a=a.threadKey;f=f===void 0?!1:f;h=c("useMWLSMessageReportingToken")(h,a);a=f?"messenger_community_messaging_subthread_view":"messenger_community_messaging_group_thread_details";b[0]!==h||b[1]!==a?(f={entryPoint:"report_long_press",id:h,location:a},b[0]=h,b[1]=a,b[2]=f):f=b[2];h=f;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(a={},b[3]=a):a=b[3];var k=a;f=h;a=c("useMWXEntryPointDialog")(c("CometFRX.entrypoint"),f);var l=a[0];b[4]!==l?(h=function(){return l(k)},b[4]=l,b[5]=h):h=b[5];var m=h;b[6]!==j||b[7]!==m?(f=function(){j&&j(),m()},b[6]=j,b[7]=m,b[8]=f):f=b[8];b[9]!==e||b[10]!==g||b[11]!==f?(a=i.jsx(c("MWXMenuItem.react"),{"aria-label":g,icon:e,onClick:f,primaryText:g}),b[9]=e,b[10]=g,b[11]=f,b[12]=a):a=b[12];return a}g["default"]=a}),98);
__d("getIsMessageTimeBelowEditThreshold",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=d("I64"))).of_int32(15*60);function a(a,b){a=(h||(h=d("I64"))).div(a,h.of_int32(1e3));b=h.div(b,h.of_int32(1e3));a=h.sub(a,b);return h.lt(a,i)}g.MAX_EDIT_TIME_PERIOD_IN_SECONDS=i;g.getIsMessageTimeBelowEditThreshold=a}),98);
__d("useMWPCanUserEditMessage",["I64","LSAuthorityLevel","LSContactBitOffset","LSContactTypeExact","LSHotEmojiSize","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWThreadCutover","MWMessageDeliveryStatus","MWPActor.react","ReQL","ReQLSuspense","URLMatcher","getIsMessageTimeBelowEditThreshold","gkx","isDeliveryStatusErrorState","isMWBumpMessage","isStringNullOrEmpty","mwCMIsAnyCMThread","mwCMIsCMSubthread","react-compiler-runtime","useMWGetOtherUserContact","useMWIsContactRestricted","useReStore","useServerTime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=5;function a(a,b,e){var g,m,n=d("react-compiler-runtime").c(42),o=d("MWPActor.react").useActor(),p=(j||(j=c("useReStore")))(),q;n[0]!==p.tables.attachments||n[1]!==a.messageId||n[2]!==a.threadKey?(q=function(){return d("ReQL").fromTableAscending(p.tables.attachments).getKeyRange(a.threadKey,a.messageId)},n[0]=p.tables.attachments,n[1]=a.messageId,n[2]=a.threadKey,n[3]=q):q=n[3];var r;n[4]!==p||n[5]!==a.messageId||n[6]!==a.threadKey?(r=[p,a.messageId,a.threadKey],n[4]=p,n[5]=a.messageId,n[6]=a.threadKey,n[7]=r):r=n[7];q=d("ReQLSuspense").useFirst(q,r,f.id+":68");n[8]===Symbol["for"]("react.memo_cache_sentinel")?(r=["contactTypeExact"].concat(d("LSContactBitOffset").contactCapabilityFields),n[8]=r):r=n[8];r=c("useMWGetOtherUserContact")(a.threadKey,b.threadType,r);var s;n[9]!==r?(s=r!=null&&(h||(h=d("I64"))).equal(r.contactTypeExact,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactTypeExact").MESSENGER_KID)),n[9]=r,n[10]=s):s=n[10];s=s;r=c("useMWIsContactRestricted")(r);e=d("MAWThreadCutover").useIsCutoverOpenThread(e);var t=c("useServerTime")();if(c("isDeliveryStatusErrorState")(d("MWMessageDeliveryStatus").getFromSendStatus(a.sendStatusV2)))return!1;if(b==null)return!1;g=(h||(h=d("I64"))).to_int32((g=a.editCount)!=null?g:(h||(h=d("I64"))).zero)<k;var u;n[11]!==a.timestampMs||n[12]!==t?(u=d("getIsMessageTimeBelowEditThreshold").getIsMessageTimeBelowEditThreshold((h||(h=d("I64"))).of_float(t.getTime()),a.timestampMs),n[11]=a.timestampMs,n[12]=t,n[13]=u):u=n[13];t=u;n[14]!==o||n[15]!==a.senderId?(u=(h||(h=d("I64"))).equal(a.senderId,o),n[14]=o,n[15]=a.senderId,n[16]=u):u=n[16];o=u;u=(u=a.isForwarded)!=null?u:!1;var v=a.text!=null&&a.text!=="",w=a.text!=null&&c("URLMatcher").match(a.text)!=null;m=(m=a.hotEmojiSize)!=null?m:(h||(h=d("I64"))).zero;var x;n[17]!==m?(x=(h||(h=d("I64"))).equal(m,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE)),n[17]=m,n[18]=x):x=n[18];m=x;if(n[19]!==(q==null?void 0:q.hasXma)||n[20]!==a.mentionIds){x=((x=q==null?void 0:q.hasXma)!=null?x:!1)||!c("isStringNullOrEmpty")(a.mentionIds);n[19]=q==null?void 0:q.hasXma;n[20]=a.mentionIds;n[21]=x}else x=n[21];q=x;n[22]!==a.authorityLevel||n[23]!==a.isUnsent?(x=a.isUnsent===!1&&(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)),n[22]=a.authorityLevel,n[23]=a.isUnsent,n[24]=x):x=n[24];x=x;var y;n[25]!==a.replyType?(y=c("isMWBumpMessage")(a.replyType),n[25]=a.replyType,n[26]=y):y=n[26];y=y;var z;n[27]!==q||n[28]!==x||n[29]!==g||n[30]!==t||n[31]!==y||n[32]!==e||n[33]!==u||n[34]!==s||n[35]!==r||n[36]!==o||n[37]!==w||n[38]!==v||n[39]!==m||n[40]!==b?(z=g&&t&&o&&v&&!w&&m&&!u&&!e&&!q&&x&&!r&&!y&&!s&&l(b),n[27]=q,n[28]=x,n[29]=g,n[30]=t,n[31]=y,n[32]=e,n[33]=u,n[34]=s,n[35]=r,n[36]=o,n[37]=w,n[38]=v,n[39]=m,n[40]=b,n[41]=z):z=n[41];return z}function l(a){var b=a.threadType;if(d("LSMessagingThreadTypeUtil").isWorkThread(a.threadSubtype))return!1;if(d("LSMessagingThreadTypeUtil").isArmadilloSecure(b))return!0;if(d("LSMessagingThreadTypeUtil").isJoinedDiscoverablePublicBroadcastChannel(b))return!0;if(c("mwCMIsAnyCMThread")(b)||c("mwCMIsCMSubthread")(b))return d("LSThreadBitOffset").has(194,a)&&c("gkx")("7675");return d("LSMessagingThreadTypeUtil").isOpenFnFThread(a)?!0:!1}g["default"]=a}),98);
__d("MWV2ContextualActionsMenu.react",["fbt","BusinessMessageNegativeFeedbackMenuItem.react","BusinessMessagePositiveFeedbackMenuItem.react","I64","LSIntEnum","LSMessagingThreadTypeUtil","MAWEditMenuItem.react","MWBroadcastChannelLoggingShapes","MWCMCreateSubthreadMenuItem.react","MWChatMessageBothOrientationFocusGroup.react","MWLogBroadcastChannelFalcoEvent","MWMessageRowActions.react","MWPThreadCapabilitiesContext","MWPinMessageMenuItem.react","MWV2ForwardMenuItem.react","MWV2MessageReactionMenuItem.react","MWV2RemoveMenuItem.react","MWV2ReplyMenuItem.react","MWV2ReportMessageMenuItem.react","MWV2ReportMessageToFBMenuItem.react","MWXMenu.react","MWXPopover.react","MessagingAttachmentType","MessagingThreadSubtype","WebUXLoggingSurfaceContextProvider","cr:1111","cr:1200","cr:14125","cr:17199","cr:2243","cr:4140","cr:5790","cr:6088","cr:6644","cr:6934","focusScopeQueries","gkx","react","react-compiler-runtime","useMWEntrypoint","useMWFalcoFeatureEventLogger","useMWPCanUserEditMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=i||d("react");function a(a){var e=d("react-compiler-runtime").c(112),f=a.attachment,g=a.canRemoveMessageGlobally,i=a.canRemoveMessageLocally,m=a.containerThreadKey,n=a.extraActions,o=a.isOutgoing,p=a.learnMoreDialogType,q=a.learnMoreOnMessageRemove,r=a.message,s=a.onClose,t=a.onRemoveMessageLogger,u=a.removeMessageDialogTitle,v=a.showBumpActionInContextualMenu,w=a.showBusinessMessageFeedbackOptionsInContextualMenu,x=a.showCreateSubthread,y=a.showFeedbackOptionsInContextualMenu,z=a.showForwardActionInContextualMenu,A=a.showLearnMoreInContextualMenu,B=a.showPinMessageActionInContextualMenu,C=a.showReactionInContextualMenu,D=a.showReplyActionInContextualMenu,E=a.showReportCommunityMessageToAdmin,F=a.showReportCommunityMessageToFacebook,G=a.showReportMessageToFacebook,H=a.showUnsendInContextualMenu,I=a.thread;a=d("MWPThreadCapabilitiesContext").useMWPThreadCapabilitiesContext();a=a.blurMediaEnabled;a=c("gkx")("24098")&&a;var J;e[0]!==f?(J=f!=null?(j||(j=d("I64"))).equal(f.attachmentType,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)):!1,e[0]=f,e[1]=J):J=e[1];J=J;var K;e[2]!==f?(K=f!=null?(j||(j=d("I64"))).equal(f.attachmentType,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)):!1,e[2]=f,e[3]=K):K=e[3];K=K;a=a&&(J||K);var L=c("useMWEntrypoint")();J=I==null?void 0:I.threadType;K=I==null?void 0:I.threadSubtype;var M=c("useMWFalcoFeatureEventLogger")(r.threadKey,J),N;e[4]===Symbol["for"]("react.memo_cache_sentinel")?(N=h._(/*BTDS*/"More actions"),e[4]=N):N=e[4];N=N;var O;e[5]!==K?(O=K!=null&&(j||(j=d("I64"))).equal(K,(k||(k=d("LSIntEnum"))).ofNumber(c("MessagingThreadSubtype").SUPPORT_MESSAGING_THREAD)),e[5]=K,e[6]=O):O=e[6];K=O;O=c("useMWPCanUserEditMessage")(r,I,m);e[7]!==I.threadType?(m=d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(I.threadType),e[7]=I.threadType,e[8]=m):m=e[8];var P=m;e[9]!==r||e[10]!==a||e[11]!==D?(m=D&&!a?l.jsx(c("MWV2ReplyMenuItem.react"),{message:r}):null,e[9]=r,e[10]=a,e[11]=D,e[12]=m):m=e[12];e[13]!==r||e[14]!==s||e[15]!==C||e[16]!==J?(a=C?l.jsx(c("MWV2MessageReactionMenuItem.react"),{closeActionsMenu:s,message:r,threadType:J}):null,e[13]=r,e[14]=s,e[15]=C,e[16]=J,e[17]=a):a=e[17];e[18]!==r||e[19]!==O||e[20]!==J?(D=O?l.jsx(c("MAWEditMenuItem.react"),{message:r,threadType:J}):null,e[18]=r,e[19]=O,e[20]=J,e[21]=D):D=e[21];e[22]!==g||e[23]!==i||e[24]!==q||e[25]!==r||e[26]!==t||e[27]!==u||e[28]!==H||e[29]!==J?(s=H?l.jsx(c("MWV2RemoveMenuItem.react"),{canRemoveMessageGlobally:g,canRemoveMessageLocally:i,learnMoreOnMessageRemove:q,message:r,onRemoveMessageLogger:t,threadType:J,title:u}):null,e[22]=g,e[23]=i,e[24]=q,e[25]=r,e[26]=t,e[27]=u,e[28]=H,e[29]=J,e[30]=s):s=e[30];e[31]!==r||e[32]!==z||e[33]!==J?(C=z?l.jsx(c("MWV2ForwardMenuItem.react"),{message:r,threadType:J}):null,e[31]=r,e[32]=z,e[33]=J,e[34]=C):C=e[34];e[35]!==r||e[36]!==v||e[37]!==I.threadKey?(O=v&&b("cr:14125")?l.jsx(b("cr:14125"),{message:r,threadKey:I.threadKey}):null,e[35]=r,e[36]=v,e[37]=I.threadKey,e[38]=O):O=e[38];e[39]!==p||e[40]!==A?(g=b("cr:6088")&&A&&p&&p===d("MWMessageRowActions.react").LearnMoreDialogType.AI_STICKERS?l.jsx(b("cr:6088"),{dialogType:p}):null,e[39]=p,e[40]=A,e[41]=g):g=e[41];e[42]!==r||e[43]!==x?(i=x?l.jsx(c("MWCMCreateSubthreadMenuItem.react"),{message:r}):null,e[42]=r,e[43]=x,e[44]=i):i=e[44];e[45]!==L||e[46]!==P||e[47]!==M||e[48]!==r||e[49]!==B||e[50]!==I.threadKey?(q=B?l.jsx(c("MWPinMessageMenuItem.react"),{message:r,onClick:function(a){if(P){a=a?d("MWBroadcastChannelLoggingShapes").UNPIN_MESSAGE:d("MWBroadcastChannelLoggingShapes").PIN_MESSAGE;d("MWLogBroadcastChannelFalcoEvent").logBroadcastChannelFalcoEvent(babelHelpers["extends"]({},a,{threadFbid:I.threadKey}))}},onPinCompleted:function(){M(L,"pin_message")}}):null,e[45]=L,e[46]=P,e[47]=M,e[48]=r,e[49]=B,e[50]=I.threadKey,e[51]=q):q=e[51];e[52]!==r||e[53]!==E?(t=E?l.jsx(c("MWV2ReportMessageMenuItem.react"),{message:r}):null,e[52]=r,e[53]=E,e[54]=t):t=e[54];e[55]!==r.messageId||e[56]!==r.threadKey||e[57]!==F||e[58]!==J?(u=F?l.jsx(c("MWV2ReportMessageToFBMenuItem.react"),{isSubthread:d("LSMessagingThreadTypeUtil").isCMSubthread(J),menuItemLabel:h._(/*BTDS*/"Report"),messageId:r.messageId,threadKey:r.threadKey}):null,e[55]=r.messageId,e[56]=r.threadKey,e[57]=F,e[58]=J,e[59]=u):u=e[59];e[60]!==r.messageId||e[61]!==r.threadKey||e[62]!==G||e[63]!==J?(H=b("cr:17199")&&G?l.jsx(b("cr:17199"),{messageId:r.messageId,threadKey:r.threadKey,threadType:J}):null,e[60]=r.messageId,e[61]=r.threadKey,e[62]=G,e[63]=J,e[64]=H):H=e[64];e[65]!==r?(z=b("cr:5790")?l.jsx(b("cr:5790"),{message:r}):null,e[65]=r,e[66]=z):z=e[66];e[67]!==P||e[68]!==o||e[69]!==r?(v=b("cr:6934")!=null&&P&&!o&&l.jsx(b("cr:6934"),{message:r}),e[67]=P,e[68]=o,e[69]=r,e[70]=v):v=e[70];e[71]!==o||e[72]!==K||e[73]!==r?(p=b("cr:2243")!=null&&!o&&K&&l.jsx(b("cr:2243"),{message:r}),e[71]=o,e[72]=K,e[73]=r,e[74]=p):p=e[74];e[75]!==r||e[76]!==y?(A=b("cr:1200")!=null&&y&&l.jsx(b("cr:1200"),{message:r}),e[75]=r,e[76]=y,e[77]=A):A=e[77];e[78]!==r||e[79]!==y?(x=b("cr:1111")!=null&&y&&l.jsx(b("cr:1111"),{message:r}),e[78]=r,e[79]=y,e[80]=x):x=e[80];e[81]!==r||e[82]!==w?(B=c("BusinessMessagePositiveFeedbackMenuItem.react")!=null&&w&&l.jsx(c("BusinessMessagePositiveFeedbackMenuItem.react"),{message:r}),e[81]=r,e[82]=w,e[83]=B):B=e[83];e[84]!==r||e[85]!==w?(E=c("BusinessMessageNegativeFeedbackMenuItem.react")!=null&&w&&l.jsx(c("BusinessMessageNegativeFeedbackMenuItem.react"),{message:r}),e[84]=r,e[85]=w,e[86]=E):E=e[86];e[87]!==f||e[88]!==r?(F=b("cr:4140")?l.jsxs(l.Fragment,{children:[b("cr:6644")&&l.jsx(b("cr:6644"),{}),l.jsx(b("cr:4140"),{attachment:f,message:r})]}):null,e[87]=f,e[88]=r,e[89]=F):F=e[89];e[90]!==n||e[91]!==C||e[92]!==O||e[93]!==g||e[94]!==i||e[95]!==q||e[96]!==t||e[97]!==u||e[98]!==H||e[99]!==z||e[100]!==v||e[101]!==p||e[102]!==A||e[103]!==x||e[104]!==B||e[105]!==E||e[106]!==F||e[107]!==m||e[108]!==a||e[109]!==D||e[110]!==s?(G=l.jsx(c("MWXPopover.react"),{role:"menu",withArrow:!0,children:l.jsx(d("MWChatMessageBothOrientationFocusGroup.react").keyCommands,{children:l.jsx(d("MWChatMessageBothOrientationFocusGroup.react").FocusGroup,{allowModifiers:!0,orientation:"both",preventScrollOnFocus:!1,tabScopeQuery:d("focusScopeQueries").tabbableScopeQuery,children:l.jsx(c("MWXMenu.react"),{"aria-label":N,size:"full",truncate:!0,children:l.jsxs(d("WebUXLoggingSurfaceContextProvider").WebUXLoggingSurfaceContextProvider,{value:"thread_view_message_options",children:[m,a,D,s,C,O,g,i,q,t,u,H,z,v,p,A,x,B,E,n,F]})})})})}),e[90]=n,e[91]=C,e[92]=O,e[93]=g,e[94]=i,e[95]=q,e[96]=t,e[97]=u,e[98]=H,e[99]=z,e[100]=v,e[101]=p,e[102]=A,e[103]=x,e[104]=B,e[105]=E,e[106]=F,e[107]=m,e[108]=a,e[109]=D,e[110]=s,e[111]=G):G=e[111];return G}g["default"]=a}),226);
__d("MessageThreadEventsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5034");b=d("FalcoLoggerInternal").create("message_thread_events",a);e=b;g["default"]=e}),98);
__d("MessengerDiscoverableChatClientEventsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1254");b=d("FalcoLoggerInternal").create("messenger_discoverable_chat_client_events",a);e=b;g["default"]=e}),98);
__d("MwbGroupBlockeeMessagesTapToRevealActionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5396");b=d("FalcoLoggerInternal").create("mwb_group_blockee_messages_tap_to_reveal_action",a);e=b;g["default"]=e}),98);
__d("MwbHighlyForwardedIndicatorImpressionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1323");b=d("FalcoLoggerInternal").create("mwb_highly_forwarded_indicator_impression",a);e=b;g["default"]=e}),98);
__d("getUpgradedCometEmojiComposerHandler",["CometLexicalEmojiNode","EmojiRenderer","FBEmojiResource","Lexical"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=a.registerNodeTransform(d("Lexical").TextNode,function(a){if(!a.isSimpleText())return;var e=a.getTextContent(),f=a,g=0;d("EmojiRenderer").parse(e).forEach(function(e){var h=e.emoji,i=e.length;e=e.offset;var j=h.join("");h=c("FBEmojiResource").fromCodepoints(h);if(h==null)return;h=h.getImageURL(b);if(h==null)return;var k=j;j=d("CometLexicalEmojiNode").$createEmojiNode(j,k,h,b);k=e-g;h=k+i;if(k===0){e=f.splitText(h);a=e[0];f=e[1]}else{i=f.splitText(k,h);a=i[1];f=i[2]}g+=h;a.replace(j);j})});return function(){e()}}g["default"]=a}),98);
__d("mwEBCheckIfEBKeysExistInDisk",["FBLogger","MAWCurrentUser","MAWIndexedDbMetadata","MWChatEncryptedBackupsQPLEvents","Promise","QPLUserFlow","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("gkx")("415");function a(a){return new(h||(h=b("Promise")))(function(b,e){if(!i||a==="true")return b(null);var f,g;try{var h=d("MAWCurrentUser").getID();g=d("MAWIndexedDbMetadata").ebLSDBName(h);f=indexedDB.open(g)}catch(a){h="[labyrinth_web] Failed to open DB due to: "+a;c("FBLogger")("labyrinth_web").warn(h);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_start_open_db"}});return e(null)}f.onerror=function(){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] Failed to open DB: "+g);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_open_db"}});return e(null)};f.onsuccess=function(a){var f="secure_encrypted_backups_client_state";a=a.target.result;if(!a.objectStoreNames.contains(f)){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] client state not present in IDB");c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"table_not_present"}});return e(null)}var g;try{a=a.transaction(f);a=a.objectStore(f);g=a.count()}catch(a){c("FBLogger")("labyrinth_web").warn("[labyrinth_web] Failed to get count of rows in table: "+f+" error: "+a);c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"failed_to_get_count_of_rows"}});return e(null)}g.onsuccess=function(a){a=a.target.result;a=a>0;c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:a.toString()}});b(null)};g.onerror=function(){c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{has_eb_keys_on_disk:"get_rows_failed"}});return e(null)}}})}g["default"]=a}),98);